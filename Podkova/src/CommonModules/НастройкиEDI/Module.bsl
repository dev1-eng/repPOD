
#Область ПрограммныйИнтерфейс

// Принимает значение Истина, если обмен с сервисом 1С:EDI используется.
// 
// Возвращаемое значение:
//  Булево - признак использования интеграции с 1C:EDI
//
Функция ИспользуетсяФункциональностьПодсистемы() Экспорт 
    
    Возврат ПолучитьФункциональнуюОпцию("ИспользоватьОбменEDI");
    
КонецФункции

// Предназначена для определения настроек учета в прикладной конфигурации
//
// Возвращаемое значение:
//  Структура - содержит поля:
//  * СоответствиеДокументовEDIПрикладнымОбъектам     - Соответствие - задает соответствие перечислению "Типы документов EDI" и типам соответствующих им прикладных документов.
//  * СоответствиеПрикладныхОбъектовДокументамEDI     - Соответствие - задает соответствие типов прикладных документов и перечисления "Типы документов EDI".
//  * ТипИнтеграции                                   - ПеречислениеСсылка.ТипыИнтеграцииEDI - какой вариант интеграции библиотеки выполнен, полное встраивание или используется только обработка.
//  * ИспользуетсяОтменаСтрокЗаказовКлиента           - Булево - признак того, что для заказов клиентов используется отмена строк заказов клиентов.
//  * ИспользуетсяОтменаСтрокЗаказовКлиента           - Булево - признак того, что в конфигурации используется причины отмены заказов клиента .
//  * ИспользуетсяОтменаСтрокЗаказовПоставщикам       - Булево - признак того, что используются причины отмены строк заказов поставщикам.
//  * ИспользуютсяПричиныОтменСтрокЗаказовПоставщикам - Булево - признак того, что в конфигурации используется причины отмены заказов поставщикам.
//
Функция НастройкиУчета() Экспорт
	
	НастройкиУчета = Новый Структура;
	НастройкиУчета.Вставить("СоответствиеДокументовEDIПрикладнымОбъектам",          СоответствиеДокументовEDIПрикладнымОбъектам());
	НастройкиУчета.Вставить("ТипИнтеграции",                                        Перечисления.ТипыИнтеграцииEDI.ИспользуетсяТолькоОбработка);
	НастройкиУчета.Вставить("ИспользуетсяОтменаСтрокЗаказовКлиента",                Ложь);
	НастройкиУчета.Вставить("ИспользуютсяПричиныОтменСтрокЗаказовКлиента",          Ложь);
	НастройкиУчета.Вставить("ИспользуетсяОтменаСтрокЗаказовПоставщикам",            Ложь);
	НастройкиУчета.Вставить("ИспользуютсяПричиныОтменСтрокЗаказовПоставщикам",      Ложь);
	НастройкиУчета.Вставить("ИспользуютсяСклады",                                   Ложь);
	НастройкиУчета.Вставить("ДоступноАвтоматическоеЗаполнениеСклада",               Ложь);
	НастройкиУчета.Вставить("ПредставлениеНастройкиАвтоматическогоЗаполненияСклада", "");
	НастройкиУчета.Вставить("ПояснениеМеханизмаАвтоматическогоЗаполненияСклада",     "");
	
	СервисEDIПереопределяемый.ПриОпределенииНастроекУчета(НастройкиУчета);
	
	НастройкиУчета.Вставить("СоответствиеПрикладныхОбъектовДокументамEDI", 
	                        СоответствиеПрикладныхОбъектовДокументамEDI(НастройкиУчета.СоответствиеДокументовEDIПрикладнымОбъектам));
	
	Возврат НастройкиУчета;
	
КонецФункции

#КонецОбласти

#Область СлужебныйПрограммныйИнтерфейс

Функция СоответствиеДокументовEDIПрикладнымОбъектам() Экспорт
	
	СоответствиеДокументовEDIПрикладнымОбъектам = Новый Соответствие;
	
	Для Инд =1 По Перечисления.ТипыДокументовEDI.Количество() Цикл
		
		ЗначениеПеречисления = Перечисления.ТипыДокументовEDI.Получить(Инд - 1);
		СоответствиеДокументовEDIПрикладнымОбъектам.Вставить(ЗначениеПеречисления, Неопределено);
		
	КонецЦикла;
	
	Возврат СоответствиеДокументовEDIПрикладнымОбъектам;
	
КонецФункции

Функция СоответствиеПрикладныхОбъектовДокументамEDI(СоответствиеДокументовEDIПрикладнымОбъектам) Экспорт
	
	СоответствиеПрикладныхОбъектовДокументамEDI = Новый Соответствие;
	
	Для Каждого ЭлементСоответствия Из СоответствиеДокументовEDIПрикладнымОбъектам Цикл
		
		 СоответствиеПрикладныхОбъектовДокументамEDI.Вставить(ЭлементСоответствия.Значение, ЭлементСоответствия.Ключ);
		
	КонецЦикла;
	
	Возврат СоответствиеПрикладныхОбъектовДокументамEDI;
	
КонецФункции

Функция ИспользуемыеТипыДокументов() Экспорт
	
	ИспользуемыеТипыДокументов = Новый Массив;
	
	НастройкиУчета = НастройкиУчета();
	
	Для Каждого ЭлементСоответствия Из НастройкиУчета.СоответствиеДокументовEDIПрикладнымОбъектам Цикл
		
		Если ЭлементСоответствия.Значение <> Неопределено Тогда
			 ИспользуемыеТипыДокументов.Добавить(ЭлементСоответствия.Ключ);
		КонецЕсли;
		
	КонецЦикла;
	
	Возврат ИспользуемыеТипыДокументов;
	
КонецФункции

Функция ТипОрганизация() Экспорт
	
	ТипОрганизация = Неопределено;
	
	Для Каждого ТипОрганизация Из Метаданные.ОпределяемыеТипы.ОрганизацияEDI.Тип.Типы() Цикл
		
		МетаданныеПрикладногоОбъекта = Метаданные.НайтиПоТипу(ТипОрганизация);
		Если МетаданныеПрикладногоОбъекта = Неопределено Тогда
			Продолжить;
		КонецЕсли;
		
		Если Не ОбщегоНазначения.ЭтоСсылка(ТипОрганизация) Тогда
			Продолжить;
		КонецЕсли;
		
		Возврат ТипОрганизация;
		
	КонецЦикла;
	
	Возврат ТипОрганизация;
	
КонецФункции

Функция ЕстьНастройкиОрганизаций() Экспорт 
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ ПЕРВЫЕ 1
	               |	НастройкиИнтеграцииEDI.Организация КАК Организация
	               |ИЗ
	               |	РегистрСведений.НастройкиИнтеграцииEDI КАК НастройкиИнтеграцииEDI";
	
	УстановитьПривилегированныйРежим(Истина);
	Возврат Не Запрос.Выполнить().Пустой();
	
КонецФункции

#КонецОбласти
