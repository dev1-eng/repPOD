#Область ПрограммныйИнтерфейс

#Область ЭтапыРасчета

// Этап "ЗаполнениеПартийВРегистреСебестоимостьТоваров"
//
// Параметры:
//	ПараметрыРасчета - Структура - параметры выполнения расчета
//			Подробнее см. пояснения в коде РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьПараметрыРасчетаПартий()
//
Процедура ЗаполнениеПартийВРегистреСебестоимостьТоваров(ПараметрыРасчета) Экспорт
	
	// Заполним служебные параметры этого этапа (в других этапах не требуется).
	РасчетСебестоимостиПрикладныеАлгоритмы.ВыполняетсяЗаполнениеПартийВРегистреСебестоимостьТоваров(ПараметрыРасчета, Истина);
	
	РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "ЗаполнениеПартийВРегистреСебестоимостьТоваров");
	
	// 1. Инициализация структуры данных для расчета
	//	- формирует структуру ПараметрыРасчета.РаспределениеПартий.
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьРаспределениеПартий(
		ПараметрыРасчета,
		ТаблицаДляРаспределенияПартийТоваров(ПараметрыРасчета),
		ОписаниеЦепочекПартийТоваров(ПараметрыРасчета),
		ОписаниеДвиженийПартийТоваров(ПараметрыРасчета),
		ОписаниеНезаписываемыхПартийТоваров(ПараметрыРасчета));
	
	// 2. Получение исходных данных для расчета
	// 	- формирует временную таблицу Данные.
	ПолучитьДанныеДляПартийТоваров(ПараметрыРасчета);
	
	// 3. Получение цепочек из исходных данных
	// 	- формирует временные таблицы Источники и Приемники.
	РасчетСебестоимостиПрикладныеАлгоритмы.ПостроитьЦепочкиДвижений(ПараметрыРасчета);
	
	// 4. Заполнение партий в цепочках
	// 	- заполняет таблицу ПараметрыРасчета.РаспределениеПартий.РасчетныеПартии.
	РасчетСебестоимостиПрикладныеАлгоритмы.РассчитатьПартииПоЦепочкам(ПараметрыРасчета);
	
	// 5. Помещение данных в таблицу-приемник и очистка вспомогательных временных таблиц.
	// 	- формирует движения по регистру СебестоимостьТоваров.
	РасчетСебестоимостиПрикладныеАлгоритмы.ЗавершитьРаспределениеПартий(ПараметрыРасчета);
	
	// Заполним служебные параметры этого этапа (в других этапах не требуется).
	РасчетСебестоимостиПрикладныеАлгоритмы.ВыполняетсяЗаполнениеПартийВРегистреСебестоимостьТоваров(ПараметрыРасчета, Ложь);
	
КонецПроцедуры

// Этап "ЗаполнениеПартийВРегистреВыручкаИСебестоимостьПродаж"
//
// Параметры:
//	ПараметрыРасчета - Структура - параметры выполнения расчета
//			Подробнее см. пояснения в коде РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьПараметрыРасчетаПартий()
//
Процедура ЗаполнениеПартийВРегистреВыручкаИСебестоимостьПродаж(ПараметрыРасчета) Экспорт
	
	// Заполним служебные параметры этого этапа (в других этапах не требуется).
	РасчетСебестоимостиПрикладныеАлгоритмы.ВыполняетсяЗаполнениеПартийВРегистреВыручкаИСебестоимостьПродаж(ПараметрыРасчета, Истина);
	
	РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "ЗаполнениеПартийВРегистреВыручкаИСебестоимостьПродаж");
	
	// 1. Инициализация структуры данных для расчета
	//	- формирует структуру ПараметрыРасчета.РаспределениеПартий.
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьРаспределениеПартий(
		ПараметрыРасчета,
		ТаблицаДляРаспределенияПартийВыручки(ПараметрыРасчета),
		ОписаниеЦепочекПартийВыручки(ПараметрыРасчета),
		ОписаниеДвиженийПартийВыручки(ПараметрыРасчета),
		ОписаниеНезаписываемыхПартийВыручки(ПараметрыРасчета));
	
	// 2. Получение исходных данных для расчета
	// 	- формирует временную таблицу Данные.
	ПолучитьДанныеДляПартийВыручки(ПараметрыРасчета);
	
	// 3. Получение цепочек из исходных данных
	// 	- формирует временные таблицы Источники и Приемники.
	РасчетСебестоимостиПрикладныеАлгоритмы.ПостроитьЦепочкиДвижений(ПараметрыРасчета);
	
	// 4. Заполнение партий в цепочках
	// 	- заполняет таблицу ПараметрыРасчета.РаспределениеПартий.РасчетныеПартии.
	РасчетСебестоимостиПрикладныеАлгоритмы.РассчитатьПартииПоЦепочкам(ПараметрыРасчета);
	
	// 5. Помещение данных в таблицу-приемник и очистка вспомогательных временных таблиц.
	// 	- формирует движения по регистру ВыручкаИСебестоимостьПродаж.
	РасчетСебестоимостиПрикладныеАлгоритмы.ЗавершитьРаспределениеПартий(ПараметрыРасчета);
	
	// Заполним служебные параметры этого этапа (в других этапах не требуется).
	РасчетСебестоимостиПрикладныеАлгоритмы.ВыполняетсяЗаполнениеПартийВРегистреВыручкаИСебестоимостьПродаж(ПараметрыРасчета, Ложь);
	
КонецПроцедуры

#КонецОбласти

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#Область ПроцедурыЭтапа_ЗаполнениеПартийВРегистреСебестоимостьТоваров

// Инициализация данных

Функция ПоляПотребленийПартииТоваров(ПараметрыРасчета)
	
	Возврат "АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета";
	
КонецФункции

Функция ОписаниеЦепочекПартийТоваров(ПараметрыРасчета) Экспорт
	
	// Важно: особенности использования типов записи в движениях, формируемых именно этим этапом.
	// Если на данном этапе сформирована запись с типом записи, используемым в макете регистра себестоимости,
	// (см. РасчетСебестоимостиПовтИсп.ЭтоТолькоРасчетныйТипЗаписи())
	// то считается, что это "первичная" запись, в которой просто дозаполнены поля партионной идентификации.
	//	- признак "РасчетПартий" для такой записи устанавливается в значение Ложь.
	// Если сформирована запись с любым другим типом записи, то считается что это "расчетная" запись.
	//	- признак "РасчетПартий" для такой записи устанавливается в значение Истина.
	// Также можно "принудительно" установить РасчетПартий в значение Истина - с помощью поля запроса ЭтоТочноРасчетноеДвижение.
	
	ОписаниеЦепочек = Новый Соответствие;
	ПоляПотреблений	= ПоляПотребленийПартииТоваров(ПараметрыРасчета);
	
	// Потребление <- (Остаток, Партия, Перемещение, ПеремещениеОбособленно, Сторно, ВозвратПрошлыхПериодов, ПеремещениеУпр,
	// ВозвратБезДокументаИсточника).
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Потребление, 		ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.Остаток,				ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.Партия,				ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.Перемещение, 		ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.Сторно, 				ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов, ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно, ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.ПеремещениеУпр,      ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.ВозвратБезДокументаИсточника, ПоляПотреблений);
		
	// ПотреблениеАвто <- (Остаток, Партия, Перемещение, ПеремещениеОбособленно, Сторно).
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ПотреблениеАвто, 		ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
		Перечисления.ТипыЗаписейПартий.Остаток,				ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
		Перечисления.ТипыЗаписейПартий.Партия,				ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
		Перечисления.ТипыЗаписейПартий.Перемещение, 		ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
		Перечисления.ТипыЗаписейПартий.Сторно, 				ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
		Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно, ПоляПотреблений);
		
	// КорректировкаПриобретения <- (Остаток, Партия, ВозвратПрошлыхПериодов)	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения, ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения,
		Перечисления.ТипыЗаписейПартий.Остаток, 				 ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения,
		Перечисления.ТипыЗаписейПартий.Партия, 				 	 ПоляПотреблений);	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения,
		Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов, 	 ПоляПотреблений);
		
	// ДопРасходыБезПартии <- (Импорт)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии,	ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии,
		Перечисления.ТипыЗаписейПартий.Импорт, 				ПоляПотреблений);
	
	// ДопРасходыСПартией <- (Импорт, Прошлое, Потребление)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией,	ПоляПотреблений + ", ДокументИсточник");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией,
		Перечисления.ТипыЗаписейПартий.Импорт, 				ПоляПотреблений + ", Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией,
		Перечисления.ТипыЗаписейПартий.Прошлое, 				ПоляПотреблений + ", Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией,
		Перечисления.ТипыЗаписейПартий.Потребление, 		ПоляПотреблений + ", Регистратор");
		
	// КорректировкаПриобретенияПрошлогоПериода <- (Прошлое)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода, ПоляПотреблений + ", ДокументИсточник");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода,
		Перечисления.ТипыЗаписейПартий.Прошлое, ПоляПотреблений + ", Регистратор");
	
	// Сторно <- (Потребление, ПотреблениеАвто)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Сторно, 				"ДокументИсточник, КорАналитикаУчетаНоменклатуры, КорВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Сторно,
		Перечисления.ТипыЗаписейПартий.Потребление, 		"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Сторно,
		Перечисления.ТипыЗаписейПартий.ПотреблениеАвто, 		"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов");
		
	// СторноВозвратНаДругойСклад <- (Потребление, ПотреблениеАвто)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.СторноВозвратНаДругойСклад,	"ДокументИсточник, КорАналитикаУчетаНоменклатуры, КорВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СторноВозвратНаДругойСклад,
		Перечисления.ТипыЗаписейПартий.Потребление, 				"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СторноВозвратНаДругойСклад,
		Перечисления.ТипыЗаписейПартий.ПотреблениеАвто, 			"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов");

	// ВозвратБезДокументаИсточника <- (Потребление)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ВозвратБезДокументаИсточника, ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ВозвратБезДокументаИсточника,
		Перечисления.ТипыЗаписейПартий.Потребление, 				 ПоляПотреблений);
		
	// ВозвратНаДругойСклад <- (СторноВозвратНаДругойСклад)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ВозвратНаДругойСклад,		"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ВозвратНаДругойСклад,
		Перечисления.ТипыЗаписейПартий.СторноВозвратНаДругойСклад,	"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета");
	
	// Перемещение <- (Потребление, ПотреблениеПроизводство, ПотреблениеАвто, ВозвратНаДругойСклад).
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Перемещение, 			"Регистратор, РазделУчета, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Перемещение,
		Перечисления.ТипыЗаписейПартий.Потребление, 			"Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Перемещение,
		Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство, "Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Перемещение,
		Перечисления.ТипыЗаписейПартий.ПотреблениеАвто, 		"Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Перемещение,
		Перечисления.ТипыЗаписейПартий.ВозвратНаДругойСклад, 	"Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов, Организация");
		
	// ПеремещениеОбособленно <- (Потребление, ПотреблениеПроизводство, ПотреблениеАвто, ВозвратНаДругойСклад).
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно, 	"Регистратор, РазделУчета, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно,
		Перечисления.ТипыЗаписейПартий.Потребление, 			"Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов, КорОрганизация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно,
		Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство, "Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов, КорОрганизация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно,
		Перечисления.ТипыЗаписейПартий.ПотреблениеАвто, 		"Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов, КорОрганизация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно,
		Перечисления.ТипыЗаписейПартий.ВозвратНаДругойСклад, 	"Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов, КорОрганизация");
		
	// ПеремещениеАвто <- (Потребление, ПотреблениеПроизводство, ПотреблениеАвто, Распределение).
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ПеремещениеАвто, 		"Регистратор, РазделУчета, АналитикаУчетаНоменклатуры, ВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеАвто,
		Перечисления.ТипыЗаписейПартий.Потребление, 			"Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеАвто,
		Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство, "Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеАвто,
		Перечисления.ТипыЗаписейПартий.ПотреблениеАвто, 		"Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеАвто,
		Перечисления.ТипыЗаписейПартий.Распределение, 			"Регистратор, КорРазделУчета, КорАналитикаУчетаНоменклатуры, КорВидЗапасов");
		
	// ПеремещениеУпр <- (Потребление)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ПеремещениеУпр, 	"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеУпр,
		Перечисления.ТипыЗаписейПартий.Потребление, 	"Регистратор, КорАналитикаУчетаНоменклатуры, КорВидЗапасов, КорОрганизация");
	
	// Распределение <- (Перемещение, ПеремещениеОбособленно, Остаток, Партия, ПеремещениеОбособленно, ВозвратПрошлыхПериодов)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Распределение, 		"АналитикаУчетаНоменклатуры, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Распределение,
		Перечисления.ТипыЗаписейПартий.Перемещение, 		"АналитикаУчетаНоменклатуры, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Распределение,
		Перечисления.ТипыЗаписейПартий.Остаток,				"АналитикаУчетаНоменклатуры, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Распределение,
		Перечисления.ТипыЗаписейПартий.Партия,				"АналитикаУчетаНоменклатуры, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Распределение,
		Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно, "АналитикаУчетаНоменклатуры, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Распределение,
		Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов, "АналитикаУчетаНоменклатуры, Организация");
		
	// СписанияНаВыпуск <- (Перемещение, ПеремещениеОбособленно, ПеремещениеАвто, Партия, Остаток, ОстатокНЗП, СторноСписанияНаВыпуск).
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск, 	"АналитикаУчетаНоменклатуры, Организация, ЗаказНаПроизводство");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск,
		Перечисления.ТипыЗаписейПартий.Перемещение, 		"АналитикаУчетаНоменклатуры, Организация, ЗаказНаПроизводство");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск,
		Перечисления.ТипыЗаписейПартий.ПеремещениеАвто, 	"АналитикаУчетаНоменклатуры, Организация, ЗаказНаПроизводство");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск,
		Перечисления.ТипыЗаписейПартий.Партия,				"АналитикаУчетаНоменклатуры, Организация, ЗаказНаПроизводство");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск,
		Перечисления.ТипыЗаписейПартий.ОстатокНЗП,			"АналитикаУчетаНоменклатуры, Организация, ЗаказНаПроизводство");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск,
		Перечисления.ТипыЗаписейПартий.Остаток,				"АналитикаУчетаНоменклатуры, Организация, ЗаказНаПроизводство");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск,
		Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно, "АналитикаУчетаНоменклатуры, Организация, ЗаказНаПроизводство");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск,
		Перечисления.ТипыЗаписейПартий.СторноСписанияНаВыпуск, "АналитикаУчетаНоменклатуры, Организация, ЗаказНаПроизводство");
		
	// Выпуск <- (СписанияНаВыпуск)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Выпуск, 				"Регистратор, КорАналитикаУчетаНоменклатуры, КорВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Выпуск,
		Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск, 	"Регистратор, КорАналитикаУчетаНоменклатуры, КорВидЗапасов");
		
	// ПотреблениеПроизводство <- (Партия, Перемещение, ПеремещениеОбособленно, Остаток)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство, "АналитикаУчетаНоменклатуры, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство,
		Перечисления.ТипыЗаписейПартий.Партия, 				"АналитикаУчетаНоменклатуры, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство,
		Перечисления.ТипыЗаписейПартий.Перемещение, 		"АналитикаУчетаНоменклатуры, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство,
		Перечисления.ТипыЗаписейПартий.Остаток,				"АналитикаУчетаНоменклатуры, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство,
		Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно, "АналитикаУчетаНоменклатуры, Организация");
		
	// СписаниеНаРасходы <- (Партия)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.СписаниеНаРасходы,	"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписаниеНаРасходы,
		Перечисления.ТипыЗаписейПартий.Партия, 				"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета");
		
	// ВозвратПрошлыхПериодов <- (Прошлое)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов, "ДокументИсточник, КорАналитикаУчетаНоменклатуры, КорВидЗапасов, Организация, РазделУчета");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов,
		Перечисления.ТипыЗаписейПартий.Прошлое, 				"ДокументИсточник, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета");
	
	// Дополнение <- (<без источников - для формирования записей по данным запроса>)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеДополнения(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Дополнение);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеДополнения(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ВключениеИсключениеНДСВСтоимости);
	
	Возврат ОписаниеЦепочек;
	
КонецФункции

Функция ОписаниеДвиженийПартийТоваров(ПараметрыРасчета)
	
	КолонкиТаблицыРаспределения = ТаблицаДляРаспределенияПартийТоваров(ПараметрыРасчета).Колонки;
	
	ОписаниеДвижений = РасчетСебестоимостиПрикладныеАлгоритмы.ОписаниеДвижений();
	ОписаниеДвижений.Вставить("Контекст", "ЗаполнениеПартийВРегистреСебестоимостьТоваров");
	ОписаниеДвижений.Вставить("ИмяРегистра", Метаданные.РегистрыНакопления.СебестоимостьТоваров.Имя);
	ОписаниеДвижений.Вставить("ПоляРасчета", РасчетСебестоимостиПрикладныеАлгоритмы.ПереченьПолей(КолонкиТаблицыРаспределения));
	ОписаниеДвижений.Вставить("КлючиСравнения",	ПоляПотребленийПартииТоваров(ПараметрыРасчета));
	ОписаниеДвижений.Вставить("Показатели", "Знаменатель, Количество, Стоимость, СтоимостьБезНДС, ДопРасходы, ДопРасходыБезНДС,
		|СтоимостьРегл, ПостояннаяРазница, ВременнаяРазница,
		|СтоимостьЗабалансовая, Трудозатраты, ПостатейныеПостоянныеСНДС, ПостатейныеПостоянныеБезНДС,
		|ПостатейныеПеременныеСНДС, ПостатейныеПеременныеБезНДС,
		|СтоимостьУпр, ДопРасходыУпр, ТрудозатратыУпр, ПостатейныеПостоянныеУпр, ПостатейныеПеременныеУпр,
		|СтоимостьЗабалансоваяРегл, ДопРасходыРегл, ТрудозатратыРегл,
		|ПостатейныеПостоянныеРегл, ПостатейныеПеременныеРегл");
	ОписаниеДвижений.Вставить("БазисПрихода", "Количество");
	ОписаниеДвижений.Вставить("БазисРасхода", "Количество");
	ОписаниеДвижений.Вставить("КлючРасхода", "ДокументИсточник");
	ОписаниеДвижений.Вставить("ПолеПорядка", "ПериодПоступления");
	ОписаниеДвижений.Вставить("ПоляСортировки", "Партия, ВидДеятельностиНДС, АналитикаФинансовогоУчета, ПриоритетнаяХозяйственнаяОперация");
	ОписаниеДвижений.Вставить("СортировкаПоУсловию", Истина);
	
	ОписаниеДвижений.Вставить("ЕстьСторно", Истина);
	
	Возврат ОписаниеДвижений;
	
КонецФункции

Функция ОписаниеНезаписываемыхПартийТоваров(ПараметрыРасчета)
	
	НезаписываемыеТипыЗаписей = Новый Соответствие;
	Для Каждого ТекЭлемент Из ПараметрыРасчета.НепересчитываемыеТипыЗаписей Цикл
		НезаписываемыеТипыЗаписей.Вставить(ТекЭлемент, Истина);
	КонецЦикла;
	
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.Импорт, Истина);
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.Прошлое, Истина);
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск, Истина);
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.СторноСписанияНаВыпуск, Истина);
	
	НезаписываемыеРазделы = Новый Соответствие;
	НезаписываемыеРазделы.Вставить(Перечисления.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка(), Истина);
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ОписаниеНезаписываемыхДанных(Истина, НезаписываемыеТипыЗаписей, НезаписываемыеРазделы);
	
КонецФункции

Функция ТаблицаДляРаспределенияПартийТоваров(ПараметрыРасчета)
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ТаблицаДляРаспределенияПартий(ПараметрыРасчета,
		ТекстОписаниеДанныхДляПартийТоваров());
	
КонецФункции

// Выборка данных

Процедура ПолучитьДанныеДляПартийТоваров(ПараметрыРасчета)
	
	ПараметрыНумерации = РасчетСебестоимостиПрикладныеАлгоритмы.СформироватьПараметрыНумерацииСтрокВременнойТаблицы(
		"АналитикаУчетаНоменклатуры", // разделитель
		"Знаменатель, Количество,
			|Стоимость, СтоимостьБезНДС, СтоимостьЗабалансовая, ДопРасходы, ДопРасходыБезНДС, Трудозатраты,
			|ПостатейныеПостоянныеСНДС, ПостатейныеПостоянныеБезНДС,
			|ПостатейныеПеременныеСНДС, ПостатейныеПеременныеБезНДС,
			|СтоимостьУпр, ДопРасходыУпр, ТрудозатратыУпр, ПостатейныеПостоянныеУпр, ПостатейныеПеременныеУпр,
			|СтоимостьРегл, СтоимостьЗабалансоваяРегл, ПостояннаяРазница, ВременнаяРазница,
			|ДопРасходыРегл, ТрудозатратыРегл, ПостатейныеПостоянныеРегл, ПостатейныеПеременныеРегл", // ресурсы
		"Номенклатура УБЫВ, Приоритет ВОЗР, Период, Организация, ВидЗапасов,
			|Партия, АналитикаУчетаПартий, Регистратор, КорПартия, ВидДвижения УБЫВ"); // порядок
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьДанныеЭтапаРасчета(
		ПараметрыРасчета,
		ТекстЗапросаДляПартийТоваров(ПараметрыРасчета),
		ПараметрыНумерации);
	
	СкорректироватьАналитикиУчетаПартийДляПартийТоваров(ПараметрыРасчета);
	
КонецПроцедуры

Процедура СкорректироватьАналитикиУчетаПартийДляПартийТоваров(ПараметрыРасчета)
	
	ТекстЗапроса = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Т.АналитикаУчетаПартий КАК АналитикаУчетаПартий
	|ИЗ
	|	Данные КАК Т
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ВЫБОР
	|		КОГДА Т.КорАналитикаУчетаНоменклатуры = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
	|			ТОГДА Т.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ Т.КорАналитикаУчетаНоменклатуры
	|	КОНЕЦ,
	|	Т.КорАналитикаУчетаПартий
	|ИЗ
	|	Данные КАК Т";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.СкорректироватьАналитикиУчетаПартийПриРасчете(ПараметрыРасчета, ТекстЗапроса);
	
КонецПроцедуры

// Тексты запросов

// ... общий

Функция ТекстЗапросаДляПартийТоваров(ПараметрыРасчета = Неопределено) Экспорт
	
	ТекстЗапроса = ""
		// подготовка временных таблиц
		+ ТекстИнициализацияПартийТоваров() // вт Декларации, ПрошлыеРеализации, ПродукцияДавальца, ЕстьДекларации, Выпуски
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете() + ТекстНеотфактурованныеПоставки() // вт НеотфактурованныеПоставки
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()
		// выборка данных
		+ ТекстОписаниеДанныхДляПартийТоваров() // вт Данные
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстНачальныеОстаткиНЗП()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстНачальныеОстаткиПартийТоваров()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстТекущиеОборотыПартийТоваров()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстТекущиеРеализацииТолькоРегл()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстНачальныеОстаткиЗакупокПоИмпорту()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстНачальныеОстаткиДляКорректировкиПриобретения()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстТекущиеЗакупкиПоИмпорту()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстТекущиеДопРасходыБезПартииКРаспределению() // использует Декларации
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстТекущиеДопРасходыСПартиейКРаспределению() // использует Декларации
		//++ Локализация
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстТекущиеДопРасходыСПартиейЗаявленияОВвозе()
		//-- Локализация
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстКорректировкиПриобретенияПрошлогоПериода()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстРеализацииПрошлыхМесяцев() // использует ПрошлыеРеализации 
		+ РасчетСебестоимостиЛокализация.ТекстЗапросаДляПартийТоваров()
		+ "";
	
	Возврат ТекстЗапроса;
	
КонецФункции

// ... описания данных

Функция ТекстОписаниеДанныхДляПартийТоваров() Экспорт
	Возврат 
		"ВЫБРАТЬ ПЕРВЫЕ 0 // 76 ПОЛЕЙ
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(80)) 					КАК ЗапросИсточник,
		|	Т.ТипЗаписи										КАК ТипЗаписи,
		|	ЛОЖЬ											КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ											КАК Сторно,
		|	0 												КАК Приоритет,
		|	0 												КАК Знаменатель,
		|	ЛОЖЬ 											КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)  КАК Номенклатура,
		|	Т.АналитикаУчетаПартий.НалогообложениеНДС 		КАК НалогообложениеПартии,
		|	Т.Период										КАК Период,
		|	Т.Период										КАК ПериодПоступления,
		|	Т.Регистратор									КАК Регистратор,
		|	Т.ВидДвижения 									КАК ВидДвижения,
		|
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.РазделУчета,
		|	Т.ВидЗапасов,
		|	Т.Организация,
		|	Т.Партия,
		|	Т.Партия КАК ЗаказНаПроизводство,
		|	Т.АналитикаУчетаПартий,
		|	Т.АналитикаФинансовогоУчета,
		|	Т.ВидДеятельностиНДС,
		|
		|	Т.Количество,
		|	Т.Стоимость,
		|	Т.СтоимостьБезНДС,
		|	Т.СтоимостьЗабалансовая,
		|	Т.СтоимостьУпр,
		|	Т.ДопРасходыУпр,
		|	Т.ПостатейныеПеременныеСНДС,
		|	Т.ПостатейныеПеременныеБезНДС,
		|	Т.ТрудозатратыУпр,
		|	Т.ПостатейныеПостоянныеУпр,
		|	Т.ПостатейныеПеременныеУпр,
		|	Т.ДопРасходы,
		|	Т.ДопРасходыБезНДС,
		|	Т.Трудозатраты,
		|	Т.ПостатейныеПостоянныеСНДС,
		|	Т.ПостатейныеПостоянныеБезНДС,
		|	Т.СтоимостьРегл,
		|	Т.СтоимостьЗабалансоваяРегл,
		|	Т.ПостояннаяРазница,
		|	Т.ВременнаяРазница,
		|	Т.ДопРасходыРегл,
		|	Т.ТрудозатратыРегл,
		|	Т.ПостатейныеПостоянныеРегл,
		|	Т.ПостатейныеПеременныеРегл,
		|
		|	Т.ХозяйственнаяОперация,
		|	Т.ХозяйственнаяОперация КАК ПриоритетнаяХозяйственнаяОперация,
		|	Т.КорАналитикаУчетаНоменклатуры,
		|	Т.КорРазделУчета,
		|	Т.КорВидЗапасов,
		|	Т.КорОрганизация,
		|	Т.КорСтоимость,
		|	Т.АналитикаУчетаПоПартнерам,
		|	Т.ЗаказКлиента,
		|	Т.Подразделение,
		|	Т.АналитикаРасходов,
		|	Т.СтатьяРасходовСписания,
		|	Т.СтатьяДоходов,
		|	Т.АналитикаДоходов,
		|	Т.ПериодПродажи,
		|	Т.СтатьяАктивовПассивов,
		|	Т.АналитикаАктивовПассивов,
		|	Т.ДокументДвижения,
		|	Т.ИдентификаторСтроки,
		|	Т.ГруппаПродукции,
		|	Т.КорПартия,
		|	Т.КорАналитикаУчетаПартий,
		|	Т.КорАналитикаФинансовогоУчета,
		|	Т.КорВидДеятельностиНДС,
		|	Т.КорВидДеятельностиНДС КАК ВидДеятельностиНДСДокумента,
		|	Т.НДСУпр,
		|	Т.НДСРегл,
		|	Т.СтатьяКалькуляции,
		|	Т.ДокументИсточник,
		|	Т.КорНаправлениеДеятельности,
		|	Т.КодСтроки
		|//ВоВременнуюТаблицу
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК Т
		|";
КонецФункции

// ... формирования временные таблиц

Функция ТекстИнициализацияПартийТоваров() // Декларации, ДекларацииПоПоступлениям, ПрошлыеРеализации, ПродукцияДавальца, ЕстьДекларации, Выпуски
	Возврат "
		|ВЫБРАТЬ
		|	ДД.Ссылка,
		|	(ВЫБОР
		|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
		|			ТОГДА Строки.АналитикаУчетаНоменклатуры
		|		ИНАЧЕ АналитикаБезНазначения.КлючАналитики
		|	КОНЕЦ) КАК АналитикаУчетаНоменклатуры,
		|	СтрокиРазделов.СтавкаНДС,
		|	Строки.ВидЗапасов КАК ВидЗапасов,
		|	МАКСИМУМ(Строки.ДокументПоступления) КАК ДокументПоступления,
		|	СУММА(Строки.Количество) КАК Количество
		|ПОМЕСТИТЬ Декларации
		|ИЗ
		|	Документ.ТаможеннаяДекларацияИмпорт КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ТаможеннаяДекларацияИмпорт.Товары КАК Строки
		|		ПО Строки.Ссылка = ДД.Ссылка
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ТаможеннаяДекларацияИмпорт.Разделы КАК СтрокиРазделов
		|		ПО СтрокиРазделов.Ссылка = ДД.Ссылка
		|		И СтрокиРазделов.НомерРаздела = Строки.НомерРаздела
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
		|		ПО Аналитика.Ссылка = Строки.АналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаБезНазначения
		|		ПО Аналитика.Номенклатура = АналитикаБезНазначения.Номенклатура
		|		И Аналитика.Характеристика = АналитикаБезНазначения.Характеристика
		|		И Аналитика.Серия = АналитикаБезНазначения.Серия
		|		И Аналитика.МестоХранения = АналитикаБезНазначения.МестоХранения
		|		И ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка) = АналитикаБезНазначения.Назначение
		|		И Аналитика.СтатьяКалькуляции = АналитикаБезНазначения.СтатьяКалькуляции
		|ГДЕ
		|	ДД.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|	И ДД.Организация В (&МассивОрганизаций)
		|	И ДД.Проведен
		|СГРУППИРОВАТЬ ПО
		|	ДД.Ссылка,
		|	(ВЫБОР
		|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
		|			ТОГДА Строки.АналитикаУчетаНоменклатуры
		|		ИНАЧЕ АналитикаБезНазначения.КлючАналитики
		|	КОНЕЦ),
		|	СтрокиРазделов.СтавкаНДС,
		|	Строки.ВидЗапасов
		|;
		|ВЫБРАТЬ
		|	ДД.Ссылка,
		|	(ВЫБОР
		|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
		|			ТОГДА Строки.АналитикаУчетаНоменклатуры
		|		ИНАЧЕ АналитикаБезНазначения.КлючАналитики
		|	КОНЕЦ) КАК АналитикаУчетаНоменклатуры,
		|	Строки.ДокументПоступления,
		|	СтрокиРазделов.СтавкаНДС,
		|	Строки.ВидЗапасов КАК ВидЗапасов,
		|	СУММА(Строки.Количество) КАК Количество
		|ПОМЕСТИТЬ ДекларацииПоПоступлениям
		|ИЗ
		|	Документ.ТаможеннаяДекларацияИмпорт КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ТаможеннаяДекларацияИмпорт.Товары КАК Строки
		|		ПО Строки.Ссылка = ДД.Ссылка
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ТаможеннаяДекларацияИмпорт.Разделы КАК СтрокиРазделов
		|		ПО СтрокиРазделов.Ссылка = ДД.Ссылка
		|		И СтрокиРазделов.НомерРаздела = Строки.НомерРаздела
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
		|		ПО Аналитика.Ссылка = Строки.АналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаБезНазначения
		|		ПО Аналитика.Номенклатура = АналитикаБезНазначения.Номенклатура
		|		И Аналитика.Характеристика = АналитикаБезНазначения.Характеристика
		|		И Аналитика.Серия = АналитикаБезНазначения.Серия
		|		И Аналитика.МестоХранения = АналитикаБезНазначения.МестоХранения
		|		И ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка) = АналитикаБезНазначения.Назначение
		|		И Аналитика.СтатьяКалькуляции = АналитикаБезНазначения.СтатьяКалькуляции
		|ГДЕ
		|	ДД.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|	И ДД.Организация В (&МассивОрганизаций)
		|	И ДД.Проведен
		|	И Строки.ДокументПоступления <> ЗНАЧЕНИЕ(Документ.ПриобретениеТоваровУслуг.ПустаяСсылка)
		|СГРУППИРОВАТЬ ПО
		|	ДД.Ссылка,
		|	(ВЫБОР
		|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
		|			ТОГДА Строки.АналитикаУчетаНоменклатуры
		|		ИНАЧЕ АналитикаБезНазначения.КлючАналитики
		|	КОНЕЦ),
		|	Строки.ДокументПоступления,
		|	СтрокиРазделов.СтавкаНДС,
		|	Строки.ВидЗапасов
		|;
		|////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДД.ДокументИсточник КАК ДокументРеализации,
		|	ДД.ДокументИсточник КАК ДокументИсточник,
		|	ДД.КорАналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов КАК ВидЗапасов
		|ПОМЕСТИТЬ ПрошлыеРеализации
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|ГДЕ
		|	ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов)
		|	И ДД.Количество > 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	КорректировкаРеализации.Ссылка КАК ДокументРеализации,
		|	КорректировкаРеализации.ДокументОснование КАК ДокументИсточник,
		|	ДД.КорАналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов КАК ВидЗапасов
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.КорректировкаРеализации КАК КорректировкаРеализации
		|		ПО КорректировкаРеализации.ДокументОснование = ДД.ДокументИсточник
		|			И НЕ КорректировкаРеализации.Ссылка = ДД.Регистратор
		|ГДЕ
		|	ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов)
		|	И ДД.Количество > 0
		|;
		|////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Остатки.Партия КАК Партия,
		|	НАЧАЛОПЕРИОДА(Импорт.Дата, МЕСЯЦ) КАК Дата
		|ПОМЕСТИТЬ ОстаткиИмпорт
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров.Остатки(&ГраницаКонецПредыдущегоПериода,
		|		Организация В (&МассивОрганизаций)
		|	) КАК Остатки
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК Импорт
		|		ПО Импорт.Ссылка = Остатки.Партия
		|		И Импорт.ХозяйственнаяОперация В (
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпорту),
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути))
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		|;
		|////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДД.Партия КАК Партия,
		|	МАКСИМУМ(ДД.Дата) КАК Дата
		|ПОМЕСТИТЬ ЕстьДекларации
		|ИЗ
		|	(ВЫБРАТЬ
		|		Партии.ДокументИсточник КАК Партия,
		|		МАКСИМУМ(Декларации.Дата) КАК Дата
		|	ИЗ
		|		Документ.ТаможеннаяДекларацияИмпорт КАК Декларации
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК Партии
		|			ПО Партии.Регистратор = Декларации.Ссылка
		|	ГДЕ
		|		Декларации.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|		И Декларации.Проведен
		|		И Партии.ТипЗаписи В (
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией))
		|	СГРУППИРОВАТЬ ПО
		|		Партии.ДокументИсточник
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		Остатки.Партия КАК Партия,
		|		МАКСИМУМ(Декларации.Дата) КАК Дата
		|	ИЗ
		|		ОстаткиИмпорт КАК Остатки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК Партии
		|			ПО Партии.Партия = Остатки.Партия
		|			И Партии.Период МЕЖДУ Остатки.Дата И &НачалоПериода
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ТаможеннаяДекларацияИмпорт КАК Декларации
		|			ПО Партии.Регистратор = Декларации.Ссылка
		|	ГДЕ
		|		Партии.ТипЗаписи В (
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией))
		|	СГРУППИРОВАТЬ ПО
		|		Остатки.Партия
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		Партии.ДокументПоступления КАК Партия,
		|		МАКСИМУМ(Декларации.Дата) КАК Дата
		|	ИЗ
		|		Документ.ТаможеннаяДекларацияИмпорт КАК Декларации
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ТаможеннаяДекларацияИмпорт.Товары КАК Партии
		|			ПО Партии.Ссылка = Декларации.Ссылка
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|			ПО Партии.Ссылка = СебестоимостьТоваров.Регистратор
		|			И Партии.ДокументПоступления = СебестоимостьТоваров.Партия
		|			И СебестоимостьТоваров.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией))
		|	ГДЕ
		|		Декларации.Дата МЕЖДУ &НачалоПериода И &КонецПериода
		|		И СебестоимостьТоваров.Регистратор ЕСТЬ NULL
		|		И НЕ Партии.ДокументПоступления = ЗНАЧЕНИЕ(Документ.ПриобретениеТоваровУслуг.ПустаяСсылка)
		|		И Декларации.Проведен
		|	СГРУППИРОВАТЬ ПО
		|		Партии.ДокументПоступления
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		Остатки.Партия КАК Партия,
		|		МАКСИМУМ(Декларации.Дата) КАК Дата
		|	ИЗ
		|		ОстаткиИмпорт КАК Остатки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ТаможеннаяДекларацияИмпорт.Товары КАК Партии
		|			ПО Партии.ДокументПоступления = Остатки.Партия
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ТаможеннаяДекларацияИмпорт КАК Декларации
		|			ПО Партии.Ссылка = Декларации.Ссылка
		|			И Декларации.Дата МЕЖДУ Остатки.Дата И &НачалоПериода
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|			ПО Партии.Ссылка = СебестоимостьТоваров.Регистратор
		|			И Партии.ДокументПоступления = СебестоимостьТоваров.Партия
		|			И СебестоимостьТоваров.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией))
		|	ГДЕ
		|		СебестоимостьТоваров.Регистратор ЕСТЬ NULL
		|		И НЕ Партии.ДокументПоступления = ЗНАЧЕНИЕ(Документ.ПриобретениеТоваровУслуг.ПустаяСсылка)
		|		И Декларации.Проведен
		|	СГРУППИРОВАТЬ ПО
		|		Остатки.Партия
		|	) КАК ДД
		|СГРУППИРОВАТЬ ПО
		|	ДД.Партия
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		//++ Устарело_Производство21
		//-- Устарело_Производство21
		|;
		|////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДД.ДокументИсточник КАК Ссылка,
		|	ВЫБОР КОГДА ДД.ХозяйственнаяОперация В
		|			(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки),
		|			 ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки))
		|		ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ФактуровкаПоставки
		|ПОМЕСТИТЬ ДокументыПоступленияИмпортаПрошлогоПериода
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РеестрДокументов КАК Реестр
		|		ПО Реестр.Ссылка = ДД.ДокументИсточник
		|		И Реестр.Организация = ДД.Организация
		|		И НЕ Реестр.ДополнительнаяЗапись
		|ГДЕ
		|	(ДД.ТипЗаписи В
		|		(ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
		|		 ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией))
		|	ИЛИ (ДД.ХозяйственнаяОперация В
		|			(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки),
		|			 ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки))
		|		И ДД.Регистратор ССЫЛКА Документ.КорректировкаПриобретения))
		|	И ДД.ДокументИсточник <> НЕОПРЕДЕЛЕНО
		|	И ЕСТЬNULL(Реестр.ДатаДокументаИБ, &КонецПредыдущегоПериода) < &НачалоПериода
		|";
КонецФункции
	
Функция ТекстНеотфактурованныеПоставки() // вт НеотфактурованныеПоставки
	Возврат "
		|ВЫБРАТЬ
		|	ДД.Регистратор КАК Партия,
		|	ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов КАК ВидЗапасов,
		|	ДД.РазделУчета КАК РазделУчета,
		|	МАКСИМУМ(ДД.КорАналитикаУчетаНоменклатуры) КАК КорАналитикаУчетаНоменклатуры,
		|	МАКСИМУМ(ДД.КорВидЗапасов) КАК КорВидЗапасов,
		|	МАКСИМУМ(ДД.КорРазделУчета) КАК КорРазделУчета,
		|	МАКСИМУМ(ПриходНаСклад.Партия) КАК КорПартия,
		|	МАКСИМУМ(ПриходНаСклад.АналитикаУчетаПартий) КАК КорАналитикаУчетаПартий
		|	
		|ПОМЕСТИТЬ НеотфактурованныеПоставки
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров.Остатки(&ГраницаКонецПредыдущегоПериода,
		|		Организация В (&МассивОрганизаций)
		|		И РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|	) КАК Остатки
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК ДД
		|		ПО ДД.Регистратор = Остатки.Партия
		|		И ДД.Период < &НачалоПериода
		|		И ДД.АналитикаУчетаНоменклатуры = Остатки.АналитикаУчетаНоменклатуры
		|		И ДД.ВидЗапасов = Остатки.ВидЗапасов
		|		И ДД.РазделУчета = Остатки.РазделУчета
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК ПриходНаСклад
		|		ПО ПриходНаСклад.Регистратор = Остатки.Партия
		|		И ПриходНаСклад.Период < &НачалоПериода
		|		И ПриходНаСклад.АналитикаУчетаНоменклатуры = ДД.КорАналитикаУчетаНоменклатуры
		|		И ПриходНаСклад.ВидЗапасов = ДД.КорВидЗапасов
		|		И ПриходНаСклад.РазделУчета = ДД.КорРазделУчета
		|СГРУППИРОВАТЬ ПО
		|	ДД.Регистратор,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.РазделУчета
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия,
		|	АналитикаУчетаНоменклатуры,
		|	ВидЗапасов,
		|	РазделУчета
		|";

КонецФункции

// ... выборки данных

Функция ТекстНачальныеОстаткиПартийТоваров() // использует ЕстьДекларации, НеотфактурованныеПоставки
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстНачальныеОстаткиПартийТоваров"" 			 КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Остаток) КАК ТипЗаписи,
		|	ЛОЖЬ											 КАК ЭтоТочноРасчетноеДвижение,
		|	(ВЫБОР
		|		КОГДА Т.КоличествоОстаток < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ)							 КАК Сторно,
		|	0 												 КАК Приоритет,
		|	0 												 КАК Знаменатель,
		|	ИСТИНА 											 КАК РасчетЗавершен,
		|	Т.АналитикаУчетаНоменклатуры.Номенклатура 		 КАК Номенклатура,
		|	Т.АналитикаУчетаПартий.НалогообложениеНДС 		 КАК НалогообложениеПартии,
		|
		|	(ВЫБОР
		|		КОГДА НЕ ЕстьДекларации.Дата ЕСТЬ NULL ТОГДА ЕстьДекларации.Дата
		|		КОГДА НЕ ПервичныйДокумент.Дата ЕСТЬ NULL ТОГДА ПервичныйДокумент.Дата
		// Для остатков с партиями период определяется датой партии.
		|		КОГДА НЕ Периодика.ДатаРегистратора ЕСТЬ NULL ТОГДА Периодика.ДатаРегистратора
		// При учете по ФИФО остатки без партий должны списываться в первую очередь.
		|		КОГДА Т.Организация В (&ОрганизацииСФИФОСкользящая) ТОГДА ДАТАВРЕМЯ(1,1,1)
		// При учете по средней остатки без партий должны списываться после остатков с партиями.
		|		ИНАЧЕ &КонецПредыдущегоПериода КОНЕЦ)        КАК Период,
		// Поле ПериодПоступления заполняется аналогично полю Период.
		|	(ВЫБОР
		|		КОГДА НЕ ЕстьДекларации.Дата ЕСТЬ NULL ТОГДА ЕстьДекларации.Дата
		|		КОГДА НЕ ПервичныйДокумент.Дата ЕСТЬ NULL ТОГДА ПервичныйДокумент.Дата
		|		КОГДА НЕ Периодика.ДатаРегистратора ЕСТЬ NULL ТОГДА Периодика.ДатаРегистратора
		|		КОГДА Т.Организация В (&ОрганизацииСФИФОСкользящая) ТОГДА ДАТАВРЕМЯ(1,1,1)
		|		ИНАЧЕ &КонецПредыдущегоПериода КОНЕЦ)        КАК ПериодПоступления,
		|	Т.Партия										 КАК Регистратор,
		|	НЕОПРЕДЕЛЕНО 			 	 					 КАК ВидДвижения,
		|	Т.АналитикаУчетаНоменклатуры 					 КАК АналитикаУчетаНоменклатуры,
		|	Т.РазделУчета				 					 КАК РазделУчета,
		|	Т.ВидЗапасов				 					 КАК ВидЗапасов,
		|	Т.Организация				 					 КАК Организация,
		|	Т.Партия					 					 КАК Партия,
		|	НЕОПРЕДЕЛЕНО									 КАК ЗаказНаПроизводство,
		|	Т.АналитикаУчетаПартий		 					 КАК АналитикаУчетаПартий,
		|	Т.АналитикаФинансовогоУчета  					 КАК АналитикаФинансовогоУчета,
		|	Т.ВидДеятельностиНДС		 					 КАК ВидДеятельностиНДС,
		|
		|	Т.КоличествоОстаток 							 КАК Количество,
		|	Т.СтоимостьОстаток 								 КАК Стоимость,
		|	Т.СтоимостьБезНДСОстаток 						 КАК СтоимостьБезНДС,
		|	Т.СтоимостьЗабалансоваяОстаток 					 КАК СтоимостьЗабалансовая,
		|	Т.СтоимостьУпрОстаток 							 КАК СтоимостьУпр,
		|	Т.ДопРасходыУпрОстаток 							 КАК ДопРасходыУпр,
		|	Т.ПостатейныеПеременныеСНДСОстаток 				 КАК ПостатейныеПеременныеСНДС,
		|	Т.ПостатейныеПеременныеБезНДСОстаток 			 КАК ПостатейныеПеременныеБезНДС,
		|	Т.ТрудозатратыУпрОстаток 						 КАК ТрудозатратыУпр,
		|	Т.ПостатейныеПостоянныеУпрОстаток 				 КАК ПостатейныеПостоянныеУпр,
		|	Т.ПостатейныеПеременныеУпрОстаток 				 КАК ПостатейныеПеременныеУпр,
		|	Т.ДопРасходыОстаток 						 	 КАК ДопРасходы,
		|	Т.ДопРасходыБезНДСОстаток 				 		 КАК ДопРасходыБезНДС,
		|	Т.ТрудозатратыОстаток 							 КАК Трудозатраты,
		|	Т.ПостатейныеПостоянныеСНДСОстаток 				 КАК ПостатейныеПостоянныеСНДС,
		|	Т.ПостатейныеПостоянныеБезНДСОстаток 			 КАК ПостатейныеПостоянныеБезНДС,
		|	Т.СтоимостьРеглОстаток 							 КАК СтоимостьРегл,
		|	Т.СтоимостьЗабалансоваяРеглОстаток 				 КАК СтоимостьЗабалансоваяРегл,
		|	Т.ПостояннаяРазницаОстаток 						 КАК ПостояннаяРазница,
		|	Т.ВременнаяРазницаОстаток 						 КАК ВременнаяРазница,
		|	Т.ДопРасходыРеглОстаток 						 КАК ДопРасходыРегл,
		|	Т.ТрудозатратыРеглОстаток 						 КАК ТрудозатратыРегл,
		|	Т.ПостатейныеПостоянныеРеглОстаток 				 КАК ПостатейныеПостоянныеРегл,
		|	Т.ПостатейныеПеременныеРеглОстаток 			     КАК ПостатейныеПеременныеРегл,
		|
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) 				КАК ХозяйственнаяОперация,
		|	(ВЫБОР
		|		КОГДА ЛОЖЬ ТОГДА НЕОПРЕДЕЛЕНО // для удобства расстановки тегов
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК ПриоритетнаяХозяйственнаяОперация,
		|	ЕСТЬNULL(НеотфактурованныеПоставки.КорАналитикаУчетаНоменклатуры,
		|		ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка))	КАК КорАналитикаУчетаНоменклатуры,
		|	ЕСТЬNULL(НеотфактурованныеПоставки.КорРазделУчета,
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)) КАК КорРазделУчета,
		|	ЕСТЬNULL(НеотфактурованныеПоставки.КорВидЗапасов,
		|		ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка))						КАК КорВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) 							КАК КорОрганизация,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК КорСтоимость,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПоПартнерам.ПустаяСсылка) 		КАК АналитикаУчетаПоПартнерам,
		|	НЕОПРЕДЕЛЕНО 															КАК ЗаказКлиента,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) 					КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаРасходов,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) 			КАК СтатьяРасходовСписания,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка) 			КАК СтатьяДоходов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаДоходов,
		|	ДАТАВРЕМЯ(1, 1, 1) 														КАК ПериодПродажи,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка) 	КАК СтатьяАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК ДокументДвижения,
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(36)) 											КАК ИдентификаторСтроки,
		|	ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка) КАК ГруппаПродукции,
		|	ЕСТЬNULL(НеотфактурованныеПоставки.КорПартия,
		|		НЕОПРЕДЕЛЕНО)														КАК КорПартия,
		|	ЕСТЬNULL(НеотфактурованныеПоставки.КорАналитикаУчетаПартий,
		|		ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка))		КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО 															КАК КорАналитикаФинансовогоУчета,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК КорВидДеятельностиНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК ВидДеятельностиНДСДокумента,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСУпр,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСРегл,
		|	НЕОПРЕДЕЛЕНО															КАК СтатьяКалькуляции,
		|	НЕОПРЕДЕЛЕНО															КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО															КАК КорНаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО															КАК КодСтроки
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров.Остатки(&ГраницаКонецПредыдущегоПериода,	Организация В (&МассивОрганизаций)) КАК Т
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК Импорт
		|		ПО Импорт.Ссылка = Т.Партия
		|		И Импорт.ХозяйственнаяОперация В (
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпорту),
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути))
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЕстьДекларации КАК ЕстьДекларации
		|		ПО ЕстьДекларации.Партия = Т.Партия
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПервичныйДокумент КАК ПервичныйДокумент
		|		ПО ПервичныйДокумент.Ссылка = Т.Партия
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК Периодика
		|		ПО Периодика.Организация = Т.Организация
		|		И Периодика.Документ = Т.Партия
		|	ЛЕВОЕ СОЕДИНЕНИЕ НеотфактурованныеПоставки КАК НеотфактурованныеПоставки
		|		ПО НеотфактурованныеПоставки.Партия = Т.Партия
		|		И НеотфактурованныеПоставки.АналитикаУчетаНоменклатуры = Т.АналитикаУчетаНоменклатуры
		|		И НеотфактурованныеПоставки.ВидЗапасов = Т.ВидЗапасов
		|		И НеотфактурованныеПоставки.РазделУчета = Т.РазделУчета
		|ГДЕ
		|	НЕ (НЕ Импорт.Ссылка ЕСТЬ NULL И ЕстьДекларации.Партия ЕСТЬ NULL)
		|	И НЕ (Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
		//++ Устарело_Производство21
		//-- Устарело_Производство21
		|		)
		|";
КонецФункции

Функция ТекстНачальныеОстаткиНЗП()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстНачальныеОстаткиНЗП"" 			 		 КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОстатокНЗП) КАК ТипЗаписи,
		|	ЛОЖЬ											 КАК ЭтоТочноРасчетноеДвижение,
		|	(ВЫБОР
		|		КОГДА Т.КоличествоОстаток < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ)							 КАК Сторно,
		|	0 												 КАК Приоритет,
		|	0 												 КАК Знаменатель,
		|	ИСТИНА 											 КАК РасчетЗавершен,
		|	Т.АналитикаУчетаНоменклатуры.Номенклатура 		 КАК Номенклатура,
		|	Т.АналитикаУчетаПартий.НалогообложениеНДС 		 КАК НалогообложениеПартии,
		|
		|	ЕСТЬNULL(Периодика.ДатаРегистратора,
		|			&КонецПредыдущегоПериода)				 КАК Период,
		|	ЕСТЬNULL(Периодика.ДатаРегистратора,
		|			&КонецПредыдущегоПериода)				 КАК ПериодПоступления,
		|	НЕОПРЕДЕЛЕНО									 КАК Регистратор,
		|	НЕОПРЕДЕЛЕНО 			 	 					 КАК ВидДвижения,
		|	Т.АналитикаУчетаНоменклатуры 					 КАК АналитикаУчетаНоменклатуры,
		|	Т.РазделУчета				 					 КАК РазделУчета,
		|	Т.ВидЗапасов				 					 КАК ВидЗапасов,
		|	Т.Организация				 					 КАК Организация,
		|	Т.Партия					 					 КАК Партия,
		|	Т.Партия 										 КАК ЗаказНаПроизводство,
		|	Т.АналитикаУчетаПартий		 					 КАК АналитикаУчетаПартий,
		|	Т.АналитикаФинансовогоУчета  					 КАК АналитикаФинансовогоУчета,
		|	Т.ВидДеятельностиНДС		 					 КАК ВидДеятельностиНДС,
		|
		|	Т.КоличествоОстаток 							 КАК Количество,
		|	Т.СтоимостьОстаток 								 КАК Стоимость,
		|	Т.СтоимостьБезНДСОстаток 						 КАК СтоимостьБезНДС,
		|	Т.СтоимостьЗабалансоваяОстаток 					 КАК СтоимостьЗабалансовая,
		|	Т.СтоимостьУпрОстаток 							 КАК СтоимостьУпр,
		|	Т.ДопРасходыУпрОстаток 							 КАК ДопРасходыУпр,
		|	Т.ПостатейныеПеременныеСНДСОстаток 				 КАК ПостатейныеПеременныеСНДС,
		|	Т.ПостатейныеПеременныеБезНДСОстаток 			 КАК ПостатейныеПеременныеБезНДС,
		|	Т.ТрудозатратыУпрОстаток 						 КАК ТрудозатратыУпр,
		|	Т.ПостатейныеПостоянныеУпрОстаток 				 КАК ПостатейныеПостоянныеУпр,
		|	Т.ПостатейныеПеременныеУпрОстаток 				 КАК ПостатейныеПеременныеУпр,
		|	Т.ДопРасходыОстаток 						 	 КАК ДопРасходы,
		|	Т.ДопРасходыБезНДСОстаток 				 		 КАК ДопРасходыБезНДС,
		|	Т.ТрудозатратыОстаток 							 КАК Трудозатраты,
		|	Т.ПостатейныеПостоянныеСНДСОстаток 				 КАК ПостатейныеПостоянныеСНДС,
		|	Т.ПостатейныеПостоянныеБезНДСОстаток 			 КАК ПостатейныеПостоянныеБезНДС,
		|	Т.СтоимостьРеглОстаток 							 КАК СтоимостьРегл,
		|	Т.СтоимостьЗабалансоваяРеглОстаток 				 КАК СтоимостьЗабалансоваяРегл,
		|	Т.ПостояннаяРазницаОстаток 						 КАК ПостояннаяРазница,
		|	Т.ВременнаяРазницаОстаток 						 КАК ВременнаяРазница,
		|	Т.ДопРасходыРеглОстаток 						 КАК ДопРасходыРегл,
		|	Т.ТрудозатратыРеглОстаток 						 КАК ТрудозатратыРегл,
		|	Т.ПостатейныеПостоянныеРеглОстаток 				 КАК ПостатейныеПостоянныеРегл,
		|	Т.ПостатейныеПеременныеРеглОстаток 			     КАК ПостатейныеПеременныеРегл,
		|
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) 				КАК ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО															КАК ПриоритетнаяХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)		КАК КорАналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) 	КАК КорРазделУчета,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)							КАК КорВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) 							КАК КорОрганизация,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК КорСтоимость,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПоПартнерам.ПустаяСсылка) 		КАК АналитикаУчетаПоПартнерам,
		|	НЕОПРЕДЕЛЕНО 															КАК ЗаказКлиента,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) 					КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаРасходов,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) 			КАК СтатьяРасходовСписания,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка) 			КАК СтатьяДоходов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаДоходов,
		|	ДАТАВРЕМЯ(1, 1, 1) 														КАК ПериодПродажи,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка) 	КАК СтатьяАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК ДокументДвижения,
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(36)) 											КАК ИдентификаторСтроки,
		|	ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка) КАК ГруппаПродукции,
		|	НЕОПРЕДЕЛЕНО 															КАК КорПартия,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) 			КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО 															КАК КорАналитикаФинансовогоУчета,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК КорВидДеятельностиНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК ВидДеятельностиНДСДокумента,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСУпр,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСРегл,
		|	НЕОПРЕДЕЛЕНО															КАК СтатьяКалькуляции,
		|	НЕОПРЕДЕЛЕНО															КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО															КАК КорНаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО															КАК КодСтроки
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров.Остатки(&ГраницаКонецПредыдущегоПериода,	Организация В (&МассивОрганизаций)) КАК Т
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК Периодика
		|		ПО Периодика.Организация = Т.Организация
		|		И Периодика.Документ = Т.Партия
		|ГДЕ
		|	Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
		|";
КонецФункции

Функция ТекстТекущиеОборотыПартийТоваров() // использует ЕстьДекларации, ВозвратныеОтходы
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстТекущиеОборотыПартийТоваров"" 						КАК ЗапросИсточник,
		|	Т.ТипЗаписи 												КАК ТипЗаписи,
		|	ЛОЖЬ														КАК ЭтоТочноРасчетноеДвижение,
		|	(ВЫБОР
		|		КОГДА Т.Количество < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ)										КАК Сторно,
		|	(ВЫБОР
		//++ Локализация
		|		КОГДА НЕ Т.СлужебноеВидДвиженияПриход И Т.Регистратор ССЫЛКА Документ.КорректировкаВидаДеятельностиНДС ТОГДА 15
		//-- Локализация
		|		КОГДА Т.СлужебноеВидДвиженияПриход И Т.ТипЗаписи В (&НепересчитываемыеТипыЗаписей) ТОГДА 10
		|		ИНАЧЕ 90 КОНЕЦ)											КАК Приоритет,
		|	0 															КАК Знаменатель,
		|	ВЫБОР КОГДА Т.ТипЗаписи В (&НепересчитываемыеТипыЗаписей)
		|		ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|		ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|		ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ 														КАК РасчетЗавершен,
		|	Аналитика.Номенклатура										КАК Номенклатура,
		|	ВЫБОР КОГДА (Т.ТипЗаписи В (&НепересчитываемыеТипыЗаписей) И Т.Организация В (&ОрганизацииСФИФОСкользящая))
		|		ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|		ТОГДА Т.АналитикаУчетаПартий.НалогообложениеНДС
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ 														КАК НалогообложениеПартии,
		|
		|	Т.Период КАК Период,
		|	ВЫБОР
		|		КОГДА Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
		|			ТОГДА &НачалоПериода
		|		КОГДА Т.ТипЗаписи В (&НепересчитываемыеТипыЗаписей)
		|		 И НЕ ПервичныйДокумент.Дата ЕСТЬ NULL
		|			ТОГДА ПервичныйДокумент.Дата
		|		КОГДА Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		 И Т.КорРазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
		|			ТОГДА КОНЕЦПЕРИОДА(Т.Период, ДЕНЬ)
		|		КОГДА Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства)
		|		 И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение)
		|		 И Т.КорРазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение)
		|			ТОГДА КОНЕЦПЕРИОДА(Т.Период, ДЕНЬ)
		|		ИНАЧЕ ЕСТЬNULL(ЕстьДекларации.Дата, Т.Период)
		|	КОНЕЦ КАК ПериодПоступления,
		|	Т.Регистратор,
		|	ВЫБОР КОГДА Т.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.РазделУчета,
		|	Т.ВидЗапасов,
		|	Т.Организация,
		|	ВЫБОР КОГДА (Т.ТипЗаписи В (&НепересчитываемыеТипыЗаписей)
		|				И Т.Организация В (&ОрганизацииСФИФОСкользящая))
		|		ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|		ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|		ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути)
		|			И Т.ТипЗаписи <> ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|			ТОГДА Т.Партия
		|		КОГДА ВозвратыТоваровПоставщику.ДокументПоступления ЕСТЬ НЕ NULL
		|				И Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА ВозвратыТоваровПоставщику.ДокументПоступления
		//++ Локализация
		|		КОГДА КорректировкаНДС.ДокументПоступления ЕСТЬ НЕ NULL
		|				И Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА КорректировкаНДС.ДокументПоступления
		//-- Локализация
		|		КОГДА ТИПЗНАЧЕНИЯ(ЕСТЬNULL(ПоступлениеТоваров.Распоряжение, НЕОПРЕДЕЛЕНО)) = ТИП(Документ.ПриобретениеТоваровУслуг)
		|		 И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 	ТОГДА ПоступлениеТоваров.Распоряжение
		|		КОГДА КорректировкаПриобретения.ДокументОснование ЕСТЬ НЕ NULL
		|				И Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА КорректировкаПриобретения.ДокументОснование
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ КАК Партия,
		|	(ВЫБОР
		|		КОГДА ЛОЖЬ ТОГДА НЕОПРЕДЕЛЕНО // для удобства расстановки тегов
		//++ Устарело_Производство21
		//-- Устарело_Производство21
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК ЗаказНаПроизводство,
		|	ВЫБОР КОГДА (Т.ТипЗаписи В (&НепересчитываемыеТипыЗаписей)
		|				И Т.Организация В (&ОрганизацииСФИФОСкользящая))
		|		ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|		ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
		|			И Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|		ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|		ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути)
		|		ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|		ТОГДА Т.АналитикаУчетаПартий
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ КАК АналитикаУчетаПартий,
		|	ВЫБОР
		|		КОГДА Т.ТипЗаписи В (&НепересчитываемыеТипыЗаписей)
		|			ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|			ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
		|			ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеОбособленно)
		|			ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
		|			ИЛИ Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|			ТОГДА Т.АналитикаФинансовогоУчета
		|		ИНАЧЕ Т.КорАналитикаФинансовогоУчета
		|	КОНЕЦ КАК АналитикаФинансовогоУчета,
		|	ВЫБОР
		|		КОГДА Т.ТипЗаписи В (&НепересчитываемыеТипыЗаписей)
		|		 ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|			ТОГДА Т.ВидДеятельностиНДС
		|		КОГДА НЕ Т.СлужебноеВидДвиженияПриход
		|		 И ЕСТЬNULL(Т.КорАналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС, ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка))
		|				<> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|		 И Т.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|			ТОГДА Т.КорАналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС
		//++ Локализация
		|		КОГДА НЕ КорректировкаНДС.НалогообложениеНДС ЕСТЬ NULL И Т.СлужебноеВидДвиженияПриход
		|			ТОГДА КорректировкаНДС.НовоеНалогообложениеНДС
		|		КОГДА НЕ КорректировкаНДС.НалогообложениеНДС ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА КорректировкаНДС.НалогообложениеНДС
		//-- Локализация
		|		КОГДА НЕ Перемещение.ПеремещениеПодДеятельность ЕСТЬ NULL
		|			ТОГДА
		|				ВЫБОР КОГДА Перемещение.ПеремещениеПодДеятельность <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|					ТОГДА Перемещение.ПеремещениеПодДеятельность
		|					ИНАЧЕ УчетныеПолитикиОрганизаций.НалогообложениеНДСПоУмолчанию
		|				КОНЕЦ
		|		КОГДА НЕ ВнутреннееПотребление.ПотреблениеДляДеятельности ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА ВЫБОР
		|				КОГДА НЕ СтатьяСписания.Ссылка ЕСТЬ NULL
		|				 И СтатьяСписания.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
		|				 И СтатьяСписания.ВидЦенностиНДС В (ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ОС), ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.НМА))
		|				 И СтатьяСписания.ВариантРаздельногоУчетаНДС = ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
		|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ВводОСВЭксплуатацию)
		|				КОГДА ВнутреннееПотребление.ПотреблениеДляДеятельности <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|					ТОГДА ВнутреннееПотребление.ПотреблениеДляДеятельности
		|					ИНАЧЕ УчетныеПолитикиОрганизаций.НалогообложениеНДСПоУмолчанию
		|				КОНЕЦ
		|		КОГДА НЕ Пересортица.ВидДеятельностиНДС ЕСТЬ NULL
		|			ТОГДА
		|				ВЫБОР КОГДА Пересортица.ВидДеятельностиНДС <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|					ТОГДА Пересортица.ВидДеятельностиНДС
		|					ИНАЧЕ УчетныеПолитикиОрганизаций.НалогообложениеНДСПоУмолчанию
		|				КОНЕЦ
		|		КОГДА НЕ Порча.ВидДеятельностиНДС ЕСТЬ NULL
		|			ТОГДА
		|				ВЫБОР КОГДА Порча.ВидДеятельностиНДС <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|					ТОГДА Порча.ВидДеятельностиНДС
		|					ИНАЧЕ УчетныеПолитикиОрганизаций.НалогообложениеНДСПоУмолчанию
		|				КОНЕЦ
		|		КОГДА Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноСписанияНаРасходы)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|		КОГДА НЕ Т.СлужебноеВидДвиженияПриход
		|		 И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
		|			ТОГДА НЕОПРЕДЕЛЕНО
		|		КОГДА Т.КорВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|		 ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов)
		|			ТОГДА УчетныеПолитикиОрганизаций.НалогообложениеНДСПоУмолчанию
		|		ИНАЧЕ Т.КорВидДеятельностиНДС
		|	КОНЕЦ КАК ВидДеятельностиНДС,
		|
		|	Т.Количество,
		|	Т.Стоимость,
		|	Т.СтоимостьБезНДС,
		|	Т.СтоимостьЗабалансовая,
		|	Т.СтоимостьУпр,
		|	Т.ДопРасходыУпр,
		|	Т.ПостатейныеПеременныеСНДС,
		|	Т.ПостатейныеПеременныеБезНДС,
		|	Т.ТрудозатратыУпр,
		|	Т.ПостатейныеПостоянныеУпр,
		|	Т.ПостатейныеПеременныеУпр,
		|	Т.ДопРасходы,
		|	Т.ДопРасходыБезНДС,
		|	Т.Трудозатраты,
		|	Т.ПостатейныеПостоянныеСНДС,
		|	Т.ПостатейныеПостоянныеБезНДС,
		|	Т.СтоимостьРегл,
		|	Т.СтоимостьЗабалансоваяРегл,
		|	Т.ПостояннаяРазница,
		|	Т.ВременнаяРазница,
		|	Т.ДопРасходыРегл,
		|	Т.ТрудозатратыРегл,
		|	Т.ПостатейныеПостоянныеРегл,
		|	Т.ПостатейныеПеременныеРегл,
		|
		|	Т.ХозяйственнаяОперация,
		|	(ВЫБОР
		|		КОГДА Т.АналитикаУчетаНоменклатуры.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
		|			ТОГДА НЕОПРЕДЕЛЕНО
		|		КОГДА Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		 И Т.КорРазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаМатериаловВПроизводство)
		|		КОГДА Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
		|		 И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаМатериаловВПроизводство)
		|		КОГДА Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		 И Т.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзКладовой))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства)
		|		КОГДА Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства)
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК ПриоритетнаяХозяйственнаяОперация,
		|	Т.КорАналитикаУчетаНоменклатуры,
		|	Т.КорРазделУчета,
		|	Т.КорВидЗапасов,
		|	Т.КорОрганизация,
		|	Т.КорСтоимость,
		|	Т.АналитикаУчетаПоПартнерам,
		|	Т.ЗаказКлиента,
		|	Т.Подразделение,
		|	Т.АналитикаРасходов,
		|	Т.СтатьяРасходовСписания,
		|	Т.СтатьяДоходов,
		|	Т.АналитикаДоходов,
		|	Т.ПериодПродажи,
		|	Т.СтатьяАктивовПассивов,
		|	Т.АналитикаАктивовПассивов,
		|	Т.ДокументДвижения,
		|	Т.ИдентификаторСтроки,
		|	Т.ГруппаПродукции,
		|	ВЫБОР КОГДА Т.КорРазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
		|			И Т.КорПартия <> Т.Регистратор
		|			И Т.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|			ТОГДА НЕОПРЕДЕЛЕНО
		|		КОГДА Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|		 И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|       	ТОГДА Т.Партия
		|		ИНАЧЕ Т.КорПартия
		|	КОНЕЦ КАК КорПартия,
		|	ВЫБОР КОГДА Т.КорРазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
		|			И Т.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|			И Т.КорПартия <> Т.Регистратор
		|			ТОГДА НЕОПРЕДЕЛЕНО
		|		КОГДА Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|		 И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И Т.Организация В (&ОрганизацииСФИФОСкользящая)
		|       	ТОГДА Т.АналитикаУчетаПартий
		|		ИНАЧЕ Т.КорАналитикаУчетаПартий
		|	КОНЕЦ КАК КорАналитикаУчетаПартий,
		|	ВЫБОР
		|		КОГДА ЛОЖЬ ТОГДА НЕОПРЕДЕЛЕНО // для удобства расстановки тегов
		|		ИНАЧЕ Т.КорАналитикаФинансовогоУчета
		|	КОНЕЦ КАК КорАналитикаФинансовогоУчета,
		|	ВЫБОР
		|		КОГДА НЕ Т.СлужебноеВидДвиженияПриход
		|		 И ЕСТЬNULL(Т.КорАналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС, ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка))
		|				<> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|				И Т.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|			ТОГДА Т.КорАналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС
		|		КОГДА НЕ Перемещение.ПеремещениеПодДеятельность ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|		 И Перемещение.ПеремещениеПодДеятельность <> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА Перемещение.ПеремещениеПодДеятельность
		|		КОГДА НЕ ВнутреннееПотребление.ПотреблениеДляДеятельности ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА ВЫБОР
		|				КОГДА НЕ СтатьяСписания.Ссылка ЕСТЬ NULL
		|				 И СтатьяСписания.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
		|				 И СтатьяСписания.ВидЦенностиНДС В (ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ОС), ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.НМА))
		|				 И СтатьяСписания.ВариантРаздельногоУчетаНДС = ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
		|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ВводОСВЭксплуатацию)
		|				КОГДА НЕ СтатьяСписания.Ссылка ЕСТЬ NULL
		|				 И СтатьяСписания.ВариантРаздельногоУчетаНДС = ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
		|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|				ИНАЧЕ ВнутреннееПотребление.ПотреблениеДляДеятельности КОНЕЦ
		|		КОГДА НЕ КорректировкаНазначения.Ссылка ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|		КОГДА НЕ Пересортица.ВидДеятельностиНДС ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА Пересортица.ВидДеятельностиНДС
		|		КОГДА НЕ Порча.ВидДеятельностиНДС ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА Порча.ВидДеятельностиНДС
		|		КОГДА Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноСписанияНаРасходы)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|		КОГДА НЕ Т.СлужебноеВидДвиженияПриход
		|		 И Т.КорВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА УчетныеПолитикиОрганизаций.НалогообложениеНДСПоУмолчанию
		|		ИНАЧЕ Т.КорВидДеятельностиНДС
		|	КОНЕЦ КАК КорВидДеятельностиНДС,
		|
		|	ВЫБОР
		|		КОГДА НЕ Т.СлужебноеВидДвиженияПриход
		|		 И ЕСТЬNULL(Т.КорАналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС, ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка))
		|				<> ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|				И Т.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|			ТОГДА Т.КорАналитикаУчетаНоменклатуры.Назначение.ВидДеятельностиНДС
		|		КОГДА НЕ Перемещение.ПеремещениеПодДеятельность ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА Перемещение.ПеремещениеПодДеятельность
		|		КОГДА НЕ ВнутреннееПотребление.ПотреблениеДляДеятельности ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА ВЫБОР
		|				КОГДА НЕ СтатьяСписания.Ссылка ЕСТЬ NULL
		|				 И СтатьяСписания.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
		|				 И СтатьяСписания.ВидЦенностиНДС В (ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ОС), ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.НМА))
		|				 И СтатьяСписания.ВариантРаздельногоУчетаНДС = ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
		|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ВводОСВЭксплуатацию)
		|				КОГДА НЕ СтатьяСписания.Ссылка ЕСТЬ NULL
		|				 И СтатьяСписания.ВариантРаздельногоУчетаНДС = ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.Распределение)
		|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|				ИНАЧЕ ВнутреннееПотребление.ПотреблениеДляДеятельности КОНЕЦ
		|		КОГДА НЕ КорректировкаНазначения.Ссылка ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|		КОГДА НЕ Пересортица.ВидДеятельностиНДС ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА Пересортица.ВидДеятельностиНДС
		|		КОГДА НЕ Порча.ВидДеятельностиНДС ЕСТЬ NULL И НЕ Т.СлужебноеВидДвиженияПриход
		|			ТОГДА Порча.ВидДеятельностиНДС
		|		КОГДА Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноСписанияНаРасходы)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|		ИНАЧЕ Т.КорВидДеятельностиНДС
		|	КОНЕЦ КАК ВидДеятельностиНДСДокумента,
		|	Т.НДСУпр,
		|	Т.НДСРегл,
		|	Т.СтатьяКалькуляции,
		|	ВЫБОР
		|		КОГДА Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|			ТОГДА Т.Регистратор
		|		КОГДА НЕ Т.ТипЗаписи В (
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Сторно),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноВозвратНаДругойСклад),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение))
		|		ТОГДА НЕОПРЕДЕЛЕНО
		|		ИНАЧЕ Т.ДокументИсточник
		|	КОНЕЦ КАК ДокументИсточник,
		|	Т.КорНаправлениеДеятельности,
		|	Т.КодСтроки
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
		|		ПО Аналитика.Ссылка = Т.АналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК КорАналитика
		|		ПО КорАналитика.Ссылка = Т.КорАналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК КорСклады
		|		ПО КорАналитика.МестоХранения = КорСклады.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК Импорт
		|		ПО Импорт.Ссылка = Т.Регистратор
		|		И Импорт.ХозяйственнаяОперация В (
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпорту),
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути))
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЕстьДекларации КАК ЕстьДекларации
		|		ПО ЕстьДекларации.Партия = Т.Регистратор
		//++ Локализация
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.КорректировкаВидаДеятельностиНДС КАК КорректировкаНДС
		|		ПО КорректировкаНДС.Ссылка = Т.Регистратор
		//-- Локализация
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПеремещениеТоваров КАК Перемещение
		|		ПО Перемещение.Ссылка = Т.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.КорректировкаНазначенияТоваров КАК КорректировкаНазначения
		|		ПО КорректировкаНазначения.Ссылка = Т.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВнутреннееПотреблениеТоваров КАК ВнутреннееПотребление
		|		ПО ВнутреннееПотребление.Ссылка = Т.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.КорректировкаПриобретения КАК КорректировкаПриобретения
		|		ПО КорректировкаПриобретения.Ссылка = Т.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПересортицаТоваров КАК Пересортица
		|		ПО Пересортица.Ссылка = Т.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПорчаТоваров КАК Порча
		|		ПО Порча.Ссылка = Т.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПоступлениеТоваровНаСклад КАК ПоступлениеТоваров
		|		ПО ПоступлениеТоваров.Ссылка = Т.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПервичныйДокумент КАК ПервичныйДокумент
		|		ПО ПервичныйДокумент.Ссылка = Т.Партия
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВозвратТоваровПоставщику.ВидыЗапасов КАК ВозвратыТоваровПоставщику
		|		ПО ВозвратыТоваровПоставщику.Ссылка = Т.Регистратор
		|		И Т.ИдентификаторСтроки = ВозвратыТоваровПоставщику.ИдентификаторСтроки
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТУчетныеПолитикиОрганизаций КАК УчетныеПолитикиОрганизаций
		|		ПО Т.Организация = УчетныеПолитикиОрганизаций.Организация
		|	ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиРасходов КАК СтатьяСписания
		|		ПО СтатьяСписания.Ссылка = Т.СтатьяРасходовСписания
		|ГДЕ
		|	(Т.Количество <> 0 ИЛИ Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение))
		|	И (НЕ Импорт.Ссылка ЕСТЬ NULL И НЕ ЕстьДекларации.Партия ЕСТЬ NULL
		|		ИЛИ Импорт.Ссылка ЕСТЬ NULL)
		// Приходы при реализации по регл учету описаны в функции ТекстТекущиеРеализацииТолькоРегл() 
		|	И НЕ (Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеУпр)
		|		И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияКлиентуРеглУчет))
		|";
КонецФункции

Функция ТекстТекущиеРеализацииТолькоРегл()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстТекущиеРеализацииТолькоРегл"" КАК ЗапросИсточник,
		|	ДД.ТипЗаписи,
		|	ЛОЖЬ КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ КАК Сторно,
		|	90 КАК Приоритет,
		|	0 КАК Знаменатель,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
		|	ДД.АналитикаУчетаПартий.НалогообложениеНДС КАК НалогообложениеПартии,
		|
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	НЕОПРЕДЕЛЕНО КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|
		|	СУММА(ДД.Количество) КАК Количество,
		|	0 КАК Стоимость,
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК СтоимостьЗабалансовая,
		|	0 КАК СтоимостьУпр,
		|	0 КАК ДопРасходыУпр,
		|	0 КАК ПостатейныеПеременныеСНДС,
		|	0 КАК ПостатейныеПеременныеБезНДС,
		|	0 КАК ТрудозатратыУпр,
		|	0 КАК ПостатейныеПостоянныеУпр,
		|	0 КАК ПостатейныеПеременныеУпр,
		|	0 КАК ДопРасходы,
		|	0 КАК ДопРасходыБезНДС,
		|	0 КАК Трудозатраты,
		|	0 КАК ПостатейныеПостоянныеСНДС,
		|	0 КАК ПостатейныеПостоянныеБезНДС,
		|	0 КАК СтоимостьРегл,
		|	0 КАК СтоимостьЗабалансоваяРегл,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
		|	0 КАК ДопРасходыРегл,
		|	0 КАК ТрудозатратыРегл,
		|	0 КАК ПостатейныеПостоянныеРегл,
		|	0 КАК ПостатейныеПеременныеРегл,
		|
		|	ДД.ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетнаяХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	0 КАК КорСтоимость,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.ГруппаПродукции,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС КАК КорВидДеятельностиНДС,
		|	ДД.КорВидДеятельностиНДС КАК ВидДеятельностиНДСДокумента,
		|	0 КАК НДСУпр,
		|	0 КАК НДСРегл,
		|	ДД.СтатьяКалькуляции,
		|	ДД.ДокументИсточник,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.КодСтроки
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|ГДЕ
		|	ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеУпр)
		|	И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияКлиентуРеглУчет)
		|СГРУППИРОВАТЬ ПО
		|	ДД.ТипЗаписи,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.АналитикаУчетаПартий.НалогообложениеНДС,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ, // ВидДвижения
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|
		|	ДД.ХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.ГруппаПродукции,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС,
		|	ДД.СтатьяКалькуляции,
		|	ДД.ДокументИсточник,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.КодСтроки
		|";
КонецФункции


Функция ТекстНачальныеОстаткиЗакупокПоИмпорту()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстНачальныеОстаткиЗакупокПоИмпорту"" 	  	КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Импорт) КАК ТипЗаписи,
		|	ЛОЖЬ											КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ											КАК Сторно,
		|	0 										  		КАК Приоритет,
		|	0								  				КАК Знаменатель,
		|	ИСТИНА 											КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 		КАК Номенклатура,
		|	ДД.АналитикаУчетаПартий.НалогообложениеНДС 		КАК НалогообложениеПартии,
		|
		|	&КонецПредыдущегоПериода 	 					КАК Период,
		|	&КонецПредыдущегоПериода 	 					КАК ПериодПоступления,
		|	ДД.Партия 				 	 					КАК Регистратор,
		|	НЕОПРЕДЕЛЕНО 			 	 					КАК ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|
		|	ДД.КоличествоОстаток КАК Количество,
		|	0 КАК Стоимость,
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК СтоимостьЗабалансовая,
		|	0 КАК СтоимостьУпр,
		|	0 КАК ДопРасходыУпр,
		|	0 КАК ПостатейныеПеременныеСНДС,
		|	0 КАК ПостатейныеПеременныеБезНДС,
		|	0 КАК ТрудозатратыУпр,
		|	0 КАК ПостатейныеПостоянныеУпр,
		|	0 КАК ПостатейныеПеременныеУпр,
		|	0 КАК ДопРасходы,
		|	0 КАК ДопРасходыБезНДС,
		|	0 КАК Трудозатраты,
		|	0 КАК ПостатейныеПостоянныеСНДС,
		|	0 КАК ПостатейныеПостоянныеБезНДС,
		|	0 КАК СтоимостьРегл,
		|	0 КАК СтоимостьЗабалансоваяРегл,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
		|	0 КАК ДопРасходыРегл,
		|	0 КАК ТрудозатратыРегл,
		|	0 КАК ПостатейныеПостоянныеРегл,
		|	0 КАК ПостатейныеПеременныеРегл,
		|
		|	ЕСТЬNULL(Поступление.ХозяйственнаяОперация, НЕОПРЕДЕЛЕНО) 				КАК ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО															КАК ПриоритетнаяХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) 		КАК КорАналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) 	КАК КорРазделУчета,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) 							КАК КорВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) 							КАК КорОрганизация,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК КорСтоимость,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПоПартнерам.ПустаяСсылка) 		КАК АналитикаУчетаПоПартнерам,
		|	НЕОПРЕДЕЛЕНО 															КАК ЗаказКлиента,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) 					КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаРасходов,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) 			КАК СтатьяРасходовСписания,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка) 			КАК СтатьяДоходов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаДоходов,
		|	ДАТАВРЕМЯ(1, 1, 1) 														КАК ПериодПродажи,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка) 	КАК СтатьяАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК ДокументДвижения,
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(36)) 											КАК ИдентификаторСтроки,
		|	ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка) КАК ГруппаПродукции,
		|	НЕОПРЕДЕЛЕНО 															КАК КорПартия,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) 			КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО 															КАК КорАналитикаФинансовогоУчета,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК КорВидДеятельностиНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК ВидДеятельностиНДСДокумента,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСУпр,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСРегл,
		|	НЕОПРЕДЕЛЕНО															КАК СтатьяКалькуляции,
		|	НЕОПРЕДЕЛЕНО 															КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО															КАК КорНаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров.Остатки(&ГраницаКонецПредыдущегоПериода,	Организация В (&МассивОрганизаций)) КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК Поступление
		|		ПО Поступление.Ссылка = ДД.Партия
		|ГДЕ
		|	ЕСТЬNULL(Поступление.ХозяйственнаяОперация, НЕОПРЕДЕЛЕНО) В (
		|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпорту),
		|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути))
		|	ИЛИ ДД.Партия = НЕОПРЕДЕЛЕНО
		|";
КонецФункции

Функция ТекстНачальныеОстаткиДляКорректировкиПриобретения()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстНачальныеОстаткиДляКорректировкиПриобретения"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Прошлое) 	  КАК ТипЗаписи,
		|	ЛОЖЬ												  КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ												  КАК Сторно,
		|	0 										  			  КАК Приоритет,
		|	0								  					  КАК Знаменатель,
		|	ИСТИНА 												  КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 			  КАК Номенклатура,
		|	ДД.АналитикаУчетаПартий.НалогообложениеНДС 			  КАК НалогообложениеПартии,
		|
		|	&КонецПредыдущегоПериода 	 						  КАК Период,
		|	&КонецПредыдущегоПериода 	 						  КАК ПериодПоступления,
		|	ДД.Регистратор			 	 						  КАК Регистратор,
		|	НЕОПРЕДЕЛЕНО 			 	 						  КАК ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|
		|	ДД.Количество КАК Количество,
		|	0 КАК Стоимость,
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК СтоимостьЗабалансовая,
		|	0 КАК СтоимостьУпр,
		|	0 КАК ДопРасходыУпр,
		|	0 КАК ПостатейныеПеременныеСНДС,
		|	0 КАК ПостатейныеПеременныеБезНДС,
		|	0 КАК ТрудозатратыУпр,
		|	0 КАК ПостатейныеПостоянныеУпр,
		|	0 КАК ПостатейныеПеременныеУпр,
		|	0 КАК ДопРасходы,
		|	0 КАК ДопРасходыБезНДС,
		|	0 КАК Трудозатраты,
		|	0 КАК ПостатейныеПостоянныеСНДС,
		|	0 КАК ПостатейныеПостоянныеБезНДС,
		|	0 КАК СтоимостьРегл,
		|	0 КАК СтоимостьЗабалансоваяРегл,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
		|	0 КАК ДопРасходыРегл,
		|	0 КАК ТрудозатратыРегл,
		|	0 КАК ПостатейныеПостоянныеРегл,
		|	0 КАК ПостатейныеПеременныеРегл,
		|
		|	ДД.ХозяйственнаяОперация 												КАК ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО															КАК ПриоритетнаяХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) 		КАК КорАналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) 	КАК КорРазделУчета,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) 							КАК КорВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) 							КАК КорОрганизация,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК КорСтоимость,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПоПартнерам.ПустаяСсылка) 		КАК АналитикаУчетаПоПартнерам,
		|	НЕОПРЕДЕЛЕНО 															КАК ЗаказКлиента,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) 					КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаРасходов,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) 			КАК СтатьяРасходовСписания,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка) 			КАК СтатьяДоходов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаДоходов,
		|	ДАТАВРЕМЯ(1, 1, 1) 														КАК ПериодПродажи,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка) 	КАК СтатьяАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК ДокументДвижения,
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(36)) 											КАК ИдентификаторСтроки,
		|	ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка) КАК ГруппаПродукции,
		|	НЕОПРЕДЕЛЕНО 															КАК КорПартия,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) 			КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО 															КАК КорАналитикаФинансовогоУчета,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК КорВидДеятельностиНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК ВидДеятельностиНДСДокумента,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСУпр,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСРегл,
		|	НЕОПРЕДЕЛЕНО															КАК СтатьяКалькуляции,
		|	НЕОПРЕДЕЛЕНО 															КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО															КАК КорНаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДокументыПоступленияИмпортаПрошлогоПериода КАК Поступление
		|		ПО Поступление.Ссылка = ДД.Регистратор
		|ГДЕ
		|	ДД.Количество <> 0
		|	И НЕ (&ИспользовалсяПартионныйУчетДоПереходаНаВерсию22 = ИСТИНА // значение параметра может быть НЕОПРЕДЕЛЕНО
		|		И ДД.Период < &ДатаПереходаНаПартионныйУчетВерсии22)
		|";
КонецФункции

Функция ТекстТекущиеЗакупкиПоИмпорту()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстТекущиеЗакупкиПоИмпорту"" 	  				 		 КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Импорт) 			 КАК ТипЗаписи,
		|	ЛОЖЬ														 КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ														 КАК Сторно,
		|	10 										  					 КАК Приоритет,
		|	0								  							 КАК Знаменатель,
		|	ИСТИНА 														 КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 					 КАК Номенклатура,
		|	ДД.АналитикаУчетаПартий.НалогообложениеНДС 					 КАК НалогообложениеПартии,
		|
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	НЕОПРЕДЕЛЕНО КАК ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|
		|	ДД.Количество,
		|	0 КАК Стоимость,
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК СтоимостьЗабалансовая,
		|	0 КАК СтоимостьУпр,
		|	0 КАК ДопРасходыУпр,
		|	0 КАК ПостатейныеПеременныеСНДС,
		|	0 КАК ПостатейныеПеременныеБезНДС,
		|	0 КАК ТрудозатратыУпр,
		|	0 КАК ПостатейныеПостоянныеУпр,
		|	0 КАК ПостатейныеПеременныеУпр,
		|	0 КАК ДопРасходы,
		|	0 КАК ДопРасходыБезНДС,
		|	0 КАК Трудозатраты,
		|	0 КАК ПостатейныеПостоянныеСНДС,
		|	0 КАК ПостатейныеПостоянныеБезНДС,
		|	0 КАК СтоимостьРегл,
		|	0 КАК СтоимостьЗабалансоваяРегл,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
		|	0 КАК ДопРасходыРегл,
		|	0 КАК ТрудозатратыРегл,
		|	0 КАК ПостатейныеПостоянныеРегл,
		|	0 КАК ПостатейныеПеременныеРегл,
		|
		|	ДД.ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетнаяХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорСтоимость,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.ГруппаПродукции,
		|	ДД.КорПартия,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС КАК КорВидДеятельностиНДС,
		|	ДД.КорВидДеятельностиНДС КАК ВидДеятельностиНДСДокумента,
		|	ДД.НДСУпр,
		|	ДД.НДСРегл,
		|	ДД.СтатьяКалькуляции,
		|	ДД.ДокументИсточник,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.КодСтроки
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|ГДЕ
		|	ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|	И ДД.ХозяйственнаяОперация В (
		|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпорту),
		|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути))
		|";
КонецФункции

Функция ТекстТекущиеДопРасходыБезПартииКРаспределению() // Использует Декларации
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстТекущиеДопРасходыКРаспределению"" 	  				КАК ЗапросИсточник,
		|	ДД.ТипЗаписи 							  					КАК ТипЗаписи,
		|	ЛОЖЬ														КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ														КАК Сторно,
		|	10 										  					КАК Приоритет,
		|	МАКСИМУМ(Декларации.Количество)								КАК Знаменатель,
		|	ЛОЖЬ 														КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 					КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО 												КАК НалогообложениеПартии,
		|
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	(ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА Декларации.ДокументПоступления
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|
		|	0 КАК Количество,
		|	СУММА(ДД.Стоимость) КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьЗабалансовая) КАК СтоимостьЗабалансовая,
		|	СУММА(ДД.СтоимостьУпр) КАК СтоимостьУпр,
		|	СУММА(ДД.ДопРасходыУпр) КАК ДопРасходыУпр,
		|	СУММА(ДД.ПостатейныеПеременныеСНДС) КАК ПостатейныеПеременныеСНДС,
		|	СУММА(ДД.ПостатейныеПеременныеБезНДС) КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(ДД.ТрудозатратыУпр) КАК ТрудозатратыУпр,
		|	СУММА(ДД.ПостатейныеПостоянныеУпр) КАК ПостатейныеПостоянныеУпр,
		|	СУММА(ДД.ПостатейныеПеременныеУпр) КАК ПостатейныеПеременныеУпр,
		|	СУММА(ДД.ДопРасходы) КАК ДопРасходы,
		|	СУММА(ДД.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		|	СУММА(ДД.Трудозатраты) КАК Трудозатраты,
		|	СУММА(ДД.ПостатейныеПостоянныеСНДС) КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(ДД.ПостатейныеПостоянныеБезНДС) КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
		|	СУММА(ДД.СтоимостьЗабалансоваяРегл) КАК СтоимостьЗабалансоваяРегл,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница,
		|	СУММА(ДД.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	СУММА(ДД.ТрудозатратыРегл) КАК ТрудозатратыРегл,
		|	СУММА(ДД.ПостатейныеПостоянныеРегл) КАК ПостатейныеПостоянныеРегл,
		|	СУММА(ДД.ПостатейныеПеременныеРегл) КАК ПостатейныеПеременныеРегл,
		|
		|	ДД.ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетнаяХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорСтоимость,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.ГруппаПродукции,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС,
		|	ДД.КорВидДеятельностиНДС КАК ВидДеятельностиНДСДокумента,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
		|	СУММА(ДД.НДСРегл) КАК НДСРегл,
		|	ДД.СтатьяКалькуляции,
		|	Декларации.ДокументПоступления КАК ДокументИсточник,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.КодСтроки
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Декларации КАК Декларации
		|		ПО Декларации.Ссылка = ДД.Регистратор
		|		И Декларации.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Декларации.ВидЗапасов = ДД.ВидЗапасов
		|		И Декларации.СтавкаНДС = ДД.КорАналитикаУчетаПартий.СтавкаНДС
		|ГДЕ
		|	ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии)
		|СГРУППИРОВАТЬ ПО
		|	ДД.ТипЗаписи,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.ХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорСтоимость,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.КодСтроки,
		|	ДД.ГруппаПродукции,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.СтатьяКалькуляции,
		|	Декларации.ДокументПоступления
		|";
КонецФункции

Функция ТекстТекущиеДопРасходыСПартиейКРаспределению() // Использует ДекларацииПоПоступлениям
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстТекущиеДопРасходыКРаспределению"" 	  				КАК ЗапросИсточник,
		|	ДД.ТипЗаписи 							  					КАК ТипЗаписи,
		|	ЛОЖЬ														КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ														КАК Сторно,
		|	10 										  					КАК Приоритет,
		|	МАКСИМУМ(Декларации.Количество)			  					КАК Знаменатель,
		|	ЛОЖЬ 														КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 					КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО 												КАК НалогообложениеПартии,
		|
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	НЕОПРЕДЕЛЕНО КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|
		|	0 КАК Количество,
		|	СУММА(ДД.Стоимость) КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьЗабалансовая) КАК СтоимостьЗабалансовая,
		|	СУММА(ДД.СтоимостьУпр) КАК СтоимостьУпр,
		|	СУММА(ДД.ДопРасходыУпр) КАК ДопРасходыУпр,
		|	СУММА(ДД.ПостатейныеПеременныеСНДС) КАК ПостатейныеПеременныеСНДС,
		|	СУММА(ДД.ПостатейныеПеременныеБезНДС) КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(ДД.ТрудозатратыУпр) КАК ТрудозатратыУпр,
		|	СУММА(ДД.ПостатейныеПостоянныеУпр) КАК ПостатейныеПостоянныеУпр,
		|	СУММА(ДД.ПостатейныеПеременныеУпр) КАК ПостатейныеПеременныеУпр,
		|	СУММА(ДД.ДопРасходы) КАК ДопРасходы,
		|	СУММА(ДД.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		|	СУММА(ДД.Трудозатраты) КАК Трудозатраты,
		|	СУММА(ДД.ПостатейныеПостоянныеСНДС) КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(ДД.ПостатейныеПостоянныеБезНДС) КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
		|	СУММА(ДД.СтоимостьЗабалансоваяРегл) КАК СтоимостьЗабалансоваяРегл,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница,
		|	СУММА(ДД.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	СУММА(ДД.ТрудозатратыРегл) КАК ТрудозатратыРегл,
		|	СУММА(ДД.ПостатейныеПостоянныеРегл) КАК ПостатейныеПостоянныеРегл,
		|	СУММА(ДД.ПостатейныеПеременныеРегл) КАК ПостатейныеПеременныеРегл,
		|
		|	ДД.ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетнаяХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорСтоимость,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.ГруппаПродукции,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС КАК КорВидДеятельностиНДС,
		|	ДД.КорВидДеятельностиНДС КАК ВидДеятельностиНДСДокумента,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
		|	СУММА(ДД.НДСРегл) КАК НДСРегл,
		|	ДД.СтатьяКалькуляции,
		|	ДД.ДокументИсточник КАК ДокументИсточник,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.КодСтроки
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДекларацииПоПоступлениям КАК Декларации
		|		ПО Декларации.Ссылка = ДД.Регистратор
		|		И Декларации.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Декларации.ВидЗапасов = ДД.ВидЗапасов
		|		И Декларации.ДокументПоступления = ДД.ДокументИсточник
		|		И Декларации.СтавкаНДС = ДД.КорАналитикаУчетаПартий.СтавкаНДС
		|ГДЕ
		|	ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией)
		|СГРУППИРОВАТЬ ПО
		|	ДД.ТипЗаписи,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.ХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорСтоимость,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.КодСтроки,
		|	ДД.ГруппаПродукции,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.СтатьяКалькуляции,
		|	ДД.ДокументИсточник
		|";
КонецФункции

//++ Локализация

Функция ТекстТекущиеДопРасходыСПартиейЗаявленияОВвозе()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстТекущиеДопРасходыСПартиейЗаявленияОВвозе"" 	  		КАК ЗапросИсточник,
		|	ДД.ТипЗаписи 							  					КАК ТипЗаписи,
		|	ЛОЖЬ														КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ														КАК ЭтоСторно,
		|	10 										  					КАК Приоритет,
		|	СУММА(ТоварыЗаявления.Количество)							КАК Знаменатель,
		|	ЛОЖЬ 														КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 					КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО 												КАК НалогообложениеПартии,
		|
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	НЕОПРЕДЕЛЕНО КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|
		|	0 КАК Количество,
		|	СУММА(ДД.Стоимость) КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьЗабалансовая) КАК СтоимостьЗабалансовая,
		|	СУММА(ДД.СтоимостьУпр) КАК СтоимостьУпр,
		|	СУММА(ДД.ДопРасходыУпр) КАК ДопРасходыУпр,
		|	СУММА(ДД.ПостатейныеПеременныеСНДС) КАК ПостатейныеПеременныеСНДС,
		|	СУММА(ДД.ПостатейныеПеременныеБезНДС) КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(ДД.ТрудозатратыУпр) КАК ТрудозатратыУпр,
		|	СУММА(ДД.ПостатейныеПостоянныеУпр) КАК ПостатейныеПостоянныеУпр,
		|	СУММА(ДД.ПостатейныеПеременныеУпр) КАК ПостатейныеПеременныеУпр,
		|	СУММА(ДД.ДопРасходы) КАК ДопРасходы,
		|	СУММА(ДД.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		|	СУММА(ДД.Трудозатраты) КАК Трудозатраты,
		|	СУММА(ДД.ПостатейныеПостоянныеСНДС) КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(ДД.ПостатейныеПостоянныеБезНДС) КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
		|	СУММА(ДД.СтоимостьЗабалансоваяРегл) КАК СтоимостьЗабалансоваяРегл,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница,
		|	СУММА(ДД.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	СУММА(ДД.ТрудозатратыРегл) КАК ТрудозатратыРегл,
		|	СУММА(ДД.ПостатейныеПостоянныеРегл) КАК ПостатейныеПостоянныеРегл,
		|	СУММА(ДД.ПостатейныеПеременныеРегл) КАК ПостатейныеПеременныеРегл,
		|
		|	ДД.ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетнаяХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорСтоимость,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.ГруппаПродукции,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС,
		|	ДД.КорВидДеятельностиНДС КАК ВидДеятельностиНДСДокумента,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
		|	СУММА(ДД.НДСРегл) КАК НДСРегл,
		|	ДД.СтатьяКалькуляции,
		|	ДД.ДокументИсточник,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.КодСтроки
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаявлениеОВвозеТоваров.Товары КАК ТоварыЗаявления
		|		ПО ТоварыЗаявления.ссылка = ДД.Регистратор
		|		И ТоварыЗаявления.ИдентификаторСтроки = ДД.ИдентификаторСтроки
		|ГДЕ
		|	ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией)
		|	И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки)
		|СГРУППИРОВАТЬ ПО
		|	ДД.ТипЗаписи,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.ХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорСтоимость,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.КодСтроки,
		|	ДД.ГруппаПродукции,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.СтатьяКалькуляции,
		|	ДД.ДокументИсточник
		|";
КонецФункции

//-- Локализация

Функция ТекстКорректировкиПриобретенияПрошлогоПериода()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстКорректировкиПриобретенияПрошлогоПериода""			КАК ЗапросИсточник,
		|	ДД.ТипЗаписи 							  					КАК ТипЗаписи,
		|	ЛОЖЬ														КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ														КАК Сторно,
		|	10 										  					КАК Приоритет,
		|	0															КАК Знаменатель,
		|	ЛОЖЬ 														КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 					КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО 												КАК НалогообложениеПартии,
		|
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	НЕОПРЕДЕЛЕНО КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|
		|	0 КАК Количество,
		|	СУММА(ДД.Стоимость) КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьЗабалансовая) КАК СтоимостьЗабалансовая,
		|	СУММА(ДД.СтоимостьУпр) КАК СтоимостьУпр,
		|	СУММА(ДД.ДопРасходыУпр) КАК ДопРасходыУпр,
		|	СУММА(ДД.ПостатейныеПеременныеСНДС) КАК ПостатейныеПеременныеСНДС,
		|	СУММА(ДД.ПостатейныеПеременныеБезНДС) КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(ДД.ТрудозатратыУпр) КАК ТрудозатратыУпр,
		|	СУММА(ДД.ПостатейныеПостоянныеУпр) КАК ПостатейныеПостоянныеУпр,
		|	СУММА(ДД.ПостатейныеПеременныеУпр) КАК ПостатейныеПеременныеУпр,
		|	СУММА(ДД.ДопРасходы) КАК ДопРасходы,
		|	СУММА(ДД.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		|	СУММА(ДД.Трудозатраты) КАК Трудозатраты,
		|	СУММА(ДД.ПостатейныеПостоянныеСНДС) КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(ДД.ПостатейныеПостоянныеБезНДС) КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
		|	СУММА(ДД.СтоимостьЗабалансоваяРегл) КАК СтоимостьЗабалансоваяРегл,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница,
		|	СУММА(ДД.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	СУММА(ДД.ТрудозатратыРегл) КАК ТрудозатратыРегл,
		|	СУММА(ДД.ПостатейныеПостоянныеРегл) КАК ПостатейныеПостоянныеРегл,
		|	СУММА(ДД.ПостатейныеПеременныеРегл) КАК ПостатейныеПеременныеРегл,
		|
		|	ДД.ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО КАК ПриоритетнаяХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорСтоимость,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.ГруппаПродукции,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС КАК КорВидДеятельностиНДС,
		|	ДД.КорВидДеятельностиНДС КАК ВидДеятельностиНДСДокумента,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
		|	СУММА(ДД.НДСРегл) КАК НДСРегл,
		|	ДД.СтатьяКалькуляции,
		|	ДД.ДокументИсточник КАК ДокументИсточник,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.КодСтроки
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|ГДЕ
		|	ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода)
		|СГРУППИРОВАТЬ ПО
		|	ДД.ТипЗаписи,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.ХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорСтоимость,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.СтатьяДоходов,
		|	ДД.АналитикаДоходов,
		|	ДД.ПериодПродажи,
		|	ДД.СтатьяАктивовПассивов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументДвижения,
		|	ДД.ИдентификаторСтроки,
		|	ДД.КодСтроки,
		|	ДД.ГруппаПродукции,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.СтатьяКалькуляции,
		|	ДД.ДокументИсточник
		|";
КонецФункции

Функция ТекстРеализацииПрошлыхМесяцев() // использует ПрошлыеРеализации 
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстРеализацииПрошлыхМесяцев"" 	  			 КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Прошлое) КАК ТипЗаписи,
		|	ЛОЖЬ											 КАК ЭтоТочноРасчетноеДвижение,
		|	ЛОЖЬ											 КАК Сторно,
		|	0 										  		 КАК Приоритет,
		|	0								  				 КАК Знаменатель,
		|	ИСТИНА 											 КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 		 КАК Номенклатура,
		|	ДД.АналитикаУчетаПартий.НалогообложениеНДС 		 КАК НалогообложениеПартии,
		|
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ДД.ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	(ВЫБОР
		|		КОГДА ДД.ВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
		|			ТОГДА Прошлые.ВидЗапасов
		|		ИНАЧЕ ДД.ВидЗапасов КОНЕЦ) КАК ВидЗапасов,
		|	ДД.Организация,
		|	ДД.Партия,
		|	НЕОПРЕДЕЛЕНО КАК ЗаказНаПроизводство,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	(ВЫБОР
		|		КОГДА ДД.КорВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА ДД.ВидДеятельностиНДС
		|		ИНАЧЕ ДД.КорВидДеятельностиНДС КОНЕЦ) КАК ВидДеятельностиНДС,
		|
		|	СУММА(ДД.Количество) КАК Количество,
		|	0 КАК Стоимость,
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК СтоимостьЗабалансовая,
		|	0 КАК СтоимостьУпр,
		|	0 КАК ДопРасходыУпр,
		|	0 КАК ПостатейныеПеременныеСНДС,
		|	0 КАК ПостатейныеПеременныеБезНДС,
		|	0 КАК ТрудозатратыУпр,
		|	0 КАК ПостатейныеПостоянныеУпр,
		|	0 КАК ПостатейныеПеременныеУпр,
		|	0 КАК ДопРасходы,
		|	0 КАК ДопРасходыБезНДС,
		|	0 КАК Трудозатраты,
		|	0 КАК ПостатейныеПостоянныеСНДС,
		|	0 КАК ПостатейныеПостоянныеБезНДС,
		|	0 КАК СтоимостьРегл,
		|	0 КАК СтоимостьЗабалансоваяРегл,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
		|	0 КАК ДопРасходыРегл,
		|	0 КАК ТрудозатратыРегл,
		|	0 КАК ПостатейныеПостоянныеРегл,
		|	0 КАК ПостатейныеПеременныеРегл,
		|
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) 				КАК ХозяйственнаяОперация,
		|	НЕОПРЕДЕЛЕНО															КАК ПриоритетнаяХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) 		КАК КорАналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) 	КАК КорРазделУчета,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) 							КАК КорВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) 							КАК КорОрганизация,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК КорСтоимость,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПоПартнерам.ПустаяСсылка) 		КАК АналитикаУчетаПоПартнерам,
		|	НЕОПРЕДЕЛЕНО 															КАК ЗаказКлиента,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) 					КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаРасходов,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) 			КАК СтатьяРасходовСписания,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка) 			КАК СтатьяДоходов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаДоходов,
		|	ДАТАВРЕМЯ(1, 1, 1) 														КАК ПериодПродажи,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка) 	КАК СтатьяАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК АналитикаАктивовПассивов,
		|	НЕОПРЕДЕЛЕНО 															КАК ДокументДвижения,
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(36)) 											КАК ИдентификаторСтроки,
		|	ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка) КАК ГруппаПродукции,
		|	НЕОПРЕДЕЛЕНО 															КАК КорПартия,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) 			КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО 															КАК КорАналитикаФинансовогоУчета,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК КорВидДеятельностиНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 				КАК ВидДеятельностиНДСДокумента,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСУпр,
		|	ВЫРАЗИТЬ(0 КАК ЧИСЛО(31,2)) 											КАК НДСРегл,
		|	НЕОПРЕДЕЛЕНО															КАК СтатьяКалькуляции,
		|	Прошлые.ДокументИсточник												КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПрошлыеРеализации КАК Прошлые
		|		ПО ДД.Регистратор = Прошлые.ДокументРеализации
		|		И ДД.АналитикаУчетаНоменклатуры = Прошлые.АналитикаУчетаНоменклатуры
		|		И (ДД.ВидЗапасов = Прошлые.ВидЗапасов
		|			ИЛИ ДД.ВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка))
		|ГДЕ
		|	ДД.Организация В (&МассивОрганизаций)
		|	И ДД.Активность
		|	И НЕ ДД.РасчетСебестоимости
		|	И НЕ (&ИспользовалсяПартионныйУчетДоПереходаНаВерсию22 = ИСТИНА // значение параметра может быть НЕОПРЕДЕЛЕНО
		|		И ДД.Период < &ДатаПереходаНаПартионныйУчетВерсии22)
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.АналитикаУчетаПартий.НалогообложениеНДС,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.ВидДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	(ВЫБОР
		|		КОГДА ДД.ВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
		|			ТОГДА Прошлые.ВидЗапасов
		|		ИНАЧЕ ДД.ВидЗапасов КОНЕЦ),
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	(ВЫБОР
		|		КОГДА ДД.КорВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
		|			ТОГДА ДД.ВидДеятельностиНДС
		|		ИНАЧЕ ДД.КорВидДеятельностиНДС КОНЕЦ),
		|	Прошлые.ДокументИсточник
		|";
КонецФункции


// Заполнение расчетной партии

Процедура ЗаполнитьРасчетнуюПартиюСебестоимостиТоваров(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход)
	
	Если (Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск
			ИЛИ Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Распределение)
	 И Не ЗначениеЗаполнено(Расход.ЗаказНаПроизводство)
	 И ЗначениеЗаполнено(Расход.РазделУчета)
	 И Расход.РазделУчета <> Приход.РазделУчета Тогда
		Возврат;
	
	//++ Устарело_Производство21	
	//-- Устарело_Производство21
	// Для доп. расходов, отраженных таможенной декларацией на импорт исключаем источники, отличные от закупки по импорту.
	ИначеЕсли (Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии
	 ИЛИ Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией)
	 И ЗначениеЗаполнено(Приход.ХозяйственнаяОперация)
	 И Приход.ХозяйственнаяОперация <> Перечисления.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки
	 И Приход.ХозяйственнаяОперация <> Перечисления.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки
	 И Приход.ХозяйственнаяОперация <> Перечисления.ХозяйственныеОперации.ЗакупкаПоИмпорту
	 И Приход.ХозяйственнаяОперация <> Перечисления.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути Тогда
		Возврат;
		
	ИначеЕсли ЗначениеЗаполнено(Расход.Регистратор)
		И Расход.Регистратор = Приход.ДокументИсточник
		И ЗначениеЗаполнено(Приход.ХозяйственнаяОперация)
		И Приход.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.Сторно
		И Приход.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ВозвратБезДокументаИсточника
		И Не Расход.Регистратор = Приход.Регистратор Тогда
		Возврат;
	КонецЕсли;
	
	СуммовыеРесурсыСтрокой = 
	"Стоимость, СтоимостьБезНДС, ДопРасходы, ДопРасходыБезНДС,
	|СтоимостьУпр, ДопРасходыУпр, ТрудозатратыУпр, ПостатейныеПостоянныеУпр, ПостатейныеПеременныеУпр,
	|СтоимостьРегл, ПостояннаяРазница, ВременнаяРазница,
	|СтоимостьЗабалансовая, Трудозатраты, ПостатейныеПостоянныеСНДС, ПостатейныеПостоянныеБезНДС,
	|ПостатейныеПеременныеСНДС, ПостатейныеПеременныеБезНДС,
	|НДСРегл, НДСУпр,
	|СтоимостьЗабалансоваяРегл, ДопРасходыРегл, ТрудозатратыРегл, ПостатейныеПостоянныеРегл, ПостатейныеПеременныеРегл";
	СуммовыеРесурсы = Новый Структура(СуммовыеРесурсыСтрокой);
	
	// Заполняем расчетную партию по расходной партии-основании
	ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Расход);
	
	//	Заполняем партионную идентификацию в расчетной партии
	ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Приход, "Партия, АналитикаУчетаПартий, НалогообложениеПартии, АналитикаФинансовогоУчета, ПериодПоступления");
	
	Если РасчетнаяПартия.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности
	 И РасчетнаяПартия.ВидДвижения = ВидДвиженияНакопления.Приход
	 И ПараметрыРасчета.УчетныеПолитики.ФИФОСкользящая.ИспользуютВТекущемПериоде.Найти(РасчетнаяПартия.Организация) <> Неопределено Тогда
		РасчетнаяПартия.Партия = РасчетнаяПартия.Регистратор;
		РасчетнаяПартия.АналитикаУчетаПартий = Неопределено;
	//++ Устарело_Производство21
	//-- Устарело_Производство21
	ИначеЕсли РасчетнаяПартия.ВидДвижения = ВидДвиженияНакопления.Приход
	 И ЗначениеЗаполнено(РасчетнаяПартия.Партия)
	 И РасчетнаяПартия.РазделУчета <> Перечисления.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути
	 И РасчетнаяПартия.РазделУчета <> Перечисления.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки
	 И РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией
	 И РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии
	 И РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения
	 И ПараметрыРасчета.УчетныеПолитики.ФИФОСкользящая.ИспользуютВТекущемПериоде.Найти(РасчетнаяПартия.Организация) = Неопределено Тогда
		РасчетнаяПартия.Партия = Неопределено;
		РасчетнаяПартия.АналитикаУчетаПартий = Неопределено;
	КонецЕсли;
	
	Если РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода
	 И РасчетнаяПартия.Количество = 0 Тогда
		// ДокументИсточник не меняется, нужно сохранить запись как есть
	ИначеЕсли РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Выпуск
	 ИЛИ РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СторноСписанияНаВыпуск
	 ИЛИ Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СторноСписанияНаВыпуск Тогда
		РасчетнаяПартия.ДокументИсточник = Приход.ДокументИсточник;
	Иначе
		РасчетнаяПартия.ДокументИсточник = Приход.Регистратор;
	КонецЕсли;
	
	Если РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск Тогда
		РасчетнаяПартия.Сторно = Ложь;
		РасчетнаяПартия.АналитикаУчетаПоПартнерам = Приход.АналитикаУчетаПоПартнерам;
	КонецЕсли;
	
	Если РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Выпуск Тогда
		РасчетнаяПартия.ВидДвижения = Приход.ВидДвижения;
		РасчетнаяПартия.АналитикаУчетаПоПартнерам = Приход.АналитикаУчетаПоПартнерам;
	КонецЕсли;
	
	Если РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.Перемещение
		И РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно
		И РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ПеремещениеУпр
		И РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ПеремещениеАвто Тогда
		Если РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов
		 ИЛИ Не ЗначениеЗаполнено(РасчетнаяПартия.ВидДеятельностиНДС) Тогда
			РасчетнаяПартия.ВидДеятельностиНДС = Приход.ВидДеятельностиНДС;
		КонецЕсли;
	Иначе
		Если ЗначениеЗаполнено(Приход.КорАналитикаФинансовогоУчета) Тогда
			РасчетнаяПартия.АналитикаФинансовогоУчета = Приход.КорАналитикаФинансовогоУчета;
		Иначе
			РасчетнаяПартия.АналитикаФинансовогоУчета = Расход.АналитикаФинансовогоУчета;
		КонецЕсли;
		
		Если Не ЗначениеЗаполнено(РасчетнаяПартия.АналитикаФинансовогоУчета)
			И РасчетнаяПартия.АналитикаФинансовогоУчета <> Неопределено Тогда
			РасчетнаяПартия.АналитикаФинансовогоУчета = Неопределено;
		КонецЕсли;
		
		Если Не ЗначениеЗаполнено(РасчетнаяПартия.КорАналитикаФинансовогоУчета)
			И РасчетнаяПартия.КорАналитикаФинансовогоУчета <> Неопределено Тогда
			РасчетнаяПартия.КорАналитикаФинансовогоУчета = Неопределено;
		КонецЕсли;
		
		Если ЗначениеЗаполнено(Приход.КорВидДеятельностиНДС) Тогда
			РасчетнаяПартия.ВидДеятельностиНДС = Приход.КорВидДеятельностиНДС;
		Иначе
			РасчетнаяПартия.ВидДеятельностиНДС = Приход.ВидДеятельностиНДС;
		КонецЕсли;
	КонецЕсли;
	
	Если РасчетнаяПартия.ВидДвижения = ВидДвиженияНакопления.Приход
	 И Приход.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.Импорт
	 И Расход.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения
	 И НЕ (Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Прошлое
	 	 И Расход.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов) Тогда
		
		РасчетнаяПартия.КорВидДеятельностиНДС = Приход.ВидДеятельностиНДС;
		РасчетнаяПартия.КорАналитикаУчетаНоменклатуры = Приход.АналитикаУчетаНоменклатуры;
		РасчетнаяПартия.КорПартия = Приход.Партия;
		РасчетнаяПартия.КорАналитикаУчетаПартий = Приход.АналитикаУчетаПартий;
		
		Если ЗначениеЗаполнено(Приход.КорОрганизация) Тогда
			РасчетнаяПартия.КорОрганизация = Приход.Организация;
		КонецЕсли;
		
	КонецЕсли;
	
	Если РасчетнаяПартия.ВидДвижения = ВидДвиженияНакопления.Расход
		И Не ЗначениеЗаполнено(РасчетнаяПартия.ВидДеятельностиНДСДокумента) Тогда
		РасчетнаяПартия.КорВидДеятельностиНДС = Приход.ВидДеятельностиНДС;
	КонецЕсли;
	
	
	//++ Устарело_Производство21
	//-- Устарело_Производство21
	
	Если (ЗначениеЗаполнено(РасчетнаяПартия.КорРазделУчета)
		  ИЛИ РасчетнаяПартия.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеализацияКлиентуРеглУчет)
	 И РасчетнаяПартия.ВидДвижения = ВидДвиженияНакопления.Расход
	 // Дополнительное условие на тип партии.
	 И РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.Выпуск
	 И РасчетнаяПартия.КорПартия <> РасчетнаяПартия.Регистратор Тогда
	 
		// Сработает для расходных движений документа, удовлетворяющего следующим условиям:
		// - документ формирует движения и по приходу и по расходу
		// - его приходное движение не образует новую партию
		// Пример такого документа - перемещение товаров между складами.
		Если (ПараметрыРасчета.УчетныеПолитики.ФИФОСкользящая.ИспользуютВТекущемПериоде.Найти(РасчетнаяПартия.Организация) = Неопределено
				И РасчетнаяПартия.КорРазделУчета <> Перечисления.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
		 ИЛИ (ЗначениеЗаполнено(РасчетнаяПартия.КорОрганизация)
			  И ПараметрыРасчета.УчетныеПолитики.ФИФОСкользящая.ИспользуютВТекущемПериоде.Найти(РасчетнаяПартия.КорОрганизация) = Неопределено) Тогда
			РасчетнаяПартия.КорПартия 				= Неопределено;
			РасчетнаяПартия.КорАналитикаУчетаПартий = Неопределено;
		//++ Устарело_Производство21
		//-- Устарело_Производство21
		Иначе
			РасчетнаяПартия.КорПартия 				= Приход.Партия;
			РасчетнаяПартия.КорАналитикаУчетаПартий = Приход.АналитикаУчетаПартий;
		КонецЕсли;
		
		Если Не ЗначениеЗаполнено(РасчетнаяПартия.КорВидЗапасов) Тогда
			РасчетнаяПартия.КорВидЗапасов = Приход.ВидЗапасов;
		КонецЕсли;
		
	КонецЕсли;
	
	// Расчетная партия заполняется на наибольшее общее вычитаемое
	Если Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии
	 ИЛИ Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией Тогда
		КоличествоСписания = Мин(Расход.Знаменатель, Приход.Количество);
		ПриходБазис = ?(Приход.Количество <> 0, КоличествоСписания / Приход.Количество, 0);
		РасходБазис = ?(Расход.Знаменатель <> 0, КоличествоСписания / Расход.Знаменатель, 0);
		
	// У корректировки приобретения прошлого периода нет количества, поэтому используем первый источник полностью.
	ИначеЕсли Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода Тогда
		КоличествоСписания = Приход.Количество;
		ПриходБазис = 1;
		РасходБазис = 1;
	ИначеЕсли Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск
	 И Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Выпуск Тогда
		КоличествоСписания = Мин(Приход.Знаменатель, Расход.Количество);
		ПриходБазис = ?(Приход.Знаменатель <> 0, КоличествоСписания / Приход.Знаменатель, 0);
		РасходБазис = ?(Расход.Количество <> 0, КоличествоСписания / Расход.Количество, 0);
	Иначе
		КоличествоСписания = Мин(Расход.Количество, Приход.Количество);
		ПриходБазис = ?(Приход.Количество <> 0, КоличествоСписания / Приход.Количество, 0);
		РасходБазис = ?(Расход.Количество <> 0, КоличествоСписания / Расход.Количество, 0);
	КонецЕсли;
	
	// Заполняем показатели расчетной партии
	Если Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии
	 ИЛИ Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией
	 ИЛИ Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода Тогда
		РасчетнаяПартия.Количество = 0;
	ИначеЕсли Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск
	 И Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Выпуск Тогда
		РасчетнаяПартия.Количество = Окр(ПриходБазис * Приход.Количество, 3);
	Иначе
		РасчетнаяПартия.Количество = Окр(КоличествоСписания, 3);
	КонецЕсли;
	
	Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
		РасчетнаяПартия[ИмяРесурса.Ключ] = Окр(РасходБазис * РасчетнаяПартия[ИмяРесурса.Ключ], 2);
	КонецЦикла;
	
	// Корректируем базу расчета в расходе
	Если РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.Выпуск Тогда
	
		Расход.Количество = Расход.Количество - РасчетнаяПартия.Количество;
		Если Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии
			ИЛИ Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией Тогда
			Расход.Знаменатель = Расход.Знаменатель - КоличествоСписания;
		КонецЕсли;
		
		Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
			Расход[ИмяРесурса.Ключ] = Расход[ИмяРесурса.Ключ] - РасчетнаяПартия[ИмяРесурса.Ключ];
		КонецЦикла;
		
	КонецЕсли;
	
	// Корректируем базу расчета в приходе
	Если НЕ (Приход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеализацияКлиентуРеглУчет
		И Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Потребление)
	И НЕ (Приход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РаспределениеРасходовНаПартииПроизводства
	  И Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Распределение) Тогда
		
		Если Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии
		 ИЛИ Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией Тогда
			Приход.Количество = Приход.Количество - КоличествоСписания;
		ИначеЕсли НЕ Приход.Сторно И РасчетнаяПартия.Сторно
		 И РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Потребление Тогда	
			Приход.Количество = Приход.Количество + РасчетнаяПартия.Количество;
		ИначеЕсли Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения
		 И РасчетнаяПартия.Количество < 0 Тогда
			Приход.Количество = Приход.Количество + РасчетнаяПартия.Количество;
		Иначе
			Приход.Количество = Приход.Количество - РасчетнаяПартия.Количество;
		КонецЕсли;
		
	КонецЕсли;
	
	Если Не ЗначениеЗаполнено(РасчетнаяПартия.РазделУчета) Тогда
		РасчетнаяПартия.РазделУчета = Приход.РазделУчета;
	КонецЕсли;
	
	Если Не ЗначениеЗаполнено(РасчетнаяПартия.ВидЗапасов) И ЗначениеЗаполнено(Приход.ВидЗапасов)
	 ИЛИ РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство Тогда
		РасчетнаяПартия.ВидЗапасов = Приход.ВидЗапасов;
	КонецЕсли;
	
	Если РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Выпуск Тогда
		
		РасчетнаяПартия.АналитикаУчетаНоменклатуры = Приход.АналитикаУчетаНоменклатуры;
		РасчетнаяПартия.Партия = Приход.Партия;
		РасчетнаяПартия.АналитикаУчетаПартий = Приход.АналитикаУчетаПартий;
		РасчетнаяПартия.Подразделение = Приход.Подразделение;
		РасчетнаяПартия.СтатьяКалькуляции = Приход.СтатьяКалькуляции;
		РасчетнаяПартия.ИдентификаторСтроки = Приход.ИдентификаторСтроки;
		РасчетнаяПартия.КодСтроки = Приход.КодСтроки;
		
	КонецЕсли;
	
	Если РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.Выпуск Тогда
		Если РасчетнаяПартия.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство
			ИЛИ РасчетнаяПартия.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты Тогда
			Если Приход.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку Тогда
				РасчетнаяПартия.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку;
			ИначеЕсли Приход.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение Тогда
				РасчетнаяПартия.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение;
			КонецЕсли;
		КонецЕсли;
		
		Если Не ЗначениеЗаполнено(РасчетнаяПартия.КорАналитикаУчетаНоменклатуры)
			И (РасчетнаяПартия.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку
				ИЛИ РасчетнаяПартия.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение) Тогда
			РасчетнаяПартия.КорРазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка();
		ИначеЕсли ЗначениеЗаполнено(РасчетнаяПартия.КорАналитикаУчетаНоменклатуры)
			И РасчетнаяПартия.ВидДвижения = ВидДвиженияНакопления.Расход
			И Не РасчетнаяПартия.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ВозвратИзПроизводства
			И (РасчетнаяПартия.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку
				ИЛИ РасчетнаяПартия.РазделУчета = Перечисления.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение) Тогда
			РасчетнаяПартия.КорРазделУчета = РасчетнаяПартия.РазделУчета;
		КонецЕсли;
	КонецЕсли;
	
	// Заменим старые аналитики учета партий на новые.
	Если ПараметрыРасчета.РаспределениеПартий.ДополнительныеСвойства.Свойство("АналитикиУчетаПартий") Тогда
		
		НоваяАналитикаУчетаПартий = ПараметрыРасчета.РаспределениеПартий.ДополнительныеСвойства.АналитикиУчетаПартий.Получить(РасчетнаяПартия.АналитикаУчетаПартий);
		
		Если ЗначениеЗаполнено(НоваяАналитикаУчетаПартий) Тогда
			РасчетнаяПартия.АналитикаУчетаПартий = НоваяАналитикаУчетаПартий;
		КонецЕсли;
		
		НоваяАналитикаУчетаПартий = ПараметрыРасчета.РаспределениеПартий.ДополнительныеСвойства.АналитикиУчетаПартий.Получить(РасчетнаяПартия.КорАналитикаУчетаПартий);
		
		Если ЗначениеЗаполнено(НоваяАналитикаУчетаПартий) Тогда
			РасчетнаяПартия.КорАналитикаУчетаПартий = НоваяАналитикаУчетаПартий;
		КонецЕсли;
		
	КонецЕсли;
	
	// Сторно списания на выпуск только уменьшает количество списания на выпуск,
	// но в дальнейших цепочках результат не должен использоваться.  
	Если РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск
	 И Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СторноСписанияНаВыпуск Тогда
		РасчетнаяПартия.РасчетЗавершен = Ложь;
	Иначе
		// По результатам партионной идентификации определяем завершенность расчета
		РасчетнаяПартия.РасчетЗавершен = Приход.РасчетЗавершен;
	КонецЕсли;
	
	// Включение или исключение НДС в стоимости товаров для движений таможенной декларации на импорт.
	Если (РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии
	 ИЛИ РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией)
	 И РасчетнаяПартия.ВидДеятельностиНДС <> РасчетнаяПартия.КорВидДеятельностиНДС Тогда
	 
		ВключениеИсключениеНДС = РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьРасчетнуюПартию(ПараметрыРасчета);
		ЗаполнитьЗначенияСвойств(ВключениеИсключениеНДС, РасчетнаяПартия,, СуммовыеРесурсыСтрокой);
		ВключениеИсключениеНДС.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ВключениеИсключениеНДСВСтоимости;
		
		Если ПараметрыРасчета.ТипыНалогообложенияНДСУчитываетсяВСтоимости[РасчетнаяПартия.ВидДеятельностиНДС] <> Неопределено
		 И ПараметрыРасчета.ТипыНалогообложенияНДСНеУчитываетсяВСтоимости[РасчетнаяПартия.КорВидДеятельностиНДС] <> Неопределено Тогда
			ВключениеИсключениеНДС.ДопРасходыРегл = РасчетнаяПартия.НДСРегл;
			ВключениеИсключениеНДС.ДопРасходыУпр = ?(ПараметрыРасчета.УправленческийУчетОрганизаций, РасчетнаяПартия.НДСУпр, 0);
			
		ИначеЕсли ПараметрыРасчета.ТипыНалогообложенияНДСНеУчитываетсяВСтоимости[РасчетнаяПартия.ВидДеятельностиНДС] <> Неопределено
		 И ПараметрыРасчета.ТипыНалогообложенияНДСУчитываетсяВСтоимости[РасчетнаяПартия.КорВидДеятельностиНДС] <> Неопределено Тогда
			ВключениеИсключениеНДС.ДопРасходыРегл = -РасчетнаяПартия.НДСРегл;
			ВключениеИсключениеНДС.ДопРасходыУпр = ?(ПараметрыРасчета.УправленческийУчетОрганизаций, -РасчетнаяПартия.НДСУпр, 0);
		 
		КонецЕсли;
	 
	КонецЕсли;
	
	// Отклонения в стоимости товаров
	Если Расход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки
	 ИЛИ Расход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки Тогда
	 
		Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
			СуммовыеРесурсы[ИмяРесурса.Ключ] = Окр(ПриходБазис * Приход[ИмяРесурса.Ключ], 2);
			Приход[ИмяРесурса.Ключ] = Приход[ИмяРесурса.Ключ] - СуммовыеРесурсы[ИмяРесурса.Ключ];
		КонецЦикла;
		
		// Заполним кор реквизиты. Они будут нужны для отнесения доп расходов.
		Если Расход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки
		 И Приход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСНеотфактурованнаяПоставка
		 ИЛИ Расход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки
		 И Приход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ЗакупкаУПоставщикаНеотфактурованнаяПоставка Тогда
			ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Приход, "КорАналитикаУчетаНоменклатуры, КорРазделУчета, КорВидЗапасов, КорПартия, КорАналитикаУчетаПартий");
	 	КонецЕсли;
		
		// Отклонения между фактической и договорной стоимостью.
		Отклонения = РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьРасчетнуюПартию(ПараметрыРасчета, РасчетнаяПартия, Ложь);
		
		Отклонения.ВидДвижения = ВидДвиженияНакопления.Расход;
		Отклонения.Количество  = 0;
		Отклонения.ТипЗаписи   = Перечисления.ТипыЗаписейПартий.ОтклонениеВСтоимости;
		
		Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
			// Всю сумму доп расходов по неотфактурованнм поставкам относим на отклонение в стоимости. 
			Если Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией Тогда
				Отклонения[ИмяРесурса.Ключ] = РасчетнаяПартия[ИмяРесурса.Ключ];
			Иначе
				Отклонения[ИмяРесурса.Ключ] = РасчетнаяПартия[ИмяРесурса.Ключ] - СуммовыеРесурсы[ИмяРесурса.Ключ];
			КонецЕсли;
		КонецЦикла;
		
		// Отклонения отражаем как доп. расходы.
		Если ЗначениеЗаполнено(Приход.КорРазделУчета) Тогда
			
			ОтклоненияНаСклад = РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьРасчетнуюПартию(ПараметрыРасчета,, Ложь);
			ЗаполнитьЗначенияСвойств(ОтклоненияНаСклад, Отклонения,
				"Период, Регистратор, ВидЗапасов, Организация, АналитикаФинансовогоУчета, ВидДеятельностиНДС, ХозяйственнаяОперация, ДокументИсточник,
				|НДСРегл, НДСУпр, РасчетЗавершен");
			
			ОтклоненияНаСклад.АналитикаУчетаНоменклатуры = Приход.КорАналитикаУчетаНоменклатуры;
			ОтклоненияНаСклад.РазделУчета 				 = Приход.КорРазделУчета;
			ОтклоненияНаСклад.ВидЗапасов 				 = Приход.КорВидЗапасов;
			ОтклоненияНаСклад.Партия 					 = Приход.КорПартия;
			ОтклоненияНаСклад.АналитикаУчетаПартий  	 = Приход.КорАналитикаУчетаПартий;
			ОтклоненияНаСклад.КорАналитикаУчетаПартий  	 = Приход.АналитикаУчетаПартий;
			ОтклоненияНаСклад.ТипЗаписи 				 = Перечисления.ТипыЗаписейПартий.ОтклонениеВСтоимости;
			ОтклоненияНаСклад.ДопРасходы 				 = Отклонения.Стоимость + Отклонения.ДопРасходы;
			ОтклоненияНаСклад.ДопРасходыБезНДС 			 = Отклонения.СтоимостьБезНДС + Отклонения.ДопРасходыБезНДС;
			ОтклоненияНаСклад.ДопРасходыУпр 			 = Отклонения.СтоимостьУпр + Отклонения.ДопРасходыУпр;
			ОтклоненияНаСклад.ДопРасходыРегл 			 = Отклонения.СтоимостьРегл + Отклонения.ДопРасходыРегл;
			ОтклоненияНаСклад.АналитикаРасходов 		 = Приход.Партия;
			
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область ПроцедурыЭтапа_ЗаполнениеПартийВРегистреВыручкаИСебестоимостьПродаж

// Инициализация данных

Функция ПоляПотребленийПартииВыручки(ПараметрыРасчета)
	
	Возврат "Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета, АналитикаУчетаПоПартнерам, ЗаказКлиента";
	
КонецФункции

Функция ОписаниеЦепочекПартийВыручки(ПараметрыРасчета)
	
	ОписаниеЦепочек = Новый Соответствие;
	ПоляПотреблений	= ПоляПотребленийПартииВыручки(ПараметрыРасчета);
	
	// Потребление <- (Партия)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Потребление, ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.Партия,		ПоляПотреблений);
		
	// ПотреблениеАвто <- (Партия)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ПотреблениеАвто, ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
		Перечисления.ТипыЗаписейПартий.Партия,		ПоляПотреблений);	
	
	// Дополнение <- (<без источников - для формирования записей по данным запроса>)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеДополнения(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Дополнение);
	
	Возврат ОписаниеЦепочек;
	
КонецФункции

Функция ОписаниеДвиженийПартийВыручки(ПараметрыРасчета)
	
	КолонкиТаблицыРаспределения = ТаблицаДляРаспределенияПартийВыручки(ПараметрыРасчета).Колонки;
	
	ОписаниеДвижений = РасчетСебестоимостиПрикладныеАлгоритмы.ОписаниеДвижений();
	ОписаниеДвижений.Вставить("Контекст", "ЗаполнениеПартийВРегистреВыручкаИСебестоимостьПродаж");
	ОписаниеДвижений.Вставить("ИмяРегистра", Метаданные.РегистрыНакопления.ВыручкаИСебестоимостьПродаж.Имя);
	ОписаниеДвижений.Вставить("ПоляРасчета", РасчетСебестоимостиПрикладныеАлгоритмы.ПереченьПолей(КолонкиТаблицыРаспределения));
	ОписаниеДвижений.Вставить("КлючиСравнения",	ПоляПотребленийПартииВыручки(ПараметрыРасчета));
	ОписаниеДвижений.Вставить("Показатели", "Количество, Стоимость, СтоимостьБезНДС, ДопРасходы, ДопРасходыБезНДС,
		|СуммаВыручки, СуммаВыручкиБезНДС, СуммаВыручкиРегл, СуммаВыручкиСНДСРегл, СуммаРучнойСкидки, СуммаАвтоматическойСкидки,
		|СтоимостьРегл, ПостояннаяРазница, ВременнаяРазница,
		|СтоимостьЗабалансовая, Трудозатраты, ПостатейныеПостоянныеСНДС, ПостатейныеПостоянныеБезНДС,
		|ПостатейныеПеременныеСНДС, ПостатейныеПеременныеБезНДС,
		|СтоимостьУпр, ДопРасходыУпр, ТрудозатратыУпр, ПостатейныеПостоянныеУпр, ПостатейныеПеременныеУпр,
		|СтоимостьЗабалансоваяРегл, ДопРасходыРегл, ТрудозатратыРегл,
		|ПостатейныеПостоянныеРегл, ПостатейныеПеременныеРегл,
		|СуммаВВалютеВзаиморасчетов, СуммаБезНДСВВалютеВзаиморасчетов, СуммаВВалютеДокумента, СуммаБезНДСВВалютеДокумента");
	ОписаниеДвижений.Вставить("БазисПрихода", "Количество");
	ОписаниеДвижений.Вставить("БазисРасхода", "Количество");
	ОписаниеДвижений.Вставить("ПолеПорядка", "Период");
	ОписаниеДвижений.Вставить("ПоляСортировки", "ВидДеятельностиНДС, АналитикаФинансовогоУчета");
	ОписаниеДвижений.Вставить("СортировкаПоУсловию", Истина);
	ОписаниеДвижений.Вставить("ЕстьСторно", Истина);
	
	Возврат ОписаниеДвижений;
	
КонецФункции

Функция ОписаниеНезаписываемыхПартийВыручки(ПараметрыРасчета)
	
	НезаписываемыеТипыЗаписей = Новый Соответствие;
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.Партия, Истина);
	
	НезаписываемыеРазделы = Новый Соответствие;
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ОписаниеНезаписываемыхДанных(Истина, НезаписываемыеТипыЗаписей, НезаписываемыеРазделы);
	
КонецФункции

Функция ТаблицаДляРаспределенияПартийВыручки(ПараметрыРасчета)
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ТаблицаДляРаспределенияПартий(ПараметрыРасчета,
		ТекстОписаниеДанныхПартийВыручки());
	
КонецФункции

// Выборка данных

Процедура ПолучитьДанныеДляПартийВыручки(ПараметрыРасчета)
	
	ПараметрыНумерации = РасчетСебестоимостиПрикладныеАлгоритмы.СформироватьПараметрыНумерацииСтрокВременнойТаблицы(
		"АналитикаУчетаНоменклатуры", // разделитель
		ПараметрыРасчета.РаспределениеПартий.ОписаниеДвижений.Показатели, // ресурсы
		ПоляПотребленийПартииВыручки(ПараметрыРасчета)); // порядок
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьДанныеЭтапаРасчета(
		ПараметрыРасчета,
		ТекстЗапросаДляПартийВыручки(ПараметрыРасчета),
		ПараметрыНумерации);
	
КонецПроцедуры

// Тексты запросов

// ... общий

Функция ТекстЗапросаДляПартийВыручки(ПараметрыРасчета = Неопределено) Экспорт
	
	ТекстЗапроса = ""
		// подготовка временных таблиц
		+ ТекстИнициализацияПартийВыручки()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()
		// выборка данных
		+ ТекстОписаниеДанныхПартийВыручки() // вт Данные
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстПартииДляВыручки()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстПартииДляВыручкиБезКоличества()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстВыручкаБезПартий()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстВыручкаБезПартийБезКоличества()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстВыручкаСохраняемыеДвижения()
		+ "";
	
	Возврат ТекстЗапроса;
	
КонецФункции

// ... описания данных

Функция ТекстОписаниеДанныхПартийВыручки()
	Возврат 
		"ВЫБРАТЬ ПЕРВЫЕ 0
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(80)) 						  КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПустаяСсылка) КАК ТипЗаписи,
		|	ЛОЖЬ 												  КАК РасчетЗавершен,
		|	Т.Период											  КАК Период,
		|	Т.Регистратор										  КАК Регистратор,
		|	ЛОЖЬ 												  КАК Сторно,
		|
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)		  КАК Организация,
		|   Т.АналитикаУчетаНоменклатуры,
		|   Т.ЗаказКлиента,
		|   Т.АналитикаУчетаПоПартнерам,
		|   Т.Подразделение,
		|   Т.ТипЗапасов,
		|   Т.ВидЗапасов,
		|   Т.РазделУчета,
		|   Т.Партия,
		|   Т.АналитикаУчетаПартий,
		|   Т.АналитикаФинансовогоУчета,
		|   Т.ВидДеятельностиНДС,
		|   Т.Менеджер,
		|   Т.Склад,
		|   Т.Соглашение,
		|   Т.Договор,
		|   Т.ХозяйственнаяОперация,
		|   Т.АналитикаУчетаНаборов,
		|   Т.НаправлениеДеятельностиКонтрагента,
		|   Т.НаправлениеДеятельностиНоменклатуры,
		|
		|   Т.Количество,
		|   Т.СуммаВыручки,
		|   Т.СуммаВыручкиБезНДС,
		|   Т.Стоимость,
		|   Т.СтоимостьБезНДС,
		|   Т.ДопРасходы,
		|   Т.ДопРасходыБезНДС,
		|   Т.СтоимостьРегл,
		|   Т.СуммаВыручкиРегл,
		|   Т.ПостояннаяРазница,
		|   Т.ВременнаяРазница,
		|   Т.СуммаВыручкиСНДСРегл,
		|   Т.СуммаРучнойСкидки,
		|   Т.СуммаАвтоматическойСкидки,
		|   Т.СтоимостьЗабалансовая,
		|   Т.Трудозатраты,
		|   Т.ПостатейныеПостоянныеСНДС,
		|   Т.ПостатейныеПеременныеСНДС,
		|   Т.ПостатейныеПостоянныеБезНДС,
		|   Т.ПостатейныеПеременныеБезНДС,
		|   Т.СтоимостьЗабалансоваяРегл,
		|   Т.ДопРасходыРегл,
		|   Т.ТрудозатратыРегл,
		|   Т.ПостатейныеПостоянныеРегл,
		|   Т.ПостатейныеПеременныеРегл,
		|   Т.СтоимостьУпр,
		|   Т.ДопРасходыУпр,
		|   Т.ТрудозатратыУпр,
		|   Т.ПостатейныеПостоянныеУпр,
		|   Т.ПостатейныеПеременныеУпр,
		|
		|   Т.НалогообложениеНДС,
		|   Т.ВалютаВзаиморасчетов,
		|   Т.СуммаВВалютеВзаиморасчетов,
		|   Т.СуммаБезНДСВВалютеВзаиморасчетов,
		|   Т.ВалютаДокумента,
		|   Т.СуммаВВалютеДокумента,
		|   Т.СуммаБезНДСВВалютеДокумента,
		|   Т.ИсточникГФУНоменклатуры,
		|   Т.ИсточникГФУРасчетов,
		|   Т.ДокументДвижения
		|//ВоВременнуюТаблицу
		|ИЗ
		|	РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Т
		|";
КонецФункции

// ... формирования временные таблиц

Функция ТекстИнициализацияПартийВыручки()
	Возврат "
		|ВЫБРАТЬ
		|	Т.Период,
		|	Т.Регистратор,
		|	АналитикаПартнеров.Организация КАК Организация,
		|   Т.АналитикаУчетаНоменклатуры,
		|   Т.ЗаказКлиента,
		|   Т.АналитикаУчетаПоПартнерам,
		|   Т.Подразделение,
		|   Т.ТипЗапасов,
		|   Т.ВидЗапасов,
		|   Т.РазделУчета,
		|   Т.Менеджер,
		|   Т.Склад,
		|   Т.Соглашение,
		|   Т.Договор,
		|   Т.ХозяйственнаяОперация,
		|   Т.АналитикаУчетаНаборов,
		|   Т.НаправлениеДеятельностиКонтрагента,
		|   Т.НаправлениеДеятельностиНоменклатуры,
		|   Т.НалогообложениеНДС,
		|   Т.ВалютаВзаиморасчетов,
		|   Т.ВалютаДокумента,
		|   Т.ИсточникГФУНоменклатуры,
		|   Т.ИсточникГФУРасчетов,
		|   Т.ДокументДвижения,
		|
		|	СУММА(Т.Количество) КАК Количество,
		|	СУММА(Т.СуммаВыручки) КАК СуммаВыручки,
		|	СУММА(Т.СуммаВыручкиБезНДС) КАК СуммаВыручкиБезНДС,
		|	СУММА(Т.Стоимость) КАК Стоимость,
		|	СУММА(Т.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(Т.ДопРасходы) КАК ДопРасходы,
		|	СУММА(Т.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		|	СУММА(Т.СтоимостьРегл) КАК СтоимостьРегл,
		|	СУММА(Т.СуммаВыручкиРегл) КАК СуммаВыручкиРегл,
		|	СУММА(Т.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(Т.ВременнаяРазница) КАК ВременнаяРазница,
		|	СУММА(Т.СуммаВыручкиСНДСРегл) КАК СуммаВыручкиСНДСРегл,
		|	СУММА(Т.СуммаРучнойСкидки) КАК СуммаРучнойСкидки,
		|	СУММА(Т.СуммаАвтоматическойСкидки) КАК СуммаАвтоматическойСкидки,
		|	СУММА(Т.СтоимостьЗабалансовая) КАК СтоимостьЗабалансовая,
		|	СУММА(Т.Трудозатраты) КАК Трудозатраты,
		|	СУММА(Т.ПостатейныеПостоянныеСНДС) КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(Т.ПостатейныеПеременныеСНДС) КАК ПостатейныеПеременныеСНДС,
		|	СУММА(Т.ПостатейныеПостоянныеБезНДС) КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(Т.ПостатейныеПеременныеБезНДС) КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(Т.СтоимостьЗабалансоваяРегл) КАК СтоимостьЗабалансоваяРегл,
		|	СУММА(Т.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	СУММА(Т.ТрудозатратыРегл) КАК ТрудозатратыРегл,
		|	СУММА(Т.ПостатейныеПостоянныеРегл) КАК ПостатейныеПостоянныеРегл,
		|	СУММА(Т.ПостатейныеПеременныеРегл) КАК ПостатейныеПеременныеРегл,
		|	СУММА(Т.СтоимостьУпр) КАК СтоимостьУпр,
		|	СУММА(Т.ДопРасходыУпр) КАК ДопРасходыУпр,
		|	СУММА(Т.ТрудозатратыУпр) КАК ТрудозатратыУпр,
		|	СУММА(Т.ПостатейныеПостоянныеУпр) КАК ПостатейныеПостоянныеУпр,
		|	СУММА(Т.ПостатейныеПеременныеУпр) КАК ПостатейныеПеременныеУпр,
		|
		|   СУММА(Т.СуммаВВалютеВзаиморасчетов) КАК СуммаВВалютеВзаиморасчетов,
		|   СУММА(Т.СуммаБезНДСВВалютеВзаиморасчетов) КАК СуммаБезНДСВВалютеВзаиморасчетов,
		|   СУММА(Т.СуммаВВалютеДокумента) КАК СуммаВВалютеДокумента,
		|   СУММА(Т.СуммаБезНДСВВалютеДокумента) КАК СуммаБезНДСВВалютеДокумента
		|ПОМЕСТИТЬ ВТВыручкаБезПартий
		|ИЗ
		|	РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Т
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтборАналитикаПоПартнерам КАК АналитикаПартнеров
		|			ПО Т.АналитикаУчетаПоПартнерам = АналитикаПартнеров.КлючАналитики
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикаНоменклатуры
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|				ПО АналитикаНоменклатуры.Номенклатура = СпрНоменклатура.Ссылка
		|			ПО Т.АналитикаУчетаНоменклатуры = АналитикаНоменклатуры.Ссылка
		|ГДЕ
		|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|	И НЕ Т.Регистратор ССЫЛКА Документ.ВводОстатков
		|	И СпрНоменклатура.ТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
		|	И НЕ Т.РасчетПартий
		|	И НЕ Т.РасчетСебестоимости
		|	И Т.Активность
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.Период,
		|	Т.Регистратор,
		|	АналитикаПартнеров.Организация,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.ЗаказКлиента,
		|	Т.АналитикаУчетаПоПартнерам,
		|	Т.Подразделение,
		|	Т.ТипЗапасов,
		|	Т.ВидЗапасов,
		|	Т.РазделУчета,
		|	Т.Менеджер,
		|	Т.Склад,
		|	Т.Соглашение,
		|	Т.Договор,
		|	Т.ХозяйственнаяОперация,
		|	Т.АналитикаУчетаНаборов,
		|	Т.НаправлениеДеятельностиКонтрагента,
		|	Т.НаправлениеДеятельностиНоменклатуры,
		|	Т.НалогообложениеНДС,
		|	Т.ВалютаВзаиморасчетов,
		|	Т.ВалютаДокумента,
		|	Т.ИсточникГФУНоменклатуры,
		|	Т.ИсточникГФУРасчетов,
		|	Т.ДокументДвижения
		|;
		|////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Т.Регистратор,
		|   Т.ЗаказКлиента
		|ПОМЕСТИТЬ ВТКорректировкиСумм
		|ИЗ
		|	ВТВыручкаБезПартий КАК Т
		|ГДЕ
		|	Т.Количество = 0
		|
		|;
		|////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|   Т.Регистратор,
		|	Т.ЗаказКлиента,
		|	Отбор.Регистратор КАК Корректировка
		|ПОМЕСТИТЬ ВТДокументыРеализации
		|ИЗ
		|	РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Т
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТКорректировкиСумм КАК Отбор
		|			ПО Т.ЗаказКлиента = Отбор.ЗаказКлиента
		|ГДЕ
		|	Т.Период <= &КонецПериода
		|	И НЕ Т.РасчетПартий
		|	И НЕ Т.РасчетСебестоимости
		|	И Т.Активность
		|	И Т.Количество <> 0
		|	И (Отбор.ЗаказКлиента <> НЕОПРЕДЕЛЕНО ИЛИ Т.Регистратор = Отбор.Регистратор)
		|
		|;
		|////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Т.Период,
		|	Т.Регистратор,
		|	Регистраторы.Корректировка,
		|   Т.Организация,
		|   Т.АналитикаУчетаНоменклатуры,
		|   Т.ЗаказКлиента,
		|   Т.АналитикаУчетаПоПартнерам,
		|   Т.ВидЗапасов,
		|   Т.РазделУчета,
		|   Т.Партия,
		|   Т.АналитикаУчетаПартий,
		|   Т.АналитикаФинансовогоУчета,
		|   Т.ВидДеятельностиНДС,
		|   Т.ХозяйственнаяОперация,
		|   Т.Количество
		|ПОМЕСТИТЬ ВТПартииДляКорректировокСумм
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДокументыРеализации КАК Регистраторы
		|		ПО Т.Регистратор = Регистраторы.Регистратор
		|ГДЕ
		|	Т.Количество <> 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Т.Период,
		|	Т.Регистратор,
		|	Регистраторы.Корректировка,
		|   Т.Организация,
		|   Т.АналитикаУчетаНоменклатуры,
		|   Т.ЗаказКлиента,
		|   Т.АналитикаУчетаПоПартнерам,
		|   Т.ВидЗапасов,
		|   Т.РазделУчета,
		|   Т.Партия,
		|   Т.АналитикаУчетаПартий,
		|   Т.АналитикаФинансовогоУчета,
		|   Т.ВидДеятельностиНДС,
		|   Т.ХозяйственнаяОперация,
		|   Т.Количество
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДокументыРеализации КАК Регистраторы
		|		ПО Т.Регистратор = Регистраторы.Регистратор
		|ГДЕ
		|	Т.Период < &НачалоПериода
		|	И НЕ Т.РасчетПартий
		|	И НЕ Т.РасчетСебестоимости
		|	И Т.Активность
		|	И Т.Количество <> 0
		|;
		|////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Т.Период КАК Период,
		|	Т.Регистратор КАК Регистратор,
		|	Т.Организация КАК Организация,
		|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	Т.ЗаказКлиента КАК ЗаказКлиента,
		|	Т.АналитикаУчетаПоПартнерам КАК АналитикаУчетаПоПартнерам,
		|	Т.Подразделение КАК Подразделение,
		|	Т.ТипЗапасов КАК ТипЗапасов,
		|	Т.ВидЗапасов КАК ВидЗапасов,
		|	Т.РазделУчета КАК РазделУчета,
		|	Т.Менеджер КАК Менеджер,
		|	Т.Склад КАК Склад,
		|	Т.Соглашение КАК Соглашение,
		|	Т.Договор КАК Договор,
		|	Т.ХозяйственнаяОперация КАК ХозяйственнаяОперация,
		|	Т.АналитикаУчетаНаборов КАК АналитикаУчетаНаборов,
		|	Т.НаправлениеДеятельностиКонтрагента КАК НаправлениеДеятельностиКонтрагента,
		|	Т.НаправлениеДеятельностиНоменклатуры КАК НаправлениеДеятельностиНоменклатуры,
		|	СУММА(Реализации.Количество) КАК Количество,
		|	СУММА(ВЫБОР КОГДА Реализации.Количество > 0 ТОГДА Реализации.Количество ИНАЧЕ 0 КОНЕЦ) КАК КоличествоПоложительное,
		|	МИНИМУМ(Т.СуммаВыручки) КАК СуммаВыручки,
		|	МИНИМУМ(Т.СуммаВыручкиБезНДС) КАК СуммаВыручкиБезНДС,
		|	МИНИМУМ(Т.Стоимость) КАК Стоимость,
		|	МИНИМУМ(Т.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	МИНИМУМ(Т.ДопРасходы) КАК ДопРасходы,
		|	МИНИМУМ(Т.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		|	МИНИМУМ(Т.СтоимостьРегл) КАК СтоимостьРегл,
		|	МИНИМУМ(Т.СуммаВыручкиРегл) КАК СуммаВыручкиРегл,
		|	МИНИМУМ(Т.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	МИНИМУМ(Т.ВременнаяРазница) КАК ВременнаяРазница,
		|	МИНИМУМ(Т.СуммаВыручкиСНДСРегл) КАК СуммаВыручкиСНДСРегл,
		|	МИНИМУМ(Т.СуммаРучнойСкидки) КАК СуммаРучнойСкидки,
		|	МИНИМУМ(Т.СуммаАвтоматическойСкидки) КАК СуммаАвтоматическойСкидки,
		|	МИНИМУМ(Т.СтоимостьЗабалансовая) КАК СтоимостьЗабалансовая,
		|	МИНИМУМ(Т.Трудозатраты) КАК Трудозатраты,
		|	МИНИМУМ(Т.ПостатейныеПостоянныеСНДС) КАК ПостатейныеПостоянныеСНДС,
		|	МИНИМУМ(Т.ПостатейныеПеременныеСНДС) КАК ПостатейныеПеременныеСНДС,
		|	МИНИМУМ(Т.ПостатейныеПостоянныеБезНДС) КАК ПостатейныеПостоянныеБезНДС,
		|	МИНИМУМ(Т.ПостатейныеПеременныеБезНДС) КАК ПостатейныеПеременныеБезНДС,
		|	МИНИМУМ(Т.СтоимостьЗабалансоваяРегл) КАК СтоимостьЗабалансоваяРегл,
		|	МИНИМУМ(Т.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	МИНИМУМ(Т.ТрудозатратыРегл) КАК ТрудозатратыРегл,
		|	МИНИМУМ(Т.ПостатейныеПостоянныеРегл) КАК ПостатейныеПостоянныеРегл,
		|	МИНИМУМ(Т.ПостатейныеПеременныеРегл) КАК ПостатейныеПеременныеРегл,
		|	МИНИМУМ(Т.СтоимостьУпр) КАК СтоимостьУпр,
		|	МИНИМУМ(Т.ДопРасходыУпр) КАК ДопРасходыУпр,
		|	МИНИМУМ(Т.ТрудозатратыУпр) КАК ТрудозатратыУпр,
		|	МИНИМУМ(Т.ПостатейныеПостоянныеУпр) КАК ПостатейныеПостоянныеУпр,
		|	МИНИМУМ(Т.ПостатейныеПеременныеУпр) КАК ПостатейныеПеременныеУпр,
		|	Т.НалогообложениеНДС КАК НалогообложениеНДС,
		|	Т.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
		|	МИНИМУМ(Т.СуммаВВалютеВзаиморасчетов) КАК СуммаВВалютеВзаиморасчетов,
		|	МИНИМУМ(Т.СуммаБезНДСВВалютеВзаиморасчетов) КАК СуммаБезНДСВВалютеВзаиморасчетов,
		|	Т.ВалютаДокумента КАК ВалютаДокумента,
		|	МИНИМУМ(Т.СуммаВВалютеДокумента) КАК СуммаВВалютеДокумента,
		|	МИНИМУМ(Т.СуммаБезНДСВВалютеДокумента) КАК СуммаБезНДСВВалютеДокумента,
		|	Т.ИсточникГФУНоменклатуры КАК ИсточникГФУНоменклатуры,
		|	Т.ИсточникГФУРасчетов КАК ИсточникГФУРасчетов,
		|	Т.ДокументДвижения КАК ДокументДвижения
		|ПОМЕСТИТЬ ВТВыручкаБезПартийБезКоличества
		|ИЗ
		|	ВТВыручкаБезПартий КАК Т
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТКорректировкиСумм КАК Корректировки
		|		ПО Т.Регистратор = Корректировки.Регистратор
		|			И Т.ЗаказКлиента = Корректировки.ЗаказКлиента
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТПартииДляКорректировокСумм КАК Реализации
		|		ПО Т.АналитикаУчетаНоменклатуры = Реализации.АналитикаУчетаНоменклатуры
		|			И Т.ВидЗапасов = Реализации.ВидЗапасов
		|			И Т.Организация = Реализации.Организация
		|			И Т.РазделУчета = Реализации.РазделУчета
		|			И (Т.АналитикаУчетаПоПартнерам = Реализации.АналитикаУчетаПоПартнерам
		|				ИЛИ Реализации.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности)
		|				И Реализации.АналитикаУчетаПоПартнерам = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПоПартнерам.ПустаяСсылка))
		|			И (Т.ЗаказКлиента = Реализации.ЗаказКлиента
		|				ИЛИ Реализации.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности)
		|				И Реализации.ЗаказКлиента = НЕОПРЕДЕЛЕНО)
		|			И Т.Регистратор = Реализации.Корректировка
		|ГДЕ
		|	Т.Количество = 0
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.Период,
		|	Т.Регистратор,
		|	Т.Организация,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.ЗаказКлиента,
		|	Т.АналитикаУчетаПоПартнерам,
		|	Т.Подразделение,
		|	Т.ТипЗапасов,
		|	Т.ВидЗапасов,
		|	Т.РазделУчета,
		|	Т.Менеджер,
		|	Т.Склад,
		|	Т.Соглашение,
		|	Т.Договор,
		|	Т.ХозяйственнаяОперация,
		|	Т.АналитикаУчетаНаборов,
		|	Т.НаправлениеДеятельностиКонтрагента,
		|	Т.НаправлениеДеятельностиНоменклатуры,
		|	Т.НалогообложениеНДС,
		|	Т.ВалютаВзаиморасчетов,
		|	Т.ВалютаДокумента,
		|	Т.ИсточникГФУНоменклатуры,
		|	Т.ИсточникГФУРасчетов,
		|	Т.ДокументДвижения
		|
		|;
		|////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Т.Регистратор
		|ПОМЕСТИТЬ ВТРегистраторыВыручки
		|ИЗ
		|	ВТВыручкаБезПартий КАК Т
		|";
	
КонецФункции

// ... выборки данных

Функция ТекстПартииДляВыручки()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстПартииДляВыручки"" 						  	  КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)  	  КАК ТипЗаписи,
		|	ИСТИНА 												  КАК РасчетЗавершен,
		|	Т.Период											  КАК Период,
		|	Т.Регистратор										  КАК Регистратор,
		|	ВЫБОР КОГДА Т.Количество < 0 ТОГДА ИСТИНА ИНАЧЕ ЛОЖЬ КОНЕЦ КАК Сторно,
		|
		|   Т.Организация,
		|   Т.АналитикаУчетаНоменклатуры,
		|   Т.ЗаказКлиента,
		|   Т.АналитикаУчетаПоПартнерам,
		|   НЕОПРЕДЕЛЕНО КАК Подразделение,
		|   НЕОПРЕДЕЛЕНО КАК ТипЗапасов,
		|   Т.ВидЗапасов,
		|   Т.РазделУчета,
		|   Т.Партия,
		|   Т.АналитикаУчетаПартий,
		|   Т.АналитикаФинансовогоУчета,
		|   Т.ВидДеятельностиНДС,
		|   НЕОПРЕДЕЛЕНО КАК Менеджер,
		|   НЕОПРЕДЕЛЕНО КАК Склад,
		|   НЕОПРЕДЕЛЕНО КАК Соглашение,
		|   НЕОПРЕДЕЛЕНО КАК Договор,
		|   НЕОПРЕДЕЛЕНО КАК ХозяйственнаяОперация,
		|   НЕОПРЕДЕЛЕНО КАК АналитикаУчетаНаборов,
		|   НЕОПРЕДЕЛЕНО КАК НаправлениеДеятельностиКонтрагента,
		|   НЕОПРЕДЕЛЕНО КАК НаправлениеДеятельностиНоменклатуры,
		|
		|   Т.Количество,
		|   0 КАК СуммаВыручки,
		|   0 КАК СуммаВыручкиБезНДС,
		|   0 КАК Стоимость,
		|   0 КАК СтоимостьБезНДС,
		|   0 КАК ДопРасходы,
		|   0 КАК ДопРасходыБезНДС,
		|   0 КАК СтоимостьРегл,
		|   0 КАК СуммаВыручкиРегл,
		|   0 КАК ПостояннаяРазница,
		|   0 КАК ВременнаяРазница,
		|   0 КАК СуммаВыручкиСНДСРегл,
		|   0 КАК СуммаРучнойСкидки,
		|   0 КАК СуммаАвтоматическойСкидки,
		|   0 КАК СтоимостьЗабалансовая,
		|   0 КАК Трудозатраты,
		|   0 КАК ПостатейныеПостоянныеСНДС,
		|   0 КАК ПостатейныеПеременныеСНДС,
		|   0 КАК ПостатейныеПостоянныеБезНДС,
		|   0 КАК ПостатейныеПеременныеБезНДС,
		|   0 КАК СтоимостьЗабалансоваяРегл,
		|   0 КАК ДопРасходыРегл,
		|   0 КАК ТрудозатратыРегл,
		|   0 КАК ПостатейныеПостоянныеРегл,
		|   0 КАК ПостатейныеПеременныеРегл,
		|   0 КАК СтоимостьУпр,
		|   0 КАК ДопРасходыУпр,
		|   0 КАК ТрудозатратыУпр,
		|   0 КАК ПостатейныеПостоянныеУпр,
		|   0 КАК ПостатейныеПеременныеУпр,
		|
		|   НЕОПРЕДЕЛЕНО КАК НалогообложениеНДС,
		|   НЕОПРЕДЕЛЕНО КАК ВалютаВзаиморасчетов,
		|   0 КАК СуммаВВалютеВзаиморасчетов,
		|   0 КАК СуммаБезНДСВВалютеВзаиморасчетов,
		|   НЕОПРЕДЕЛЕНО КАК ВалютаДокумента,
		|   0 КАК СуммаВВалютеДокумента,
		|   0 КАК СуммаБезНДСВВалютеДокумента,
		|   НЕОПРЕДЕЛЕНО КАК ИсточникГФУНоменклатуры,
		|   НЕОПРЕДЕЛЕНО КАК ИсточникГФУРасчетов,
		|   НЕОПРЕДЕЛЕНО КАК ДокументДвижения
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТРегистраторыВыручки КАК Регистраторы
		|		ПО Т.Регистратор = Регистраторы.Регистратор
		|ГДЕ
		|	Т.Количество <> 0
		|";
КонецФункции

Функция ТекстПартииДляВыручкиБезКоличества()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстПартииДляВыручкиБезКоличества"" 				  КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)  	  КАК ТипЗаписи,
		|	ИСТИНА 												  КАК РасчетЗавершен,
		|	Т.Период											  КАК Период,
		|	Т.Корректировка										  КАК Регистратор,
		|	ВЫБОР КОГДА СУММА(Т.Количество) < 0 ТОГДА ИСТИНА ИНАЧЕ ЛОЖЬ КОНЕЦ КАК Сторно,
		|
		|   Т.Организация,
		|   Т.АналитикаУчетаНоменклатуры,
		|   Т.ЗаказКлиента,
		|   Т.АналитикаУчетаПоПартнерам,
		|   НЕОПРЕДЕЛЕНО КАК Подразделение,
		|   НЕОПРЕДЕЛЕНО КАК ТипЗапасов,
		|   Т.ВидЗапасов,
		|   Т.РазделУчета,
		|   Т.Партия,
		|   Т.АналитикаУчетаПартий,
		|   Т.АналитикаФинансовогоУчета,
		|   Т.ВидДеятельностиНДС,
		|   НЕОПРЕДЕЛЕНО КАК Менеджер,
		|   НЕОПРЕДЕЛЕНО КАК Склад,
		|   НЕОПРЕДЕЛЕНО КАК Соглашение,
		|   НЕОПРЕДЕЛЕНО КАК Договор,
		|   НЕОПРЕДЕЛЕНО КАК ХозяйственнаяОперация,
		|   НЕОПРЕДЕЛЕНО КАК АналитикаУчетаНаборов,
		|   НЕОПРЕДЕЛЕНО КАК НаправлениеДеятельностиКонтрагента,
		|   НЕОПРЕДЕЛЕНО КАК НаправлениеДеятельностиНоменклатуры,
		|
		|   СУММА(Т.Количество) КАК Количество,
		|   0 КАК СуммаВыручки,
		|   0 КАК СуммаВыручкиБезНДС,
		|   0 КАК Стоимость,
		|   0 КАК СтоимостьБезНДС,
		|   0 КАК ДопРасходы,
		|   0 КАК ДопРасходыБезНДС,
		|   0 КАК СтоимостьРегл,
		|   0 КАК СуммаВыручкиРегл,
		|   0 КАК ПостояннаяРазница,
		|   0 КАК ВременнаяРазница,
		|   0 КАК СуммаВыручкиСНДСРегл,
		|   0 КАК СуммаРучнойСкидки,
		|   0 КАК СуммаАвтоматическойСкидки,
		|   0 КАК СтоимостьЗабалансовая,
		|   0 КАК Трудозатраты,
		|   0 КАК ПостатейныеПостоянныеСНДС,
		|   0 КАК ПостатейныеПеременныеСНДС,
		|   0 КАК ПостатейныеПостоянныеБезНДС,
		|   0 КАК ПостатейныеПеременныеБезНДС,
		|   0 КАК СтоимостьЗабалансоваяРегл,
		|   0 КАК ДопРасходыРегл,
		|   0 КАК ТрудозатратыРегл,
		|   0 КАК ПостатейныеПостоянныеРегл,
		|   0 КАК ПостатейныеПеременныеРегл,
		|   0 КАК СтоимостьУпр,
		|   0 КАК ДопРасходыУпр,
		|   0 КАК ТрудозатратыУпр,
		|   0 КАК ПостатейныеПостоянныеУпр,
		|   0 КАК ПостатейныеПеременныеУпр,
		|
		|   НЕОПРЕДЕЛЕНО КАК НалогообложениеНДС,
		|   НЕОПРЕДЕЛЕНО КАК ВалютаВзаиморасчетов,
		|   0 КАК СуммаВВалютеВзаиморасчетов,
		|   0 КАК СуммаБезНДСВВалютеВзаиморасчетов,
		|   НЕОПРЕДЕЛЕНО КАК ВалютаДокумента,
		|   0 КАК СуммаВВалютеДокумента,
		|   0 КАК СуммаБезНДСВВалютеДокумента,
		|   НЕОПРЕДЕЛЕНО КАК ИсточникГФУНоменклатуры,
		|   НЕОПРЕДЕЛЕНО КАК ИсточникГФУРасчетов,
		|   НЕОПРЕДЕЛЕНО КАК ДокументДвижения
		|ИЗ
		|	ВТПартииДляКорректировокСумм КАК Т
		|СГРУППИРОВАТЬ ПО
		|	Т.Период,
		|	Т.Корректировка,
		|   Т.Организация,
		|   Т.АналитикаУчетаНоменклатуры,
		|   Т.ЗаказКлиента,
		|   Т.АналитикаУчетаПоПартнерам,
		|   Т.ВидЗапасов,
		|   Т.РазделУчета,
		|   Т.Партия,
		|   Т.АналитикаУчетаПартий,
		|   Т.АналитикаФинансовогоУчета,
		|   Т.ВидДеятельностиНДС
		|";
КонецФункции

Функция ТекстВыручкаБезПартий()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстВыручкаБезПартий"" 						  	  КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)  КАК ТипЗаписи,
		|	ЛОЖЬ 												  КАК РасчетЗавершен,
		|	Т.Период											  КАК Период,
		|	Т.Регистратор										  КАК Регистратор,
		|	ВЫБОР КОГДА Т.Количество < 0 ТОГДА ИСТИНА ИНАЧЕ ЛОЖЬ КОНЕЦ КАК Сторно,
		|
		|	Т.Организация,
		|   Т.АналитикаУчетаНоменклатуры,
		|   Т.ЗаказКлиента,
		|   Т.АналитикаУчетаПоПартнерам,
		|   Т.Подразделение,
		|   Т.ТипЗапасов,
		|   Т.ВидЗапасов,
		|   Т.РазделУчета,
		|   НЕОПРЕДЕЛЕНО КАК Партия,
		|   НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
		|   НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|   НЕОПРЕДЕЛЕНО КАК ВидДеятельностиНДС,
		|   Т.Менеджер,
		|   Т.Склад,
		|   Т.Соглашение,
		|   Т.Договор,
		|   Т.ХозяйственнаяОперация,
		|   Т.АналитикаУчетаНаборов,
		|   Т.НаправлениеДеятельностиКонтрагента,
		|   Т.НаправлениеДеятельностиНоменклатуры,
		|
		|   Т.Количество,
		|   Т.СуммаВыручки,
		|   Т.СуммаВыручкиБезНДС,
		|   Т.Стоимость,
		|   Т.СтоимостьБезНДС,
		|   Т.ДопРасходы,
		|   Т.ДопРасходыБезНДС,
		|   Т.СтоимостьРегл,
		|   Т.СуммаВыручкиРегл,
		|   Т.ПостояннаяРазница,
		|   Т.ВременнаяРазница,
		|   Т.СуммаВыручкиСНДСРегл,
		|   Т.СуммаРучнойСкидки,
		|   Т.СуммаАвтоматическойСкидки,
		|   Т.СтоимостьЗабалансовая,
		|   Т.Трудозатраты,
		|   Т.ПостатейныеПостоянныеСНДС,
		|   Т.ПостатейныеПеременныеСНДС,
		|   Т.ПостатейныеПостоянныеБезНДС,
		|   Т.ПостатейныеПеременныеБезНДС,
		|   Т.СтоимостьЗабалансоваяРегл,
		|   Т.ДопРасходыРегл,
		|   Т.ТрудозатратыРегл,
		|   Т.ПостатейныеПостоянныеРегл,
		|   Т.ПостатейныеПеременныеРегл,
		|   Т.СтоимостьУпр,
		|   Т.ДопРасходыУпр,
		|   Т.ТрудозатратыУпр,
		|   Т.ПостатейныеПостоянныеУпр,
		|   Т.ПостатейныеПеременныеУпр,
		|
		|   Т.НалогообложениеНДС,
		|   Т.ВалютаВзаиморасчетов,
		|   Т.СуммаВВалютеВзаиморасчетов,
		|   Т.СуммаБезНДСВВалютеВзаиморасчетов,
		|   Т.ВалютаДокумента,
		|   Т.СуммаВВалютеДокумента,
		|   Т.СуммаБезНДСВВалютеДокумента,
		|   Т.ИсточникГФУНоменклатуры,
		|   Т.ИсточникГФУРасчетов,
		|   Т.ДокументДвижения
		|ИЗ
		|	ВТВыручкаБезПартий КАК Т
		|ГДЕ
		|	Т.Количество <> 0
		|";
КонецФункции

Функция ТекстВыручкаБезПартийБезКоличества()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстВыручкаБезПартийБезКоличества"" 				  	 КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПотреблениеАвто) КАК ТипЗаписи,
		|	ЛОЖЬ 												  	 КАК РасчетЗавершен,
		|	Т.Период											  	 КАК Период,
		|	Т.Регистратор										  	 КАК Регистратор,
		|	ВЫБОР КОГДА Т.Количество < 0 ТОГДА ИСТИНА ИНАЧЕ ЛОЖЬ КОНЕЦ КАК Сторно,
		|
		|	Т.Организация,
		|   Т.АналитикаУчетаНоменклатуры,
		|   Т.ЗаказКлиента,
		|   Т.АналитикаУчетаПоПартнерам,
		|   Т.Подразделение,
		|   Т.ТипЗапасов,
		|   Т.ВидЗапасов,
		|   Т.РазделУчета,
		|   НЕОПРЕДЕЛЕНО КАК Партия,
		|   НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
		|   НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|   НЕОПРЕДЕЛЕНО КАК ВидДеятельностиНДС,
		|   Т.Менеджер,
		|   Т.Склад,
		|   Т.Соглашение,
		|   Т.Договор,
		|   Т.ХозяйственнаяОперация,
		|   Т.АналитикаУчетаНаборов,
		|   Т.НаправлениеДеятельностиКонтрагента,
		|   Т.НаправлениеДеятельностиНоменклатуры,
		|
		|   ВЫБОР КОГДА Т.КоличествоПоложительное > 0
		|		ТОГДА Т.КоличествоПоложительное
		|		ИНАЧЕ Т.Количество
		|	КОНЕЦ КАК Количество,
		|   Т.СуммаВыручки,
		|   Т.СуммаВыручкиБезНДС,
		|   Т.Стоимость,
		|   Т.СтоимостьБезНДС,
		|   Т.ДопРасходы,
		|   Т.ДопРасходыБезНДС,
		|   Т.СтоимостьРегл,
		|   Т.СуммаВыручкиРегл,
		|   Т.ПостояннаяРазница,
		|   Т.ВременнаяРазница,
		|   Т.СуммаВыручкиСНДСРегл,
		|   Т.СуммаРучнойСкидки,
		|   Т.СуммаАвтоматическойСкидки,
		|   Т.СтоимостьЗабалансовая,
		|   Т.Трудозатраты,
		|   Т.ПостатейныеПостоянныеСНДС,
		|   Т.ПостатейныеПеременныеСНДС,
		|   Т.ПостатейныеПостоянныеБезНДС,
		|   Т.ПостатейныеПеременныеБезНДС,
		|   Т.СтоимостьЗабалансоваяРегл,
		|   Т.ДопРасходыРегл,
		|   Т.ТрудозатратыРегл,
		|   Т.ПостатейныеПостоянныеРегл,
		|   Т.ПостатейныеПеременныеРегл,
		|   Т.СтоимостьУпр,
		|   Т.ДопРасходыУпр,
		|   Т.ТрудозатратыУпр,
		|   Т.ПостатейныеПостоянныеУпр,
		|   Т.ПостатейныеПеременныеУпр,
		|
		|   Т.НалогообложениеНДС,
		|   Т.ВалютаВзаиморасчетов,
		|   Т.СуммаВВалютеВзаиморасчетов,
		|   Т.СуммаБезНДСВВалютеВзаиморасчетов,
		|   Т.ВалютаДокумента,
		|   Т.СуммаВВалютеДокумента,
		|   Т.СуммаБезНДСВВалютеДокумента,
		|   Т.ИсточникГФУНоменклатуры,
		|   Т.ИсточникГФУРасчетов,
		|   Т.ДокументДвижения
		|ИЗ
		|	ВТВыручкаБезПартийБезКоличества КАК Т
		|";
КонецФункции

Функция ТекстВыручкаСохраняемыеДвижения()
	Возврат 
		"ВЫБРАТЬ
		|	""ТекстВыручкаСохраняемыеДвижения"" 				  КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)   КАК ТипЗаписи,
		|	ИСТИНА 												  КАК РасчетЗавершен,
		|	Т.Период											  КАК Период,
		|	Т.Регистратор										  КАК Регистратор,
		|	ЛОЖЬ 												  КАК Сторно,
		|
		|	АналитикаПартнеров.Организация 						  КАК Организация,
		|   Т.АналитикаУчетаНоменклатуры,
		|   Т.ЗаказКлиента,
		|   Т.АналитикаУчетаПоПартнерам,
		|   Т.Подразделение,
		|   Т.ТипЗапасов,
		|   Т.ВидЗапасов,
		|   Т.РазделУчета,
		|   Т.Партия,
		|   Т.АналитикаУчетаПартий,
		|   Т.АналитикаФинансовогоУчета,
		|   Т.ВидДеятельностиНДС,
		|   Т.Менеджер,
		|   Т.Склад,
		|   Т.Соглашение,
		|   Т.Договор,
		|   Т.ХозяйственнаяОперация,
		|   Т.АналитикаУчетаНаборов,
		|   Т.НаправлениеДеятельностиКонтрагента,
		|   Т.НаправлениеДеятельностиНоменклатуры,
		|
		|   Т.Количество,
		|   Т.СуммаВыручки,
		|   Т.СуммаВыручкиБезНДС,
		|   Т.Стоимость,
		|   Т.СтоимостьБезНДС,
		|   Т.ДопРасходы,
		|   Т.ДопРасходыБезНДС,
		|   Т.СтоимостьРегл,
		|   Т.СуммаВыручкиРегл,
		|   Т.ПостояннаяРазница,
		|   Т.ВременнаяРазница,
		|   Т.СуммаВыручкиСНДСРегл,
		|   Т.СуммаРучнойСкидки,
		|   Т.СуммаАвтоматическойСкидки,
		|   Т.СтоимостьЗабалансовая,
		|   Т.Трудозатраты,
		|   Т.ПостатейныеПостоянныеСНДС,
		|   Т.ПостатейныеПеременныеСНДС,
		|   Т.ПостатейныеПостоянныеБезНДС,
		|   Т.ПостатейныеПеременныеБезНДС,
		|   Т.СтоимостьЗабалансоваяРегл,
		|   Т.ДопРасходыРегл,
		|   Т.ТрудозатратыРегл,
		|   Т.ПостатейныеПостоянныеРегл,
		|   Т.ПостатейныеПеременныеРегл,
		|   Т.СтоимостьУпр,
		|   Т.ДопРасходыУпр,
		|   Т.ТрудозатратыУпр,
		|   Т.ПостатейныеПостоянныеУпр,
		|   Т.ПостатейныеПеременныеУпр,
		|
		|   Т.НалогообложениеНДС,
		|   Т.ВалютаВзаиморасчетов,
		|   Т.СуммаВВалютеВзаиморасчетов,
		|   Т.СуммаБезНДСВВалютеВзаиморасчетов,
		|   Т.ВалютаДокумента,
		|   Т.СуммаВВалютеДокумента,
		|   Т.СуммаБезНДСВВалютеДокумента,
		|   Т.ИсточникГФУНоменклатуры,
		|   Т.ИсточникГФУРасчетов,
		|   Т.ДокументДвижения
		|ИЗ
		|	РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Т
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтборАналитикаПоПартнерам КАК АналитикаПартнеров
		|			ПО Т.АналитикаУчетаПоПартнерам = АналитикаПартнеров.КлючАналитики
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикаНоменклатуры
		|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|				ПО АналитикаНоменклатуры.Номенклатура = СпрНоменклатура.Ссылка
		|			ПО Т.АналитикаУчетаНоменклатуры = АналитикаНоменклатуры.Ссылка
		|ГДЕ
		|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|	И (СпрНоменклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
		|		ИЛИ Т.Регистратор ССЫЛКА Документ.ВводОстатков)
		|	И Т.Активность
		|	И НЕ Т.РасчетПартий
		|	И НЕ Т.РасчетСебестоимости
		|";
КонецФункции

// Заполнение расчетной партии

Процедура ЗаполнитьРасчетнуюПартиюВыручкиИСебестоимостьПродаж(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход)
	
	// Для корректировок сумм без корректировки количества в качестве источников используем только
	// записи с положительным количеством, т.е. берем данные только из реальных реализаций,
	// т.к. в них есть вся нужная информация о корректируемых партиях товаров.
	// Если есть только сторно реализаций, то берем данные из них.
	Если Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ПотреблениеАвто
	 И Приход.Количество <= 0 И Расход.Количество >= 0 Тогда
		КоличествоСписания = 0;
	Иначе
		КоличествоСписания = Мин(Расход.Количество, Приход.Количество);
	КонецЕсли;
	
	Если КоличествоСписания = 0 Тогда
		Возврат;
	КонецЕсли;
	
	СуммовыеРесурсы = Новый Структура(
	"Стоимость, СтоимостьБезНДС, ДопРасходы, ДопРасходыБезНДС,
    |СуммаВыручки, СуммаВыручкиБезНДС, СуммаВыручкиРегл, СуммаВыручкиСНДСРегл, СуммаРучнойСкидки, СуммаАвтоматическойСкидки,
	|СтоимостьРегл, ПостояннаяРазница, ВременнаяРазница,
	|СтоимостьЗабалансовая, Трудозатраты, ПостатейныеПостоянныеСНДС, ПостатейныеПостоянныеБезНДС,
	|ПостатейныеПеременныеСНДС, ПостатейныеПеременныеБезНДС,
	|СтоимостьУпр, ДопРасходыУпр, ТрудозатратыУпр, ПостатейныеПостоянныеУпр, ПостатейныеПеременныеУпр,
	|СтоимостьЗабалансоваяРегл, ДопРасходыРегл, ТрудозатратыРегл,
	|ПостатейныеПостоянныеРегл, ПостатейныеПеременныеРегл,
	|СуммаВВалютеВзаиморасчетов, СуммаБезНДСВВалютеВзаиморасчетов, СуммаВВалютеДокумента, СуммаБезНДСВВалютеДокумента");
	
	// Заполняем расчетную партию по расходной партии-основании
	ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Расход);
	
	//	Заполняем партионную идентификацию в расчетной партии
	ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Приход, "Партия, АналитикаУчетаПартий, ВидДеятельностиНДС, АналитикаФинансовогоУчета");
	
	// Расчетная партия заполняется на наибольшее общее вычитаемое
	РасходБазис = ?(Расход.Количество <> 0, КоличествоСписания / Расход.Количество, 0);
	
	// Заполняем показатели расчетной партии
	
	Если Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ПотреблениеАвто Тогда
		РасчетнаяПартия.Количество = 0;
	Иначе
		РасчетнаяПартия.Количество = КоличествоСписания;
	КонецЕсли;
	
	Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
		РасчетнаяПартия[ИмяРесурса.Ключ] = Окр(РасходБазис * РасчетнаяПартия[ИмяРесурса.Ключ], 2);
		Расход[ИмяРесурса.Ключ] = Расход[ИмяРесурса.Ключ] - РасчетнаяПартия[ИмяРесурса.Ключ];
	КонецЦикла;
	
	// Корректируем базу расчета в приходе и расходе
	Если Расход.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ПотреблениеАвто Тогда
		Приход.Количество = Приход.Количество - КоличествоСписания;
	КонецЕсли;
	Расход.Количество = Расход.Количество - КоличествоСписания;
	
	РасчетнаяПартия.РасчетЗавершен = Истина;
	
КонецПроцедуры

#КонецОбласти

#Область ПроцедурыЭтапов_Контекстные

// Используется для всех вызовов заполнения расчетной партии.
//
Процедура ЗаполнитьРасчетнуюПартию(ПараметрыРасчета, Контекст, РасчетнаяПартия, Расход, Приход, ПартияЗаполнена) Экспорт
	
	Если Контекст = "ЗаполнениеПартийВРегистреСебестоимостьТоваров" Тогда
		ЗаполнитьРасчетнуюПартиюСебестоимостиТоваров(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход);
		ПартияЗаполнена = Истина;
	ИначеЕсли Контекст = "ЗаполнениеПартийВРегистреВыручкаИСебестоимостьПродаж" Тогда
		ЗаполнитьРасчетнуюПартиюВыручкиИСебестоимостьПродаж(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход);
		ПартияЗаполнена = Истина;
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область Тестирование

Процедура ДополнитьЭтапыСРаспределениемПартий(СписокЭтапов) Экспорт
	
	СписокЭтапов.Добавить("ЗаполнениеПартийВРегистреСебестоимостьТоваров");
	СписокЭтапов.Добавить("ЗаполнениеПартийВРегистреВыручкаИСебестоимостьПродаж");
	
КонецПроцедуры

Процедура ДополнитьЭтапыСТрансляциейПартий(СписокЭтапов) Экспорт
	
	// Этапов с трансляцией партий в этом модуле пока нет.
	
КонецПроцедуры

Процедура ТекстЗапросаДляРасчетаЭтапа(ИмяЭтапа, ПараметрыРасчета, ТекстЗапроса) Экспорт
	
	Если ИмяЭтапа = "ЗаполнениеПартийВРегистреСебестоимостьТоваров" Тогда
		ТекстЗапроса = ТекстЗапросаДляПартийТоваров(ПараметрыРасчета);
		
	ИначеЕсли ИмяЭтапа = "ЗаполнениеПартийВРегистреВыручкаИСебестоимостьПродаж" Тогда
		ТекстЗапроса = ТекстЗапросаДляПартийВыручки(ПараметрыРасчета);
		
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#КонецОбласти