
// Вызываются процедуры и функции общих модулей:
//	- РасчетСебестоимостиПрикладныеАлгоритмы.
//	- РасчетСебестоимостиПроизводство

#Область ПрограммныйИнтерфейс

#Область ЭтапыРасчета

// Этап 10 (Контекст: "ДопРасходы_ЗаказыПоставщикам", "ДопРасходы_ПартииПрочихРасходов", "ДопРасходы_ПриходПартийРасходов")
// ПУ 2.1: РассчитатьПартииПрочих(), области РасчетПриходыРасходовСебестоимость, РасчетЗаписейНоменклатураДоходыРасходы.
//
// Параметры:
//	ПараметрыРасчета - Структура - параметры расчета себестоимости
//
Процедура РаспределениеДопРасходовМеждуПартиямиИТоварами(ПараметрыРасчета) Экспорт
	
	РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "РаспределениеДопРасходовМеждуПартиямиИТоварами");
	
	ДанныеДляПартийПрочих = ПолучитьДанныеДляДопРасходов(ПараметрыРасчета);
	
	РасчетСебестоимостиПротоколРасчета.УвеличитьКоличествоОбработанныхДанныхДляЗамера(
		ПараметрыРасчета,
		ДанныеДляПартийПрочих.Количество());
	
	// Формирует движения по регистру ПартииПрочихРасходов
	СформироватьПартииПрочихРасходов(ПараметрыРасчета, ДанныеДляПартийПрочих);
	РасчетСебестоимостиПрикладныеАлгоритмы.КэшироватьСформированныеДвижения(ПараметрыРасчета);
	
	РасчетныеПриходыПартийРасходов = ПолучитьДанныеПриходовПартийРасходов(ПараметрыРасчета, ДанныеДляПартийПрочих);
	ДанныеДляПартийПрочих = Неопределено;
	
	РасчетСебестоимостиПротоколРасчета.УвеличитьКоличествоОбработанныхДанныхДляЗамера(
		ПараметрыРасчета,
		РасчетныеПриходыПартийРасходов.Количество());
	
	// Формирует движения по регистру СебестоимостьТоваров
	СформироватьДопРасходыВСебестоимостьТоваров(ПараметрыРасчета, РасчетныеПриходыПартийРасходов);
	РасчетСебестоимостиПрикладныеАлгоритмы.КэшироватьСформированныеДвижения(ПараметрыРасчета);
	
	// Формирует движения по регистру ПрочиеРасходы
	СформироватьДопРасходыВПрочиеРасходы(ПараметрыРасчета, РасчетныеПриходыПартийРасходов);
	РасчетСебестоимостиПрикладныеАлгоритмы.КэшироватьСформированныеДвижения(ПараметрыРасчета);
	
	// Формирует движения по регистру ПартииПрочихРасходов
	СформироватьДопРасходыВПартииПрочихРасходов(ПараметрыРасчета, РасчетныеПриходыПартийРасходов);
	РасчетСебестоимостиПрикладныеАлгоритмы.КэшироватьСформированныеДвижения(ПараметрыРасчета);
	
	// Формирует движения по регистру ПартииНДСКРаспределению
	СформироватьДопРасходыВПартииНДСКРаспределению(ПараметрыРасчета, РасчетныеПриходыПартийРасходов);
	РасчетСебестоимостиПрикладныеАлгоритмы.КэшироватьСформированныеДвижения(ПараметрыРасчета);
	
	// Формирует движения по регистру ДвиженияНоменклатураДоходыРасходы
	СформироватьДопРасходыВДвиженияНоменклатураДоходыРасходы(ПараметрыРасчета);
	РасчетСебестоимостиПрикладныеАлгоритмы.КэшироватьСформированныеДвижения(ПараметрыРасчета);
	
КонецПроцедуры

// Этап 10.1 (Контекст: "СписаниеРасходовНаВыбытиеТоваров")
//
// Параметры:
//	ПараметрыРасчета - Структура - параметры расчета себестоимости
//
Процедура СписаниеРасходовНаВыбытиеТоваровПрошлыхПериодов(ПараметрыРасчета) Экспорт
	
	РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "СписаниеРасходовНаВыбытиеТоваровПрошлыхПериодов");
	
	// Запомним существующие временные таблицы.
	СуществующиеВТ = РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьПереченьСуществующихВременныхТаблиц(ПараметрыРасчета);
	
	// 1. Инициализация структуры данных для расчета
	//	- формирует структуру ПараметрыРасчета.РаспределениеПартий.
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьТрансляциюПартий(
		ПараметрыРасчета,
		Неопределено,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Имя);
	
	// 2. Получение исходных данных для трансляции
	// 	- формирует временную таблицу Данные.
	ПолучитьДанныеДляСписанияРасходовНаВыбытиеТоваровРегистрСебестоимость(ПараметрыРасчета);
	
	// 3. Помещение данных в таблицу-приемник и очистка вспомогательных временных таблиц.
	// 	- формирует движения по регистру СебестоимостьТоваров.
	РасчетСебестоимостиПрикладныеАлгоритмы.ЗавершитьРаспределениеПартий(ПараметрыРасчета);
	
	// 4. Инициализация структуры данных для расчета
	//	- формирует структуру ПараметрыРасчета.РаспределениеПартий.
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьТрансляциюПартий(
		ПараметрыРасчета,
		Неопределено,
		Метаданные.РегистрыНакопления.ВыручкаИСебестоимостьПродаж.Имя);
	
	// 5. Получение исходных данных для трансляции
	// 	- формирует временную таблицу Данные.
	ПолучитьДанныеДляСписанияРасходовНаВыбытиеТоваровРегистрВыручка(ПараметрыРасчета);
	
	// 6. Помещение данных в таблицу-приемник и очистка вспомогательных временных таблиц.
	// 	- формирует движения по регистру ВыручкаИСебестоимостьПродаж.
	РасчетСебестоимостиПрикладныеАлгоритмы.ЗавершитьРаспределениеПартий(ПараметрыРасчета);
	
	// 7. Инициализация структуры данных для расчета
	//	- формирует структуру ПараметрыРасчета.РаспределениеПартий.
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьТрансляциюПартий(
		ПараметрыРасчета,
		Неопределено,
		Метаданные.РегистрыНакопления.ПрочиеРасходы.Имя);
	
	// 8. Получение исходных данных для трансляции
	// 	- формирует временную таблицу Данные.
	ПолучитьДанныеДляСписанияРасходовНаВыбытиеТоваровРегистрПрочиеРасходы(ПараметрыРасчета);
	
	// 9. Помещение данных в таблицу-приемник и очистка вспомогательных временных таблиц.
	// 	- формирует движения по регистру ПрочиеРасходы.
	РасчетСебестоимостиПрикладныеАлгоритмы.ЗавершитьРаспределениеПартий(ПараметрыРасчета);
	
	// 10. Инициализация структуры данных для расчета
	//	- формирует структуру ПараметрыРасчета.РаспределениеПартий.
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьТрансляциюПартий(
		ПараметрыРасчета,
		Неопределено,
		Метаданные.РегистрыНакопления.ДвиженияНоменклатураДоходыРасходы.Имя);
	
	// 11. Получение исходных данных для трансляции
	// 	- формирует временную таблицу Данные.
	ПолучитьДанныеДляСписанияРасходовНаВыбытиеТоваровРегистрНоменклатураДоходыРасходы(ПараметрыРасчета);
	
	// 12. Помещение данных в таблицу-приемник и очистка вспомогательных временных таблиц.
	// 	- формирует движения по регистру ДвиженияНоменклатураДоходыРасходы.
	РасчетСебестоимостиПрикладныеАлгоритмы.ЗавершитьРаспределениеПартий(ПараметрыРасчета);
	
	// Уничтожим вспомогательные временные таблицы, созданные в данном этапе расчета.
	НовыеВТ = РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьПереченьСуществующихВременныхТаблиц(ПараметрыРасчета, СуществующиеВТ);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.УничтожитьВременныеТаблицы(ПараметрыРасчета, НовыеВТ);
	
КонецПроцедуры


// Этап распределения расходов будущих периодов.
//
// Параметры:
//	ПараметрыРасчета - Структура - параметры расчета себестоимости
//
Процедура РаспределитьРасходыБудущихПериодов(ПараметрыРасчета) Экспорт
	
	РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "РаспределитьРасходыБудущихПериодов");
	
	Запрос = Новый Запрос;
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьСвойстваЗапроса(Запрос, ПараметрыРасчета);
	
	Запрос.Текст = "
	|ВЫБРАТЬ
	|	ДД.Организация,
	|	ДД.Подразделение,
	|	ДД.СтатьяРасходов,
	|	ДД.АналитикаРасходов,
	|	ДД.НаправлениеДеятельности,
	|	МАКСИМУМ(ВЫБОР
	|		КОГДА ДД.ВариантУказанияСуммыУпр = ЗНАЧЕНИЕ(Перечисление.ВариантыУказанияСуммыРБП.ОпределяетсяАвтоматически)
	|		 И Статья.ВариантРаспределенияРасходовУпр = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаРасходыБудущихПериодов)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ КОНЕЦ) КАК РаспределитьУпр,
	|	МАКСИМУМ(ВЫБОР
	|		КОГДА ДД.ВариантУказанияСуммыРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыУказанияСуммыРБП.ОпределяетсяАвтоматически)
	|		 И Статья.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаРасходыБудущихПериодов)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ КОНЕЦ) КАК РаспределитьРегл,
	|	
	|	СУММА(ВЫБОР
	|		КОГДА ДД.ВариантУказанияСуммыУпр = ЗНАЧЕНИЕ(Перечисление.ВариантыУказанияСуммыРБП.ОпределяетсяАвтоматически)
	|		 И Статья.ВариантРаспределенияРасходовУпр = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаРасходыБудущихПериодов)
	|			ТОГДА Строки.ДоляСтоимости
	|		ИНАЧЕ 0 КОНЕЦ) КАК ДоляСтоимостиУпр,
	|	СУММА(ВЫБОР
	|		КОГДА ДД.ВариантУказанияСуммыРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыУказанияСуммыРБП.ОпределяетсяАвтоматически)
	|		 И Статья.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаРасходыБудущихПериодов)
	|			ТОГДА Строки.ДоляСтоимости
	|		ИНАЧЕ 0 КОНЕЦ) КАК ДоляСтоимостиРегл
	|
	|ПОМЕСТИТЬ ВтРаспределенияРБП
	|ИЗ
	|	Документ.РаспределениеРасходовБудущихПериодов КАК ДД
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.РаспределениеРасходовБудущихПериодов.РаспределениеРасходов КАК Строки
	|		ПО Строки.Ссылка = ДД.Ссылка
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиРасходов КАК Статья
	|		ПО Статья.Ссылка = ДД.СтатьяРасходов
	|ГДЕ
	|	ДД.Проведен
	|	И ДД.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|	И (ДД.ВариантУказанияСуммыУпр = ЗНАЧЕНИЕ(Перечисление.ВариантыУказанияСуммыРБП.ОпределяетсяАвтоматически)
	|		ИЛИ ДД.ВариантУказанияСуммыРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыУказанияСуммыРБП.ОпределяетсяАвтоматически))
	|СГРУППИРОВАТЬ ПО
	|	ДД.Организация,
	|	ДД.Подразделение,
	|	ДД.СтатьяРасходов,
	|	ДД.АналитикаРасходов,
	|	ДД.НаправлениеДеятельности
	|;
	|ВЫБРАТЬ
	|	1 КАК Порядок,
	|	Расходы.Организация КАК Организация,
	|	Расходы.Подразделение КАК Подразделение,
	|	Расходы.СтатьяРасходов КАК СтатьяРасходов,
	|	Расходы.АналитикаРасходов КАК АналитикаРасходов,
	|	Расходы.НаправлениеДеятельности КАК НаправлениеДеятельности,
	|	(ВЫБОР
	|		КОГДА Распределение.РаспределитьУпр ТОГДА Расходы.Сумма
	|		ИНАЧЕ 0 КОНЕЦ) КАК Сумма,
	|	(ВЫБОР
	|		КОГДА Распределение.РаспределитьУпр ТОГДА Расходы.СуммаУпр
	|		ИНАЧЕ 0 КОНЕЦ) КАК СуммаУпр,
	|	(ВЫБОР
	|		КОГДА Распределение.РаспределитьРегл ТОГДА Расходы.СуммаРегл
	|		ИНАЧЕ 0 КОНЕЦ) КАК СуммаРегл,
	|	(ВЫБОР
	|		КОГДА Распределение.РаспределитьРегл ТОГДА Расходы.ПостояннаяРазница
	|		ИНАЧЕ 0 КОНЕЦ) КАК ПостояннаяРазница,
	|	(ВЫБОР
	|		КОГДА Распределение.РаспределитьРегл ТОГДА Расходы.ВременнаяРазница
	|		ИНАЧЕ 0 КОНЕЦ) КАК ВременнаяРазница,
	|
	|	НЕОПРЕДЕЛЕНО КАК ДокументДвижения,
	|	Распределение.ДоляСтоимостиУпр КАК ДоляСтоимостиУпр,
	|	Распределение.ДоляСтоимостиРегл КАК ДоляСтоимостиРегл,
	|	ДАТАВРЕМЯ(1,1,1) КАК Период,
	|	НЕОПРЕДЕЛЕНО КАК ПодразделениеПолучатель,
	|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовПолучатель,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходовПолучатель
	|ИЗ
	|	ВТКэшРасчетныеОборотыПрочиеРасходы КАК Расходы
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВтРаспределенияРБП КАК Распределение
	|		ПО Распределение.Организация = Расходы.Организация
	|		И Распределение.Подразделение = Расходы.Подразделение
	|		И Распределение.СтатьяРасходов = Расходы.СтатьяРасходов
	|		И Распределение.АналитикаРасходов = Расходы.АналитикаРасходов
	|		И Распределение.НаправлениеДеятельности = Расходы.НаправлениеДеятельности
	|ГДЕ
	|	Расходы.СлужебноеВидДвиженияПриход
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|ВЫБРАТЬ
	|	2 КАК Порядок,
	|	ДД.Организация,
	|	ДД.Подразделение,
	|	ДД.СтатьяРасходов,
	|	ДД.АналитикаРасходов,
	|	ДД.НаправлениеДеятельности,
	|	0 КАК Сумма,
	|	0 КАК СуммаУпр,
	|	0 КАК СуммаРегл,
	|	0 КАК ПостояннаяРазница,
	|	0 КАК ВременнаяРазница,
	|
	|	ДД.Ссылка КАК ДокументДвижения,
	|	(ВЫБОР
	|		КОГДА ДД.ВариантУказанияСуммыУпр = ЗНАЧЕНИЕ(Перечисление.ВариантыУказанияСуммыРБП.ОпределяетсяАвтоматически)
	|			ТОГДА Строки.ДоляСтоимости
	|		ИНАЧЕ 0 КОНЕЦ) КАК ДоляСтоимостиУпр,
	|	(ВЫБОР
	|		КОГДА ДД.ВариантУказанияСуммыРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыУказанияСуммыРБП.ОпределяетсяАвтоматически)
	|			ТОГДА Строки.ДоляСтоимости
	|		ИНАЧЕ 0 КОНЕЦ) КАК ДоляСтоимостиРегл,
	|	Строки.Дата КАК Период,
	|	Строки.Подразделение КАК ПодразделениеПолучатель,
	|	Строки.СтатьяРасходов КАК СтатьяРасходовПолучатель,
	|	Строки.АналитикаРасходов КАК АналитикаРасходовПолучатель
	|ИЗ
	|	Документ.РаспределениеРасходовБудущихПериодов КАК ДД
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.РаспределениеРасходовБудущихПериодов.РаспределениеРасходов КАК Строки
	|		ПО Строки.Ссылка = ДД.Ссылка
	|ГДЕ
	|	ДД.Проведен
	|	И ДД.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|	И (ДД.ВариантУказанияСуммыУпр = ЗНАЧЕНИЕ(Перечисление.ВариантыУказанияСуммыРБП.ОпределяетсяАвтоматически)
	|		ИЛИ ДД.ВариантУказанияСуммыРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыУказанияСуммыРБП.ОпределяетсяАвтоматически))
	|
	|УПОРЯДОЧИТЬ ПО
	|	Организация,
	|	Подразделение,
	|	СтатьяРасходов,
	|	АналитикаРасходов,
	|	НаправлениеДеятельности,
	|	Порядок ВОЗР,
	|	ДокументДвижения,
	|	Период ВОЗР
	|";
	
	Выборка = РасчетСебестоимостиПрикладныеАлгоритмы.ВыполнитьЗапросСЗамеромДляПротокола(ПараметрыРасчета, Запрос, Истина);
	
	СтрокаОстатка = Новый Структура;
	СуммовыеРесурсы = Новый Структура;
	
	Для Каждого Колонка Из Выборка.Владелец().Колонки Цикл
		СтрокаОстатка.Вставить(Колонка.Имя);
		Если Колонка.ТипЗначения.СодержитТип(Тип("Число")) Тогда
			СуммовыеРесурсы.Вставить(Колонка.Имя);
		КонецЕсли;
	КонецЦикла;
	
	// Формируются движения по регистрам:
	// - ВыручкаИСебестоимостьПродаж
	Пока Выборка.Следующий() Цикл
		
		Если Выборка.Порядок = 1 Тогда
			
			ЗаполнитьЗначенияСвойств(СтрокаОстатка, Выборка);
			
		ИначеЕсли СтрокаОстатка.Организация = Выборка.Организация
		 И СтрокаОстатка.Подразделение = Выборка.Подразделение
		 И СтрокаОстатка.СтатьяРасходов = Выборка.СтатьяРасходов
		 И СтрокаОстатка.АналитикаРасходов = Выборка.АналитикаРасходов
		 И СтрокаОстатка.НаправлениеДеятельности = Выборка.НаправлениеДеятельности Тогда
		
		 	Если СтрокаОстатка.ДоляСтоимостиУпр <= Выборка.ДоляСтоимостиУпр Тогда
			    ЗаполнитьЗначенияСвойств(СуммовыеРесурсы, СтрокаОстатка, "Сумма, СуммаУпр");
				СтрокаОстатка.ДоляСтоимостиУпр = 0;
			Иначе
				Если СтрокаОстатка.ДоляСтоимостиУпр <> 0 Тогда
					СуммовыеРесурсы.Сумма = 
						Окр(Выборка.ДоляСтоимостиУпр * СтрокаОстатка.Сумма / СтрокаОстатка.ДоляСтоимостиУпр, 2, 1);
					СуммовыеРесурсы.СуммаУпр = 
						Окр(Выборка.ДоляСтоимостиУпр * СтрокаОстатка.СуммаУпр / СтрокаОстатка.ДоляСтоимостиУпр, 2, 1);
				КонецЕсли;
				СтрокаОстатка.ДоляСтоимостиУпр = СтрокаОстатка.ДоляСтоимостиУпр - Выборка.ДоляСтоимостиУпр;
			КонецЕсли;
				
			Если СтрокаОстатка.ДоляСтоимостиРегл <= Выборка.ДоляСтоимостиРегл Тогда
				ЗаполнитьЗначенияСвойств(СуммовыеРесурсы, СтрокаОстатка, "СуммаРегл, ПостояннаяРазница, ВременнаяРазница");
				СтрокаОстатка.ДоляСтоимостиРегл = 0;
			Иначе	
				Если СтрокаОстатка.ДоляСтоимостиРегл <> 0 Тогда
					СуммовыеРесурсы.СуммаРегл = 
						Окр(Выборка.ДоляСтоимостиРегл * СтрокаОстатка.СуммаРегл / СтрокаОстатка.ДоляСтоимостиРегл, 2, 1);
					СуммовыеРесурсы.ПостояннаяРазница = 
						Окр(Выборка.ДоляСтоимостиРегл * СтрокаОстатка.ПостояннаяРазница / СтрокаОстатка.ДоляСтоимостиРегл, 2, 1);
					СуммовыеРесурсы.ВременнаяРазница = 
						Окр(Выборка.ДоляСтоимостиРегл * СтрокаОстатка.ВременнаяРазница / СтрокаОстатка.ДоляСтоимостиРегл, 2, 1);
				КонецЕсли;
				СтрокаОстатка.ДоляСтоимостиРегл = СтрокаОстатка.ДоляСтоимостиРегл - Выборка.ДоляСтоимостиРегл;
			КонецЕсли;
			
			СтрокаОстатка.Сумма = СтрокаОстатка.Сумма - СуммовыеРесурсы.Сумма;
			СтрокаОстатка.СуммаУпр = СтрокаОстатка.СуммаУпр - СуммовыеРесурсы.СуммаУпр;
			СтрокаОстатка.СуммаРегл = СтрокаОстатка.СуммаРегл - СуммовыеРесурсы.СуммаРегл;
			СтрокаОстатка.ПостояннаяРазница = СтрокаОстатка.ПостояннаяРазница - СуммовыеРесурсы.ПостояннаяРазница;
			СтрокаОстатка.ВременнаяРазница = СтрокаОстатка.ВременнаяРазница - СуммовыеРесурсы.ВременнаяРазница;
			
			// Формируются движения по регистрам:
			// - ПрочиеРасходы
			СформироватьДвиженияРаспределениеРБП(ПараметрыРасчета, Выборка, СуммовыеРесурсы);
		КонецЕсли;
		
	КонецЦикла;
	
	РасчетСебестоимостиПрикладныеАлгоритмы.УничтожитьВременныеТаблицы(ПараметрыРасчета, "ВтРаспределенияРБП");
	
	РасчетСебестоимостиПрикладныеАлгоритмы.КэшироватьСформированныеДвижения(ПараметрыРасчета);
	
КонецПроцедуры

#КонецОбласти

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#Область ПроцедурыЭтапа10_РаспределениеДопРасходовМеждуПартиямиИТоварами

// Выборка данных и формирование движений

Функция ПолучитьДанныеДляДопРасходов(ПараметрыРасчета) Экспорт
	
	Запрос = Новый Запрос;
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьСвойстваЗапроса(Запрос, ПараметрыРасчета);
	
	// Определяем базу распределения прочих расходов на заказы поставщикам и заказы перемещений,
	// т.е. распределяем выполненные строки заказов на поступления партий - указываем заказ в партии.
	ТекстСортировка = "
		|УПОРЯДОЧИТЬ ПО
		|	Регистратор, Номенклатура, Характеристика, Склад, Назначение, Приоритет
		|";
	
	Запрос.Текст = ""
		// подготовка временных таблиц
		+ ТекстНачальныеОстаткиПартийПрочихРасходов() // вт НачальныеОстаткиРасходов
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете() + РасчетСебестоимостиЛокализация.ТекстТаможенныеДекларацииИПоступления() // вт Декларации, КоличествоДеклараций
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете() + ТекстАналитикиРасходовВсе() // вт АналитикиРасходовВсе
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()	+ ТекстЗаказыИзАналитикРасходов() // вт ЗаказыИзАналитикРасходов, ПоступленияИзАналитикРасходов, ПоступленияИЗаказыИзАналитикРасходов
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()
		// выборка данных
		+ ТекстПоступившиеЗаказы()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстПриходыПоступленийПоЗаказамСебестоимости()
		+ ТекстСортировка;
	
	ДанныеРасчетаЗаказов = РасчетСебестоимостиПрикладныеАлгоритмы.ВыполнитьЗапросСЗамеромДляПротокола(ПараметрыРасчета, Запрос, Истина,, Истина, "ДанныеРасчетаЗаказов");
	Если ТипЗнч(ДанныеРасчетаЗаказов) = Тип("Массив") Тогда
		ДанныеРасчетаЗаказов = ДанныеРасчетаЗаказов[ДанныеРасчетаЗаказов.Количество()-1].Выгрузить();
	Иначе
		ДанныеРасчетаЗаказов = ДанныеРасчетаЗаказов.Выгрузить(); // результат запроса
	КонецЕсли;
	
	РасчетныеПартииПоЗаказам = Новый ТаблицаЗначений;
	ПоляРасчетаЗаказов = СкопироватьКолонки(ДанныеРасчетаЗаказов.Колонки, РасчетныеПартииПоЗаказам.Колонки);
	
	ОписаниеДвижений = РасчетСебестоимостиПрикладныеАлгоритмы.ОписаниеДвижений();
	ОписаниеДвижений.Вставить("Контекст", "ДопРасходы_ЗаказыПоставщикам");
	ОписаниеДвижений.Вставить("ПоляРасчета", ПоляРасчетаЗаказов);
	ОписаниеДвижений.Вставить("КлючиСравнения",	"Номенклатура, Регистратор, Характеристика, Назначение, Склад");
	ОписаниеДвижений.Вставить("Показатели", "Количество, Стоимость");
	ОписаниеДвижений.Вставить("БазисПрихода", "Количество");
	ОписаниеДвижений.Вставить("БазисРасхода", "Количество");
	ОписаниеДвижений.Вставить("КлючРасхода", "Заказ");
	ОписаниеДвижений.Вставить("ПолеПорядка", "Период");
	ОписаниеДвижений.Вставить("БазисПриходаРегл", "Количество"); 
	ОписаниеДвижений.Вставить("БазисРасходаРегл", "Количество");
	
	// Заполнение таблицы РасчетныеПартииПоЗаказам
	РасчетСебестоимостиПрикладныеАлгоритмы.РаспределитьПриходыНаРасходы(ПараметрыРасчета, ОписаниеДвижений, ДанныеРасчетаЗаказов, РасчетныеПартииПоЗаказам);
	ДанныеРасчетаЗаказов = Неопределено;
	
	// Получаем данные для расчета списания партий прочих расходов и прихода партий расходов на с/с товаров.
	ТекстСортировка = "
		|УПОРЯДОЧИТЬ ПО
		|	Организация, Приоритет, ВидДвижения, Период, Регистратор";

	Запрос.УстановитьПараметр("РасчетныеПартииПоЗаказам", РасчетныеПартииПоЗаказам);
	
	Запрос.Текст = ""
		// подготовка временных таблиц
		+ ТекстПартииПоЗаказам() // вт ПартииПоЗаказам
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()	+ ТекстРегистраторыПрочих() // вт РегистраторыПрочих
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()	+ ТекстПериодыПартийПрочих() // вт ПериодыПартийПрочих
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()	+ НеотфактурованныеПоставки() // вт НеотфактурованныеПоставки
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()	+ ТекстПрошлыеПоступленияИзТоваровВПути() // вт ПрошлыеПоступленияИзТоваровВПути
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()	+ ОстаткиПрошлыхПоступленийСводно() // вт ОстаткиПрошлыхПоступленийСводно
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()	+ ТекстПрошлыеПеремещенияПоступленияСборка() // вт ПрошлыеПеремещенияПоступленияСборка
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()	+ ТекстАналитикиРасходовПрошлыеПоступления() // вт АналитикиРасходовПрошлыеПоступления
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()	+ ТекстАналитикиПрошлыхПоступленийТоваровПредварительная() // вт АналитикиПрошлыхПоступленийПредварительная
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()	+ ТекстАналитикиПрошлыхПоступленийТоваров() // вт АналитикиПрошлыхПоступлений
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()	+ ТекстПрошлыеВыбытияТоваровБезСтоимостей() // вт ПрошлыеВыбытияТоваровБезСтоимостей
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()	+ ТекстПрошлыеВыбытияТоваров() // вт ПрошлыеВыбытияТоваров
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()	+ ТекстПрошлыеПоступления() // вт ПрошлыеПоступления
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()	+ ТекстПрошлыеЗаказы() // вт ПрошлыеЗаказы
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()	+ ТекстВключениеУчетаПоВидамЗапасов() // вт ВключениеУчетаПоВидамЗапасов
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()	+ ТекстОтборОстатковПрошлыхПоступлений() // ВТ ОтборОстатковПрошлыхПоступлений
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()	+ ОстаткиПрошлыхПоступлений(); // вт ОстаткиПрошлыхПоступлений
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ВыполнитьЗапросСЗамеромДляПротокола(ПараметрыРасчета, Запрос, Истина);
	
		// выборка данных
	Запрос.Текст = ""
		+ ТекстОписаниеДанныхДляПартийПрочих()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстОстаткиПартийПрочих()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстПриходыПартийПрочих()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазисОстаткиСебестоимость()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазисОстаткиПоЗаказамСебестоимость()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазисПриходыСебестоимость()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазисФактуровкаПоставки() // использует НеотфактурованныеПоставки
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазисПрошлыеФактуровкаПоставки() // использует НеотфактурованныеПоставки
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазисПеремещенияПоСкладуСебестоимость()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазисКорректировкиПоступлений()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазисПередачиТоваровСебестоимость()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазисПередачиТоваровСебестоимостьРегл()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазисПеремещенияПоступленияСборкаСебестоимость()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазисПрошлыеПеремещенияПоступленияСборкаСебестоимость()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазисПоступленияИзТоваровВПути()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазисПрошлыеПоступленияИзТоваровВПути()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазисПрошлыеПриходыТоваровСебестоимость()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазисЗаказы()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазисПрошлыеЗаказы()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазисУслуги()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазисПрочиеАктивыПассивы()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазисПартииПрочихРасходов()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазисСписанияИРеклассификацияРасходовУпр()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазисСписанияИРеклассификацияРасходовРегл()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазисПрошлыеВыбытияТоваров() // использует АналитикиПрошлыхПоступлений
		+ ТекстСортировка;
		
	ДанныеДляРасчета = РасчетСебестоимостиПрикладныеАлгоритмы.ВыполнитьЗапросСЗамеромДляПротокола(ПараметрыРасчета, Запрос, Истина,, Истина, "ДанныеДляРасчета");
	Если ТипЗнч(ДанныеДляРасчета) = Тип("Массив") Тогда
		ДанныеДляРасчета = ДанныеДляРасчета[ДанныеДляРасчета.Количество()-1].Выгрузить();
	Иначе
		ДанныеДляРасчета = ДанныеДляРасчета.Выгрузить(); // результат запроса
	КонецЕсли;
	
	РасчетныеПартииПоЗаказам = Неопределено;
	
	РасчетСебестоимостиПрикладныеАлгоритмы.УничтожитьВременныеТаблицы(ПараметрыРасчета,
		"НачальныеОстаткиРасходов, АналитикиРасходовВсе, ЗаказыИзАналитикРасходов, ПоступленияИзАналитикРасходов,
		|Декларации, КоличествоДеклараций, АналитикиРасходовПрошлыеПоступления,
		|ПоступленияИЗаказыИзАналитикРасходов, ПартииПоЗаказам, РегистраторыПрочих, ПериодыПартийПрочих,
		|АналитикиПрошлыхПоступлений, ПрошлыеВыбытияТоваров, ПрошлыеВыбытияТоваровПоНоменклатуре,
		|ПрошлыеПоступления, ПрошлыеПеремещенияПоступленияСборка, ОстаткиПрошлыхПоступлений, НеотфактурованныеПоставки,
		|ОстаткиПрошлыхПоступленийСводно, ПрошлыеЗаказы, СоответствиеПартийИПрошлыхЗаказов, ПрошлыеПоступленияИзТоваровВПути,
		|СоответствиеПартийИЗаказовВПутиОтПоставщиков");
	
	Возврат ДанныеДляРасчета;
	
КонецФункции

Функция СформироватьПартииПрочихРасходов(ПараметрыРасчета, ДанныеДляРасчета) Экспорт
	
	Контекст 	= "ДопРасходы_ПартииПрочихРасходов";
	ИмяРегистра = Метаданные.РегистрыНакопления.ПартииПрочихРасходов.Имя;
	
	// Шаг 0: Свертка исходных данных
	ПоляСуммирования = "Базис, Количество, Вес, Объем, Стоимость, СтоимостьБезНДС, СтоимостьРегл, НДСРегл, ПостояннаяРазница, ВременнаяРазница";
	Исключения = "ЗапросИсточник";
	ПоляГруппировки = РасчетСебестоимостиПрикладныеАлгоритмы.ПереченьПолей(ДанныеДляРасчета.Колонки, ПоляСуммирования + ", " + Исключения);
	ДанныеДляРасчета.Свернуть(ПоляГруппировки, ПоляСуммирования);
	
	// Кэшируем получение пустых ссылок - на множественных итерациях есть выигрыш.
	ПустыеСсылки = Новый Соответствие;
	ПропорциональноКоличеству = Перечисления.ПравилаРаспределенияНаСебестоимостьТоваров.ПропорциональноКоличеству;
	ПропорциональноСебестоимости = Перечисления.ПравилаРаспределенияНаСебестоимостьТоваров.ПропорциональноСебестоимости;
	ПропорциональноВесу = Перечисления.ПравилаРаспределенияНаСебестоимостьТоваров.ПропорциональноВесу;
	ПропорциональноОбъему = Перечисления.ПравилаРаспределенияНаСебестоимостьТоваров.ПропорциональноОбъему;
	
	// Шаг 1: Рассчитываем базу распределения для каждого прихода прочих расходов с учетом налогообложения партии распределения.
	УзлыДвижений = Новый Соответствие; // [Организация, [АналитикаРасходов, [ИндексСтроки, [НалогообложениеНДС, Базис]]]]
	Ключи = Новый Массив(4); // {Организация, АналитикаРасходов, ИндексСтроки, НалогообложениеНДС}
	
	УдаляемыеСтроки = Новый Массив;
	
	// Расчет базы по для каждой строки прихода по налогообложению каждого расхода.
	Для Каждого Движение Из ДанныеДляРасчета Цикл
		
		Ключи[0] = Движение.Организация;
		Ключи[1] = Неопределено;
		Ключи[2] = ДанныеДляРасчета.Индекс(Движение);
		Ключи[3] = Движение.НалогообложениеНДС;
		
		// Накапливаем приход партий прочих расходов для распределения по налогообложению.
		Если ЗначениеЗаполнено(Движение.СтатьяРасходов)
		 И Движение.ХозяйственнаяОперация <> Перечисления.ХозяйственныеОперации.РеклассификацияРасходов
		 И Движение.ХозяйственнаяОперация <> Перечисления.ХозяйственныеОперации.СписаниеПрочихРасходов Тогда
			Ключи[1] = Движение.АналитикаРаспределения;
			ДобавитьУзелИндекса(УзлыДвижений, Ключи, Неопределено);
			Продолжить;
		КонецЕсли;
		
		// Возвраты добавляются как положительный базис.
		Количество = Движение.Количество;
		Стоимость  = Движение.Стоимость;
		СтоимостьРегл  = Движение.СтоимостьРегл;
		Вес = Движение.Вес;
		Объем = Движение.Объем;
		
		// Исключаем строки с отрицательными показателями базиса распределения.
		Если Количество < 0
		 ИЛИ Стоимость < 0
		 ИЛИ СтоимостьРегл < 0
		 ИЛИ Вес < 0
		 ИЛИ Объем < 0 Тогда
			УдаляемыеСтроки.Добавить(Движение);
			Продолжить;
		КонецЕсли;
		
		// Непосредственно расчет базисов по налогообложению.
		Аналитики = УзелИндекса(УзлыДвижений, Ключи);
		Если Аналитики = Неопределено Тогда
			Продолжить;
		КонецЕсли;
		
		Для Каждого Значение Из АналитикиОбсчетаПартийПрочих(Движение, ПустыеСсылки) Цикл
			ИндексыСтрок = Аналитики[Значение];
			Если ИндексыСтрок = Неопределено Тогда
				Продолжить;
			КонецЕсли;
			Для Каждого ИндексСтроки Из ИндексыСтрок Цикл
				Приход = ДанныеДляРасчета[ИндексСтроки.Ключ];
				Если ПараметрыРасчета.УчитыватьСебестоимостьТоваровПоНазначениям 
				 И ЗначениеЗаполнено(Движение.НаправлениеДеятельности)
				 И ЗначениеЗаполнено(Приход.НаправлениеДеятельности)
				 И Движение.НаправлениеДеятельности <> Приход.НаправлениеДеятельности Тогда
					Продолжить;
				ИначеЕсли ПараметрыРасчета.УчитыватьСебестоимостьТоваровПоНазначениям 
				 И НЕ ЗначениеЗаполнено(Движение.НаправлениеДеятельности)
				 И ЗначениеЗаполнено(Приход.НаправлениеДеятельности) Тогда
					Продолжить;
				ИначеЕсли (Движение.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеклассификацияРасходов
					ИЛИ Движение.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.СписаниеПрочихРасходов)
				 И (Движение.СтатьяРасходов <> Приход.СтатьяРасходов
				  ИЛИ Движение.АналитикаРасходов <> Приход.АналитикаРасходов
				  ИЛИ Движение.Подразделение <> Приход.Подразделение
				  ИЛИ Движение.Регистратор = Приход.Регистратор) Тогда
					Продолжить;
				// Доп.расходы с пустой аналитикой расходов не должны распределятся на партии прошлого периода.
				ИначеЕсли Не ЗначениеЗаполнено(Приход.АналитикаРасходов) И Движение.Период < ПараметрыРасчета.РасчетныйПериод.НачалоПериода Тогда
					Продолжить;
				ИначеЕсли Приход.ПравилоРаспределения = ПропорциональноКоличеству Тогда
					Базис = Количество;
					БазисРегл = Количество;
				ИначеЕсли Приход.ПравилоРаспределения = ПропорциональноВесу Тогда
					Базис = Вес;
					БазисРегл = Вес;
				ИначеЕсли Приход.ПравилоРаспределения = ПропорциональноОбъему Тогда
					Базис = Объем;
					БазисРегл = Объем;
				ИначеЕсли Приход.ПравилоРаспределения = ПропорциональноСебестоимости Тогда
					Базис = Стоимость;
					БазисРегл = СтоимостьРегл;
				Иначе
					Продолжить;
				КонецЕсли;
				Приход.Базис = Приход.Базис + Базис;
				Приход.БазисРегл = Приход.БазисРегл + БазисРегл;
				// Увеличим базу по налогообложению (Ключи[3]).
				Налоги = ИндексСтроки.Значение;
				Если Движение.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеклассификацияРасходов
				 ИЛИ Движение.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.СписаниеПрочихРасходов Тогда
					КлючБазы = Движение.ХозяйственнаяОперация;
				Иначе
					КлючБазы = Ключи[3];
				КонецЕсли;
				ОписаниеБазы = ?(Налоги[КлючБазы] = Неопределено, Новый Структура("Базис, БазисРегл", 0, 0), Налоги[КлючБазы]);
				ОписаниеБазы.Базис = ОписаниеБазы.Базис + Базис;
				ОписаниеБазы.БазисРегл = ОписаниеБазы.БазисРегл + БазисРегл;
				Налоги.Вставить(КлючБазы, ОписаниеБазы);
			КонецЦикла;
		КонецЦикла;
		
	КонецЦикла;
	
	// Шаг 2: создаем буфер накопления рассчитанных партий.
	РасчетныеПартии = Новый ТаблицаЗначений;
	СкопироватьКолонки(ДанныеДляРасчета.Колонки, РасчетныеПартии.Колонки);
	
	// Шаг 3: Создаем расчетные партии расходов по каждому накопленному налогообложению.
	Для Каждого Организация Из УзлыДвижений Цикл
		Для Каждого Аналитика Из Организация.Значение Цикл
			Для Каждого ИндексСтроки Из Аналитика.Значение Цикл
				Движение = ДанныеДляРасчета[ИндексСтроки.Ключ];
				Если Движение.Базис = 0 И Движение.БазисРегл = 0 Тогда
					Продолжить;
				КонецЕсли;
				Для Каждого РаспределениеБазиса Из ИндексСтроки.Значение Цикл
					Если РаспределениеБазиса.Значение = Неопределено Тогда
						Продолжить;
					КонецЕсли;
					РасчетнаяПартия = РасчетныеПартии.Добавить();
					РасчетСебестоимостиПрикладныеАлгоритмы.ЗаполнитьРасчетнуюПартию(ПараметрыРасчета, Контекст, РасчетнаяПартия, Движение, РаспределениеБазиса);
				КонецЦикла;
			КонецЦикла;
		КонецЦикла;
	КонецЦикла;
	
	// Шаг 4: Удаляем измененные записи ДанныеДляРасчета (партии, остатки) - они теперь лишние.
	// Удаляем строки с отрицательным базисом.
	Для Каждого Строка Из УдаляемыеСтроки Цикл
		ДанныеДляРасчета.Удалить(Строка);
	КонецЦикла;
	УдаляемыеСтроки.Очистить();

	МинимальныйИндекс = 1 - ДанныеДляРасчета.Количество();
	Для Индекс = МинимальныйИндекс По 0 Цикл
		Движение = ДанныеДляРасчета[-Индекс];
		Если РасчетСебестоимостиПовтИсп.ЭтоНепересчитываемыйТипЗаписи(Движение.ТипЗаписи) Тогда
			ДанныеДляРасчета.Удалить(-Индекс);
		КонецЕсли;
	КонецЦикла;
	
	// Шаг 5: Копируем рассчитанные партии с указанием налогообложения в ДанныеДляРасчета.
	// (эти движения понадобятся для формирования прихода в партии расходов на себестоимость).
	Для Каждого РасчетнаяПартия Из РасчетныеПартии Цикл
		
		Если РасчетСебестоимостиПовтИсп.ЭтоНепересчитываемыйТипЗаписи(РасчетнаяПартия.ТипЗаписи) Тогда
			Продолжить;
		КонецЕсли;
		
		Если РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Потребление Тогда
			Движение = ДанныеДляРасчета.Добавить();
			ЗаполнитьЗначенияСвойств(Движение, РасчетнаяПартия);
			
			Движение.ТипЗаписи   = Перечисления.ТипыЗаписейПартий.Остаток;
			Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
		КонецЕсли;
		
		// Сформируем движение по регистру ПартииПрочихРасходов.
		РасчетСебестоимости.ДобавитьЗаписьВТаблицуДвижений(ПараметрыРасчета, ИмяРегистра, РасчетнаяПартия);
		
	КонецЦикла;
	
	Возврат РасчетныеПартии;
	
КонецФункции

Функция ПолучитьДанныеПриходовПартийРасходов(ПараметрыРасчета, ДанныеДляРасчета)
	
	// кэшируем получение пустых ссылок - на множественных итерациях есть выигрыш
	ПустыеСсылки = Новый Соответствие;
	ПравилаРаспределения = Новый Массив(4);
	ПравилаРаспределения[0] = Перечисления.ПравилаРаспределенияНаСебестоимостьТоваров.ПропорциональноКоличеству;
	ПравилаРаспределения[1] = Перечисления.ПравилаРаспределенияНаСебестоимостьТоваров.ПропорциональноСебестоимости;
	ПравилаРаспределения[2] = Перечисления.ПравилаРаспределенияНаСебестоимостьТоваров.ПропорциональноВесу;
	ПравилаРаспределения[3] = Перечисления.ПравилаРаспределенияНаСебестоимостьТоваров.ПропорциональноОбъему;
	
	// Шаг 1: Строим сопоставление приходов с базисом и расходов, по которым базис рассчитан.
	ДанныеДляРасчета.Сортировать("Организация, НалогообложениеНДС, Приоритет, Период, Регистратор, АналитикаУчетаНоменклатуры", Новый СравнениеЗначений);
	УзлыДвижений = Новый Соответствие;
	Ключи = Новый Массив(7); // {Организация, НалогообложениеНДС, ПравилоРаспределения, АналитикаРасходов, ДокументПоступленияРасходов, НомерСтроки}
	
	// формирование упорядоченных массивов строк таблицы ДанныеДляРасчета
	Для Каждого Движение Из ДанныеДляРасчета Цикл
		
		Ключи[0] = Движение.Организация;
		Если Движение.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеклассификацияРасходов
		 ИЛИ Движение.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.СписаниеПрочихРасходов Тогда
			Ключи[1] = Движение.ХозяйственнаяОперация;
		Иначе
			Ключи[1] = Движение.НалогообложениеНДС;
		КонецЕсли;
		Ключи[2] = Движение.ПравилоРаспределения;
		Ключи[3] = Неопределено;
		Ключи[4] = Неопределено;
		Ключи[5] = Неопределено;
		Ключи[6] = Движение.НаправлениеДеятельности;
		
		// накапливаем приход партий прочих расходов для дальнейшего сопоставления
		Если ЗначениеЗаполнено(Движение.СтатьяРасходов)
		 И Движение.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Остаток Тогда
			Ключи[3] = Движение.АналитикаРаспределения;
			Ключи[4] = Движение.ДокументПоступленияРасходов;
			Ключи[5] = ДанныеДляРасчета.Индекс(Движение);
			Движения = УзелИндекса(УзлыДвижений, Ключи);
			Если Движения = Неопределено Тогда
				Движения = ДобавитьУзелИндекса(УзлыДвижений, Ключи, Новый Массив);
			КонецЕсли;
			Движения.Добавить(Движение);
			Продолжить;
		КонецЕсли;
		
		// непосредственно вставка строки расхода в сопоставления по каждой аналитике
		Для Каждого Правило Из ПравилаРаспределения Цикл
			Ключи[2] = Правило;
			Аналитики = УзелИндекса(УзлыДвижений, Ключи);
			Если Аналитики = Неопределено Тогда
				Продолжить;
			КонецЕсли;
			// Аналитики содержат соответствие, в ключах которого значение аналитики расхода,
			// в значениях - соответствие между документом поступления расхода и движениями относящимися к этому расходу.
			Для Каждого Значение Из АналитикиОбсчетаПартийПрочих(Движение, ПустыеСсылки) Цикл
				// Доп.расходы с пустой аналитикой расходов не должны распределятся на партии прошлого периода.
				Если Не ЗначениеЗаполнено(Значение) И Движение.Период < ПараметрыРасчета.РасчетныйПериод.НачалоПериода Тогда
					Продолжить;
				КонецЕсли;
				ПоступленияРасходов = Аналитики[Значение];
				Если ПоступленияРасходов = Неопределено Тогда
					Продолжить;
				КонецЕсли;
				Для Каждого ПоступлениеРасхода Из ПоступленияРасходов Цикл
					Для Каждого НомерСтроки Из  ПоступлениеРасхода.Значение Цикл
						Для Каждого НаправлениеДеятельности Из НомерСтроки.Значение Цикл
							Если НЕ ПараметрыРасчета.УчитыватьСебестоимостьТоваровПоНазначениям
							 ИЛИ (ЗначениеЗаполнено(НаправлениеДеятельности.Ключ)
							 	И НаправлениеДеятельности.Ключ = Движение.НаправлениеДеятельности)
							 ИЛИ НЕ ЗначениеЗаполнено(НаправлениеДеятельности.Ключ) Тогда
								НаправлениеДеятельности.Значение.Добавить(Движение);
							КонецЕсли;
						КонецЦикла;
					КонецЦикла
				КонецЦикла;
			КонецЦикла;
		КонецЦикла;
		
	КонецЦикла;
	
	// Шаг 2: создаем буфер накопления рассчитанных партий
	РасчетныеПартии = Новый ТаблицаЗначений;
	ПоляРасчета = СкопироватьКолонки(ДанныеДляРасчета.Колонки, РасчетныеПартии.Колонки);
	
	// Шаг 3: распределяем каждый массив строк в аналитиках
	ОписаниеДвижений = РасчетСебестоимостиПрикладныеАлгоритмы.ОписаниеДвижений();
	ОписаниеДвижений.Вставить("Контекст", "ДопРасходы_ПриходПартийРасходов");
	ОписаниеДвижений.Вставить("ПоляРасчета", ПоляРасчета);
	ОписаниеДвижений.Вставить("КлючиСравнения",	"Организация");
	ОписаниеДвижений.Вставить("Показатели", "Базис, БазисРегл, Количество, Вес, Объем, Стоимость, СтоимостьБезНДС,
		|СтоимостьРегл, НДСРегл, НДСУпр, ПостояннаяРазница, ВременнаяРазница");
	ОписаниеДвижений.Вставить("БазисПрихода", "Базис");
	ОписаниеДвижений.Вставить("БазисРасхода", "<БАЗИС_РАСХОДА>");
	ОписаниеДвижений.Вставить("КлючРасхода", "ДокументРеализации");
	ОписаниеДвижений.Вставить("ПолеПорядка", "Период");
	ОписаниеДвижений.Вставить("БазисПриходаРегл", "БазисРегл");
	ОписаниеДвижений.Вставить("БазисРасходаРегл", "<БАЗИС_РАСХОДАРЕГЛ>");
	
	Для Каждого Организации Из УзлыДвижений Цикл
		Для Каждого Налогообложения Из Организации.Значение Цикл
			Для Каждого Правила Из Налогообложения.Значение Цикл
				
				Если Правила.Ключ = ПравилаРаспределения[0] Тогда
					ОписаниеДвижений.БазисРасхода = "Количество";
					ОписаниеДвижений.БазисРасходаРегл = "Количество";
				ИначеЕсли Правила.Ключ = ПравилаРаспределения[2] Тогда
					ОписаниеДвижений.БазисРасхода = "Вес";
					ОписаниеДвижений.БазисРасходаРегл = "Вес";
				ИначеЕсли Правила.Ключ = ПравилаРаспределения[3] Тогда
					ОписаниеДвижений.БазисРасхода = "Объем";
					ОписаниеДвижений.БазисРасходаРегл = "Объем";
				Иначе
					ОписаниеДвижений.БазисРасхода = "Стоимость";
					ОписаниеДвижений.БазисРасходаРегл = "СтоимостьРегл";
				КонецЕсли;
				
				Для Каждого Аналитики Из Правила.Значение Цикл
					Для Каждого ПоступлениеРасхода Из Аналитики.Значение Цикл
						Для Каждого НомерСтроки Из ПоступлениеРасхода.Значение Цикл
							Для Каждого НаправлениеДеятельности Из НомерСтроки.Значение Цикл
								РасчетСебестоимостиПрикладныеАлгоритмы.РаспределитьПриходыНаРасходы(ПараметрыРасчета, ОписаниеДвижений, НаправлениеДеятельности.Значение, РасчетныеПартии);
							КонецЦикла;
						КонецЦикла;
					КонецЦикла;
				КонецЦикла;
				
			КонецЦикла;
		КонецЦикла;
	КонецЦикла;
	
	// Шаг 4: Сортировка партий для дальнейшей записи
	РасчетныеПартии.Сортировать("Регистратор, ВидДвижения, Период, АналитикаУчетаНоменклатуры", Новый СравнениеЗначений);
	Возврат РасчетныеПартии;
	
КонецФункции

Процедура СформироватьДопРасходыВСебестоимостьТоваров(ПараметрыРасчета, РасчетныеПриходыПартийРасходов)
	
	ИмяРегистра = Метаданные.РегистрыНакопления.СебестоимостьТоваров.Имя;
	
	// Шаг 1: Получаем аналитики учета по партнерам
	АналитикиПартнеров = Новый Соответствие;
	Поступления = Новый Массив;
	
	Для Каждого Движение Из РасчетныеПриходыПартийРасходов Цикл
		// Аналитики учета по партнерам для дальнейшего заполнения по документам поступлений.
		Если АналитикиПартнеров[Движение.ДокументПоступления] = Неопределено Тогда
			Поступления.Добавить(Движение.ДокументПоступления);
			АналитикиПартнеров.Вставить(Движение.ДокументПоступления, Неопределено);
		КонецЕсли;
	КонецЦикла;
	
	// заполняем аналитики учета по партнерам по документам поступлений товаров
	ЗапросАналитик = Новый Запрос;
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьСвойстваЗапроса(ЗапросАналитик, ПараметрыРасчета); 
	
	ЗапросАналитик.Текст = ТекстАналитикиПартнеров();
	ЗапросАналитик.УстановитьПараметр("Поступления", Поступления);
	
	ВыборкаАналитик = ЗапросАналитик.Выполнить().Выбрать();
	Пока ВыборкаАналитик.Следующий() Цикл
		АналитикиПартнеров[ВыборкаАналитик.ДокументПоступления] = ВыборкаАналитик.АналитикаУчетаПоПартнерам;
	КонецЦикла;
	
	// Шаг 2: Формируем движения по регистру СебестоимостьТоваров
	Для Каждого Движение Из РасчетныеПриходыПартийРасходов Цикл
		
		Если НЕ ЗначениеЗаполнено(Движение.СтатьяРасходов)
		 ИЛИ ЗначениеЗаполнено(Движение.ВариантРаздельногоУчетаНДС) Тогда
			Продолжить;
		КонецЕсли;
		
		РасчетнаяПартия = РасчетСебестоимости.ДобавитьЗаписьВТаблицуДвижений(ПараметрыРасчета, ИмяРегистра, Движение,
			"Период, Регистратор, АналитикаУчетаНоменклатуры, Организация, РазделУчета, ВидЗапасов, Подразделение, АналитикаРасходов,
			|Партия, АналитикаУчетаПартий, АналитикаФинансовогоУчета, КорАналитикаУчетаПартий");
		
		РасчетнаяПартия.ВидДеятельностиНДС 			= Движение.НалогообложениеНДС;
		РасчетнаяПартия.КорВидДеятельностиНДС 		= Движение.ВидДеятельностиНДС;
		РасчетнаяПартия.ВидДвижения 				= ВидДвиженияНакопления.Приход;
		
		РасчетнаяПартия.АналитикаУчетаПоПартнерам 	= АналитикиПартнеров[Движение.ДокументПоступления];
		РасчетнаяПартия.СтатьяРасходовСписания 		= Движение.СтатьяРасходов;
		РасчетнаяПартия.КорНаправлениеДеятельности	= Движение.НаправлениеДеятельности;
		РасчетнаяПартия.ХозяйственнаяОперация 		= Перечисления.ХозяйственныеОперации.ЗакупкаУПоставщика;
		
		Если ЗначениеЗаполнено(Движение.РасчетныйПериод) Тогда
			РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходы;
		Иначе
			РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам;
		КонецЕсли;
		
		РасчетнаяПартия.ДокументДвижения 			= Движение.Регистратор;
		РасчетнаяПартия.ДокументИсточник 			= Движение.ДокументПоступления;
		
		РасчетнаяПартия.ДопРасходы 					= Движение.Стоимость;
		РасчетнаяПартия.ДопРасходыБезНДС 			= Движение.СтоимостьБезНДС;
		
		Если РасчетнаяПартия.ВидДеятельностиНДС = Перечисления.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД
		 ИЛИ РасчетнаяПартия.ВидДеятельностиНДС = Перечисления.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС Тогда
			РасчетнаяПартия.ДопРасходыРегл 			= Движение.СтоимостьРегл + Движение.НДСРегл;
			РасчетнаяПартия.ДопРасходыУпр 			= ?(ПараметрыРасчета.УправленческийУчетОрганизаций, Движение.СтоимостьБезНДС + Движение.НДСУпр, 0);
		Иначе
			РасчетнаяПартия.ДопРасходыРегл 			= Движение.СтоимостьРегл;
			РасчетнаяПартия.ДопРасходыУпр 			= ?(ПараметрыРасчета.УправленческийУчетОрганизаций, Движение.СтоимостьБезНДС, 0);
		КонецЕсли;
		
		РасчетнаяПартия.НДСРегл 					= Движение.НДСРегл;
		РасчетнаяПартия.НДСУпр 						= Движение.НДСУпр;
		
	КонецЦикла;
	
КонецПроцедуры

Процедура СформироватьДопРасходыВПрочиеРасходы(ПараметрыРасчета, РасчетныеПриходыПартийРасходов)
	
	ИмяРегистра = Метаданные.РегистрыНакопления.ПрочиеРасходы.Имя;
	
	// Шаг 1: Формируем движения по регистру ПрочиеРасходы
	Для Каждого Движение Из РасчетныеПриходыПартийРасходов Цикл
		
		Если НЕ ЗначениеЗаполнено(Движение.СтатьяРасходов)
		 ИЛИ НЕ ЗначениеЗаполнено(Движение.ВариантРаздельногоУчетаНДС)
		 ИЛИ НЕ ЗначениеЗаполнено(Движение.СтатьяОтраженияРасходов)
		 ИЛИ Движение.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеклассификацияРасходов
		 ИЛИ Движение.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.СписаниеПрочихРасходов
		 ИЛИ Движение.ВариантРаздельногоУчетаНДС = Перечисления.ВариантыРаздельногоУчетаНДС.Распределение Тогда
			Продолжить;
		КонецЕсли;
		
		РасчетнаяПартия = РасчетСебестоимости.ДобавитьЗаписьВТаблицуДвижений(ПараметрыРасчета, ИмяРегистра, Движение,
			"Период, Регистратор, Организация, НаправлениеДеятельности");
		
		РасчетнаяПартия.ВидДвижения 			= ВидДвиженияНакопления.Приход;
		РасчетнаяПартия.Подразделение 			= Движение.ПодразделениеРасходов;
		РасчетнаяПартия.СтатьяРасходов 			= Движение.СтатьяОтраженияРасходов;
		РасчетнаяПартия.АналитикаРасходов 		= Движение.АналитикаОтраженияРасходов;
		РасчетнаяПартия.ХозяйственнаяОперация 	= Перечисления.ХозяйственныеОперации.ЗакупкаУПоставщика;
		
		РасчетнаяПартия.ДокументДвижения 		= Движение.Регистратор;
		
		Если Движение.КорВидДеятельностиНДС = Перечисления.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД
		 ИЛИ Движение.КорВидДеятельностиНДС = Перечисления.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС Тогда
			РасчетнаяПартия.СуммаРегл 			= Движение.НДСРегл;
			РасчетнаяПартия.СуммаУпр 			= ?(ПараметрыРасчета.УправленческийУчетОрганизаций, Движение.НДСУпр, 0);
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

Процедура СформироватьДопРасходыВПартииПрочихРасходов(ПараметрыРасчета, РасчетныеПриходыПартийРасходов)
	
	ИмяРегистра = Метаданные.РегистрыНакопления.ПартииПрочихРасходов.Имя;
	
	// Шаг 1: Формируем движения по регистру ПартииПрочихРасходов
	Для Каждого Движение Из РасчетныеПриходыПартийРасходов Цикл
		
		Если Движение.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеклассификацияРасходов
		 ИЛИ Движение.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.СписаниеПрочихРасходов Тогда
		 	
		 	РасчетнаяПартия = РасчетСебестоимости.ДобавитьЗаписьВТаблицуДвижений(ПараметрыРасчета, ИмяРегистра, Движение,
			"Период, Регистратор, Организация, НаправлениеДеятельности");
		
			РасчетнаяПартия.ВидДвижения = ВидДвиженияНакопления.Приход;
		 	
			РасчетнаяПартия.Стоимость 					= Движение.Стоимость;
			РасчетнаяПартия.СтоимостьБезНДС				= Движение.СтоимостьБезНДС;
			РасчетнаяПартия.СтоимостьРегл 				= ?(Движение.СтоимостьРегл = 0, Движение.НДСРегл, Движение.СтоимостьРегл);
			РасчетнаяПартия.Подразделение 				= Движение.Подразделение;
			РасчетнаяПартия.СтатьяРасходов 				= Движение.СтатьяРасходов;
			РасчетнаяПартия.АналитикаРасходов 			= Движение.АналитикаРасходов;
			РасчетнаяПартия.ХозяйственнаяОперация 		= Движение.ХозяйственнаяОперация;
			
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

Процедура СформироватьДопРасходыВПартииНДСКРаспределению(ПараметрыРасчета, РасчетныеПриходыПартийРасходов)
	
	ИмяРегистра = Метаданные.РегистрыНакопления.ПартииНДСКРаспределению.Имя;
	
	// Шаг 1: Формируем движения по регистру ПартииНДСКРаспределению
	Для Каждого Движение Из РасчетныеПриходыПартийРасходов Цикл
		
		Если ЗначениеЗаполнено(Движение.СтатьяРасходов)
		 И ЗначениеЗаполнено(Движение.ВариантРаздельногоУчетаНДС)
		 И Движение.ВариантРаздельногоУчетаНДС = Перечисления.ВариантыРаздельногоУчетаНДС.Распределение
		 ИЛИ ЗначениеЗаполнено(Движение.СтатьяОтраженияРасходов)
		 	И (Движение.НалогообложениеНДС = Перечисления.ТипыНалогообложенияНДС.ВводОСВЭксплуатацию
		 	ИЛИ Движение.НалогообложениеНДС = Перечисления.ТипыНалогообложенияНДС.ОпределяетсяРаспределением) Тогда
		 	
		 	РасчетнаяПартия = РасчетСебестоимости.ДобавитьЗаписьВТаблицуДвижений(ПараметрыРасчета, ИмяРегистра, Движение,
				"Период, Регистратор, Организация, ДокументПоступленияРасходов, НаправлениеДеятельности,
				|Поставщик, ВидЦенности, СтавкаНДС,
				|СтоимостьРегл, НДСРегл");
			РасчетнаяПартия.ВидДвижения = ВидДвиженияНакопления.Приход;
			
			РасчетнаяПартия.Подразделение 			= Движение.ПодразделениеРасходов;
			РасчетнаяПартия.СтатьяРасходов 			= Движение.СтатьяОтраженияРасходов;
			РасчетнаяПартия.АналитикаРасходов 		= Движение.АналитикаОтраженияРасходов;
			РасчетнаяПартия.ВидДеятельностиНДС 		= Движение.НалогообложениеНДС;
			
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

Процедура СформироватьДопРасходыВДвиженияНоменклатураДоходыРасходы(ПараметрыРасчета)
	
	ИмяРегистра = Метаданные.РегистрыНакопления.ДвиженияНоменклатураДоходыРасходы.Имя;
	
	Запрос = Новый Запрос;
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьСвойстваЗапроса(Запрос, ПараметрыРасчета);
	
	Запрос.Текст = ""
		// подготовка временных таблиц
		+ ТекстРегистраторыДляНоменклатураДоходыРасходы() // вт РегистраторыДопРасходы
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()
		// выборка данных
		+ ТекстОписаниеДанныхДляНоменклатураДоходыРасходы()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстНоменклатураДоходыРасходыИзСебестоимости();
	
	РасчетСебестоимостиПрикладныеАлгоритмы.СформироватьДвиженияПоРегиструПоДаннымЗапроса(
		ПараметрыРасчета,
		ИмяРегистра,
		Запрос,
		"СформироватьДопРасходыВДвиженияНоменклатураДоходыРасходы");
	
	РасчетСебестоимостиПрикладныеАлгоритмы.УничтожитьВременныеТаблицы(ПараметрыРасчета, "РегистраторыДопРасходы");
	
КонецПроцедуры

// Тексты запросов

// ... для таблицы РасчетныеПартииПоЗаказам в ПолучитьДанныеДляДопРасходов()

Функция ТекстНачальныеОстаткиПартийПрочихРасходов()
	Возврат
		"ВЫБРАТЬ
		|	ДД.Организация,
		|	ДД.Подразделение,
		|	ДД.СтатьяРасходов,
		|	Статьи.ПравилоРаспределенияНаСебестоимость КАК ПравилоРаспределенияНаСебестоимость,
		|	ДД.АналитикаРасходов,
		|	ДД.ДокументПоступленияРасходов,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.НаправлениеДеятельности,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидДеятельностиНДС,
		|	(ВЫБОР
		|		КОГДА Статьи.ВариантРаспределенияРасходовУпр =
		|				ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			ТОГДА ДД.СтоимостьОстаток
		|		ИНАЧЕ 0 КОНЕЦ) КАК СтоимостьОстаток,
		|	(ВЫБОР
		|		КОГДА Статьи.ВариантРаспределенияРасходовУпр =
		|				ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			ТОГДА ДД.СтоимостьБезНДСОстаток
		|		ИНАЧЕ 0 КОНЕЦ) КАК СтоимостьБезНДСОстаток,
		|	(ВЫБОР
		|		КОГДА Статьи.ВариантРаспределенияРасходовРегл =
		|				ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			ТОГДА ДД.СтоимостьРеглОстаток
		|		ИНАЧЕ 0 КОНЕЦ) КАК СтоимостьРеглОстаток,
		|	(ВЫБОР
		|		КОГДА Статьи.ВариантРаспределенияРасходовРегл =
		|				ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			ТОГДА ДД.НДСРеглОстаток
		|		ИНАЧЕ 0 КОНЕЦ) КАК НДСРеглОстаток,
		|	(ВЫБОР
		|		КОГДА Статьи.ВариантРаспределенияРасходовУпр =
		|				ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			ТОГДА ДД.НДСУпрОстаток
		|		ИНАЧЕ 0 КОНЕЦ) КАК НДСУпрОстаток,
		|	(ВЫБОР
		|		КОГДА Статьи.ВариантРаспределенияРасходовРегл =
		|				ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			ТОГДА ДД.ПостояннаяРазницаОстаток
		|		ИНАЧЕ 0 КОНЕЦ) КАК ПостояннаяРазницаОстаток,
		|	(ВЫБОР
		|		КОГДА Статьи.ВариантРаспределенияРасходовРегл =
		|				ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			ТОГДА ДД.ВременнаяРазницаОстаток
		|		ИНАЧЕ 0 КОНЕЦ) КАК ВременнаяРазницаОстаток
		|ПОМЕСТИТЬ НачальныеОстаткиРасходов
		|ИЗ
		|	РегистрНакопления.ПартииПрочихРасходов.Остатки(&ГраницаНачалоПериода, Организация В (&МассивОрганизаций)) КАК ДД
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиРасходов КАК Статьи
		|		ПО Статьи.Ссылка = ДД.СтатьяРасходов
		|ГДЕ
		|	Статьи.ВариантРаспределенияРасходовУпр
		|		= ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|	ИЛИ Статьи.ВариантРаспределенияРасходовРегл
		|		= ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	ДД.ДокументПоступленияРасходов,
		|	ДД.Организация,
		|	ДД.СтатьяРасходов,
		|	ДД.АналитикаРасходов
		|";
КонецФункции

Функция ТекстАналитикиРасходовВсе()
	Возврат
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Ключи.Организация,
		|	Ключи.СтатьяРасходов,
		|	Ключи.АналитикаРасходов,
		|	Ключи.НаправлениеДеятельности
		|ПОМЕСТИТЬ АналитикиРасходовВсе
		|ИЗ
		|	(ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ДД.Организация,
		|		ДД.СтатьяРасходов,
		|		ЕСТЬNULL(Декларации.Ссылка, ДД.АналитикаРасходов) КАК АналитикаРасходов,
		|		ДД.НаправлениеДеятельности
		|	ИЗ
		|		НачальныеОстаткиРасходов КАК ДД
		|		ЛЕВОЕ СОЕДИНЕНИЕ Декларации КАК Декларации
		|			ПО Декларации.Поступление = ДД.АналитикаРасходов
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ДД.Организация,
		|		ДД.СтатьяРасходов,
		|		ЕСТЬNULL(Декларации.Ссылка, ДД.АналитикаРасходов) КАК АналитикаРасходов,
		|		ДД.НаправлениеДеятельности
		|	ИЗ
		|		ВТКэшРасчетныеОборотыПартииПрочихРасходов КАК ДД
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиРасходов КАК Статьи
		|			ПО Статьи.Ссылка = ДД.СтатьяРасходов
		|		ЛЕВОЕ СОЕДИНЕНИЕ Декларации КАК Декларации
		|			ПО Декларации.Поступление = ДД.АналитикаРасходов
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.КорректировкаПриобретения КАК Корректировка
		|			ПО Корректировка.Ссылка = ДД.Регистратор
		//++ Локализация
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученныйНалоговыйАгент КАК СчетФактура
		|			ПО СчетФактура.Ссылка = ДД.Регистратор
		//-- Локализация
		|	ГДЕ
		|		ДД.СлужебноеВидДвиженияПриход
		|		И (Статьи.ВариантРаспределенияРасходовУпр
		|				= ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			ИЛИ Статьи.ВариантРаспределенияРасходовРегл
		|				= ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров))
		|		И ДД.ДокументПоступленияРасходов В (
		|			ДД.Регистратор,
		//++ Локализация
		|			СчетФактура.СчетФактураОснование,
		//-- Локализация
		|			Корректировка.ДокументОснование)
		|	) КАК Ключи
		|";
КонецФункции

Функция ТекстЗаказыИзАналитикРасходов() // ВТ ЗаказыИзАналитикРасходов, ПоступленияИзАналитикРасходов, ПоступленияИЗаказыИзАналитикРасходов 
	Возврат
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДД.ДатаПоступления,
		|	ДД.Поступление,
		|	ДД.Заказ,
		|	ДД.Организация,
		|	ДД.Номенклатура,
		|	ДД.Характеристика,
		|	(ВЫБОР
		|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям ТОГДА ДД.Назначение
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка) КОНЕЦ) КАК Назначение,
		|	ДД.Склад,
		|	ДД.Количество
		|ПОМЕСТИТЬ ЗаказыИзАналитикРасходов
		|ИЗ (
		|	ВЫБРАТЬ
		|		ДД.Период КАК ДатаПоступления,
		|		ДД.Регистратор КАК Поступление,
		|		ДД.ЗаказПоставщику КАК Заказ,
		|		КлючиРасходов.Организация,
		|		ДД.Номенклатура,
		|		ДД.Характеристика,
		|		ТоварыДокумента.Назначение,
		|		(ВЫБОР
		|			КОГДА Заказ.ХозяйственнаяОперация В (
		|					ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаТоварыВПути),
		|					ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути),
		|					ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСТоварыВПути))
		|				ТОГДА Заказ.Договор
		|			ИНАЧЕ ДД.Склад КОНЕЦ) КАК Склад,
		|		СУММА(ДД.КОформлению) КАК Количество
		|	ИЗ
		|		РегистрНакопления.ЗаказыПоставщикам КАК ДД
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказПоставщику КАК Заказ
		|			ПО Заказ.Ссылка = ДД.ЗаказПоставщику
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказПоставщику.Товары КАК ТоварыДокумента
		|			ПО ТоварыДокумента.Ссылка = ДД.ЗаказПоставщику
		|			И ТоварыДокумента.КодСтроки = ДД.КодСтроки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикиРасходовВсе КАК КлючиРасходов
		|			ПО КлючиРасходов.АналитикаРасходов = ДД.ЗаказПоставщику
		|			И КлючиРасходов.НаправлениеДеятельности = 
		|				ЕСТЬNULL(ТоварыДокумента.Назначение.НаправлениеДеятельности,
		|					ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыКПоступлению КАК КПоступлению
		|			ПО КПоступлению.ДокументПоступления = Заказ.Ссылка
		|			И КПоступлению.Период <= &КонецПериода
		|			И КПоступлению.Активность
		|			И КПоступлению.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|			И КПоступлению.КОформлениюПоступленийПоРаспоряжению <> 0
		|			И КПоступлению.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаТоварыВПути),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСТоварыВПути))
		|	ГДЕ
		|		ДД.Период <= &КонецПериода
		|		И ДД.Активность
		|		И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|		И КПоступлению.Регистратор ЕСТЬ NULL
		|
		|	СГРУППИРОВАТЬ ПО
		|		ДД.Период,
		|		ДД.Регистратор,
		|		ДД.ЗаказПоставщику,
		|		КлючиРасходов.Организация,
		|		ДД.Номенклатура,
		|		ДД.Характеристика,
		|		ТоварыДокумента.Назначение,
		|		(ВЫБОР
		|			КОГДА Заказ.ХозяйственнаяОперация В (
		|					ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаТоварыВПути),
		|					ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути),
		|					ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСТоварыВПути))
		|				ТОГДА Заказ.Договор
		|			ИНАЧЕ ДД.Склад КОНЕЦ)
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ
		|		ДД.Период КАК ДатаПоступления,
		|		ДД.Регистратор КАК Поступление,
		|		ДД.ЗаказПоставщику КАК Заказ,
		|		КлючиРасходов.Организация,
		|		ДД.Номенклатура,
		|		ДД.Характеристика,
		|		ТоварыДокумента.Назначение,
		|		(ВЫБОР
		|			КОГДА Заказ.ХозяйственнаяОперация В (
		|					ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаТоварыВПути),
		|					ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути),
		|					ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСТоварыВПути))
		|				ТОГДА Заказ.Договор
		|			ИНАЧЕ ДД.Склад КОНЕЦ) КАК Склад,
		|		СУММА(ДД.КОформлению) КАК Количество
		|	ИЗ
		|		РегистрНакопления.ЗаказыПоставщикам КАК ДД
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказПоставщику КАК Заказ
		|			ПО Заказ.Ссылка = ДД.ЗаказПоставщику
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказПоставщику.Товары КАК ТоварыДокумента
		|			ПО ДД.ЗаказПоставщику = ТоварыДокумента.Ссылка
		|			И ДД.КодСтроки = ТоварыДокумента.КодСтроки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикиРасходовВсе КАК КлючиРасходов
		|			ПО КлючиРасходов.АналитикаРасходов = ЗНАЧЕНИЕ(Документ.ЗаказПоставщику.ПустаяСсылка)
		|			И КлючиРасходов.Организация = Заказ.Организация
		|			И КлючиРасходов.НаправлениеДеятельности = 
		|				ЕСТЬNULL(ТоварыДокумента.Назначение.НаправлениеДеятельности,
		|					ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыКПоступлению КАК КПоступлению
		|			ПО КПоступлению.ДокументПоступления = Заказ.Ссылка
		|			И КПоступлению.Период <= &КонецПериода
		|			И КПоступлению.Активность
		|			И КПоступлению.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|			И КПоступлению.КОформлениюПоступленийПоРаспоряжению <> 0
		|			И КПоступлению.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаТоварыВПути),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСТоварыВПути))
		|	ГДЕ
		|		ДД.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ДД.Активность
		|		И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|		И КПоступлению.Регистратор ЕСТЬ NULL
		|
		|	СГРУППИРОВАТЬ ПО
		|		ДД.Период,
		|		ДД.Регистратор,
		|		ДД.ЗаказПоставщику,
		|		КлючиРасходов.Организация,
		|		ДД.Номенклатура,
		|		ДД.Характеристика,
		|		ТоварыДокумента.Назначение,
		|		(ВЫБОР
		|			КОГДА Заказ.ХозяйственнаяОперация В (
		|					ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаТоварыВПути),
		|					ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути),
		|					ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСТоварыВПути))
		|				ТОГДА Заказ.Договор
		|			ИНАЧЕ ДД.Склад КОНЕЦ)
		|
		// Поступления товаров по неотфактурованным поставкам и товарам в пути
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ
		|		ДД.Период КАК ДатаПоступления,
		|		ДД.Регистратор КАК Поступление,
		|		ДД.ДокументПоступления КАК Заказ,
		|		КлючиРасходов.Организация,
		|		ДД.Номенклатура,
		|		ДД.Характеристика,
		|		ДД.Назначение,
		|		ДД.Склад,
		|		СУММА(ДД.КОформлениюПоступленийПоРаспоряжению) КАК Количество
		|	ИЗ
		|		РегистрНакопления.ТоварыКПоступлению КАК ДД
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказПоставщику КАК Заказ
		|			ПО Заказ.Ссылка = ДД.ДокументПоступления
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикиРасходовВсе КАК КлючиРасходов
		|			ПО КлючиРасходов.АналитикаРасходов = ДД.ДокументПоступления
		|			И КлючиРасходов.НаправлениеДеятельности =
		|				ЕСТЬNULL(ДД.Назначение.НаправлениеДеятельности,
		|					ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|	ГДЕ
		|		ДД.Период <= &КонецПериода
		|		И ДД.Активность
		|		И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|		И ДД.КОформлениюПоступленийПоРаспоряжению <> 0
		|		И Заказ.ХозяйственнаяОперация В (
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки),
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки),
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаТоварыВПути),
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути),
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСТоварыВПути))
		|	СГРУППИРОВАТЬ ПО
		|		ДД.Период,
		|		ДД.Регистратор,
		|		ДД.ДокументПоступления,
		|		КлючиРасходов.Организация,
		|		ДД.Номенклатура,
		|		ДД.Характеристика,
		|		ДД.Назначение,
		|		ДД.Склад
		|
		// Расходы по заказам на перемещение
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ
		|		ДД.Период КАК ДатаПоступления,
		|		ДД.Регистратор КАК Поступление,
		|		ДД.ЗаказНаПеремещение КАК Заказ,
		|		КлючиРасходов.Организация,
		|		ДД.Номенклатура,
		|		ДД.Характеристика,
		|		ТоварыДокумента.Назначение,
		|		Заказ.СкладПолучатель КАК Склад,
		|		СУММА(ДД.КОформлению) КАК Количество
		|	ИЗ
		|		РегистрНакопления.ЗаказыНаПеремещение КАК ДД
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказНаПеремещение КАК Заказ
		|			ПО Заказ.Ссылка = ДД.ЗаказНаПеремещение
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказНаПеремещение.Товары КАК ТоварыДокумента
		|			ПО ДД.ЗаказНаПеремещение = ТоварыДокумента.Ссылка
		|			И ДД.КодСтроки = ТоварыДокумента.КодСтроки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикиРасходовВсе КАК КлючиРасходов
		|			ПО КлючиРасходов.АналитикаРасходов = ДД.ЗаказНаПеремещение
		|			И КлючиРасходов.НаправлениеДеятельности = 
		|				ЕСТЬNULL(ТоварыДокумента.Назначение.НаправлениеДеятельности,
		|					ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|	ГДЕ
		|		ДД.Период <= &КонецПериода
		|		И ДД.Активность
		|		И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|
		|	СГРУППИРОВАТЬ ПО
		|		ДД.Период,
		|		ДД.Регистратор,
		|		ДД.ЗаказНаПеремещение,
		|		КлючиРасходов.Организация,
		|		ДД.Номенклатура,
		|		ДД.Характеристика,
		|		ТоварыДокумента.Назначение,
		|		Заказ.СкладПолучатель
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ
		|		ДД.Период КАК ДатаПоступления,
		|		ДД.Регистратор КАК Поступление,
		|		ДД.ЗаказНаПеремещение КАК Заказ,
		|		КлючиРасходов.Организация,
		|		ДД.Номенклатура,
		|		ДД.Характеристика,
		|		ТоварыДокумента.Назначение,
		|		Заказ.СкладПолучатель КАК Склад,
		|		СУММА(ДД.КОформлению) КАК Количество
		|	ИЗ
		|		РегистрНакопления.ЗаказыНаПеремещение КАК ДД
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказНаПеремещение КАК Заказ
		|			ПО Заказ.Ссылка = ДД.ЗаказНаПеремещение
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказНаПеремещение.Товары КАК ТоварыДокумента
		|			ПО ДД.ЗаказНаПеремещение = ТоварыДокумента.Ссылка
		|			И ДД.КодСтроки = ТоварыДокумента.КодСтроки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикиРасходовВсе КАК КлючиРасходов
		|			ПО КлючиРасходов.АналитикаРасходов = ЗНАЧЕНИЕ(Документ.ЗаказНаПеремещение.ПустаяСсылка)
		|			И КлючиРасходов.Организация = Заказ.Организация
		|			И КлючиРасходов.НаправлениеДеятельности = 
		|				ЕСТЬNULL(ТоварыДокумента.Назначение.НаправлениеДеятельности,
		|					ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|	ГДЕ
		|		ДД.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ДД.Активность
		|		И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|
		|	СГРУППИРОВАТЬ ПО
		|		ДД.Период,
		|		ДД.Регистратор,
		|		ДД.ЗаказНаПеремещение,
		|		КлючиРасходов.Организация,
		|		ДД.Номенклатура,
		|		ДД.Характеристика,
		|		ТоварыДокумента.Назначение,
		|		Заказ.СкладПолучатель
		|
		// Расходы по заказам на сборку
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ
		|		ДД.Период КАК ДатаПоступления,
		|		ДД.Регистратор КАК Поступление,
		|		ДД.ЗаказНаСборку КАК Заказ,
		|		КлючиРасходов.Организация,
		|		ДД.Номенклатура,
		|		ДД.Характеристика,
		|		(ВЫБОР
		|			КОГДА Заказ.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СборкаТоваров)
		|				ТОГДА Заказ.Назначение
		|			ИНАЧЕ ЗаказТовары.Назначение КОНЕЦ) КАК Назначение,
		|		Заказ.Склад КАК Склад,
		|		СУММА(ДД.КОформлению) КАК Количество
		|	ИЗ
		|		РегистрНакопления.ЗаказыНаСборку КАК ДД
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказНаСборку КАК Заказ
		|			ПО Заказ.Ссылка = ДД.ЗаказНаСборку
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЗаказНаСборку.Товары КАК ЗаказТовары
		|			ПО ЗаказТовары.Ссылка = ДД.ЗаказНаСборку
		|			И ЗаказТовары.КодСтроки = ДД.КодСтроки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикиРасходовВсе КАК КлючиРасходов
		|			ПО КлючиРасходов.АналитикаРасходов = ДД.ЗаказНаСборку
		|			И КлючиРасходов.НаправлениеДеятельности = 
		|			(ВЫБОР
		|				КОГДА Заказ.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СборкаТоваров)
		|					ТОГДА ЕСТЬNULL(Заказ.Назначение.НаправлениеДеятельности,
		|						ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|				ИНАЧЕ
		|					ЕСТЬNULL(ЗаказТовары.Назначение.НаправлениеДеятельности,
		|						ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|				КОНЕЦ)
		|	ГДЕ
		|		ДД.Период <= &КонецПериода
		|		И ДД.Активность
		|		И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|		И ДД.ТипСборки = ЗНАЧЕНИЕ(Перечисление.ТипыДвиженияЗапасов.Поступление)
		|
		|	СГРУППИРОВАТЬ ПО
		|		ДД.Период,
		|		ДД.Регистратор,
		|		ДД.ЗаказНаСборку,
		|		КлючиРасходов.Организация,
		|		ДД.Номенклатура,
		|		ДД.Характеристика,
		|		(ВЫБОР
		|			КОГДА Заказ.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СборкаТоваров)
		|				ТОГДА Заказ.Назначение
		|			ИНАЧЕ ЗаказТовары.Назначение КОНЕЦ),
		|		Заказ.Склад
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ
		|		ДД.Период КАК ДатаПоступления,
		|		ДД.Регистратор КАК Поступление,
		|		ДД.ЗаказНаСборку КАК Заказ,
		|		КлючиРасходов.Организация,
		|		ДД.Номенклатура,
		|		ДД.Характеристика,
		|		(ВЫБОР
		|			КОГДА Заказ.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СборкаТоваров)
		|				ТОГДА Заказ.Назначение
		|			ИНАЧЕ ЗаказТовары.Назначение КОНЕЦ) КАК Назначение,
		|		Заказ.Склад КАК Склад,
		|		СУММА(ДД.КОформлению) КАК Количество
		|	ИЗ
		|		РегистрНакопления.ЗаказыНаСборку КАК ДД
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказНаСборку КАК Заказ
		|			ПО Заказ.Ссылка = ДД.ЗаказНаСборку
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЗаказНаСборку.Товары КАК ЗаказТовары
		|			ПО ЗаказТовары.Ссылка = ДД.ЗаказНаСборку
		|			И ЗаказТовары.КодСтроки = ДД.КодСтроки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикиРасходовВсе КАК КлючиРасходов
		|			ПО КлючиРасходов.АналитикаРасходов = ЗНАЧЕНИЕ(Документ.ЗаказНаСборку.ПустаяСсылка)
		|			И КлючиРасходов.Организация = Заказ.Организация
		|			И КлючиРасходов.НаправлениеДеятельности = 
		|			(ВЫБОР
		|				КОГДА Заказ.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СборкаТоваров)
		|					ТОГДА ЕСТЬNULL(Заказ.Назначение.НаправлениеДеятельности,
		|						ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|				ИНАЧЕ
		|					ЕСТЬNULL(ЗаказТовары.Назначение.НаправлениеДеятельности,
		|						ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|				КОНЕЦ)
		|	ГДЕ
		|		ДД.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|		И ДД.Активность
		|		И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|		И ДД.ТипСборки = ЗНАЧЕНИЕ(Перечисление.ТипыДвиженияЗапасов.Поступление)
		|
		|	СГРУППИРОВАТЬ ПО
		|		ДД.Период,
		|		ДД.Регистратор,
		|		ДД.ЗаказНаСборку,
		|		КлючиРасходов.Организация,
		|		ДД.Номенклатура,
		|		ДД.Характеристика,
		|		(ВЫБОР
		|			КОГДА Заказ.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СборкаТоваров)
		|				ТОГДА Заказ.Назначение
		|			ИНАЧЕ ЗаказТовары.Назначение КОНЕЦ),
		|		Заказ.Склад
		|) КАК ДД
		|;
		|////////////////////////////////////////////////////////////////////////////
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Заказы.ДатаПоступления,
		|	Заказы.Поступление,
		|	Заказы.Номенклатура,
		|	Заказы.Характеристика,
		|	Заказы.Назначение,
		|	Заказы.Склад
		|ПОМЕСТИТЬ ПоступленияИзАналитикРасходов
		|ИЗ
		|	ЗаказыИзАналитикРасходов КАК Заказы
		|ГДЕ
		|	Заказы.ДатаПоступления <= &КонецПериода
		|;
		|////////////////////////////////////////////////////////////////////////////
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Заказы.Поступление КАК Поступление,
		|	Заказы.Заказ КАК Заказ
		|ПОМЕСТИТЬ ПоступленияИЗаказыИзАналитикРасходов
		|ИЗ
		|	ЗаказыИзАналитикРасходов КАК Заказы
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Поступление,
		|	Заказ
		|";
КонецФункции

Функция ТекстПоступившиеЗаказы()
	Возврат
		"ВЫБРАТЬ
		|	""ТекстПоступившиеЗаказы"" КАК ЗапросИсточник,
		|	10 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Остаток) КАК ТипЗаписи,
		|	ИСТИНА КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.ДатаПоступления КАК Период,
		|	ДД.Поступление КАК Регистратор,
		|	ДД.Поступление КАК ДокументПоступления,
		|	ДД.Заказ,
		|	ДД.Организация,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК РазделУчета,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК АналитикаУчетаНоменклатуры,
		|	ДД.Номенклатура,
		|	ДД.Характеристика,
		|	ДД.Назначение,
		|	ДД.Склад,
		|	ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка) КАК Серия,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) КАК ВидЗапасов,
		|	НЕОПРЕДЕЛЕНО КАК Партия,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК АналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) КАК ВидДеятельностиНДС,
		|	ДД.Количество,
		|	0 КАК Стоимость,
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница
		|ИЗ
		|	ЗаказыИзАналитикРасходов КАК ДД
		|";
КонецФункции

Функция ТекстПриходыПоступленийПоЗаказамСебестоимости()
	Возврат
		"ВЫБРАТЬ
		|	""ТекстПриходыПоступленийПоЗаказамСебестоимости"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	Поступления.ДатаПоступления КАК Период,
		|	ДД.Регистратор КАК Регистратор,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступления,
		|	НЕОПРЕДЕЛЕНО КАК Заказ,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура   КАК Номенклатура,
		|	ДД.АналитикаУчетаНоменклатуры.Характеристика КАК Характеристика,
		|	ДД.АналитикаУчетаНоменклатуры.Назначение     КАК Назначение,
		|	ДД.АналитикаУчетаНоменклатуры.МестоХранения  КАК МестоХранения,
		|	ДД.АналитикаУчетаНоменклатуры.Серия          КАК Серия,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|	СУММА(ДД.Количество) КАК Количество,
		|	СУММА(ДД.Стоимость) КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПоступленияИзАналитикРасходов КАК Поступления
		|		ПО Поступления.Поступление = ДД.Регистратор
		|		И Поступления.Номенклатура = ДД.АналитикаУчетаНоменклатуры.Номенклатура
		|		И Поступления.Характеристика = ДД.АналитикаУчетаНоменклатуры.Характеристика
		|		И Поступления.Назначение = ДД.АналитикаУчетаНоменклатуры.Назначение
		|		И Поступления.Склад = ДД.АналитикаУчетаНоменклатуры.МестоХранения
		|ГДЕ
		|	ДД.Период < &НачалоПериода
		|	И ДД.Организация В (&МассивОрганизаций)
		|	И ДД.Активность
		|СГРУППИРОВАТЬ ПО
		|	Поступления.ДатаПоступления,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.АналитикаУчетаНоменклатуры.Характеристика,
		|	ДД.АналитикаУчетаНоменклатуры.Назначение,
		|	ДД.АналитикаУчетаНоменклатуры.МестоХранения,
		|	ДД.АналитикаУчетаНоменклатуры.Серия,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	""ТекстПриходыПоступленийПоЗаказамСебестоимости"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	Поступления.ДатаПоступления КАК Период,
		|	ДД.Регистратор КАК Регистратор,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступления,
		|	НЕОПРЕДЕЛЕНО КАК Заказ,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура   КАК Номенклатура,
		|	ДД.АналитикаУчетаНоменклатуры.Характеристика КАК Характеристика,
		|	ДД.АналитикаУчетаНоменклатуры.Назначение     КАК Назначение,
		|	ДД.АналитикаУчетаНоменклатуры.МестоХранения  КАК МестоХранения,
		|	ДД.АналитикаУчетаНоменклатуры.Серия          КАК Серия,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|	СУММА(ДД.Количество) КАК Количество,
		|	СУММА(ЕСТЬNULL(ВЫРАЗИТЬ(ДД.Количество * Цены.Стоимость КАК ЧИСЛО(31,2)), ДД.Стоимость)) КАК Стоимость,
		|	СУММА(ЕСТЬNULL(ВЫРАЗИТЬ(ДД.Количество * Цены.СтоимостьБезНДС КАК ЧИСЛО(31,2)), ДД.СтоимостьБезНДС)) КАК СтоимостьБезНДС,
		|	СУММА(ЕСТЬNULL(ВЫРАЗИТЬ(ДД.Количество * Цены.СтоимостьРегл КАК ЧИСЛО(31,2)), ДД.СтоимостьРегл)) КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПоступленияИзАналитикРасходов КАК Поступления
		|		ПО Поступления.Поступление = ДД.Регистратор
		|		И Поступления.Номенклатура = ДД.АналитикаУчетаНоменклатуры.Номенклатура
		|		И Поступления.Характеристика = ДД.АналитикаУчетаНоменклатуры.Характеристика
		|		И Поступления.Назначение = ДД.АналитикаУчетаНоменклатуры.Назначение
		|		И Поступления.Склад = ДД.АналитикаУчетаНоменклатуры.МестоХранения
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТСтоимостьПартийТоваров КАК Цены
		|		ПО Цены.Организация = ДД.Организация
		|		И Цены.Период = НАЧАЛОПЕРИОДА(ДД.Период, МЕСЯЦ)
		|		И Цены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Цены.ВидЗапасов = ДД.ВидЗапасов
		|		И Цены.РазделУчета = ДД.РазделУчета
		|		И Цены.Партия = ДД.Партия
		|		И Цены.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Цены.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
		|		И Цены.ВидДеятельностиНДС = ДД.ВидДеятельностиНДС
		|		И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
		|СГРУППИРОВАТЬ ПО
		|	Поступления.ДатаПоступления,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.АналитикаУчетаНоменклатуры.Характеристика,
		|	ДД.АналитикаУчетаНоменклатуры.Назначение,
		|	ДД.АналитикаУчетаНоменклатуры.МестоХранения,
		|	ДД.АналитикаУчетаНоменклатуры.Серия,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС
		|";
КонецФункции

// ... для результата ПолучитьДанныеДляДопРасходов()

Функция ТекстОписаниеДанныхДляПартийПрочих() Экспорт
	Возврат
		"ВЫБРАТЬ ПЕРВЫЕ 0
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(80)) 													КАК ЗапросИсточник,
		|	0 																				КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПустаяСсылка) 							КАК ТипЗаписи,
		|	ЛОЖЬ 																			КАК РасчетЗавершен,
		|	ДД.ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 		КАК Номенклатура,
		|	ДД.АналитикаУчетаНоменклатуры.МестоХранения 	КАК Склад,
		|	НЕОПРЕДЕЛЕНО 									КАК ДокументПоступления,
		|	НЕОПРЕДЕЛЕНО 									КАК Заказ,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) 	КАК ВидЗапасов,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.НаправлениеДеятельности,
		|	ДД.АналитикаУчетаПартий.Контрагент КАК Поставщик,
		|	ДД.ДокументПоступленияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПустаяСсылка) КАК ВидЦенности,
		|	ДД.АналитикаУчетаПартий.СтавкаНДС КАК СтавкаНДС,
		|	ДД.СтатьяРасходов,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	0 КАК Количество,
		|	0 КАК Вес,
		|	0 КАК Объем,
		|	ДД.Стоимость,
		|	ДД.СтоимостьБезНДС,
		|	ДД.СтоимостьРегл,
		|	ДД.НДСРегл,
		|	ДД.НДСУпр,
		|	ДД.ПостояннаяРазница,
		|	ДД.ВременнаяРазница,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.НалогообложениеНДС,
		|	ДД.ХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) 							КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО 																	КАК ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО 																	КАК ДокументИсточник,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) 					КАК СтатьяОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ПустаяСсылка)					КАК ВариантРаздельногоУчетаНДС,
		|	НЕОПРЕДЕЛЕНО 																	КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) 	КАК ПравилоРаспределения,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) 			КАК РазделУчета,
		|	НЕОПРЕДЕЛЕНО 																	КАК Партия,
		|	НЕОПРЕДЕЛЕНО 																	КАК АналитикаФинансовогоУчета,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) 					КАК КорАналитикаУчетаПартий,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) 						КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ																			КАК ПрошлыеВыбытияТоваров,
		|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) 													КАК РасчетныйПериод
		|//ВоВременнуюТаблицу
		|ИЗ
		|	РегистрНакопления.ПартииПрочихРасходов КАК ДД
		|";
КонецФункции

Функция ТекстПартииПоЗаказам() // вт ПартииПоЗаказам
	Возврат
		"ВЫБРАТЬ
		|	ДД.Приоритет,
		|	ДД.ТипЗаписи,
		|	ДД.ВидДвижения,
		|	ДД.Период,
		|	ДД.Заказ,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.Регистратор,
		|	ДД.ДокументПоступления,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.Количество,
		|	ДД.Стоимость,
		|	ДД.СтоимостьБезНДС,
		|	ДД.СтоимостьРегл,
		|	ДД.НДСРегл,
		|	ДД.НДСУпр,
		|	ДД.ПостояннаяРазница,
		|	ДД.ВременнаяРазница
		|ПОМЕСТИТЬ ПартииПоЗаказам
		|ИЗ
		|	&РасчетныеПартииПоЗаказам КАК ДД
		|";
КонецФункции

Функция ТекстРегистраторыПрочих() // вт РегистраторыПрочих
	Возврат
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Ключи.Регистратор
		|ПОМЕСТИТЬ РегистраторыПрочих
		|ИЗ
		|	(ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ДД.ДокументПоступленияРасходов КАК Регистратор
		|	ИЗ
		|		НачальныеОстаткиРасходов КАК ДД
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ДД.ДокументПоступленияРасходов КАК Регистратор
		|	ИЗ
		|		ВТКэшРасчетныеОборотыПартииПрочихРасходов КАК ДД
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиРасходов КАК Статьи
		|			ПО Статьи.Ссылка = ДД.СтатьяРасходов
		|	ГДЕ
		|		ДД.ДокументПоступленияРасходов = ДД.Регистратор
		|		И ДД.СлужебноеВидДвиженияПриход
		|		И (Статьи.ВариантРаспределенияРасходовУпр =
		|				ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			ИЛИ  Статьи.ВариантРаспределенияРасходовРегл =
		|				ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров))
		|	) КАК Ключи
		|";
КонецФункции

Функция ТекстПериодыПартийПрочих() // вт ПериодыПартийПрочих
	Возврат
		"ВЫБРАТЬ
		|	ДД.Регистратор КАК ДокументПоступленияРасходов,
		|	ДД.Организация,
		|	ДД.СтатьяРасходов,
		|	ДД.АналитикаРасходов,
		|	МАКСИМУМ(ДД.Период) КАК Период
		|ПОМЕСТИТЬ ПериодыПартийПрочих
		|ИЗ
		|	РегистрНакопления.ПартииПрочихРасходов КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикиРасходовВсе КАК КлючиРасходов
		|		ПО КлючиРасходов.Организация = ДД.Организация
		|		И КлючиРасходов.СтатьяРасходов = ДД.СтатьяРасходов
		|		И КлючиРасходов.АналитикаРасходов = ДД.АналитикаРасходов
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.КорректировкаПриобретения КАК Корректировка
		|		ПО Корректировка.Ссылка = ДД.Регистратор
		//++ Локализация
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученныйНалоговыйАгент КАК СчетФактура
		|		ПО СчетФактура.Ссылка = ДД.Регистратор
		//-- Локализация
		|ГДЕ
		|	ДД.Период < &НачалоПериода
		|	И ДД.Организация В (&МассивОрганизаций)
		|	И ДД.Активность
		|	И ДД.ДокументПоступленияРасходов В (
		|		ДД.Регистратор,
		//++ Локализация
		|		СчетФактура.СчетФактураОснование,
		//-- Локализация
		|		Корректировка.ДокументОснование)
		|	И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|СГРУППИРОВАТЬ ПО
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.СтатьяРасходов,
		|	ДД.АналитикаРасходов
		|";
КонецФункции

Функция НеотфактурованныеПоставки() // вт НеотфактурованныеПоставки
	Возврат
		"ВЫБРАТЬ
		|	ДД.Партия КАК Партия,
		|	ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов КАК ВидЗапасов,
		|	ДД.РазделУчета КАК РазделУчета,
		|	МАКСИМУМ(Поступления.КорАналитикаУчетаНоменклатуры) КАК КорАналитикаУчетаНоменклатуры,
		|	МАКСИМУМ(Поступления.КорВидЗапасов) КАК КорВидЗапасов,
		|	МАКСИМУМ(Поступления.КорРазделУчета) КАК КорРазделУчета
		|	
		|ПОМЕСТИТЬ НеотфактурованныеПоставки
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК Поступления
		|		ПО Поступления.Регистратор = ДД.Партия
		|		И Поступления.Период < &КонецПериода
		|		И Поступления.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Поступления.ВидЗапасов = ДД.ВидЗапасов
		|		И Поступления.РазделУчета = ДД.РазделУчета
		|ГДЕ
		|	ДД.СлужебноеВидДвиженияПриход
		|	И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|	И ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|	И ДД.Регистратор В (
		|		ВЫБРАТЬ РАЗЛИЧНЫЕ
		|			ДД.Регистратор
		|		ИЗ
		|			АналитикиРасходовВсе КАК КлючиРасходов
		|		ГДЕ 
		|			КлючиРасходов.АналитикаРасходов В (
		|				ДД.Регистратор)
		|	)
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Партия,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.РазделУчета
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДД.Партия КАК Партия,
		|	ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов КАК ВидЗапасов,
		|	ДД.РазделУчета КАК РазделУчета,
		|	МАКСИМУМ(Поступления.КорАналитикаУчетаНоменклатуры) КАК КорАналитикаУчетаНоменклатуры,
		|	МАКСИМУМ(Поступления.КорВидЗапасов) КАК КорВидЗапасов,
		|	МАКСИМУМ(Поступления.КорРазделУчета) КАК КорРазделУчета
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК Поступления
		|		ПО Поступления.Регистратор = ДД.Партия
		|		И Поступления.Период < &КонецПериода
		|		И Поступления.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Поступления.ВидЗапасов = ДД.ВидЗапасов
		|		И Поступления.РазделУчета = ДД.РазделУчета
		|ГДЕ
		|	ДД.Период < &НачалоПериода
		|	И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|	И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|	И ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|	И ДД.Регистратор В (
		|		ВЫБРАТЬ РАЗЛИЧНЫЕ
		|			ДД.Регистратор
		|		ИЗ
		|			АналитикиРасходовВсе КАК КлючиРасходов
		|		ГДЕ 
		|			КлючиРасходов.АналитикаРасходов В (
		|				ДД.Регистратор)
		|	)
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Партия,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.РазделУчета
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия,
		|	АналитикаУчетаНоменклатуры,
		|	ВидЗапасов,
		|	РазделУчета
		|";
КонецФункции

Функция ТекстПрошлыеПоступленияИзТоваровВПути() // вт ПрошлыеПоступленияИзТоваровВПути
	Возврат 
		"ВЫБРАТЬ
		|	ДД.Период,
		|	ДД.Партия КАК Регистратор,
		|	ДД.КорАналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов КАК ВидЗапасов,
		|	ДД.КорРазделУчета КАК РазделУчета,
		|	ДД.Организация КАК Организация,
		|	ДД.КорПартия КАК Партия,
		|	ДД.КорАналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	ДД.КорВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	ДД.КорАналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	СУММА(ДД.Количество) КАК Количество,
		|	СУММА(ДД.Стоимость) КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница
		|ПОМЕСТИТЬ ПрошлыеПоступленияИзТоваровВПути
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикиТоваров
		|		ПО АналитикиТоваров.Ссылка = ДД.КорАналитикаУчетаНоменклатуры
		|ГДЕ
		|	ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	И ДД.Период < &НачалоПериода
		|	И ТИПЗНАЧЕНИЯ(ДД.Регистратор) = ТИП(Документ.ПоступлениеТоваровНаСклад)
		|	И ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути)
		|	И (
		|		ДД.Организация,
		|		АналитикиТоваров.Номенклатура,
		|		АналитикиТоваров.МестоХранения,
		|		ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|		ДД.Регистратор) В
		|	(
		|		ВЫБРАТЬ РАЗЛИЧНЫЕ
		|			КлючиРасходов.Организация,
		|			АналитикиТоваров.Номенклатура,
		|			АналитикиТоваров.МестоХранения,
		|			(ВЫБОР
		|				КОГДА КлючиРасходов.НаправлениеДеятельности = ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
		|				 ИЛИ НЕ &УчитыватьСебестоимостьТоваровПоНазначениям
		|					ТОГДА ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|						ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|				ИНАЧЕ КлючиРасходов.НаправлениеДеятельности КОНЕЦ) КАК НаправлениеДеятельности,
		|			ДД.Регистратор
		|		ИЗ
		|			АналитикиРасходовВсе КАК КлючиРасходов
		|		ГДЕ 
		|			КлючиРасходов.АналитикаРасходов = ДД.Партия
		|	)
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Партия,
		|	ДД.Организация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	ДД.КорРазделУчета,
		|	ДД.КорПартия,
		|	КорАналитикаУчетаПартий,
		|	ДД.КорВидДеятельностиНДС,
		|	ДД.КорАналитикаФинансовогоУчета
		|";
	
КонецФункции

Функция ТекстАналитикиРасходовПрошлыеПоступления() // вт АналитикиРасходовПрошлыеПоступления
	
	ТекстЗапроса = "
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	КлючиРасходов.Организация КАК Организация,
		|	КлючиРасходов.НаправлениеДеятельности КАК НаправлениеДеятельности,
		|	КлючиРасходов.АналитикаРасходов
		|ПОМЕСТИТЬ АналитикиРасходовПрошлыеПоступления
		|ИЗ
		|	АналитикиРасходовВсе КАК КлючиРасходов
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.РеестрДокументов КАК Реестр
		|		ПО Реестр.Ссылка = КлючиРасходов.АналитикаРасходов
		|		И НЕ Реестр.ДополнительнаяЗапись
		|ГДЕ 
		|	Реестр.ДатаДокументаИБ < &НачалоПериода
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	КлючиРасходов.Организация КАК Организация,
		|	КлючиРасходов.НаправлениеДеятельности КАК НаправлениеДеятельности,
		|	КлючиРасходов.АналитикаРасходов
		|ИЗ
		|	АналитикиРасходовВсе КАК КлючиРасходов
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ВводОстатков КАК ВводОстатков
		|		ПО ВводОстатков.Ссылка = КлючиРасходов.АналитикаРасходов
		|ГДЕ 
		|	ВводОстатков.Дата < &НачалоПериода
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Организация,
		|	НаправлениеДеятельности,
		|	АналитикаРасходов
		|";
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстАналитикиПрошлыхПоступленийТоваровПредварительная() // вт АналитикиПрошлыхПоступленийПредварительная
	
	ТекстЗапроса = "
		|ВЫБРАТЬ
		|	ДД.Регистратор,
		|	ДД.Организация КАК Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящаяВПрошломПериоде)
		|			ТОГДА ДД.Партия
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ КАК Партия,
		|	ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящаяВПрошломПериоде)
		|			ТОГДА ДД.АналитикаУчетаПартий
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|	КОНЕЦ КАК АналитикаУчетаПартий,
		|	НАЧАЛОПЕРИОДА(ДД.Период, МЕСЯЦ) КАК ПериодПоступления,
		|	СУММА(ДД.Количество)        КАК Количество,
		|	СУММА(ДД.Стоимость)         КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС)   КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьРегл)     КАК СтоимостьРегл,
		|	СУММА(ДД.СтоимостьУпр)      КАК СтоимостьУпр,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница)  КАК ВременнаяРазница
		|
		|ПОМЕСТИТЬ АналитикиПрошлыхПоступленийПредварительная
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
		|		ПО Аналитика.Ссылка = ДД.АналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК Склады
		|		ПО Склады.Ссылка = Аналитика.МестоХранения
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО СпрНоменклатура.Ссылка = Аналитика.Номенклатура
		|ГДЕ
		|	&РаспределениеДопРасходовПоВыбывшимТоварам
		|	И ДД.Период МЕЖДУ &ДатаПереходаНаПартионныйУчетВерсии22 И &КонецПредыдущегоПериода
		|	И ДД.Организация В (&МассивОрганизаций)
		|	И ДД.Активность
		|	И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|	И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|	И (ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
		|		ИЛИ ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		И (СпрНоменклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
		|			ИЛИ ЕСТЬNULL(Склады.ЦеховаяКладовая, ЛОЖЬ)))
		|	И (ДД.Организация,
		|		ЕСТЬNULL(Аналитика.Назначение.НаправлениеДеятельности,
		|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|		ДД.Регистратор) В
		|	(
		|		ВЫБРАТЬ
		|			КлючиРасходов.Организация,
		|			(ВЫБОР
		|				КОГДА КлючиРасходов.НаправлениеДеятельности = ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
		|					ТОГДА ЕСТЬNULL(Аналитика.Назначение.НаправлениеДеятельности,
		|						ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|				ИНАЧЕ КлючиРасходов.НаправлениеДеятельности КОНЕЦ) КАК НаправлениеДеятельности,
		|			КлючиРасходов.АналитикаРасходов
		|		ИЗ
		|			АналитикиРасходовПрошлыеПоступления КАК КлючиРасходов
		|	)
		|СГРУППИРОВАТЬ ПО
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящаяВПрошломПериоде)
		|			ТОГДА ДД.Партия
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящаяВПрошломПериоде)
		|			ТОГДА ДД.АналитикаУчетаПартий
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|	КОНЕЦ,
		|	НАЧАЛОПЕРИОДА(ДД.Период, МЕСЯЦ)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДД.Заказ КАК Регистратор,
		|	ДД.Организация КАК Организация,
		|	ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящаяВПрошломПериоде)
		|			ТОГДА ДД.Партия
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ КАК Партия,
		|	ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящаяВПрошломПериоде)
		|			ТОГДА ДД.АналитикаУчетаПартий
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|	КОНЕЦ КАК АналитикаУчетаПартий,
		|	НАЧАЛОПЕРИОДА(ДД.Период, МЕСЯЦ) КАК ПериодПоступления,
		|	СУММА(ДД.Количество)        КАК Количество,
		|	СУММА(ДД.Стоимость)         КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС)   КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьРегл)     КАК СтоимостьРегл,
		|	СУММА(ДД.СтоимостьБезНДС)   КАК СтоимостьУпр,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница)  КАК ВременнаяРазница
		|ИЗ
		|	ПартииПоЗаказам КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
		|		ПО Аналитика.Ссылка = ДД.АналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК Склады
		|		ПО Склады.Ссылка = Аналитика.МестоХранения
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО СпрНоменклатура.Ссылка = Аналитика.Номенклатура
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.РеестрДокументов КАК Реестр
		|		ПО Реестр.Ссылка = ДД.Регистратор
		|		И НЕ Реестр.ДополнительнаяЗапись
		|ГДЕ
		|	&РаспределениеДопРасходовПоВыбывшимТоварам
		|	И Реестр.ДатаДокументаИБ < &НачалоПериода
		|СГРУППИРОВАТЬ ПО
		|	ДД.Заказ,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящаяВПрошломПериоде)
		|			ТОГДА ДД.Партия
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящаяВПрошломПериоде)
		|			ТОГДА ДД.АналитикаУчетаПартий
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|	КОНЕЦ,
		|	НАЧАЛОПЕРИОДА(ДД.Период, МЕСЯЦ)
		|
		// Поступления из товаров в пути от поставщиков
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДД.Регистратор КАК Регистратор,
		|	ДД.Организация КАК Организация,
		|	ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящаяВПрошломПериоде)
		|			ТОГДА ДД.Партия
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ КАК Партия,
		|	ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящаяВПрошломПериоде)
		|			ТОГДА ДД.АналитикаУчетаПартий
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|	КОНЕЦ КАК АналитикаУчетаПартий,
		|	НАЧАЛОПЕРИОДА(ДД.Период, МЕСЯЦ) КАК ПериодПоступления,
		|	СУММА(ДД.Количество)        КАК Количество,
		|	СУММА(ДД.Стоимость)         КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС)   КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьРегл)     КАК СтоимостьРегл,
		|	СУММА(ДД.СтоимостьБезНДС)   КАК СтоимостьУпр,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница)  КАК ВременнаяРазница
		|ИЗ
		|	ПрошлыеПоступленияИзТоваровВПути КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
		|		ПО Аналитика.Ссылка = ДД.АналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК Склады
		|		ПО Склады.Ссылка = Аналитика.МестоХранения
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО СпрНоменклатура.Ссылка = Аналитика.Номенклатура
		|ГДЕ
		|	&РаспределениеДопРасходовПоВыбывшимТоварам
		|	И ДД.Период < &НачалоПериода
		|СГРУППИРОВАТЬ ПО
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящаяВПрошломПериоде)
		|			ТОГДА ДД.Партия
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящаяВПрошломПериоде)
		|			ТОГДА ДД.АналитикаУчетаПартий
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|	КОНЕЦ,
		|	НАЧАЛОПЕРИОДА(ДД.Период, МЕСЯЦ)
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Организация,
		|	Партия
		|";
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстАналитикиПрошлыхПоступленийТоваров() // вт АналитикиПрошлыхПоступлений, АналитикиПрошлыхПоступленийБезПартий
	
	ТекстЗапроса = "
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ПрошлыеПоступления.Регистратор,
		|	ДД.Организация КАК Организация,
		|	ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	(ВЫБОР
		|		КОГДА ДД.АналитикаУчетаНоменклатуры = ПрошлыеПоступления.АналитикаУчетаНоменклатуры ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ) КАК ЭтоАналитикаДокументаПоступления,
		|	ДД.Партия КАК Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ПрошлыеПоступления.ПериодПоступления,
		|	ПрошлыеПоступления.Количество,
		|	ПрошлыеПоступления.Стоимость,
		|	ПрошлыеПоступления.СтоимостьБезНДС,
		|	ПрошлыеПоступления.СтоимостьРегл,
		|	ПрошлыеПоступления.СтоимостьУпр,
		|	ПрошлыеПоступления.ПостояннаяРазница,
		|	ПрошлыеПоступления.ВременнаяРазница
		|
		|ПОМЕСТИТЬ АналитикиПрошлыхПоступлений
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
		|		ПО Аналитика.Ссылка = ДД.АналитикаУчетаНоменклатуры
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикиПрошлыхПоступленийПредварительная КАК ПрошлыеПоступления
		|		ПО ПрошлыеПоступления.Организация = ДД.Организация
		|		И ПрошлыеПоступления.Партия = ДД.Партия
		|		И ПрошлыеПоступления.АналитикаУчетаНоменклатуры.Номенклатура = Аналитика.Номенклатура
		|		И ПрошлыеПоступления.АналитикаУчетаНоменклатуры.Характеристика = Аналитика.Характеристика
		|		И ПрошлыеПоступления.АналитикаУчетаНоменклатуры.Серия = Аналитика.Серия
		|ГДЕ
		|	&РаспределениеДопРасходовПоВыбывшимТоварам
		|	И ДД.Период МЕЖДУ ПрошлыеПоступления.ПериодПоступления И &КонецПредыдущегоПериода
		|	И ДД.РазделУчета В (
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты))
		|	И ДД.Количество <> 0
		|	И ДД.Активность
		|ИНДЕКСИРОВАТЬ ПО
		|	АналитикаУчетаНоменклатуры,
		|	Партия
		|;
		|ВЫБРАТЬ
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	СУММА(ДД.Количество) КАК Количество
		|ПОМЕСТИТЬ АналитикиПрошлыхПоступленийБезПартий
		|ИЗ
		|	АналитикиПрошлыхПоступлений КАК ДД
		|СГРУППИРОВАТЬ ПО
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры
		|ИМЕЮЩИЕ
		|	СУММА(ДД.Количество) > 0
		|ИНДЕКСИРОВАТЬ ПО
		|	Организация,
		|	АналитикаУчетаНоменклатуры
		|";
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстПрошлыеВыбытияТоваровБезСтоимостей() // вт ПрошлыеВыбытияТоваровБезСтоимостей
	
	ТекстЗапроса = "
		|ВЫБРАТЬ
		|	ИСТИНА КАК ПрошлыеВыбытия,
		|	ПрошлыеПоступления.Регистратор КАК Регистратор,
		|	ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета КАК РазделУчета,
		|	ДД.ВидЗапасов КАК ВидЗапасов,
		|	ДД.Организация КАК Организация,
		|	ДД.Партия КАК Партия,
		|	ДД.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	СУММА(ДД.Количество) КАК Количество
		|
		|ПОМЕСТИТЬ ПрошлыеВыбытияТоваровБезСтоимостей
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикиПрошлыхПоступлений КАК ПрошлыеПоступления
		|		ПО ПрошлыеПоступления.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И ПрошлыеПоступления.Организация = ДД.Организация
		|		И ПрошлыеПоступления.Партия = ДД.Партия
		|		И ПрошлыеПоступления.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|ГДЕ
		|	&РаспределениеДопРасходовПоВыбывшимТоварам
		|	И ДД.Период МЕЖДУ ПрошлыеПоступления.ПериодПоступления И &КонецПредыдущегоПериода
		|	И ДД.РазделУчета В (
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты))
		|	И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	И НЕ ДД.Регистратор ССЫЛКА Документ.ПеремещениеТоваров
		|	И ДД.Активность
		|
		|СГРУППИРОВАТЬ ПО
		|	ПрошлыеПоступления.Регистратор,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС
		|
		// Возвраты прошлых периодов
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ИСТИНА КАК ПрошлыеВыбытия,
		|	ПрошлыеПоступления.Регистратор КАК Регистратор,
		|	ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета КАК РазделУчета,
		|	ДД.ВидЗапасов КАК ВидЗапасов,
		|	ДД.Организация КАК Организация,
		|	ДД.Партия КАК Партия,
		|	ДД.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|
		|	-СУММА(ДД.Количество) КАК Количество
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикиПрошлыхПоступлений КАК ПрошлыеПоступления
		|		ПО ПрошлыеПоступления.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И ПрошлыеПоступления.Организация = ДД.Организация
		|		И ПрошлыеПоступления.Партия = ДД.Партия
		|		И ПрошлыеПоступления.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|ГДЕ
		|	&РаспределениеДопРасходовПоВыбывшимТоварам
		|	И ДД.Период МЕЖДУ ПрошлыеПоступления.ПериодПоступления И &КонецПредыдущегоПериода
		|	И ДД.РазделУчета В (
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах))
		|	И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|	И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов)
		|	И ДД.Активность
		|
		|СГРУППИРОВАТЬ ПО
		|	ПрошлыеПоступления.Регистратор,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС
		|
		// Перемещения на другие склады (при методе учета "Средняя за месяц")
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ЛОЖЬ КАК ПрошлыеВыбытия,
		|	ПрошлыеПоступления.Регистратор КАК Регистратор,
		|	Остатки.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	Остатки.РазделУчета КАК РазделУчета,
		|	Остатки.ВидЗапасов КАК ВидЗапасов,
		|	Остатки.Организация КАК Организация,
		|	Остатки.Партия КАК Партия,
		|	Остатки.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	Остатки.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	Остатки.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|
		|	Остатки.КоличествоОстаток КАК Количество
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров.Остатки(&ГраницаНачалоПериода,
		|		(АналитикаУчетаНоменклатуры, Организация) В (
		|		ВЫБРАТЬ
		|			АналитикиПрошлыхПоступлений.АналитикаУчетаНоменклатуры,
		|			АналитикиПрошлыхПоступлений.Организация
		|		ИЗ
		|			АналитикиПрошлыхПоступленийБезПартий КАК АналитикиПрошлыхПоступлений)
		|		И Партия = НЕОПРЕДЕЛЕНО
		|		И РазделУчета В (
		|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах),
		|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты))
		|	) КАК Остатки
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикиПрошлыхПоступлений КАК ПрошлыеПоступления
		|		ПО ПрошлыеПоступления.АналитикаУчетаНоменклатуры = Остатки.АналитикаУчетаНоменклатуры
		|		И ПрошлыеПоступления.Организация = Остатки.Организация
		|		И ПрошлыеПоступления.Партия = Остатки.Партия
		|		И ПрошлыеПоступления.АналитикаУчетаПартий = Остатки.АналитикаУчетаПартий
		|		И НЕ ПрошлыеПоступления.ЭтоАналитикаДокументаПоступления
		|ГДЕ
		|	&РаспределениеДопРасходовПоВыбывшимТоварам
		|";
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстПрошлыеВыбытияТоваров() // вт ПрошлыеВыбытияТоваров
	
	ТекстЗапроса = "
		|ВЫБРАТЬ
		|	ДД.ПрошлыеВыбытия,
		|	ДД.Регистратор КАК Регистратор,
		|	ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета КАК РазделУчета,
		|	ДД.ВидЗапасов КАК ВидЗапасов,
		|	ДД.Организация КАК Организация,
		|	ДД.Партия КАК Партия,
		|	ДД.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|
		|	(ВЫБОР
		|		КОГДА ДД.Количество >= ПрошлыеПоступления.Количество
		|			ТОГДА ПрошлыеПоступления.Количество
		|		ИНАЧЕ ДД.Количество КОНЕЦ) КАК Количество,
		|	(ВЫБОР
		|		КОГДА ДД.Количество >= ПрошлыеПоступления.Количество
		|			ТОГДА ПрошлыеПоступления.Стоимость
		|		ИНАЧЕ ВЫРАЗИТЬ(ДД.Количество * ПрошлыеПоступления.Стоимость / ПрошлыеПоступления.Количество КАК ЧИСЛО(31,2))
		|	КОНЕЦ) КАК Стоимость,
		|	(ВЫБОР
		|		КОГДА ДД.Количество >= ПрошлыеПоступления.Количество
		|			ТОГДА ПрошлыеПоступления.СтоимостьБезНДС
		|		ИНАЧЕ ВЫРАЗИТЬ(ДД.Количество * ПрошлыеПоступления.СтоимостьБезНДС / ПрошлыеПоступления.Количество КАК ЧИСЛО(31,2))
		|	КОНЕЦ) КАК СтоимостьБезНДС,
		|	(ВЫБОР
		|		КОГДА ДД.Количество >= ПрошлыеПоступления.Количество
		|			ТОГДА ПрошлыеПоступления.СтоимостьУпр
		|		ИНАЧЕ ВЫРАЗИТЬ(ДД.Количество * ПрошлыеПоступления.СтоимостьУпр / ПрошлыеПоступления.Количество КАК ЧИСЛО(31,2))
		|	КОНЕЦ) КАК СтоимостьУпр,
		|	(ВЫБОР
		|		КОГДА ДД.Количество >= ПрошлыеПоступления.Количество
		|			ТОГДА ПрошлыеПоступления.СтоимостьРегл
		|		ИНАЧЕ ВЫРАЗИТЬ(ДД.Количество * ПрошлыеПоступления.СтоимостьРегл / ПрошлыеПоступления.Количество КАК ЧИСЛО(31,2))
		|	КОНЕЦ) КАК СтоимостьРегл,
		|	(ВЫБОР
		|		КОГДА ДД.Количество >= ПрошлыеПоступления.Количество
		|			ТОГДА ПрошлыеПоступления.ПостояннаяРазница
		|		ИНАЧЕ ВЫРАЗИТЬ(ДД.Количество * ПрошлыеПоступления.ПостояннаяРазница / ПрошлыеПоступления.Количество КАК ЧИСЛО(31,2))
		|	КОНЕЦ) КАК ПостояннаяРазница,
		|	(ВЫБОР
		|		КОГДА ДД.Количество >= ПрошлыеПоступления.Количество
		|			ТОГДА ПрошлыеПоступления.ВременнаяРазница
		|		ИНАЧЕ ВЫРАЗИТЬ(ДД.Количество * ПрошлыеПоступления.ВременнаяРазница / ПрошлыеПоступления.Количество КАК ЧИСЛО(31,2))
		|	КОНЕЦ) КАК ВременнаяРазница
		|
		|ПОМЕСТИТЬ ПрошлыеВыбытияТоваров
		|ИЗ
		|	ПрошлыеВыбытияТоваровБезСтоимостей КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикиПрошлыхПоступлений КАК ПрошлыеПоступления
		|		ПО ПрошлыеПоступления.Регистратор = ДД.Регистратор
		|		И ПрошлыеПоступления.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И ПрошлыеПоступления.Организация = ДД.Организация
		|		И ПрошлыеПоступления.Партия = ДД.Партия
		|		И ПрошлыеПоступления.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|;
		|////////////////////////////////////////////////////////////////////////////////
		|
		|ВЫБРАТЬ
		|	ДД.Регистратор КАК Регистратор,
		|	ДД.Организация КАК Организация,
		|	ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура      КАК Номенклатура,
		|	ДД.АналитикаУчетаНоменклатуры.Характеристика    КАК Характеристика,
		|	ДД.АналитикаУчетаНоменклатуры.Серия             КАК Серия,
		|	ДД.АналитикаУчетаНоменклатуры.СтатьяКалькуляции КАК СтатьяКалькуляции,
		|
		|	СУММА(ДД.Количество) КАК Количество,
		|	СУММА(ДД.Стоимость) КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьУпр) КАК СтоимостьУпр,
		|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница
		|ПОМЕСТИТЬ ПрошлыеВыбытияТоваровПоНоменклатуре
		|ИЗ
		|	ПрошлыеВыбытияТоваров КАК ДД
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.АналитикаУчетаНоменклатуры.Характеристика,
		|	ДД.АналитикаУчетаНоменклатуры.Серия,
		|	ДД.АналитикаУчетаНоменклатуры.СтатьяКалькуляции
		|
		|";
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ОстаткиПрошлыхПоступленийСводно() // вт ОстаткиПрошлыхПоступленийСводно
	Возврат "
		|ВЫБРАТЬ
		|	Остатки.АналитикаУчетаНоменклатуры,
		|	Остатки.РазделУчета,
		|	Остатки.ВидЗапасов,
		|	Остатки.Организация,
		|	МАКСИМУМ(Остатки.Партия) КАК Партия,
		|	МАКСИМУМ(Остатки.АналитикаУчетаПартий) КАК АналитикаУчетаПартий,
		|	МАКСИМУМ(Остатки.АналитикаФинансовогоУчета) КАК АналитикаФинансовогоУчета,
		|	МАКСИМУМ(Остатки.ВидДеятельностиНДС) КАК ВидДеятельностиНДС
		|ПОМЕСТИТЬ ОстаткиПрошлыхПоступленийСводно
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров.Остатки(&ГраницаНачалоПериода, Организация В (&МассивОрганизаций)) КАК Остатки
		|СГРУППИРОВАТЬ ПО
		|	Остатки.АналитикаУчетаНоменклатуры,
		|	Остатки.РазделУчета,
		|	Остатки.ВидЗапасов,
		|	Остатки.Организация
		|ИНДЕКСИРОВАТЬ ПО
		|	АналитикаУчетаНоменклатуры,
		|	РазделУчета,
		|	ВидЗапасов,
		|	Организация
		|";
КонецФункции

Функция ТекстПрошлыеПоступления() // вт ПрошлыеПоступления
	Возврат 
		"ВЫБРАТЬ
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.РазделУчета,
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ЕСТЬNULL(ОстаткиСводно.ВидЗапасов, ДД.ВидЗапасов) КАК ВидЗапасов,
		|	(ВЫБОР
		|		КОГДА ДД.Период >= &ДатаПереходаНаПартионныйУчетВерсии22
		|			ТОГДА ДД.ВидДеятельностиНДС
		|		ИНАЧЕ ОстаткиСводно.ВидДеятельностиНДС КОНЕЦ) КАК ВидДеятельностиНДС,
		|	(ВЫБОР
		|		КОГДА ДД.Период >= &ДатаПереходаНаПартионныйУчетВерсии22
		|			ТОГДА ДД.АналитикаФинансовогоУчета
		|		ИНАЧЕ ОстаткиСводно.АналитикаФинансовогоУчета КОНЕЦ) КАК АналитикаФинансовогоУчета,
		|	СУММА(ДД.Количество) КАК Количество,
		|	СУММА(ДД.Стоимость) КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница
		|	
		|ПОМЕСТИТЬ ПрошлыеПоступления	
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикиТоваров
		|		ПО АналитикиТоваров.Ссылка = ДД.АналитикаУчетаНоменклатуры
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО СпрНоменклатура.Ссылка = АналитикиТоваров.Номенклатура
		|	ЛЕВОЕ СОЕДИНЕНИЕ ОстаткиПрошлыхПоступленийСводно КАК ОстаткиСводно
		|		ПО ОстаткиСводно.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И ОстаткиСводно.РазделУчета = ДД.РазделУчета
		|		И (ОстаткиСводно.ВидЗапасов = ДД.ВидЗапасов
		|			ИЛИ ДД.ВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка))
		|		И ОстаткиСводно.Организация = ДД.Организация
		|ГДЕ
		|	ДД.Период < &НачалоПериода
		|	И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|	И ДД.Организация В (&МассивОрганизаций)
		|	И ДД.Активность
		|	И НЕ ТИПЗНАЧЕНИЯ(ДД.Регистратор) В (ТИП(Документ.ПеремещениеТоваров),
		|									ТИП(Документ.СборкаТоваров),
		|									ТИП(Документ.ПоступлениеТоваровНаСклад))
		|	И ((ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
		|			ИЛИ ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|				И СпрНоменклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа))
		|		И ДД.Партия = НЕОПРЕДЕЛЕНО
		| 		ИЛИ ТИПЗНАЧЕНИЯ(ДД.Партия) = ТИП(Документ.ПервичныйДокумент)
		|		)
		|	И (ДД.Организация,
		|		АналитикиТоваров.Номенклатура,
		|		АналитикиТоваров.МестоХранения,
		|		ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|		ДД.Регистратор) В
		|	(
		|		ВЫБРАТЬ РАЗЛИЧНЫЕ
		|			КлючиРасходов.Организация,
		|			АналитикиТоваров.Номенклатура,
		|			АналитикиТоваров.МестоХранения,
		|			(ВЫБОР
		|				КОГДА КлючиРасходов.НаправлениеДеятельности = ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
		|				 ИЛИ НЕ &УчитыватьСебестоимостьТоваровПоНазначениям
		|					ТОГДА ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|						ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|				ИНАЧЕ КлючиРасходов.НаправлениеДеятельности КОНЕЦ) КАК НаправлениеДеятельности,
		|			ДД.Регистратор
		|		ИЗ
		|			АналитикиРасходовВсе КАК КлючиРасходов
		|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК Поступление
		|				ПО Поступление.Регистратор = КлючиРасходов.АналитикаРасходов
		|		ГДЕ
		|			КлючиРасходов.АналитикаРасходов = ДД.Регистратор
		|			И Поступление.Период < &НачалоПериода
		|	)
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ЕСТЬNULL(ОстаткиСводно.ВидЗапасов, ДД.ВидЗапасов),
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.Партия,
		|	(ВЫБОР
		|		КОГДА ДД.Период >= &ДатаПереходаНаПартионныйУчетВерсии22
		|			ТОГДА ДД.ВидДеятельностиНДС
		|		ИНАЧЕ ОстаткиСводно.ВидДеятельностиНДС КОНЕЦ),
		|	(ВЫБОР
		|		КОГДА ДД.Период >= &ДатаПереходаНаПартионныйУчетВерсии22
		|			ТОГДА ДД.АналитикаФинансовогоУчета
		|		ИНАЧЕ ОстаткиСводно.АналитикаФинансовогоУчета КОНЕЦ)
		|";
КонецФункции

Функция ТекстПрошлыеПеремещенияПоступленияСборка() // вт ПрошлыеПеремещенияПоступленияСборка
	Возврат 
		"ВЫБРАТЬ
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.КорАналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ЕСТЬNULL(ОстаткиСводно.ВидЗапасов, ДД.КорВидЗапасов) КАК ВидЗапасов,
		|	ДД.КорРазделУчета КАК РазделУчета,
		|	ВЫБОР
		|		КОГДА ДД.КорОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
		|			ТОГДА ДД.Организация
		|		ИНАЧЕ ДД.КорОрганизация
		|	КОНЕЦ КАК Организация,
		|	(ВЫБОР
		|		КОГДА ДД.Период >= &ДатаПереходаНаПартионныйУчетВерсии22
		|			ТОГДА ДД.КорПартия
		|		ИНАЧЕ ОстаткиСводно.Партия КОНЕЦ) КАК Партия,
		|	(ВЫБОР
		|		КОГДА ДД.Период >= &ДатаПереходаНаПартионныйУчетВерсии22
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		ИНАЧЕ ОстаткиСводно.АналитикаУчетаПартий КОНЕЦ) КАК АналитикаУчетаПартий,
		|	(ВЫБОР
		|		КОГДА ДД.Период >= &ДатаПереходаНаПартионныйУчетВерсии22
		|			ТОГДА ДД.КорВидДеятельностиНДС
		|		ИНАЧЕ ОстаткиСводно.ВидДеятельностиНДС КОНЕЦ) КАК ВидДеятельностиНДС,
		|	(ВЫБОР
		|		КОГДА ДД.Период >= &ДатаПереходаНаПартионныйУчетВерсии22
		|			ТОГДА ДД.КорАналитикаФинансовогоУчета
		|		ИНАЧЕ ОстаткиСводно.АналитикаФинансовогоУчета КОНЕЦ) КАК АналитикаФинансовогоУчета,
		|	СУММА(ДД.Количество) КАК Количество,
		|	СУММА(ДД.Стоимость) КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница
		|ПОМЕСТИТЬ ПрошлыеПеремещенияПоступленияСборка
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикиТоваров
		|		ПО АналитикиТоваров.Ссылка = ДД.КорАналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ ОстаткиПрошлыхПоступленийСводно КАК ОстаткиСводно
		|		ПО ОстаткиСводно.АналитикаУчетаНоменклатуры = ДД.КорАналитикаУчетаНоменклатуры
		|		И ОстаткиСводно.РазделУчета = ДД.КорРазделУчета
		|		И (ОстаткиСводно.ВидЗапасов = ДД.КорВидЗапасов
		|			ИЛИ ДД.КорВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка))
		|		И ОстаткиСводно.Организация = 
		|			(ВЫБОР
		|				КОГДА ДД.КорОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
		|					ТОГДА ДД.Организация
		|				ИНАЧЕ ДД.КорОрганизация КОНЕЦ)
		|ГДЕ
		|	ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	И ДД.Период < &НачалоПериода
		|	И ТИПЗНАЧЕНИЯ(ДД.Регистратор) В (ТИП(Документ.ПеремещениеТоваров),
		|									ТИП(Документ.СборкаТоваров),
		|									ТИП(Документ.ПоступлениеТоваровНаСклад))
		|	И НЕ ДД.РазделУчета В (
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство))
		|	И ДД.КорРазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
		|	И (ВЫБОР
		|			КОГДА ДД.КорОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
		|				ТОГДА ДД.Организация
		|			ИНАЧЕ ДД.КорОрганизация
		|		КОНЕЦ,
		|		АналитикиТоваров.Номенклатура,
		|		АналитикиТоваров.МестоХранения,
		|		ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|		ДД.Регистратор) В
		|	(
		|		ВЫБРАТЬ РАЗЛИЧНЫЕ
		|			КлючиРасходов.Организация,
		|			АналитикиТоваров.Номенклатура,
		|			АналитикиТоваров.МестоХранения,
		|			(ВЫБОР
		|				КОГДА КлючиРасходов.НаправлениеДеятельности = ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
		|				 ИЛИ НЕ &УчитыватьСебестоимостьТоваровПоНазначениям
		|					ТОГДА ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|						ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|				ИНАЧЕ КлючиРасходов.НаправлениеДеятельности КОНЕЦ) КАК НаправлениеДеятельности,
		|			ДД.Регистратор
		|		ИЗ
		|			АналитикиРасходовВсе КАК КлючиРасходов
		|		ГДЕ 
		|			КлючиРасходов.АналитикаРасходов = ДД.Регистратор
		|	)
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР
		|		КОГДА ДД.КорОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
		|			ТОГДА ДД.Организация
		|		ИНАЧЕ ДД.КорОрганизация
		|	КОНЕЦ,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ЕСТЬNULL(ОстаткиСводно.ВидЗапасов, ДД.КорВидЗапасов),
		|	ДД.КорРазделУчета,
		|	(ВЫБОР
		|		КОГДА ДД.Период >= &ДатаПереходаНаПартионныйУчетВерсии22
		|			ТОГДА ДД.КорПартия
		|		ИНАЧЕ ОстаткиСводно.Партия КОНЕЦ),
		|	(ВЫБОР
		|		КОГДА ДД.Период >= &ДатаПереходаНаПартионныйУчетВерсии22
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		ИНАЧЕ ОстаткиСводно.АналитикаУчетаПартий КОНЕЦ),
		|	(ВЫБОР
		|		КОГДА ДД.Период >= &ДатаПереходаНаПартионныйУчетВерсии22
		|			ТОГДА ДД.КорВидДеятельностиНДС
		|		ИНАЧЕ ОстаткиСводно.ВидДеятельностиНДС КОНЕЦ),
		|	(ВЫБОР
		|		КОГДА ДД.Период >= &ДатаПереходаНаПартионныйУчетВерсии22
		|			ТОГДА ДД.КорАналитикаФинансовогоУчета
		|		ИНАЧЕ ОстаткиСводно.АналитикаФинансовогоУчета КОНЕЦ)
		|";
	
КонецФункции

Функция ТекстПрошлыеЗаказы() // вт ПрошлыеЗаказы, СоответствиеПартийИПрошлыхЗаказов, СоответствиеПартийИЗаказовВПутиОтПоставщиков
	Возврат
		"ВЫБРАТЬ
		|	ДД.Приоритет,
		|	ДД.ТипЗаписи,
		|	ДД.ВидДвижения,
		|	ДД.Период,
		|	ДД.Заказ КАК Регистратор,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ДокументПоступления,
		|	ДД.ВидЗапасов,
		|	ДД.АналитикаУчетаПартий,
		|	СУММА(ДД.Количество) КАК Количество,
		|	СУММА(ДД.Стоимость) КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
		|	СУММА(ДД.НДСРегл) КАК НДСРегл,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	(ВЫБОР
		|		КОГДА ТИПЗНАЧЕНИЯ(ДД.Заказ) = ТИП(Документ.ЗаказНаПеремещение) ТОГДА ДД.Регистратор
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК ДокументИсточник,
		|	ДД.РазделУчета,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета
		|ПОМЕСТИТЬ ПрошлыеЗаказы
		|ИЗ
		|	ПартииПоЗаказам КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК ВидыЗапасов
		|		ПО ВидыЗапасов.Ссылка = ДД.ВидЗапасов
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПоступленияИЗаказыИзАналитикРасходов КАК Заказы
		|		ПО Заказы.Поступление = ДД.Регистратор
		|		И Заказы.Заказ = ДД.Заказ
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикиТоваров
		|		ПО АналитикиТоваров.Ссылка = ДД.АналитикаУчетаНоменклатуры
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.РеестрДокументов КАК Реестр
		|		ПО Реестр.Ссылка = ДД.Регистратор
		|		И НЕ Реестр.ДополнительнаяЗапись
		|ГДЕ
		|	ЕСТЬNULL(ВидыЗапасов.ТипЗапасов, ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)) В (&СобственныеТипыЗапасов)
		|	И Реестр.ДатаДокументаИБ < &НачалоПериода
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Приоритет,
		|	ДД.ТипЗаписи,
		|	ДД.ВидДвижения,
		|	ДД.Период,
		|	ДД.Заказ,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ДокументПоступления,
		|	ДД.ВидЗапасов,
		|	ДД.РазделУчета,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|	(ВЫБОР КОГДА ДД.Период < &НачалоПериода ТОГДА &НачалоПериода ИНАЧЕ ДД.Период КОНЕЦ),
		|	(ВЫБОР
		|		КОГДА ТИПЗНАЧЕНИЯ(ДД.Заказ) = ТИП(Документ.ЗаказНаПеремещение) ТОГДА ДД.Регистратор
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ)
		|;
		|ВЫБРАТЬ
		|	ДД.Партия КАК Партия,
		|	МАКСИМУМ(ДД.Регистратор) КАК Заказ
		|ПОМЕСТИТЬ СоответствиеПартийИПрошлыхЗаказов
		|ИЗ
		|	ПрошлыеЗаказы КАК ДД
		|ГДЕ
		|	ДД.Партия <> НЕОПРЕДЕЛЕНО
		|СГРУППИРОВАТЬ ПО
		|	ДД.Партия
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		|;
		|//////////////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДД.Партия КАК Партия,
		|	МАКСИМУМ(ДД.Заказ) КАК Заказ
		|ПОМЕСТИТЬ СоответствиеПартийИЗаказовВПутиОтПоставщиков
		|ИЗ
		|	ПартииПоЗаказам КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказПоставщику КАК ЗаказПоставщику
		|		ПО ЗаказПоставщику.Ссылка = ДД.Заказ
		|ГДЕ
		|	ДД.Партия <> НЕОПРЕДЕЛЕНО
		|	И ЗаказПоставщику.ХозяйственнаяОперация В (
		|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаТоварыВПути),
		|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути),
		|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСТоварыВПути))
		|СГРУППИРОВАТЬ ПО
		|	ДД.Партия
		|ИНДЕКСИРОВАТЬ ПО
		|	Партия
		|";
КонецФункции

Функция ТекстВключениеУчетаПоВидамЗапасов() // вт ВключениеУчетаПоВидамЗапасов
	Возврат 
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС
		|ПОМЕСТИТЬ ВключениеУчетаПоВидамЗапасов
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК ДД
		|ГДЕ
		|	ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СлужебноеВключитьУчетПоВидамЗапасов)
		|	И ДД.ВидЗапасов <> ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
		|";
КонецФункции

Функция ТекстОтборОстатковПрошлыхПоступлений() // ВТ ОтборОстатковПрошлыхПоступлений
	Возврат
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Партии.АналитикаУчетаНоменклатуры,
		|	Партии.РазделУчета,
		|	ЕСТЬNULL(ОстаткиСВидамиЗапасов.ВидЗапасов, Партии.ВидЗапасов) КАК ВидЗапасов,
		|	Партии.Организация,
		|	Партии.Партия,
		|	Партии.АналитикаУчетаПартий,
		|	Партии.АналитикаФинансовогоУчета,
		|	Партии.ВидДеятельностиНДС
		|
		|ПОМЕСТИТЬ ОтборОстатковПрошлыхПоступлений
		|ИЗ (
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		Партии.АналитикаУчетаНоменклатуры,
		|		Партии.РазделУчета,
		|		Партии.ВидЗапасов,
		|		Партии.Организация,
		|		Партии.Партия,
		|		Партии.АналитикаУчетаПартий,
		|		Партии.АналитикаФинансовогоУчета,
		|		Партии.ВидДеятельностиНДС
		|	ИЗ
		|		ПрошлыеПоступления КАК Партии
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		Партии.АналитикаУчетаНоменклатуры,
		|		Партии.РазделУчета,
		|		Партии.ВидЗапасов,
		|		Партии.Организация,
		|		Партии.Партия,
		|		Партии.АналитикаУчетаПартий,
		|		Партии.АналитикаФинансовогоУчета,
		|		Партии.ВидДеятельностиНДС
		|	ИЗ
		|		ПрошлыеПеремещенияПоступленияСборка КАК Партии
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		Партии.АналитикаУчетаНоменклатуры,
		|		Партии.РазделУчета,
		|		Партии.ВидЗапасов,
		|		Партии.Организация,
		|		Партии.Партия,
		|		Партии.АналитикаУчетаПартий,
		|		Партии.АналитикаФинансовогоУчета,
		|		Партии.ВидДеятельностиНДС
		|	ИЗ
		|		ПрошлыеПоступленияИзТоваровВПути КАК Партии
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|	ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		Партии.АналитикаУчетаНоменклатуры,
		|		Партии.РазделУчета,
		|		Партии.ВидЗапасов,
		|		Партии.Организация,
		|		Партии.Партия,
		|		Партии.АналитикаУчетаПартий,
		|		Партии.АналитикаФинансовогоУчета,
		|		Партии.ВидДеятельностиНДС
		|	ИЗ
		|		ПартииПоЗаказам КАК Партии
		|	) КАК Партии
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВключениеУчетаПоВидамЗапасов КАК ОстаткиСВидамиЗапасов
		|		ПО ОстаткиСВидамиЗапасов.АналитикаУчетаНоменклатуры = Партии.АналитикаУчетаНоменклатуры
		|		И ОстаткиСВидамиЗапасов.РазделУчета = Партии.РазделУчета
		|		И ОстаткиСВидамиЗапасов.Организация = Партии.Организация
		|		И ОстаткиСВидамиЗапасов.Партия = Партии.Партия
		|		И ОстаткиСВидамиЗапасов.АналитикаУчетаПартий = Партии.АналитикаУчетаПартий
		|		И ОстаткиСВидамиЗапасов.АналитикаФинансовогоУчета = Партии.АналитикаФинансовогоУчета
		|		И ОстаткиСВидамиЗапасов.ВидДеятельностиНДС = Партии.ВидДеятельностиНДС
		|";
КонецФункции

Функция ОстаткиПрошлыхПоступлений() // вт ОстаткиПрошлыхПоступлений
	Возврат
		"ВЫБРАТЬ
		|	Остатки.АналитикаУчетаНоменклатуры,
		|	Остатки.РазделУчета,
		|	Остатки.ВидЗапасов,
		|	Остатки.Организация,
		|	Остатки.Партия,
		|	Остатки.АналитикаУчетаПартий,
		|	Остатки.АналитикаФинансовогоУчета,
		|	Остатки.ВидДеятельностиНДС
		|ПОМЕСТИТЬ ОстаткиПрошлыхПоступлений
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров.Остатки(&ГраницаНачалоПериода, 
		|		(АналитикаУчетаНоменклатуры, РазделУчета, ВидЗапасов, Организация, 
		|			Партия, АналитикаУчетаПартий, АналитикаФинансовогоУчета, ВидДеятельностиНДС
		|		) В (
		|		ВЫБРАТЬ
		|			Отбор.АналитикаУчетаНоменклатуры,
		|			Отбор.РазделУчета,
		|			Отбор.ВидЗапасов,
		|			Отбор.Организация,
		|			Отбор.Партия,
		|			Отбор.АналитикаУчетаПартий,
		|			Отбор.АналитикаФинансовогоУчета,
		|			Отбор.ВидДеятельностиНДС
		|		ИЗ
		|			ОтборОстатковПрошлыхПоступлений КАК Отбор
		|		)
		|	) КАК Остатки
		|ГДЕ
		|	Остатки.КоличествоОстаток > 0
		|";
КонецФункции

Функция ТекстОстаткиПартийПрочих()
	Возврат
		"ВЫБРАТЬ
		|	""ТекстОстаткиПартийПрочих"" КАК ЗапросИсточник,
		|	10 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Остаток) КАК ТипЗаписи,
		|	ИСТИНА КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	Периоды.Период,
		|	ДД.ДокументПоступленияРасходов КАК Регистратор,
		|	ДД.Организация,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК АналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО КАК Склад,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступления,
		|	НЕОПРЕДЕЛЕНО КАК Заказ,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) КАК ВидЗапасов,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.НаправлениеДеятельности,
		|	ДД.АналитикаУчетаПартий.Контрагент КАК Поставщик,
		|	ДД.ДокументПоступленияРасходов,
		|	ДД.АналитикаУчетаПартий.ВидЦенности КАК ВидЦенности,
		|	ДД.АналитикаУчетаПартий.СтавкаНДС КАК СтавкаНДС,
		|	ДД.СтатьяРасходов,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаРасходов КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	0 КАК Количество,
		|	0 КАК Вес,
		|	0 КАК Объем,
		|	ДД.СтоимостьОстаток КАК Стоимость,
		|	ДД.СтоимостьБезНДСОстаток КАК СтоимостьБезНДС,
		|	ДД.СтоимостьРеглОстаток КАК СтоимостьРегл,
		|	ДД.НДСРеглОстаток КАК НДСРегл,
		|	ДД.НДСУпрОстаток КАК НДСУпр,
		|	ДД.ПостояннаяРазницаОстаток КАК ПостояннаяРазница,
		|	ДД.ВременнаяРазницаОстаток КАК ВременнаяРазница,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка) КАК НалогообложениеНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ПустаяСсылка) КАК ВариантРаздельногоУчетаНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаОтраженияРасходов,
		|	ДД.ПравилоРаспределенияНаСебестоимость КАК ПравилоРаспределения,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК РазделУчета,
		|	НЕОПРЕДЕЛЕНО КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ КАК ПрошлыеВыбытияТоваров,
		|	&НачалоПериода КАК РасчетныйПериод
		|ИЗ
		|	НачальныеОстаткиРасходов КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПериодыПартийПрочих КАК Периоды
		|		ПО Периоды.ДокументПоступленияРасходов = ДД.ДокументПоступленияРасходов
		|		И Периоды.Организация = ДД.Организация
		|		И Периоды.СтатьяРасходов = ДД.СтатьяРасходов
		|		И Периоды.АналитикаРасходов = ДД.АналитикаРасходов
		|";
КонецФункции

Функция ТекстПриходыПартийПрочих()
	Возврат
		"ВЫБРАТЬ
		|	""ТекстПриходыПартийПрочих"" КАК ЗапросИсточник,
		|	10 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия) КАК ТипЗаписи,
		|	ИСТИНА КАК РасчетЗавершен,
		|	ВЫБОР
		|		КОГДА ДД.СлужебноеВидДвиженияПриход
		|			ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|			ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК АналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО КАК Склад,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступления,
		|	НЕОПРЕДЕЛЕНО КАК Заказ,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) КАК ВидЗапасов,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.НаправлениеДеятельности,
		|	ДД.АналитикаУчетаПартий.Контрагент КАК Поставщик,
		|	ДД.ДокументПоступленияРасходов,
		|	ДД.АналитикаУчетаПартий.ВидЦенности КАК ВидЦенности,
		|	ДД.АналитикаУчетаПартий.СтавкаНДС КАК СтавкаНДС,
		|	ДД.СтатьяРасходов,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ЕСТЬNULL(Декларации.Ссылка, ДД.АналитикаРасходов) КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	0 КАК Количество,
		|	0 КАК Вес,
		|	0 КАК Объем,
		|	СУММА(ВЫБОР
		|		КОГДА Статьи.ВариантРаспределенияРасходовУпр =
		|				ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			ТОГДА ДД.Стоимость / ЕСТЬNULL(Знаменатели.Количество, 1)
		|		ИНАЧЕ 0 КОНЕЦ) КАК Стоимость,
		|	СУММА(ВЫБОР
		|		КОГДА Статьи.ВариантРаспределенияРасходовУпр =
		|				ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			ТОГДА ДД.СтоимостьБезНДС / ЕСТЬNULL(Знаменатели.Количество, 1)
		|		ИНАЧЕ 0 КОНЕЦ) КАК СтоимостьБезНДС,
		|	СУММА(ВЫБОР
		|		КОГДА Статьи.ВариантРаспределенияРасходовРегл =
		|				ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			ТОГДА ДД.СтоимостьРегл / ЕСТЬNULL(Знаменатели.Количество, 1)
		|		ИНАЧЕ 0 КОНЕЦ) КАК СтоимостьРегл,
		|	СУММА(ВЫБОР
		|		КОГДА Статьи.ВариантРаспределенияРасходовРегл =
		|				ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			ТОГДА ДД.НДСРегл / ЕСТЬNULL(Знаменатели.Количество, 1)
		|		ИНАЧЕ 0 КОНЕЦ) КАК НДСРегл,
		|	СУММА(ВЫБОР
		|		КОГДА Статьи.ВариантРаспределенияРасходовУпр =
		|				ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			ТОГДА ДД.НДСУпр / ЕСТЬNULL(Знаменатели.Количество, 1)
		|		ИНАЧЕ 0 КОНЕЦ) КАК НДСУпр,
		|	СУММА(ВЫБОР
		|		КОГДА Статьи.ВариантРаспределенияРасходовРегл =
		|				ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			ТОГДА ДД.ПостояннаяРазница / ЕСТЬNULL(Знаменатели.Количество, 1)
		|		ИНАЧЕ 0 КОНЕЦ) КАК ПостояннаяРазница,
		|	СУММА(ВЫБОР
		|		КОГДА Статьи.ВариантРаспределенияРасходовРегл =
		|				ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			ТОГДА ДД.ВременнаяРазница / ЕСТЬNULL(Знаменатели.Количество, 1)
		|		ИНАЧЕ 0 КОНЕЦ) КАК ВременнаяРазница,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	ДД.НалогообложениеНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеРасходов,
		|	ДД.ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	ДД.СтатьяОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ПустаяСсылка) КАК ВариантРаздельногоУчетаНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаОтраженияРасходов,
		|	Статьи.ПравилоРаспределенияНаСебестоимость КАК ПравилоРаспределения,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК РазделУчета,
		|	НЕОПРЕДЕЛЕНО КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ КАК ПрошлыеВыбытияТоваров,
		|	ДД.Период КАК РасчетныйПериод
		|ИЗ
		|	ВТКэшРасчетныеОборотыПартииПрочихРасходов КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиРасходов КАК Статьи
		|		ПО Статьи.Ссылка = ДД.СтатьяРасходов
		|	ЛЕВОЕ СОЕДИНЕНИЕ Декларации КАК Декларации
		|		ПО Декларации.Поступление = ДД.АналитикаРасходов
		|	ЛЕВОЕ СОЕДИНЕНИЕ КоличествоДеклараций КАК Знаменатели
		|		ПО Знаменатели.Поступление = ДД.АналитикаРасходов
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.КорректировкаПриобретения КАК Корректировка
		|		ПО Корректировка.Ссылка = ДД.Регистратор
		//++ Локализация
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.СчетФактураПолученныйНалоговыйАгент КАК СчетФактура
		|		ПО СчетФактура.Ссылка = ДД.Регистратор
		//-- Локализация
		|ГДЕ
		|	ДД.СлужебноеВидДвиженияПриход
		|	И (Статьи.ВариантРаспределенияРасходовУпр =
		|			ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|		ИЛИ Статьи.ВариантРаспределенияРасходовРегл =
		|			ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров))
		|	И ДД.ДокументПоступленияРасходов В (
		|		ДД.Регистратор,
		//++ Локализация
		|		СчетФактура.СчетФактураОснование,
		//-- Локализация
		|		Корректировка.ДокументОснование)
		|СГРУППИРОВАТЬ ПО
		|	ВЫБОР
		|		КОГДА ДД.СлужебноеВидДвиженияПриход
		|			ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|			ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаУчетаПартий.Контрагент,
		|	ДД.АналитикаУчетаПартий.ВидЦенности,
		|	ДД.АналитикаУчетаПартий.СтавкаНДС,
		|	ДД.НаправлениеДеятельности,
		|	ДД.ДокументПоступленияРасходов,
		|	ДД.СтатьяРасходов,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ЕСТЬNULL(Декларации.Ссылка, ДД.АналитикаРасходов),
		|	ДД.ВидДеятельностиНДС,
		|	ДД.НалогообложениеНДС,
		|	ДД.ДокументРеализации,
		|	ДД.СтатьяОтраженияРасходов,
		|	Статьи.ПравилоРаспределенияНаСебестоимость
		|";
КонецФункции

Функция ТекстБазисОстаткиСебестоимость()
	
	ТекстЗапроса = 
		"ВЫБРАТЬ
		|	""ТекстБазисОстаткиСебестоимость"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ЕСТЬNULL(Приобретение.Дата, &НачалоПериода) КАК Период,
		|	ЕСТЬNULL(Приобретение.Ссылка, ЗНАЧЕНИЕ(Документ.ПриобретениеТоваровУслуг.ПустаяСсылка)) КАК Регистратор,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка КАК Номенклатура,
		|	АналитикиТоваров.МестоХранения КАК Склад,
		|	ЕСТЬNULL(Приобретение.Ссылка, НЕОПРЕДЕЛЕНО) КАК ДокументПоступления,
		|	НЕОПРЕДЕЛЕНО КАК Заказ,
		|	ДД.ВидЗапасов,
		|	ДД.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО) КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Поставщик,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступленияРасходов,
		|	ДД.АналитикаУчетаПартий.ВидЦенности КАК ВидЦенности,
		|	НЕОПРЕДЕЛЕНО КАК СтавкаНДС,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходов,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	ДД.КоличествоОстаток КАК Количество,
		|	&Вес * ДД.КоличествоОстаток КАК Вес,
		|	&Объем * ДД.КоличествоОстаток КАК Объем,
		|	(ВЫБОР
		|		КОГДА ДД.СтоимостьОстаток <> 0 ТОГДА ДД.СтоимостьОстаток
		|		ИНАЧЕ ДД.ТрудозатратыОстаток + ДД.ПостатейныеПостоянныеСНДСОстаток + ДД.ПостатейныеПеременныеСНДСОстаток КОНЕЦ) КАК Стоимость,
		|	(ВЫБОР
		|		КОГДА ДД.СтоимостьБезНДСОстаток <> 0 ТОГДА ДД.СтоимостьБезНДСОстаток
		|		ИНАЧЕ ДД.ТрудозатратыОстаток + ДД.ПостатейныеПостоянныеБезНДСОстаток + ДД.ПостатейныеПеременныеБезНДСОстаток КОНЕЦ) КАК СтоимостьБезНДС,
		|	(ВЫБОР
		|		КОГДА ДД.СтоимостьРеглОстаток <> 0 ТОГДА ДД.СтоимостьРеглОстаток
		|		ИНАЧЕ ДД.ТрудозатратыРеглОстаток + ДД.ПостатейныеПостоянныеРеглОстаток + ДД.ПостатейныеПеременныеРеглОстаток КОНЕЦ) КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	ДД.ПостояннаяРазницаОстаток КАК ПостояннаяРазница,
		|	ДД.ВременнаяРазницаОстаток КАК ВременнаяРазница,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	ДД.ВидДеятельностиНДС КАК НалогообложениеНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ПустаяСсылка) КАК ВариантРаздельногоУчетаНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) КАК ПравилоРаспределения,
		|	ДД.РазделУчета,
		|	ДД.Партия КАК Партия,
		|	ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ КАК ПрошлыеВыбытияТоваров,
		|	ЕСТЬNULL(Приобретение.Дата, &НачалоПериода) КАК РасчетныйПериод
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров.Остатки(&ГраницаНачалоПериода, Организация В (&МассивОрганизаций)
		|		И РазделУчета В (
		|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах),
		|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты))
		|	) КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикиТоваров
		|		ПО АналитикиТоваров.Ссылка = ДД.АналитикаУчетаНоменклатуры
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО СпрНоменклатура.Ссылка = АналитикиТоваров.Номенклатура
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК СпрСклады
		|		ПО СпрСклады.Ссылка = АналитикиТоваров.МестоХранения
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК Приобретение
		|		ПО Приобретение.Ссылка = ДД.Партия
		|ГДЕ
		|	(ВЫБОР
		|		КОГДА ДД.СтоимостьОстаток <> 0 ТОГДА ДД.СтоимостьОстаток
		|		КОГДА (ДД.ТрудозатратыОстаток + ДД.ПостатейныеПостоянныеСНДСОстаток + ДД.ПостатейныеПеременныеСНДСОстаток) <> 0
		|			ТОГДА ДД.ТрудозатратыОстаток + ДД.ПостатейныеПостоянныеСНДСОстаток + ДД.ПостатейныеПеременныеСНДСОстаток
		|		ИНАЧЕ ДД.КоличествоОстаток КОНЕЦ) > 0
		|	И (ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
		|		ИЛИ ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|			И (СпрНоменклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
		|				ИЛИ ЕСТЬNULL(СпрСклады.ЦеховаяКладовая, ЛОЖЬ)))
		|	И НЕ (ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
		|			И АналитикиТоваров.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Партнер))
		|	И (ДД.Организация,
		|			АналитикиТоваров.Номенклатура,
		|			АналитикиТоваров.МестоХранения,
		|			ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|				ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|			ДД.Партия) В
		|		(
		|			ВЫБРАТЬ РАЗЛИЧНЫЕ
		|				КлючиРасходов.Организация,
		|				АналитикиТоваров.Номенклатура,
		|				АналитикиТоваров.МестоХранения,
		|				(ВЫБОР
		|					КОГДА КлючиРасходов.НаправлениеДеятельности = ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
		|					 ИЛИ НЕ &УчитыватьСебестоимостьТоваровПоНазначениям
		|						ТОГДА ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|							ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|					ИНАЧЕ КлючиРасходов.НаправлениеДеятельности КОНЕЦ) КАК НаправлениеДеятельности,
		|				ДД.Партия
		|			ИЗ
		|				АналитикиРасходовВсе КАК КлючиРасходов
		|			ГДЕ
		|				КлючиРасходов.АналитикаРасходов В (
		|					АналитикиТоваров.Номенклатура,
		|					ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка),
		|					АналитикиТоваров.МестоХранения,
		|					ЗНАЧЕНИЕ(Справочник.Склады.ПустаяСсылка)
		|					)
		|				ИЛИ (ДД.Организация В (&ОрганизацииСФИФОСкользящаяВПрошломПериоде)
		|					И КлючиРасходов.АналитикаРасходов = ДД.Партия)
		|		)
		|";
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ПодставитьШаблоныВесаИОбъемаВТекстЗапроса(ТекстЗапроса);
	
КонецФункции

Функция ТекстБазисОстаткиПоЗаказамСебестоимость() // использует СоответствиеПартийИПрошлыхЗаказов
	
	ТекстЗапроса = 
		"ВЫБРАТЬ
		|	""ТекстБазисОстаткиПоЗаказамСебестоимость"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	Реестр.ДатаДокументаИБ КАК Период,
		|	Заказы.Заказ КАК Регистратор,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка КАК Номенклатура,
		|	АналитикиТоваров.МестоХранения КАК Склад,
		|	ДД.Партия КАК ДокументПоступления,
		|	Заказы.Заказ КАК Заказ,
		|	ДД.ВидЗапасов,
		|	ДД.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО) КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Поставщик,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступленияРасходов,
		|	ДД.АналитикаУчетаПартий.ВидЦенности КАК ВидЦенности,
		|	НЕОПРЕДЕЛЕНО КАК СтавкаНДС,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходов,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	ДД.КоличествоОстаток КАК Количество,
		|	&Вес * ДД.КоличествоОстаток КАК Вес,
		|	&Объем * ДД.КоличествоОстаток КАК Объем,
		|	(ВЫБОР
		|		КОГДА ДД.СтоимостьОстаток <> 0 ТОГДА ДД.СтоимостьОстаток
		|		ИНАЧЕ ДД.ТрудозатратыОстаток + ДД.ПостатейныеПостоянныеСНДСОстаток + ДД.ПостатейныеПеременныеСНДСОстаток КОНЕЦ) КАК Стоимость,
		|	(ВЫБОР
		|		КОГДА ДД.СтоимостьБезНДСОстаток <> 0 ТОГДА ДД.СтоимостьБезНДСОстаток
		|		ИНАЧЕ ДД.ТрудозатратыОстаток + ДД.ПостатейныеПостоянныеБезНДСОстаток + ДД.ПостатейныеПеременныеБезНДСОстаток КОНЕЦ) КАК СтоимостьБезНДС,
		|	(ВЫБОР
		|		КОГДА ДД.СтоимостьРеглОстаток <> 0 ТОГДА ДД.СтоимостьРеглОстаток
		|		ИНАЧЕ ДД.ТрудозатратыРеглОстаток + ДД.ПостатейныеПостоянныеРеглОстаток + ДД.ПостатейныеПеременныеРеглОстаток КОНЕЦ) КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	ДД.ПостояннаяРазницаОстаток КАК ПостояннаяРазница,
		|	ДД.ВременнаяРазницаОстаток КАК ВременнаяРазница,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	ДД.ВидДеятельностиНДС КАК НалогообложениеНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ПустаяСсылка) КАК ВариантРаздельногоУчетаНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) КАК ПравилоРаспределения,
		|	ДД.РазделУчета,
		|	ДД.Партия КАК Партия,
		|	ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ КАК ПрошлыеВыбытияТоваров,
		|	Реестр.ДатаДокументаИБ КАК РасчетныйПериод
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров.Остатки(&ГраницаНачалоПериода, Организация В (&МассивОрганизаций)
		|		И РазделУчета В (
		|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах),
		|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты))
		|		И Партия В (
		|		ВЫБРАТЬ
		|			ПрошлыеЗаказы.Партия
		|		ИЗ
		|			ПрошлыеЗаказы КАК ПрошлыеЗаказы)
		|	) КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикиТоваров
		|		ПО АналитикиТоваров.Ссылка = ДД.АналитикаУчетаНоменклатуры
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО СпрНоменклатура.Ссылка = АналитикиТоваров.Номенклатура
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК СпрСклады
		|		ПО СпрСклады.Ссылка = АналитикиТоваров.МестоХранения
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ СоответствиеПартийИПрошлыхЗаказов КАК Заказы
		|		ПО Заказы.Партия = ДД.Партия
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.РеестрДокументов КАК Реестр
		|		ПО Реестр.Ссылка = ДД.Партия
		|		И НЕ Реестр.ДополнительнаяЗапись
		|ГДЕ
		|	(ВЫБОР
		|		КОГДА ДД.СтоимостьОстаток <> 0 ТОГДА ДД.СтоимостьОстаток
		|		КОГДА (ДД.ТрудозатратыОстаток + ДД.ПостатейныеПостоянныеСНДСОстаток + ДД.ПостатейныеПеременныеСНДСОстаток) <> 0
		|			ТОГДА ДД.ТрудозатратыОстаток + ДД.ПостатейныеПостоянныеСНДСОстаток + ДД.ПостатейныеПеременныеСНДСОстаток
		|		ИНАЧЕ ДД.КоличествоОстаток КОНЕЦ) > 0
		|	И (ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
		|		ИЛИ ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|			И (СпрНоменклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
		|				ИЛИ ЕСТЬNULL(СпрСклады.ЦеховаяКладовая, ЛОЖЬ)))
		|";
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ПодставитьШаблоныВесаИОбъемаВТекстЗапроса(ТекстЗапроса);
	
КонецФункции

Функция ТекстБазисПриходыСебестоимость()
	
	ТекстЗапроса = 
		"ВЫБРАТЬ
		|	""ТекстБазисПриходыСебестоимость"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка КАК Номенклатура,
		|	АналитикиТоваров.МестоХранения КАК Склад,
		|	ДД.Регистратор,
		|	НЕОПРЕДЕЛЕНО КАК Заказ,
		|	ДД.ВидЗапасов,
		|	ДД.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО) КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Поставщик,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступленияРасходов,
		|	ЕСТЬNULL(ДД.АналитикаУчетаПартий.ВидЦенности, ДД.КорАналитикаУчетаПартий.ВидЦенности) КАК ВидЦенности,
		|	НЕОПРЕДЕЛЕНО КАК СтавкаНДС,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходов,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	СУММА(ДД.Количество) КАК Количество,
		|	СУММА(&Вес * ДД.Количество) КАК Вес,
		|	СУММА(&Объем * ДД.Количество) КАК Объем,
		|	СУММА(ВЫБОР
		|		КОГДА (ДД.Стоимость + ДД.ДопРасходы) <> 0 ТОГДА (ДД.Стоимость + ДД.ДопРасходы)
		|		ИНАЧЕ ВЫРАЗИТЬ(ДД.Количество
		|			* (ЕСТЬNULL(Цены.Стоимость, 0) + ЕСТЬNULL(Цены.СтоимостьДопРасходы, 0)) КАК ЧИСЛО(31,2)) КОНЕЦ) КАК Стоимость,
		|	СУММА(ВЫБОР
		|		КОГДА (ДД.СтоимостьБезНДС + ДД.ДопРасходыБезНДС) <> 0 ТОГДА (ДД.СтоимостьБезНДС + ДД.ДопРасходыБезНДС)
		|		ИНАЧЕ ВЫРАЗИТЬ(ДД.Количество
		|			* (ЕСТЬNULL(Цены.СтоимостьБезНДС, 0) + ЕСТЬNULL(Цены.СтоимостьДопРасходыБезНДС, 0)) КАК ЧИСЛО(31,2)) КОНЕЦ) КАК СтоимостьБезНДС,
		|	СУММА(ВЫБОР
		|		КОГДА (ДД.СтоимостьРегл + ДД.ДопРасходыРегл) <> 0 ТОГДА (ДД.СтоимостьРегл + ДД.ДопРасходыРегл)
		|		ИНАЧЕ ВЫРАЗИТЬ(ДД.Количество
		|			* (ЕСТЬNULL(Цены.СтоимостьРегл, 0) + ЕСТЬNULL(Цены.ДопРасходыРегл, 0)) КАК ЧИСЛО(31,2)) КОНЕЦ) КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	ДД.ВидДеятельностиНДС КАК НалогообложениеНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ПустаяСсылка) КАК ВариантРаздельногоУчетаНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) КАК ПравилоРаспределения,
		|	ДД.РазделУчета,
		|	ДД.Партия КАК Партия,
		|	ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ КАК ПрошлыеВыбытияТоваров,
		|	ДД.Период КАК РасчетныйПериод
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикиТоваров
		|		ПО АналитикиТоваров.Ссылка = ДД.АналитикаУчетаНоменклатуры
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО СпрНоменклатура.Ссылка = АналитикиТоваров.Номенклатура
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК СпрСклады
		|		ПО СпрСклады.Ссылка = АналитикиТоваров.МестоХранения
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТСтоимостьПартийТоваров КАК Цены
		|		ПО Цены.Организация = ДД.Организация
		|		И Цены.Период = НАЧАЛОПЕРИОДА(ДД.Период, МЕСЯЦ)
		|		И Цены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Цены.ВидЗапасов = ДД.ВидЗапасов
		|		И Цены.РазделУчета = ДД.РазделУчета
		|		И Цены.Партия = ДД.Партия
		|		И Цены.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Цены.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
		|		И Цены.ВидДеятельностиНДС = ДД.ВидДеятельностиНДС
		|ГДЕ
		|	ДД.СлужебноеВидДвиженияПриход
		|	И (ДД.ТипЗаписи В (
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода))
		|		)
		|	И НЕ ТИПЗНАЧЕНИЯ(ДД.Регистратор) = ТИП(Документ.ПеремещениеТоваров)
		|	И НЕ ТИПЗНАЧЕНИЯ(ДД.Регистратор) = ТИП(Документ.СборкаТоваров)
		|	И НЕ ТИПЗНАЧЕНИЯ(ДД.Регистратор) = ТИП(Документ.ПередачаТоваровМеждуОрганизациями)
		|	И (ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
		|		ИЛИ ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|		ИЛИ ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		И (СпрНоменклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
		|			ИЛИ ЕСТЬNULL(СпрСклады.ЦеховаяКладовая, ЛОЖЬ)
		|			))
		|	И НЕ (ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
		|			И АналитикиТоваров.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Партнер))
		|	И (ДД.Организация,
		|		АналитикиТоваров.Номенклатура,
		|		АналитикиТоваров.МестоХранения,
		|		ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|		ДД.Регистратор) В
		|	(
		|		ВЫБРАТЬ РАЗЛИЧНЫЕ
		|			КлючиРасходов.Организация,
		|			АналитикиТоваров.Номенклатура,
		|			АналитикиТоваров.МестоХранения,
		|			(ВЫБОР
		|				КОГДА КлючиРасходов.НаправлениеДеятельности = ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
		|				 ИЛИ НЕ &УчитыватьСебестоимостьТоваровПоНазначениям
		|					ТОГДА ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|						ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|				ИНАЧЕ КлючиРасходов.НаправлениеДеятельности КОНЕЦ) КАК НаправлениеДеятельности,
		|			ДД.Регистратор
		|		ИЗ
		|			АналитикиРасходовВсе КАК КлючиРасходов
		|		ГДЕ 
		|			КлючиРасходов.АналитикаРасходов В (
		|				АналитикиТоваров.Номенклатура,
		|				ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка),
		|				АналитикиТоваров.МестоХранения,
		|				ЗНАЧЕНИЕ(Справочник.Склады.ПустаяСсылка),
		|				ДД.Регистратор)
		|			ИЛИ
		|			ТИПЗНАЧЕНИЯ(ДД.Регистратор) = ТИПЗНАЧЕНИЯ(КлючиРасходов.АналитикаРасходов)
		|			И КлючиРасходов.АналитикаРасходов В (
		|				ЗНАЧЕНИЕ(Документ.ПриобретениеТоваровУслуг.ПустаяСсылка),
		|				ЗНАЧЕНИЕ(Документ.СборкаТоваров.ПустаяСсылка))
		|	)
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка,
		|	АналитикиТоваров.МестоХранения,
		|	ДД.Регистратор,
		|	ДД.ВидЗапасов,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО),
		|	ЕСТЬNULL(ДД.АналитикаУчетаПартий.ВидЦенности, ДД.КорАналитикаУчетаПартий.ВидЦенности),
		|	ДД.ВидДеятельностиНДС,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета
		|";
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ПодставитьШаблоныВесаИОбъемаВТекстЗапроса(ТекстЗапроса);
	
КонецФункции

Функция ТекстБазисКорректировкиПоступлений()
	
	ТекстЗапроса = 
		"ВЫБРАТЬ
		|	""ТекстБазисКорректировкиПоступлений"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	Поступление.Дата КАК Период,
		|	КорректировкиПриобретения.ДокументОснование КАК Регистратор,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка КАК Номенклатура,
		|	АналитикиТоваров.МестоХранения КАК Склад,
		|	КорректировкиПриобретения.ДокументОснование КАК ДокументПоступления,
		|	НЕОПРЕДЕЛЕНО КАК Заказ,
		|	ДД.ВидЗапасов,
		|	ДД.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО) КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Поставщик,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступленияРасходов,
		|	ЕСТЬNULL(ДД.АналитикаУчетаПартий.ВидЦенности, ДД.КорАналитикаУчетаПартий.ВидЦенности) КАК ВидЦенности,
		|	НЕОПРЕДЕЛЕНО КАК СтавкаНДС,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходов,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	СУММА(ДД.Количество) КАК Количество,
		|	СУММА(&Вес * ДД.Количество) КАК Вес,
		|	СУММА(&Объем * ДД.Количество) КАК Объем,
		|	СУММА(ВЫБОР
		|		КОГДА ДД.Стоимость <> 0 ТОГДА ДД.Стоимость
		|		ИНАЧЕ ВЫРАЗИТЬ(ДД.Количество
		|			* (ЕСТЬNULL(Цены.Стоимость, 0) + ЕСТЬNULL(Цены.СтоимостьДопРасходы, 0)) КАК ЧИСЛО(31,2)) КОНЕЦ) КАК Стоимость,
		|	СУММА(ВЫБОР
		|		КОГДА ДД.СтоимостьБезНДС <> 0 ТОГДА ДД.СтоимостьБезНДС
		|		ИНАЧЕ ВЫРАЗИТЬ(ДД.Количество
		|			* (ЕСТЬNULL(Цены.СтоимостьБезНДС, 0) + ЕСТЬNULL(Цены.СтоимостьДопРасходыБезНДС, 0)) КАК ЧИСЛО(31,2)) КОНЕЦ) КАК СтоимостьБезНДС,
		|	СУММА(ВЫБОР
		|		КОГДА ДД.СтоимостьРегл <> 0 ТОГДА ДД.СтоимостьРегл
		|		ИНАЧЕ ВЫРАЗИТЬ(ДД.Количество
		|			* (ЕСТЬNULL(Цены.СтоимостьРегл, 0) + ЕСТЬNULL(Цены.ДопРасходыРегл, 0)) КАК ЧИСЛО(31,2)) КОНЕЦ) КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	ДД.ВидДеятельностиНДС КАК НалогообложениеНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ПустаяСсылка) КАК ВариантРаздельногоУчетаНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) КАК ПравилоРаспределения,
		|	ДД.РазделУчета,
		|	ДД.Партия КАК Партия,
		|	ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ КАК ПрошлыеВыбытияТоваров,
		|	Поступление.Дата КАК РасчетныйПериод
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.КорректировкаПриобретения КАК КорректировкиПриобретения
		|		ПО КорректировкиПриобретения.Ссылка = ДД.Регистратор
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК Поступление
		|		ПО Поступление.Ссылка = КорректировкиПриобретения.ДокументОснование
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикиТоваров
		|		ПО АналитикиТоваров.Ссылка = ДД.АналитикаУчетаНоменклатуры
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО СпрНоменклатура.Ссылка = АналитикиТоваров.Номенклатура
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК СпрСклады
		|		ПО СпрСклады.Ссылка = АналитикиТоваров.МестоХранения
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТСтоимостьПартийТоваров КАК Цены
		|		ПО Цены.Организация = ДД.Организация
		|		И Цены.Период = НАЧАЛОПЕРИОДА(ДД.Период, МЕСЯЦ)
		|		И Цены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Цены.ВидЗапасов = ДД.ВидЗапасов
		|		И Цены.РазделУчета = ДД.РазделУчета
		|		И Цены.Партия = ДД.Партия
		|		И Цены.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Цены.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
		|		И Цены.ВидДеятельностиНДС = ДД.ВидДеятельностиНДС
		|ГДЕ
		|	ДД.СлужебноеВидДвиженияПриход
		|	И ДД.ТипЗаписи В (
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения))
		|	И (ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
		|		ИЛИ ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		И (СпрНоменклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
		|			ИЛИ ЕСТЬNULL(СпрСклады.ЦеховаяКладовая, ЛОЖЬ)))
		|	И (ДД.Организация,
		|		АналитикиТоваров.Номенклатура,
		|		АналитикиТоваров.МестоХранения,
		|		ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|		КорректировкиПриобретения.ДокументОснование) В
		|	(
		|		ВЫБРАТЬ РАЗЛИЧНЫЕ
		|			КлючиРасходов.Организация,
		|			АналитикиТоваров.Номенклатура,
		|			АналитикиТоваров.МестоХранения,
		|			(ВЫБОР
		|				КОГДА КлючиРасходов.НаправлениеДеятельности = ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
		|				 ИЛИ НЕ &УчитыватьСебестоимостьТоваровПоНазначениям
		|					ТОГДА ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|						ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|				ИНАЧЕ КлючиРасходов.НаправлениеДеятельности КОНЕЦ) КАК НаправлениеДеятельности,
		|			КорректировкиПриобретения.ДокументОснование
		|		ИЗ
		|			АналитикиРасходовВсе КАК КлючиРасходов
		|		ГДЕ 
		|			КлючиРасходов.АналитикаРасходов В (
		|				АналитикиТоваров.Номенклатура,
		|				ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка),
		|				АналитикиТоваров.МестоХранения,
		|				ЗНАЧЕНИЕ(Справочник.Склады.ПустаяСсылка),
		|				КорректировкиПриобретения.ДокументОснование)
		|			ИЛИ
		|			ТИПЗНАЧЕНИЯ(КорректировкиПриобретения.ДокументОснование) = ТИПЗНАЧЕНИЯ(КлючиРасходов.АналитикаРасходов)
		|			И КлючиРасходов.АналитикаРасходов В (
		|				ЗНАЧЕНИЕ(Документ.ПриобретениеТоваровУслуг.ПустаяСсылка),
		|				ЗНАЧЕНИЕ(Документ.СборкаТоваров.ПустаяСсылка),
		|				ЗНАЧЕНИЕ(Документ.ПередачаТоваровМеждуОрганизациями.ПустаяСсылка))
		|	)
		|СГРУППИРОВАТЬ ПО
		|	Поступление.Дата,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка,
		|	АналитикиТоваров.МестоХранения,
		|	ДД.ВидЗапасов,
		|	ДД.Регистратор,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО),
		|	ЕСТЬNULL(ДД.АналитикаУчетаПартий.ВидЦенности, ДД.КорАналитикаУчетаПартий.ВидЦенности),
		|	ДД.ВидДеятельностиНДС,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
		|	КорректировкиПриобретения.ДокументОснование
		|";
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ПодставитьШаблоныВесаИОбъемаВТекстЗапроса(ТекстЗапроса);
	
КонецФункции

Функция ТекстБазисФактуровкаПоставки() // использует НеотфактурованныеПоставки
	
	ТекстЗапроса = 
		"ВЫБРАТЬ
		|	""ТекстБазисФактуровкаПоставки"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	НеотфактурованныеПоставки.КорАналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка КАК Номенклатура,
		|	АналитикиТоваров.МестоХранения КАК Склад,
		|	ДД.Регистратор,
		|	НЕОПРЕДЕЛЕНО КАК Заказ,
		|	НеотфактурованныеПоставки.КорВидЗапасов КАК ВидЗапасов,
		|	(ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА ДД.АналитикаУчетаПартий
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК АналитикаУчетаПартий,
		|	ЕСТЬNULL(НеотфактурованныеПоставки.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО) КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Поставщик,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступленияРасходов,
		|	ДД.АналитикаУчетаПартий.ВидЦенности КАК ВидЦенности,
		|	НЕОПРЕДЕЛЕНО КАК СтавкаНДС,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходов,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	СУММА(ДД.Количество) КАК Количество,
		|	СУММА(&Вес * ДД.Количество) КАК Вес,
		|	СУММА(&Объем * ДД.Количество) КАК Объем,
		|	СУММА(ДД.Стоимость) КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	ДД.ВидДеятельностиНДС КАК НалогообложениеНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ПустаяСсылка) КАК ВариантРаздельногоУчетаНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) КАК ПравилоРаспределения,
		|	НеотфактурованныеПоставки.КорРазделУчета КАК РазделУчета,
		|	(ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА ДД.Партия
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК Партия,
		|	ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	(ВЫБОР
		|		КОГДА Остатки.Организация ЕСТЬ NULL
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ) КАК ПрошлыеВыбытияТоваров,
		|	(ВЫБОР
		|		КОГДА Остатки.Организация ЕСТЬ NULL
		|			ТОГДА ДАТАВРЕМЯ(1,1,1)
		|		ИНАЧЕ ДД.Период КОНЕЦ) КАК РасчетныйПериод
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ НеотфактурованныеПоставки КАК НеотфактурованныеПоставки
		|		ПО НеотфактурованныеПоставки.Партия = ДД.Партия
		|		И НеотфактурованныеПоставки.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И НеотфактурованныеПоставки.ВидЗапасов = ДД.ВидЗапасов
		|		И НеотфактурованныеПоставки.РазделУчета = ДД.РазделУчета
		|	ЛЕВОЕ СОЕДИНЕНИЕ ОстаткиПрошлыхПоступлений КАК Остатки
		|		ПО Остатки.АналитикаУчетаНоменклатуры = НеотфактурованныеПоставки.КорАналитикаУчетаНоменклатуры
		|		И Остатки.РазделУчета = НеотфактурованныеПоставки.КорРазделУчета
		|		И Остатки.ВидЗапасов = НеотфактурованныеПоставки.КорВидЗапасов
		|		И Остатки.Организация = ДД.Организация
		|		И Остатки.Партия = ДД.Партия
		|		И Остатки.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Остатки.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
		|		И Остатки.ВидДеятельностиНДС = ДД.ВидДеятельностиНДС
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикиТоваров
		|		ПО АналитикиТоваров.Ссылка = НеотфактурованныеПоставки.КорАналитикаУчетаНоменклатуры
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО СпрНоменклатура.Ссылка = АналитикиТоваров.Номенклатура
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК СпрСклады
		|		ПО СпрСклады.Ссылка = АналитикиТоваров.МестоХранения
		|ГДЕ
		|	ДД.СлужебноеВидДвиженияПриход
		|	И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|	И ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|	И (ДД.Организация,
		|		АналитикиТоваров.Номенклатура,
		|		АналитикиТоваров.МестоХранения,
		|		ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|		ДД.Регистратор) В
		|	(
		|		ВЫБРАТЬ РАЗЛИЧНЫЕ
		|			КлючиРасходов.Организация,
		|			АналитикиТоваров.Номенклатура,
		|			АналитикиТоваров.МестоХранения,
		|			(ВЫБОР
		|				КОГДА КлючиРасходов.НаправлениеДеятельности = ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
		|				 ИЛИ НЕ &УчитыватьСебестоимостьТоваровПоНазначениям
		|					ТОГДА ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|						ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|				ИНАЧЕ КлючиРасходов.НаправлениеДеятельности КОНЕЦ) КАК НаправлениеДеятельности,
		|			ДД.Регистратор
		|		ИЗ
		|			АналитикиРасходовВсе КАК КлючиРасходов
		|		ГДЕ 
		|			КлючиРасходов.АналитикаРасходов В (
		|				ДД.Регистратор)
		|	)
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	НеотфактурованныеПоставки.КорАналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка,
		|	АналитикиТоваров.МестоХранения,
		|	НеотфактурованныеПоставки.КорВидЗапасов,
		|	НеотфактурованныеПоставки.КорРазделУчета,
		|	(ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА ДД.АналитикаУчетаПартий
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ),
		|	ЕСТЬNULL(НеотфактурованныеПоставки.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО),
		|	ДД.АналитикаУчетаПартий.ВидЦенности,
		|	ДД.ВидДеятельностиНДС,
		|	(ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА ДД.Партия
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ),
		|	ДД.АналитикаФинансовогоУчета,
		|	(ВЫБОР
		|		КОГДА Остатки.Организация ЕСТЬ NULL
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ), // ПрошлыеВыбытияТоваров,
		|	(ВЫБОР
		|		КОГДА Остатки.Организация ЕСТЬ NULL
		|			ТОГДА ДАТАВРЕМЯ(1,1,1)
		|		ИНАЧЕ ДД.Период КОНЕЦ) // РасчетныйПериод
		|";
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ПодставитьШаблоныВесаИОбъемаВТекстЗапроса(ТекстЗапроса);
	
КонецФункции

Функция ТекстБазисПрошлыеФактуровкаПоставки() // использует НеотфактурованныеПоставки
	
	ТекстЗапроса = 
		"ВЫБРАТЬ
		|	""ТекстБазисФактуровкаПоставки"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	НеотфактурованныеПоставки.КорАналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка КАК Номенклатура,
		|	АналитикиТоваров.МестоХранения КАК Склад,
		|	ДД.Регистратор,
		|	НЕОПРЕДЕЛЕНО КАК Заказ,
		|	НеотфактурованныеПоставки.КорВидЗапасов КАК ВидЗапасов,
		|	(ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА ДД.АналитикаУчетаПартий
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК АналитикаУчетаПартий,
		|	ЕСТЬNULL(НеотфактурованныеПоставки.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО) КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Поставщик,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступленияРасходов,
		|	ДД.АналитикаУчетаПартий.ВидЦенности КАК ВидЦенности,
		|	НЕОПРЕДЕЛЕНО КАК СтавкаНДС,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходов,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	СУММА(ДД.Количество) КАК Количество,
		|	СУММА(&Вес * ДД.Количество) КАК Вес,
		|	СУММА(&Объем * ДД.Количество) КАК Объем,
		|	СУММА(ДД.Стоимость) КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	ДД.ВидДеятельностиНДС КАК НалогообложениеНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ПустаяСсылка) КАК ВариантРаздельногоУчетаНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) КАК ПравилоРаспределения,
		|	НеотфактурованныеПоставки.КорРазделУчета КАК РазделУчета,
		|	(ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА ДД.Партия
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК Партия,
		|	ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ КАК ПрошлыеВыбытияТоваров,
		|	ДД.Период КАК РасчетныйПериод
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ НеотфактурованныеПоставки КАК НеотфактурованныеПоставки
		|		ПО НеотфактурованныеПоставки.Партия = ДД.Партия
		|		И НеотфактурованныеПоставки.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И НеотфактурованныеПоставки.ВидЗапасов = ДД.ВидЗапасов
		|		И НеотфактурованныеПоставки.РазделУчета = ДД.РазделУчета
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикиТоваров
		|		ПО АналитикиТоваров.Ссылка = НеотфактурованныеПоставки.КорАналитикаУчетаНоменклатуры
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО СпрНоменклатура.Ссылка = АналитикиТоваров.Номенклатура
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК СпрСклады
		|		ПО СпрСклады.Ссылка = АналитикиТоваров.МестоХранения
		|ГДЕ
		|	ДД.Период < &НачалоПериода
		|	И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|	И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|	И ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|	И (ДД.Организация,
		|		АналитикиТоваров.Номенклатура,
		|		АналитикиТоваров.МестоХранения,
		|		ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|		ДД.Регистратор) В
		|	(
		|		ВЫБРАТЬ РАЗЛИЧНЫЕ
		|			КлючиРасходов.Организация,
		|			АналитикиТоваров.Номенклатура,
		|			АналитикиТоваров.МестоХранения,
		|			(ВЫБОР
		|				КОГДА КлючиРасходов.НаправлениеДеятельности = ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
		|				 ИЛИ НЕ &УчитыватьСебестоимостьТоваровПоНазначениям
		|					ТОГДА ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|						ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|				ИНАЧЕ КлючиРасходов.НаправлениеДеятельности КОНЕЦ) КАК НаправлениеДеятельности,
		|			ДД.Регистратор
		|		ИЗ
		|			АналитикиРасходовВсе КАК КлючиРасходов
		|		ГДЕ 
		|			КлючиРасходов.АналитикаРасходов В (
		|				ДД.Регистратор)
		|	)
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	НеотфактурованныеПоставки.КорАналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка,
		|	АналитикиТоваров.МестоХранения,
		|	ДД.Регистратор,
		|	НеотфактурованныеПоставки.КорВидЗапасов,
		|	НеотфактурованныеПоставки.КорРазделУчета,
		|	(ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА ДД.АналитикаУчетаПартий
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ),
		|	ЕСТЬNULL(НеотфактурованныеПоставки.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО),
		|	ДД.АналитикаУчетаПартий.ВидЦенности,
		|	ДД.ВидДеятельностиНДС,
		|	(ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА ДД.Партия
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ),
		|	ДД.АналитикаФинансовогоУчета
		|";
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ПодставитьШаблоныВесаИОбъемаВТекстЗапроса(ТекстЗапроса);
	
КонецФункции

Функция ТекстБазисПередачиТоваровСебестоимость()
	
	ТекстЗапроса = 
		"ВЫБРАТЬ
		|	""ТекстБазисПередачиТоваровСебестоимость"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.КорОрганизация КАК Организация,
		|	ДД.КорАналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка КАК Номенклатура,
		|	АналитикиТоваров.МестоХранения КАК Склад,
		|	ДД.Регистратор,
		|	НЕОПРЕДЕЛЕНО КАК Заказ,
		|	ДД.КорВидЗапасов КАК ВидЗапасов,
		|	ДД.КорАналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО) КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Поставщик,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступленияРасходов,
		|	ДД.КорАналитикаУчетаПартий.ВидЦенности КАК ВидЦенности,
		|	НЕОПРЕДЕЛЕНО КАК СтавкаНДС,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходов,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	0 КАК Количество,
		|	0 КАК Вес,
		|	0 КАК Объем,
		|	СУММА(ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.Стоимость, 0) КАК ЧИСЛО(31,2))) КАК Стоимость,
		|	СУММА(ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьБезНДС, 0) КАК ЧИСЛО(31,2))) КАК СтоимостьБезНДС,
		|	0 КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
		|	ДД.КорВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	ДД.КорВидДеятельностиНДС КАК НалогообложениеНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ПустаяСсылка) КАК ВариантРаздельногоУчетаНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) КАК ПравилоРаспределения,
		|	ДД.КорРазделУчета КАК РазделУчета,
		|	ДД.КорПартия КАК Партия,
		|	ДД.КорАналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ КАК ПрошлыеВыбытияТоваров,
		|	ДД.Период КАК РасчетныйПериод
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикиТоваров
		|		ПО АналитикиТоваров.Ссылка = ДД.КорАналитикаУчетаНоменклатуры
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО СпрНоменклатура.Ссылка = АналитикиТоваров.Номенклатура
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК СпрСклады
		|		ПО СпрСклады.Ссылка = АналитикиТоваров.МестоХранения
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТСтоимостьПартийТоваров КАК Цены
		|		ПО Цены.Организация = ДД.Организация
		|		И Цены.Период = НАЧАЛОПЕРИОДА(ДД.Период, МЕСЯЦ)
		|		И Цены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Цены.ВидЗапасов = ДД.ВидЗапасов
		|		И Цены.РазделУчета = ДД.РазделУчета
		|		И Цены.Партия = ДД.Партия
		|		И Цены.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Цены.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
		|		И Цены.ВидДеятельностиНДС = ДД.ВидДеятельностиНДС
		|ГДЕ
		|	НЕ ДД.СлужебноеВидДвиженияПриход
		|	И ДД.Регистратор ССЫЛКА Документ.ПередачаТоваровМеждуОрганизациями
		|	И (ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
		|		ИЛИ ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		И (СпрНоменклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
		|			ИЛИ ЕСТЬNULL(СпрСклады.ЦеховаяКладовая, ЛОЖЬ)
		|			))
		|	И (ДД.КорОрганизация,
		|		АналитикиТоваров.Номенклатура,
		|		АналитикиТоваров.МестоХранения,
		|		ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|		ДД.Регистратор) В
		|	(
		|		ВЫБРАТЬ РАЗЛИЧНЫЕ
		|			КлючиРасходов.Организация,
		|			АналитикиТоваров.Номенклатура,
		|			АналитикиТоваров.МестоХранения,
		|			(ВЫБОР
		|				КОГДА КлючиРасходов.НаправлениеДеятельности = ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
		|				 ИЛИ НЕ &УчитыватьСебестоимостьТоваровПоНазначениям
		|					ТОГДА ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|						ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|				ИНАЧЕ КлючиРасходов.НаправлениеДеятельности КОНЕЦ) КАК НаправлениеДеятельности,
		|			ДД.Регистратор
		|		ИЗ
		|			АналитикиРасходовВсе КАК КлючиРасходов
		|		ГДЕ 
		|			КлючиРасходов.АналитикаРасходов В (
		|				АналитикиТоваров.Номенклатура,
		|				ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка),
		|				АналитикиТоваров.МестоХранения,
		|				ЗНАЧЕНИЕ(Справочник.Склады.ПустаяСсылка),
		|				ДД.Регистратор)
		|			ИЛИ
		|			ТИПЗНАЧЕНИЯ(ДД.Регистратор) = ТИПЗНАЧЕНИЯ(КлючиРасходов.АналитикаРасходов)
		|			И КлючиРасходов.АналитикаРасходов В (
		|				ЗНАЧЕНИЕ(Документ.ПередачаТоваровМеждуОрганизациями.ПустаяСсылка))
		|	)
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.КорОрганизация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка,
		|	АналитикиТоваров.МестоХранения,
		|	ДД.Регистратор,
		|	ДД.КорВидЗапасов,
		|	ДД.КорРазделУчета,
		|	ДД.КорАналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО),
		|	ДД.КорАналитикаУчетаПартий.ВидЦенности,
		|	ДД.КорВидДеятельностиНДС,
		|	ДД.КорПартия,
		|	ДД.КорАналитикаФинансовогоУчета
		|";
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстБазисПередачиТоваровСебестоимостьРегл()
	
	ТекстЗапроса = 
		"ВЫБРАТЬ
		|	""ТекстБазисПередачиТоваровСебестоимостьРегл"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация КАК Организация,
		|	ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка КАК Номенклатура,
		|	АналитикиТоваров.МестоХранения КАК Склад,
		|	ДД.Регистратор,
		|	НЕОПРЕДЕЛЕНО КАК Заказ,
		|	ДД.ВидЗапасов КАК ВидЗапасов,
		|	ДД.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО) КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Поставщик,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступленияРасходов,
		|	ДД.АналитикаУчетаПартий.ВидЦенности КАК ВидЦенности,
		|	НЕОПРЕДЕЛЕНО КАК СтавкаНДС,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходов,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	СУММА(ДД.Количество) КАК Количество,
		|	СУММА(&Вес * ДД.Количество) КАК Вес,
		|	СУММА(&Объем * ДД.Количество) КАК Объем,
		// При продаже комиссионного товара в онлайн движениях будет заполнена стоимость в валюте упр. учета.
		// Стоимость из онлайн движений используем в качестве базы распределения.
		|	СУММА(ДД.Стоимость) КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	ДД.ВидДеятельностиНДС КАК НалогообложениеНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ПустаяСсылка) КАК ВариантРаздельногоУчетаНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) КАК ПравилоРаспределения,
		|	ДД.РазделУчета КАК РазделУчета,
		|	ДД.Партия КАК Партия,
		|	ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ КАК ПрошлыеВыбытияТоваров,
		|	ДД.Период КАК РасчетныйПериод
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикиТоваров
		|		ПО АналитикиТоваров.Ссылка = ДД.АналитикаУчетаНоменклатуры
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО СпрНоменклатура.Ссылка = АналитикиТоваров.Номенклатура
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК СпрСклады
		|		ПО СпрСклады.Ссылка = АналитикиТоваров.МестоХранения
		|ГДЕ
		|	ДД.СлужебноеВидДвиженияПриход
		|	И ДД.Регистратор ССЫЛКА Документ.ПередачаТоваровМеждуОрганизациями
		|	И (ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
		|		ИЛИ ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		И (СпрНоменклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
		|			ИЛИ ЕСТЬNULL(СпрСклады.ЦеховаяКладовая, ЛОЖЬ)
		|			))
		|	И (ДД.Организация,
		|		АналитикиТоваров.Номенклатура,
		|		АналитикиТоваров.МестоХранения,
		|		ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|		ДД.Регистратор) В
		|	(
		|		ВЫБРАТЬ РАЗЛИЧНЫЕ
		|			КлючиРасходов.Организация,
		|			АналитикиТоваров.Номенклатура,
		|			АналитикиТоваров.МестоХранения,
		|			(ВЫБОР
		|				КОГДА КлючиРасходов.НаправлениеДеятельности = ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
		|				 ИЛИ НЕ &УчитыватьСебестоимостьТоваровПоНазначениям
		|					ТОГДА ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|						ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|				ИНАЧЕ КлючиРасходов.НаправлениеДеятельности КОНЕЦ) КАК НаправлениеДеятельности,
		|			ДД.Регистратор
		|		ИЗ
		|			АналитикиРасходовВсе КАК КлючиРасходов
		|		ГДЕ 
		|			КлючиРасходов.АналитикаРасходов В (
		|				АналитикиТоваров.Номенклатура,
		|				ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка),
		|				АналитикиТоваров.МестоХранения,
		|				ЗНАЧЕНИЕ(Справочник.Склады.ПустаяСсылка),
		|				ДД.Регистратор)
		|			ИЛИ
		|			ТИПЗНАЧЕНИЯ(ДД.Регистратор) = ТИПЗНАЧЕНИЯ(КлючиРасходов.АналитикаРасходов)
		|			И КлючиРасходов.АналитикаРасходов В (
		|				ЗНАЧЕНИЕ(Документ.ПередачаТоваровМеждуОрганизациями.ПустаяСсылка))
		|	)
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка,
		|	АналитикиТоваров.МестоХранения,
		|	ДД.Регистратор,
		|	ДД.ВидЗапасов,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО),
		|	ДД.АналитикаУчетаПартий.ВидЦенности,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета
		|";
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ПодставитьШаблоныВесаИОбъемаВТекстЗапроса(ТекстЗапроса);
	
КонецФункции

Функция ТекстБазисПеремещенияПоступленияСборкаСебестоимость()
	
	ТекстЗапроса = 
		"ВЫБРАТЬ
		|	""ТекстБазисПеремещенияПоступленияСборкаСебестоимость"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР
		|		КОГДА ДД.КорОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
		|			ТОГДА ДД.Организация
		|		ИНАЧЕ ДД.КорОрганизация
		|	КОНЕЦ КАК Организация,
		|	ДД.КорАналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО КАК Склад,
		|	ДД.Регистратор,
		|	НЕОПРЕДЕЛЕНО КАК Заказ,
		|	ДД.КорВидЗапасов КАК ВидЗапасов,
		|	ДД.КорАналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО) КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Поставщик,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступленияРасходов,
		|	ДД.КорАналитикаУчетаПартий.ВидЦенности КАК ВидЦенности,
		|	НЕОПРЕДЕЛЕНО КАК СтавкаНДС,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходов,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	СУММА(ДД.Количество) КАК Количество,
		|	СУММА(&Вес * ДД.Количество) КАК Вес,
		|	СУММА(&Объем * ДД.Количество) КАК Объем,
		|	СУММА(ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.Стоимость, 0) КАК ЧИСЛО(31,2))) КАК Стоимость,
		|	СУММА(ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьБезНДС, 0) КАК ЧИСЛО(31,2))) КАК СтоимостьБезНДС,
		|	СУММА(ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьРегл, 0) КАК ЧИСЛО(31,2))) КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница,
		|	ДД.КорВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	ДД.КорВидДеятельностиНДС КАК НалогообложениеНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ПустаяСсылка) КАК ВариантРаздельногоУчетаНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) КАК ПравилоРаспределения,
		|	ДД.КорРазделУчета КАК РазделУчета,
		|	ДД.КорПартия КАК Партия,
		|	ДД.КорАналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ КАК ПрошлыеВыбытияТоваров,
		|	ДД.Период КАК РасчетныйПериод
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикиТоваров
		|		ПО АналитикиТоваров.Ссылка = ДД.КорАналитикаУчетаНоменклатуры
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО СпрНоменклатура.Ссылка = АналитикиТоваров.Номенклатура
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТСтоимостьПартийТоваров КАК Цены
		|		ПО Цены.Организация = ДД.Организация
		|		И Цены.Период = НАЧАЛОПЕРИОДА(ДД.Период, МЕСЯЦ)
		|		И Цены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Цены.ВидЗапасов = ДД.ВидЗапасов
		|		И Цены.РазделУчета = ДД.РазделУчета
		|		И Цены.Партия = ДД.Партия
		|		И Цены.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Цены.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
		|		И Цены.ВидДеятельностиНДС = ДД.ВидДеятельностиНДС
		|ГДЕ
		|	НЕ ДД.СлужебноеВидДвиженияПриход
		|	И ТИПЗНАЧЕНИЯ(ДД.Регистратор) В (ТИП(Документ.ПеремещениеТоваров),
		|									ТИП(Документ.СборкаТоваров),
		|									ТИП(Документ.КорректировкаНазначенияТоваров),
		|									ТИП(Документ.ПоступлениеТоваровНаСклад))
		|	И НЕ ДД.РазделУчета В (
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство))
		|	И ДД.КорРазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
		|	И (ВЫБОР
		|			КОГДА ДД.КорОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
		|				ТОГДА ДД.Организация
		|			ИНАЧЕ ДД.КорОрганизация
		|		КОНЕЦ,
		|		АналитикиТоваров.Номенклатура,
		|		АналитикиТоваров.МестоХранения,
		|		ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|		ДД.Регистратор) В
		|	(
		|		ВЫБРАТЬ РАЗЛИЧНЫЕ
		|			КлючиРасходов.Организация,
		|			АналитикиТоваров.Номенклатура,
		|			АналитикиТоваров.МестоХранения,
		|			(ВЫБОР
		|				КОГДА КлючиРасходов.НаправлениеДеятельности = ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
		|				 ИЛИ НЕ &УчитыватьСебестоимостьТоваровПоНазначениям
		|					ТОГДА ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|						ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|				ИНАЧЕ КлючиРасходов.НаправлениеДеятельности КОНЕЦ) КАК НаправлениеДеятельности,
		|			ДД.Регистратор
		|		ИЗ
		|			АналитикиРасходовВсе КАК КлючиРасходов
		|		ГДЕ 
		|			КлючиРасходов.АналитикаРасходов = ДД.Регистратор
		|			ИЛИ
		|			ТИПЗНАЧЕНИЯ(ДД.Регистратор) В (
		|				ТИП(Документ.СборкаТоваров),
		|				ТИП(Документ.КорректировкаНазначенияТоваров))
		|			И КлючиРасходов.АналитикаРасходов В (
		|				АналитикиТоваров.Номенклатура,
		|				ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка),
		|				АналитикиТоваров.МестоХранения,
		|				ЗНАЧЕНИЕ(Справочник.Склады.ПустаяСсылка))
		|			ИЛИ
		|			ТИПЗНАЧЕНИЯ(ДД.Регистратор) = ТИПЗНАЧЕНИЯ(КлючиРасходов.АналитикаРасходов)
		|			И КлючиРасходов.АналитикаРасходов В (
		|				ЗНАЧЕНИЕ(Документ.ПеремещениеТоваров.ПустаяСсылка),
		|				ЗНАЧЕНИЕ(Документ.СборкаТоваров.ПустаяСсылка),
		|				ЗНАЧЕНИЕ(Документ.ПоступлениеТоваровНаСклад.ПустаяСсылка))
		|	)
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР
		|		КОГДА ДД.КорОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
		|			ТОГДА ДД.Организация
		|		ИНАЧЕ ДД.КорОрганизация
		|	КОНЕЦ,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка,
		|	ДД.КорВидЗапасов,
		|	ДД.КорРазделУчета,
		|	ДД.КорАналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО),
		|	ДД.КорАналитикаУчетаПартий.ВидЦенности,
		|	ДД.КорВидДеятельностиНДС,
		|	ДД.КорПартия,
		|	ДД.КорАналитикаФинансовогоУчета
		|";
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ПодставитьШаблоныВесаИОбъемаВТекстЗапроса(ТекстЗапроса);
	
КонецФункции

Функция ТекстБазисПрошлыеПеремещенияПоступленияСборкаСебестоимость()
	
	ТекстЗапроса = 
		"ВЫБРАТЬ
		|	""ТекстБазисПрошлыеПеремещенияПоступленияСборкаСебестоимость"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО КАК Склад,
		|	ДД.Регистратор,
		|	НЕОПРЕДЕЛЕНО КАК Заказ,
		|	ДД.ВидЗапасов,
		|	ДД.АналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО) КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Поставщик,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступленияРасходов,
		|	ДД.АналитикаУчетаПартий.ВидЦенности КАК ВидЦенности,
		|	НЕОПРЕДЕЛЕНО КАК СтавкаНДС,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходов,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	ДД.Количество КАК Количество,
		|	(&Вес * ДД.Количество) КАК Вес,
		|	(&Объем * ДД.Количество) КАК Объем,
		|	ДД.Стоимость КАК Стоимость,
		|	ДД.СтоимостьБезНДС КАК СтоимостьБезНДС,
		|	ДД.СтоимостьРегл КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	ДД.ПостояннаяРазница КАК ПостояннаяРазница,
		|	ДД.ВременнаяРазница КАК ВременнаяРазница,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	ДД.ВидДеятельностиНДС КАК НалогообложениеНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ПустаяСсылка) КАК ВариантРаздельногоУчетаНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) КАК ПравилоРаспределения,
		|	ДД.РазделУчета КАК РазделУчета,
		|	ДД.Партия КАК Партия,
		|	ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ КАК ПрошлыеВыбытияТоваров,
		|	ДД.Период КАК РасчетныйПериод
		|ИЗ
		|	ПрошлыеПеремещенияПоступленияСборка КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ОстаткиПрошлыхПоступлений КАК Остатки
		|		ПО Остатки.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Остатки.РазделУчета = ДД.РазделУчета
		|		И Остатки.ВидЗапасов = ДД.ВидЗапасов
		|		И Остатки.Организация = ДД.Организация
		|		И Остатки.Партия = ДД.Партия
		|		И Остатки.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Остатки.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
		|		И Остатки.ВидДеятельностиНДС = ДД.ВидДеятельностиНДС
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО СпрНоменклатура.Ссылка = ДД.АналитикаУчетаНоменклатуры.Номенклатура
		|";
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ПодставитьШаблоныВесаИОбъемаВТекстЗапроса(ТекстЗапроса);
	
КонецФункции

Функция ТекстБазисПоступленияИзТоваровВПути() // использует СоответствиеПартийИЗаказовВПутиОтПоставщиков
	
	ТекстЗапроса = 
		"ВЫБРАТЬ
		|	""ТекстБазисПоступленияИзТоваровВПути"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Партия КАК Регистратор,
		|	ДД.Организация,
		|	ДД.КорАналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО КАК Склад,
		|	ДД.Партия КАК ДокументПоступления,
		|	ЕСТЬNULL(ПартииПоЗаказам.Заказ, НЕОПРЕДЕЛЕНО) КАК Заказ,
		|	ДД.КорВидЗапасов КАК ВидЗапасов,
		|	ДД.КорАналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО) КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Поставщик,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступленияРасходов,
		|	ДД.АналитикаУчетаПартий.ВидЦенности КАК ВидЦенности,
		|	НЕОПРЕДЕЛЕНО КАК СтавкаНДС,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходов,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	СУММА(ДД.Количество) КАК Количество,
		|	СУММА(&Вес * ДД.Количество) КАК Вес,
		|	СУММА(&Объем * ДД.Количество) КАК Объем,
		|	СУММА(ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.Стоимость, 0) КАК ЧИСЛО(31,2))) КАК Стоимость,
		|	СУММА(ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьБезНДС, 0) КАК ЧИСЛО(31,2))) КАК СтоимостьБезНДС,
		|	СУММА(ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьРегл, 0) КАК ЧИСЛО(31,2))) КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница,
		|	ДД.КорВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	ДД.КорВидДеятельностиНДС КАК НалогообложениеНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ПустаяСсылка) КАК ВариантРаздельногоУчетаНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) КАК ПравилоРаспределения,
		|	ДД.КорРазделУчета КАК РазделУчета,
		|	ДД.КорПартия КАК Партия,
		|	ДД.КорАналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ КАК ПрошлыеВыбытияТоваров,
		|	ДД.Период КАК РасчетныйПериод
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикиТоваров
		|		ПО АналитикиТоваров.Ссылка = ДД.КорАналитикаУчетаНоменклатуры
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО СпрНоменклатура.Ссылка = АналитикиТоваров.Номенклатура
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТСтоимостьПартийТоваров КАК Цены
		|		ПО Цены.Организация = ДД.Организация
		|		И Цены.Период = НАЧАЛОПЕРИОДА(ДД.Период, МЕСЯЦ)
		|		И Цены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Цены.ВидЗапасов = ДД.ВидЗапасов
		|		И Цены.РазделУчета = ДД.РазделУчета
		|		И Цены.Партия = ДД.Партия
		|		И Цены.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Цены.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
		|		И Цены.ВидДеятельностиНДС = ДД.ВидДеятельностиНДС
		|	ЛЕВОЕ СОЕДИНЕНИЕ СоответствиеПартийИЗаказовВПутиОтПоставщиков КАК ПартииПоЗаказам
		|		ПО ПартииПоЗаказам.Партия = ДД.Партия
		|ГДЕ
		|	НЕ ДД.СлужебноеВидДвиженияПриход
		|	И ТИПЗНАЧЕНИЯ(ДД.Регистратор) = ТИП(Документ.ПоступлениеТоваровНаСклад)
		|	И ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути)
		|	И (
		|		ДД.Организация,
		|		АналитикиТоваров.Номенклатура,
		|		АналитикиТоваров.МестоХранения,
		|		ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|		ДД.Регистратор) В
		|	(
		|		ВЫБРАТЬ РАЗЛИЧНЫЕ
		|			КлючиРасходов.Организация,
		|			АналитикиТоваров.Номенклатура,
		|			АналитикиТоваров.МестоХранения,
		|			(ВЫБОР
		|				КОГДА КлючиРасходов.НаправлениеДеятельности = ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
		|				 ИЛИ НЕ &УчитыватьСебестоимостьТоваровПоНазначениям
		|					ТОГДА ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|						ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|				ИНАЧЕ КлючиРасходов.НаправлениеДеятельности КОНЕЦ) КАК НаправлениеДеятельности,
		|			ДД.Регистратор
		|		ИЗ
		|			АналитикиРасходовВсе КАК КлючиРасходов
		|		ГДЕ 
		|			КлючиРасходов.АналитикаРасходов = ДД.Партия
		|			ИЛИ
		|			(КлючиРасходов.АналитикаРасходов, ДД.Партия) В (
		|				ВЫБРАТЬ
		|					Партии.Заказ,
		|					Партии.Партия
		|				ИЗ
		|					СоответствиеПартийИЗаказовВПутиОтПоставщиков КАК Партии
		|			)
		|	)
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ЕСТЬNULL(ПартииПоЗаказам.Заказ, НЕОПРЕДЕЛЕНО),
		|	ДД.Партия,
		|	ДД.Организация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка,
		|	ДД.КорВидЗапасов,
		|	ДД.КорРазделУчета,
		|	ДД.КорАналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО),
		|	ДД.АналитикаУчетаПартий.ВидЦенности,
		|	ДД.КорВидДеятельностиНДС,
		|	ДД.КорПартия,
		|	ДД.КорАналитикаФинансовогоУчета
		|";
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ПодставитьШаблоныВесаИОбъемаВТекстЗапроса(ТекстЗапроса);
	
КонецФункции

Функция ТекстБазисПрошлыеПоступленияИзТоваровВПути()
	
	ТекстЗапроса = 
		"ВЫБРАТЬ
		|	""ТекстБазисПрошлыеПоступленияИзТоваровВПути"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО КАК Склад,
		|	ДД.Регистратор,
		|	НЕОПРЕДЕЛЕНО КАК Заказ,
		|	ДД.ВидЗапасов,
		|	ДД.АналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО) КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Поставщик,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступленияРасходов,
		|	ДД.АналитикаУчетаПартий.ВидЦенности КАК ВидЦенности,
		|	НЕОПРЕДЕЛЕНО КАК СтавкаНДС,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходов,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	ДД.Количество КАК Количество,
		|	(&Вес * ДД.Количество) КАК Вес,
		|	(&Объем * ДД.Количество) КАК Объем,
		|	ДД.Стоимость КАК Стоимость,
		|	ДД.СтоимостьБезНДС КАК СтоимостьБезНДС,
		|	ДД.СтоимостьРегл КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	ДД.ПостояннаяРазница КАК ПостояннаяРазница,
		|	ДД.ВременнаяРазница КАК ВременнаяРазница,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	ДД.ВидДеятельностиНДС КАК НалогообложениеНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ПустаяСсылка) КАК ВариантРаздельногоУчетаНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) КАК ПравилоРаспределения,
		|	ДД.РазделУчета КАК РазделУчета,
		|	ДД.Партия КАК Партия,
		|	ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ КАК ПрошлыеВыбытияТоваров,
		|	ДД.Период КАК РасчетныйПериод
		|ИЗ
		|	ПрошлыеПоступленияИзТоваровВПути КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ОстаткиПрошлыхПоступлений КАК Остатки
		|		ПО Остатки.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Остатки.РазделУчета = ДД.РазделУчета
		|		И Остатки.ВидЗапасов = ДД.ВидЗапасов
		|		И Остатки.Организация = ДД.Организация
		|		И Остатки.Партия = ДД.Партия
		|		И Остатки.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Остатки.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
		|		И Остатки.ВидДеятельностиНДС = ДД.ВидДеятельностиНДС
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО СпрНоменклатура.Ссылка = ДД.АналитикаУчетаНоменклатуры.Номенклатура
		|";
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ПодставитьШаблоныВесаИОбъемаВТекстЗапроса(ТекстЗапроса);
	
КонецФункции

Функция ТекстБазисПрошлыеПриходыТоваровСебестоимость()
	
	ТекстЗапроса = 
		"ВЫБРАТЬ
		|	""ТекстБазисПрошлыеПриходыТоваровСебестоимость"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка КАК Номенклатура,
		|	ДД.АналитикаУчетаНоменклатуры.МестоХранения КАК Склад,
		|	ДД.Регистратор,
		|	НЕОПРЕДЕЛЕНО КАК Заказ,
		|	ДД.ВидЗапасов,
		|	ДД.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО) КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Поставщик,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступленияРасходов,
		|	ДД.АналитикаУчетаПартий.ВидЦенности КАК ВидЦенности,
		|	НЕОПРЕДЕЛЕНО КАК СтавкаНДС,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходов,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	(ДД.Количество - ЕСТЬNULL(ПрошлыеВыбытияТоваров.Количество, 0)) КАК Количество,
		|	(&Вес * ДД.Количество - &Вес * ЕСТЬNULL(ПрошлыеВыбытияТоваров.Количество, 0)) КАК Вес,
		|	(&Объем * ДД.Количество - &Объем * ЕСТЬNULL(ПрошлыеВыбытияТоваров.Количество, 0)) КАК Объем,
		|	(ДД.Стоимость - ЕСТЬNULL(ПрошлыеВыбытияТоваров.Стоимость, 0)) КАК Стоимость,
		|	(ДД.СтоимостьБезНДС - ЕСТЬNULL(ПрошлыеВыбытияТоваров.СтоимостьБезНДС, 0)) КАК СтоимостьБезНДС,
		|	(ДД.СтоимостьРегл - ЕСТЬNULL(ПрошлыеВыбытияТоваров.СтоимостьРегл, 0)) КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	(ДД.ПостояннаяРазница - ЕСТЬNULL(ПрошлыеВыбытияТоваров.ПостояннаяРазница, 0)) КАК ПостояннаяРазница,
		|	(ДД.ВременнаяРазница - ЕСТЬNULL(ПрошлыеВыбытияТоваров.ВременнаяРазница, 0)) КАК ВременнаяРазница,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	ДД.ВидДеятельностиНДС КАК НалогообложениеНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ПустаяСсылка) КАК ВариантРаздельногоУчетаНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) КАК ПравилоРаспределения,
		|	ДД.РазделУчета,
		|	ДД.Партия КАК Партия,
		|	ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ КАК ПрошлыеВыбытияТоваров,
		|	ДД.Период КАК РасчетныйПериод
		|ИЗ
		|	ПрошлыеПоступления КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ОстаткиПрошлыхПоступлений КАК Остатки
		|		ПО Остатки.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Остатки.РазделУчета = ДД.РазделУчета
		|		И Остатки.ВидЗапасов = ДД.ВидЗапасов
		|		И Остатки.Организация = ДД.Организация
		|		И Остатки.Партия = ДД.Партия
		|		И Остатки.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Остатки.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
		|		И Остатки.ВидДеятельностиНДС = ДД.ВидДеятельностиНДС
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО СпрНоменклатура.Ссылка = ДД.АналитикаУчетаНоменклатуры.Номенклатура
		|	ЛЕВОЕ СОЕДИНЕНИЕ ПрошлыеВыбытияТоваровПоНоменклатуре КАК ПрошлыеВыбытияТоваров
		|		ПО ПрошлыеВыбытияТоваров.Регистратор = ДД.Регистратор
		|		И ПрошлыеВыбытияТоваров.Организация = ДД.Организация
		|		И ПрошлыеВыбытияТоваров.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
		|		И ПрошлыеВыбытияТоваров.ВидДеятельностиНДС = ДД.ВидДеятельностиНДС
		|		И ДД.АналитикаУчетаНоменклатуры.Номенклатура = ПрошлыеВыбытияТоваров.Номенклатура
		|		И ДД.АналитикаУчетаНоменклатуры.Характеристика = ПрошлыеВыбытияТоваров.Характеристика
		|		И ДД.АналитикаУчетаНоменклатуры.Серия = ПрошлыеВыбытияТоваров.Серия
		|		И ДД.АналитикаУчетаНоменклатуры.СтатьяКалькуляции = ПрошлыеВыбытияТоваров.СтатьяКалькуляции
		|ГДЕ
		|	(ДД.Количество - ЕСТЬNULL(ПрошлыеВыбытияТоваров.Количество, 0)) > 0
		|";
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ПодставитьШаблоныВесаИОбъемаВТекстЗапроса(ТекстЗапроса);
	
КонецФункции

Функция ТекстБазисЗаказы()
	
	ТекстЗапроса = 
		"ВЫБРАТЬ
		|	""ТекстБазисЗаказы"" КАК ЗапросИсточник,
		|	ДД.Приоритет,
		|	ДД.ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ДД.ВидДвижения,
		|	ДД.Период,
		|	ДД.Заказ КАК Регистратор,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО КАК Склад,
		|	ДД.ДокументПоступления,
		|	ДД.Заказ КАК Заказ,
		|	ДД.ВидЗапасов,
		|	ДД.АналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО) КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Поставщик,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступленияРасходов,
		|	ДД.АналитикаУчетаПартий.ВидЦенности КАК ВидЦенности,
		|	НЕОПРЕДЕЛЕНО КАК СтавкаНДС,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходов,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	СУММА(ДД.Количество) КАК Количество,
		|	СУММА(&Вес * ДД.Количество) КАК Вес,
		|	СУММА(&Объем * ДД.Количество) КАК Объем,
		|	СУММА(ДД.Стоимость) КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
		|	СУММА(ДД.НДСРегл) КАК НДСРегл,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	ДД.ВидДеятельностиНДС КАК НалогообложениеНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	(ВЫБОР
		|		КОГДА ТИПЗНАЧЕНИЯ(ДД.Заказ) = ТИП(Документ.ЗаказНаПеремещение) ТОГДА ДД.Регистратор
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК ДокументИсточник,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ПустаяСсылка) КАК ВариантРаздельногоУчетаНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) КАК ПравилоРаспределения,
		|	ДД.РазделУчета,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ КАК ПрошлыеВыбытияТоваров,
		|	ДД.Период КАК РасчетныйПериод
		|ИЗ
		|	ПартииПоЗаказам КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК ВидыЗапасов
		|		ПО ВидыЗапасов.Ссылка = ДД.ВидЗапасов
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПоступленияИЗаказыИзАналитикРасходов КАК Заказы
		|		ПО Заказы.Поступление = ДД.Регистратор
		|		И Заказы.Заказ = ДД.Заказ
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикиТоваров
		|		ПО АналитикиТоваров.Ссылка = ДД.АналитикаУчетаНоменклатуры
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО СпрНоменклатура.Ссылка = АналитикиТоваров.Номенклатура
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.РеестрДокументов КАК Реестр
		|		ПО Реестр.Ссылка = ДД.Регистратор
		|		И НЕ Реестр.ДополнительнаяЗапись
		|ГДЕ
		|	ЕСТЬNULL(ВидыЗапасов.ТипЗапасов, ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)) В (&СобственныеТипыЗапасов)
		|	И Реестр.ДатаДокументаИБ >= &НачалоПериода
		|	И НЕ Реестр.ХозяйственнаяОперация В (
		|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаТоварыВПути),
		|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути),
		|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСТоварыВПути))
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Приоритет,
		|	ДД.ТипЗаписи,
		|	ДД.ВидДвижения,
		|	ДД.Период,
		|	ДД.Заказ,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка,
		|	ДД.ДокументПоступления,
		|	ДД.ВидЗапасов,
		|	ДД.РазделУчета,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО),
		|	ДД.АналитикаУчетаПартий.ВидЦенности,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|	(ВЫБОР КОГДА ДД.Период < &НачалоПериода ТОГДА &НачалоПериода ИНАЧЕ ДД.Период КОНЕЦ),
		|	(ВЫБОР
		|		КОГДА ТИПЗНАЧЕНИЯ(ДД.Заказ) = ТИП(Документ.ЗаказНаПеремещение) ТОГДА ДД.Регистратор
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ)
		|";
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ПодставитьШаблоныВесаИОбъемаВТекстЗапроса(ТекстЗапроса);
	
КонецФункции

Функция ТекстБазисПрошлыеЗаказы()
	
	ТекстЗапроса = 
		"ВЫБРАТЬ
		|	""ТекстБазисПрошлыеЗаказы"" КАК ЗапросИсточник,
		|	ДД.Приоритет,
		|	ДД.ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ДД.ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО КАК Склад,
		|	ДД.ДокументПоступления,
		|	ДД.Регистратор КАК Заказ,
		|	ДД.ВидЗапасов,
		|	ДД.АналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО) КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Поставщик,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступленияРасходов,
		|	ДД.АналитикаУчетаПартий.ВидЦенности КАК ВидЦенности,
		|	НЕОПРЕДЕЛЕНО КАК СтавкаНДС,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходов,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	(ДД.Количество - ЕСТЬNULL(ПрошлыеВыбытияТоваров.Количество, 0)) КАК Количество,
		|	(&Вес * ДД.Количество - &Вес * ЕСТЬNULL(ПрошлыеВыбытияТоваров.Количество, 0)) КАК Вес,
		|	(&Объем * ДД.Количество - &Объем * ЕСТЬNULL(ПрошлыеВыбытияТоваров.Количество, 0)) КАК Объем,
		|	(ДД.Стоимость - ЕСТЬNULL(ПрошлыеВыбытияТоваров.Стоимость, 0)) КАК Стоимость,
		|	(ДД.СтоимостьБезНДС - ЕСТЬNULL(ПрошлыеВыбытияТоваров.СтоимостьБезНДС, 0)) КАК СтоимостьБезНДС,
		|	(ДД.СтоимостьРегл - ЕСТЬNULL(ПрошлыеВыбытияТоваров.СтоимостьРегл, 0)) КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	(ДД.ПостояннаяРазница - ЕСТЬNULL(ПрошлыеВыбытияТоваров.ПостояннаяРазница, 0)) КАК ПостояннаяРазница,
		|	(ДД.ВременнаяРазница - ЕСТЬNULL(ПрошлыеВыбытияТоваров.ВременнаяРазница, 0)) КАК ВременнаяРазница,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	ДД.ВидДеятельностиНДС КАК НалогообложениеНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	ДД.ДокументИсточник,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ПустаяСсылка) КАК ВариантРаздельногоУчетаНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) КАК ПравилоРаспределения,
		|	ДД.РазделУчета,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ КАК ПрошлыеВыбытияТоваров,
		|	&НачалоПериода КАК РасчетныйПериод
		|ИЗ
		|	ПрошлыеЗаказы КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикиТоваров
		|		ПО АналитикиТоваров.Ссылка = ДД.АналитикаУчетаНоменклатуры
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО СпрНоменклатура.Ссылка = АналитикиТоваров.Номенклатура
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ОстаткиПрошлыхПоступлений КАК Остатки
		|		ПО Остатки.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Остатки.РазделУчета = ДД.РазделУчета
		|		И Остатки.ВидЗапасов = ДД.ВидЗапасов
		|		И Остатки.Организация = ДД.Организация
		|		И Остатки.Партия = ДД.Партия
		|		И Остатки.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Остатки.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
		|		И Остатки.ВидДеятельностиНДС = ДД.ВидДеятельностиНДС
		|	ЛЕВОЕ СОЕДИНЕНИЕ ПрошлыеВыбытияТоваровПоНоменклатуре КАК ПрошлыеВыбытияТоваров
		|		ПО ПрошлыеВыбытияТоваров.Регистратор = ДД.Регистратор
		|		И ПрошлыеВыбытияТоваров.Организация = ДД.Организация
		|		И ПрошлыеВыбытияТоваров.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
		|		И ПрошлыеВыбытияТоваров.ВидДеятельностиНДС = ДД.ВидДеятельностиНДС
		|		И АналитикиТоваров.Номенклатура = ПрошлыеВыбытияТоваров.Номенклатура
		|		И АналитикиТоваров.Характеристика = ПрошлыеВыбытияТоваров.Характеристика
		|		И АналитикиТоваров.Серия = ПрошлыеВыбытияТоваров.Серия
		|		И АналитикиТоваров.СтатьяКалькуляции = ПрошлыеВыбытияТоваров.СтатьяКалькуляции
		|ГДЕ
		|	(ДД.Количество - ЕСТЬNULL(ПрошлыеВыбытияТоваров.Количество, 0)) > 0
		// Получаем остатки прошлых заказов при учете по средней стоимости.
		// При учете по ФИФО остатки прошлых заказов получаем в функции ТекстБазисОстаткиПоЗаказамСебестоимость()
		|	И ДД.Партия = НЕОПРЕДЕЛЕНО
		|";
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ПодставитьШаблоныВесаИОбъемаВТекстЗапроса(ТекстЗапроса);
	
КонецФункции

Функция ТекстБазисУслуги()
	Возврат "
		|ВЫБРАТЬ
		|	""ТекстБазисУслуги"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО КАК Склад,
		|	ДД.Регистратор КАК ДокументПоступления,
		|	НЕОПРЕДЕЛЕНО КАК Заказ,
		|	НЕОПРЕДЕЛЕНО КАК ВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК АналитикаУчетаПартий,
		|	ДД.НаправлениеДеятельности КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Поставщик,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступленияРасходов,
		|	(ВЫБОР
		|		КОГДА ЕСТЬNULL(ДД.СтатьяРасходов.ВидЦенностиНДС, ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПустаяСсылка)) <>
		|				ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПустаяСсылка)
		|			ТОГДА ДД.СтатьяРасходов.ВидЦенностиНДС
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПрочиеРаботыИУслуги) КОНЕЦ) КАК ВидЦенности,
		|	НЕОПРЕДЕЛЕНО КАК СтавкаНДС,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходов,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	1 КАК Количество,
		|	0 КАК Вес,
		|	0 КАК Объем,
		|	СУММА(ДД.Сумма) КАК Стоимость,
		|	СУММА(ДД.Сумма) КАК СтоимостьБезНДС,
		|	СУММА(ДД.СуммаРегл) КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
		|	ЕСТЬNULL(ПоступлениеТоваров.ЗакупкаПодДеятельность, ПоступлениеУслуг.ЗакупкаПодДеятельность) КАК ВидДеятельностиНДС,
		|	ЕСТЬNULL(ПоступлениеТоваров.ЗакупкаПодДеятельность, ПоступлениеУслуг.ЗакупкаПодДеятельность) КАК НалогообложениеНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
		|	ДД.Подразделение КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	ДД.СтатьяРасходов КАК СтатьяОтраженияРасходов,
		|	ДД.СтатьяРасходов.ВариантРаздельногоУчетаНДС КАК ВариантРаздельногоУчетаНДС,
		|	ДД.АналитикаРасходов КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) КАК ПравилоРаспределения,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты) КАК РазделУчета,
		|	НЕОПРЕДЕЛЕНО КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ КАК ПрошлыеВыбытияТоваров,
		|	ДД.Период КАК РасчетныйПериод
		|ИЗ
		|	РегистрНакопления.ПрочиеРасходы КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК ПоступлениеТоваров
		|		ПО ПоступлениеТоваров.Ссылка = ДД.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеУслугПрочихАктивов КАК ПоступлениеУслуг
		|		ПО ПоступлениеУслуг.Ссылка = ДД.Регистратор
		|ГДЕ
		|	ДД.Период <= &КонецПериода
		|	И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|	И (ДД.Регистратор ССЫЛКА Документ.ПриобретениеТоваровУслуг 
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ПриобретениеУслугПрочихАктивов)
		|	И (ДД.Организация, ДД.Регистратор) В (
		|		ВЫБРАТЬ РАЗЛИЧНЫЕ
		|			КлючиРасходов.Организация, ДД.Регистратор
		|		ИЗ
		|			АналитикиРасходовВсе КАК КлючиРасходов
		|		ГДЕ 
		|			КлючиРасходов.АналитикаРасходов = ДД.Регистратор
		|			И КлючиРасходов.СтатьяРасходов = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.НДСНалоговогоАгента)
		|		)
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.Подразделение,
		|	ДД.СтатьяРасходов,
		|	ДД.СтатьяРасходов.ВариантРаздельногоУчетаНДС,
		|	ДД.АналитикаРасходов,
		|	ДД.НаправлениеДеятельности,
		|	ЕСТЬNULL(ПоступлениеТоваров.ЗакупкаПодДеятельность, ПоступлениеУслуг.ЗакупкаПодДеятельность),
		|	(ВЫБОР
		|		КОГДА ЕСТЬNULL(ДД.СтатьяРасходов.ВидЦенностиНДС, ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПустаяСсылка)) <>
		|				ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПустаяСсылка)
		|			ТОГДА ДД.СтатьяРасходов.ВидЦенностиНДС
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПрочиеРаботыИУслуги) КОНЕЦ)
		|";
КонецФункции

Функция ТекстБазисПрочиеАктивыПассивы()
	Возврат "
		|ВЫБРАТЬ
		|	""ТекстБазисПрочиеАктивыПассивы"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО КАК Склад,
		|	ДД.Регистратор КАК ДокументПоступления,
		|	НЕОПРЕДЕЛЕНО КАК Заказ,
		|	НЕОПРЕДЕЛЕНО КАК ВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК АналитикаУчетаПартий,
		|	ДД.НаправлениеДеятельности КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Поставщик,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступленияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПрочиеРаботыИУслуги) КАК ВидЦенности,
		|	НЕОПРЕДЕЛЕНО КАК СтавкаНДС,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходов,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	1 КАК Количество,
		|	0 КАК Вес,
		|	0 КАК Объем,
		|	СУММА(ДД.Сумма) КАК Стоимость,
		|	СУММА(ДД.Сумма) КАК СтоимостьБезНДС,
		|	СУММА(ДД.Сумма) КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
		|	ЕСТЬNULL(ПоступлениеТоваров.ЗакупкаПодДеятельность, ПоступлениеУслуг.ЗакупкаПодДеятельность) КАК ВидДеятельностиНДС,
		|	ЕСТЬNULL(ПоступлениеТоваров.ЗакупкаПодДеятельность, ПоступлениеУслуг.ЗакупкаПодДеятельность) КАК НалогообложениеНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
		|	ДД.Подразделение КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	ДД.Статья КАК СтатьяОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ИзДокумента) КАК ВариантРаздельногоУчетаНДС,
		|	ДД.Аналитика КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) КАК ПравилоРаспределения,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты) КАК РазделУчета,
		|	НЕОПРЕДЕЛЕНО КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ КАК ПрошлыеВыбытияТоваров,
		|	ДД.Период КАК РасчетныйПериод
		|ИЗ
		|	РегистрНакопления.ПрочиеАктивыПассивы КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК ПоступлениеТоваров
		|		ПО ПоступлениеТоваров.Ссылка = ДД.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеУслугПрочихАктивов КАК ПоступлениеУслуг
		|		ПО ПоступлениеУслуг.Ссылка = ДД.Регистратор
		|ГДЕ
		|	ДД.Период <= &КонецПериода
		|	И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|	И ДД.ВидИсточника = ЗНАЧЕНИЕ(Перечисление.ВидыИсточниковДвижений.ПустаяСсылка)
		|	И (ДД.Регистратор ССЫЛКА Документ.ПриобретениеТоваровУслуг 
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ПриобретениеУслугПрочихАктивов)
		|	И (ДД.Организация, ДД.Регистратор) В (
		|		ВЫБРАТЬ РАЗЛИЧНЫЕ
		|			КлючиРасходов.Организация, ДД.Регистратор
		|		ИЗ
		|			АналитикиРасходовВсе КАК КлючиРасходов
		|		ГДЕ 
		|			КлючиРасходов.АналитикаРасходов = ДД.Регистратор
		|			И КлючиРасходов.СтатьяРасходов = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.НДСНалоговогоАгента)
		|		)
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.Подразделение,
		|	ДД.Статья,
		|	ДД.Аналитика,
		|	ДД.НаправлениеДеятельности,
		|	ЕСТЬNULL(ПоступлениеТоваров.ЗакупкаПодДеятельность, ПоступлениеУслуг.ЗакупкаПодДеятельность)
		|";
КонецФункции

Функция ТекстБазисПартииПрочихРасходов()
	Возврат "
		|ВЫБРАТЬ
		|	""ТекстБазисПартииПрочихРасходов"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО КАК Склад,
		|	ДД.Регистратор КАК ДокументПоступления,
		|	НЕОПРЕДЕЛЕНО КАК Заказ,
		|	НЕОПРЕДЕЛЕНО КАК ВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК АналитикаУчетаПартий,
		|	ДД.НаправлениеДеятельности КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Поставщик,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступленияРасходов,
		|	(ВЫБОР
		|		КОГДА ЕСТЬNULL(ДД.СтатьяРасходов.ВидЦенностиНДС, ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПустаяСсылка)) <>
		|				ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПустаяСсылка)
		|			ТОГДА ДД.СтатьяРасходов.ВидЦенностиНДС
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПрочиеРаботыИУслуги) КОНЕЦ) КАК ВидЦенности,
		|	НЕОПРЕДЕЛЕНО КАК СтавкаНДС,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходов,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	1 КАК Количество,
		|	0 КАК Вес,
		|	0 КАК Объем,
		|	СУММА(ДД.Стоимость) КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
		|	ЕСТЬNULL(ПоступлениеТоваров.ЗакупкаПодДеятельность, ПоступлениеУслуг.ЗакупкаПодДеятельность) КАК ВидДеятельностиНДС,
		|	ЕСТЬNULL(ПоступлениеТоваров.ЗакупкаПодДеятельность, ПоступлениеУслуг.ЗакупкаПодДеятельность) КАК НалогообложениеНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
		|	ДД.Подразделение КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяОтраженияРасходов,
		|	ДД.СтатьяРасходов.ВариантРаздельногоУчетаНДС КАК ВариантРаздельногоУчетаНДС,
		|	ДД.АналитикаРасходов КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) КАК ПравилоРаспределения,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты) КАК РазделУчета,
		|	НЕОПРЕДЕЛЕНО КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ КАК ПрошлыеВыбытияТоваров,
		|	ДД.Период КАК РасчетныйПериод
		|ИЗ
		|	РегистрНакопления.ПартииПрочихРасходов КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг КАК ПоступлениеТоваров
		|		ПО ПоступлениеТоваров.Ссылка = ДД.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеУслугПрочихАктивов КАК ПоступлениеУслуг
		|		ПО ПоступлениеУслуг.Ссылка = ДД.Регистратор
		|ГДЕ
		|	ДД.Период <= &КонецПериода
		|	И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|	И ДД.СтатьяРасходов.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|	И (ДД.Регистратор ССЫЛКА Документ.ПриобретениеТоваровУслуг 
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ПриобретениеУслугПрочихАктивов)
		|	И (ДД.Организация, ДД.Регистратор) В (
		|		ВЫБРАТЬ РАЗЛИЧНЫЕ
		|			КлючиРасходов.Организация, ДД.Регистратор
		|		ИЗ
		|			АналитикиРасходовВсе КАК КлючиРасходов
		|		ГДЕ 
		|			КлючиРасходов.АналитикаРасходов = ДД.Регистратор
		|			И КлючиРасходов.СтатьяРасходов = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.НДСНалоговогоАгента)
		|		)
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.Подразделение,
		|	ДД.СтатьяРасходов,
		|	ДД.СтатьяРасходов.ВариантРаздельногоУчетаНДС,
		|	ДД.АналитикаРасходов,
		|	ДД.НаправлениеДеятельности,
		|	ЕСТЬNULL(ПоступлениеТоваров.ЗакупкаПодДеятельность, ПоступлениеУслуг.ЗакупкаПодДеятельность),
		|	(ВЫБОР
		|		КОГДА ЕСТЬNULL(ДД.СтатьяРасходов.ВидЦенностиНДС, ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПустаяСсылка)) <>
		|				ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПустаяСсылка)
		|			ТОГДА ДД.СтатьяРасходов.ВидЦенностиНДС
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ПрочиеРаботыИУслуги) КОНЕЦ)
		|";
КонецФункции

Функция ТекстБазисСписанияИРеклассификацияРасходовУпр()
	Возврат "
		|ВЫБРАТЬ
		|	""ТекстБазисСписанияИРеклассификацияРасходовУпр"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО КАК Склад,
		|	ДД.Регистратор КАК ДокументПоступления,
		|	НЕОПРЕДЕЛЕНО КАК Заказ,
		|	НЕОПРЕДЕЛЕНО КАК ВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК АналитикаУчетаПартий,
		|	ДД.НаправлениеДеятельности КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Поставщик,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступленияРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ВидЦенности,
		|	НЕОПРЕДЕЛЕНО КАК СтавкаНДС,
		|	ДД.СтатьяРасходов,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		// В качестве количества, веса или объема для списания и реклассификации используем стоимость расходов.
		|	СУММА(ДД.Стоимость) КАК Количество,
		|	СУММА(ДД.Стоимость) КАК Вес,
		|	СУММА(ДД.Стоимость) КАК Объем,
		|	СУММА(ДД.Стоимость) КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	0 КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.ВидДеятельностиНДС КАК НалогообложениеНДС,
		|	ДД.ХозяйственнаяОперация,
		|	ДД.Подразделение КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяОтраженияРасходов,
		|	ДД.СтатьяРасходов.ВариантРаздельногоУчетаНДС КАК ВариантРаздельногоУчетаНДС,
		|	ДД.АналитикаРасходов КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) КАК ПравилоРаспределения,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты) КАК РазделУчета,
		|	НЕОПРЕДЕЛЕНО КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ КАК ПрошлыеВыбытияТоваров,
		|	ДД.Период КАК РасчетныйПериод
		|ИЗ
		|	ВТКэшРасчетныеОборотыПартииПрочихРасходов КАК ДД
		|ГДЕ
		|	НЕ ДД.СлужебноеВидДвиженияПриход
		|	И ДД.СтатьяРасходов.ВариантРаспределенияРасходовУпр = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|	И ДД.Регистратор ССЫЛКА Документ.ПрочиеДоходыРасходы
		|	И (ДД.Организация, ДД.СтатьяРасходов, ДД.АналитикаРасходов) В (
		|		ВЫБРАТЬ РАЗЛИЧНЫЕ
		|			КлючиРасходов.Организация,
		|			КлючиРасходов.СтатьяРасходов,
		|			КлючиРасходов.АналитикаРасходов
		|		ИЗ
		|			АналитикиРасходовВсе КАК КлючиРасходов
		|		)
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.Подразделение,
		|	ДД.СтатьяРасходов,
		|	ДД.СтатьяРасходов.ВариантРаздельногоУчетаНДС,
		|	ДД.АналитикаРасходов,
		|	ДД.НаправлениеДеятельности,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.ХозяйственнаяОперация
		|";
КонецФункции

Функция ТекстБазисСписанияИРеклассификацияРасходовРегл()
	Возврат "
		|ВЫБРАТЬ
		|	""ТекстБазисСписанияИРеклассификацияРасходовРегл"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО КАК Склад,
		|	ДД.Регистратор КАК ДокументПоступления,
		|	НЕОПРЕДЕЛЕНО КАК Заказ,
		|	НЕОПРЕДЕЛЕНО КАК ВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК АналитикаУчетаПартий,
		|	ДД.НаправлениеДеятельности КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Поставщик,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступленияРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ВидЦенности,
		|	НЕОПРЕДЕЛЕНО КАК СтавкаНДС,
		|	ДД.СтатьяРасходов,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		// В качестве количества, веса или объема для списания и реклассификации используем стоимость расходов.
		|	0 КАК Количество,
		|	0 КАК Вес,
		|	0 КАК Объем,
		|	0 КАК Стоимость,
		|	0 КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.ВидДеятельностиНДС КАК НалогообложениеНДС,
		|	ДД.ХозяйственнаяОперация,
		|	ДД.Подразделение КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяОтраженияРасходов,
		|	ДД.СтатьяРасходов.ВариантРаздельногоУчетаНДС КАК ВариантРаздельногоУчетаНДС,
		|	ДД.АналитикаРасходов КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) КАК ПравилоРаспределения,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты) КАК РазделУчета,
		|	НЕОПРЕДЕЛЕНО КАК Партия,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ КАК ПрошлыеВыбытияТоваров,
		|	ДД.Период КАК РасчетныйПериод
		|ИЗ
		|	ВТКэшРасчетныеОборотыПартииПрочихРасходов КАК ДД
		|ГДЕ
		|	НЕ ДД.СлужебноеВидДвиженияПриход
		|	И ДД.СтатьяРасходов.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|	И ДД.Регистратор ССЫЛКА Документ.ПрочиеДоходыРасходы
		|	И (ДД.Организация, ДД.СтатьяРасходов, ДД.АналитикаРасходов) В (
		|		ВЫБРАТЬ РАЗЛИЧНЫЕ
		|			КлючиРасходов.Организация,
		|			КлючиРасходов.СтатьяРасходов,
		|			КлючиРасходов.АналитикаРасходов
		|		ИЗ
		|			АналитикиРасходовВсе КАК КлючиРасходов
		|		)
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.Подразделение,
		|	ДД.СтатьяРасходов,
		|	ДД.СтатьяРасходов.ВариантРаздельногоУчетаНДС,
		|	ДД.АналитикаРасходов,
		|	ДД.НаправлениеДеятельности,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.ХозяйственнаяОперация
		|";
КонецФункции

Функция ТекстБазисПрошлыеВыбытияТоваров() // использует ПрошлыеВыбытияТоваров
	
	ТекстЗапроса = 
		"ВЫБРАТЬ
		|	""ТекстБазисПрошлыеВыбытияТоваров"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДАТАВРЕМЯ(1,1,1) КАК Период,
		|	ВЫБОР
		|		КОГДА ДД.Партия = НЕОПРЕДЕЛЕНО
		|		 ИЛИ ТИПЗНАЧЕНИЯ(ДД.Регистратор) = ТИП(Документ.ЗаказПоставщику)
		|		 ИЛИ ТИПЗНАЧЕНИЯ(ДД.Регистратор) = ТИП(Документ.ЗаказНаПеремещение)
		|		 ИЛИ ТИПЗНАЧЕНИЯ(ДД.Регистратор) = ТИП(Документ.ЗаказНаСборку)
		|			ТОГДА ДД.Регистратор
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ КАК Регистратор,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка КАК Номенклатура,
		|	ДД.АналитикаУчетаНоменклатуры.МестоХранения КАК Склад,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступления,
		|	НЕОПРЕДЕЛЕНО КАК Заказ,
		|	ДД.ВидЗапасов,
		|	ДД.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО) КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Поставщик,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступленияРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ВидЦенности,
		|	НЕОПРЕДЕЛЕНО КАК СтавкаНДС,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходов,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	СУММА(ДД.Количество) КАК Количество,
		|	СУММА(&Вес * ДД.Количество) КАК Вес,
		|	СУММА(&Объем * ДД.Количество) КАК Объем,
		|	СУММА(ДД.Стоимость) КАК Стоимость,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьРегл) КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	ДД.ВидДеятельностиНДС КАК НалогообложениеНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ПустаяСсылка) КАК ВариантРаздельногоУчетаНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) КАК ПравилоРаспределения,
		|	ДД.РазделУчета,
		|	ДД.Партия КАК Партия,
		|	ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ИСТИНА КАК ПрошлыеВыбытияТоваров,
		|	(ВЫБОР
		|		КОГДА ДД.ПрошлыеВыбытия ТОГДА ДАТАВРЕМЯ(1,1,1)
		|		ИНАЧЕ &НачалоПериода КОНЕЦ) КАК РасчетныйПериод
		|ИЗ
		|	ПрошлыеВыбытияТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО СпрНоменклатура.Ссылка = ДД.АналитикаУчетаНоменклатуры.Номенклатура
		|СГРУППИРОВАТЬ ПО
		|	ВЫБОР
		|		КОГДА ДД.Партия = НЕОПРЕДЕЛЕНО
		|		 ИЛИ ТИПЗНАЧЕНИЯ(ДД.Регистратор) = ТИП(Документ.ЗаказПоставщику)
		|		 ИЛИ ТИПЗНАЧЕНИЯ(ДД.Регистратор) = ТИП(Документ.ЗаказНаПеремещение)
		|		 ИЛИ ТИПЗНАЧЕНИЯ(ДД.Регистратор) = ТИП(Документ.ЗаказНаСборку)
		|			ТОГДА ДД.Регистратор
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка,
		|	ДД.АналитикаУчетаНоменклатуры.МестоХранения,
		|	ДД.ВидЗапасов,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО),
		|	ДД.ВидДеятельностиНДС,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
		|	(ВЫБОР
		|		КОГДА ДД.ПрошлыеВыбытия ТОГДА ДАТАВРЕМЯ(1,1,1)
		|		ИНАЧЕ &НачалоПериода КОНЕЦ)
		|";
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ПодставитьШаблоныВесаИОбъемаВТекстЗапроса(ТекстЗапроса);
	
КонецФункции

Функция ТекстБазисПеремещенияПоСкладуСебестоимость()
	
	ТекстЗапроса = 
		"ВЫБРАТЬ
		|	""ТекстБазисПеремещенияПоСкладуСебестоимость"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка КАК Номенклатура,
		|	АналитикиТоваров.МестоХранения КАК Склад,
		|	ДД.Регистратор,
		|	НЕОПРЕДЕЛЕНО КАК Заказ,
		|	ДД.ВидЗапасов,
		|	ДД.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО) КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Поставщик,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступленияРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ВидЦенности,
		|	НЕОПРЕДЕЛЕНО КАК СтавкаНДС,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходов,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРаспределения,
		|	0 КАК Базис,
		|	0 КАК БазисРегл,
		|	СУММА(ДД.Количество) КАК Количество,
		|	СУММА(&Вес * ДД.Количество) КАК Вес,
		|	СУММА(&Объем * ДД.Количество) КАК Объем,
		|	СУММА(ВЫБОР
		|		КОГДА ДД.Стоимость <> 0 ТОГДА ДД.Стоимость
		|		ИНАЧЕ ВЫРАЗИТЬ(ДД.Количество
		|			* (ЕСТЬNULL(Цены.Стоимость, 0) + ЕСТЬNULL(Цены.СтоимостьДопРасходы, 0)) КАК ЧИСЛО(31,2)) КОНЕЦ) КАК Стоимость,
		|	СУММА(ВЫБОР
		|		КОГДА ДД.СтоимостьБезНДС <> 0 ТОГДА ДД.СтоимостьБезНДС
		|		ИНАЧЕ ВЫРАЗИТЬ(ДД.Количество
		|			* (ЕСТЬNULL(Цены.СтоимостьБезНДС, 0) + ЕСТЬNULL(Цены.СтоимостьДопРасходыБезНДС, 0)) КАК ЧИСЛО(31,2)) КОНЕЦ) КАК СтоимостьБезНДС,
		|	СУММА(ВЫБОР
		|		КОГДА ДД.СтоимостьРегл <> 0 ТОГДА ДД.СтоимостьРегл
		|		ИНАЧЕ ВЫРАЗИТЬ(ДД.Количество
		|			* (ЕСТЬNULL(Цены.СтоимостьРегл, 0) + ЕСТЬNULL(Цены.ДопРасходыРегл, 0)) КАК ЧИСЛО(31,2)) КОНЕЦ) КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница,
		|	ДД.ВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	ДД.ВидДеятельностиНДС КАК НалогообложениеНДС,
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК ПодразделениеРасходов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументРеализации,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ВариантыРаздельногоУчетаНДС.ПустаяСсылка) КАК ВариантРаздельногоУчетаНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаОтраженияРасходов,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаРаспределенияНаСебестоимостьТоваров.ПустаяСсылка) КАК ПравилоРаспределения,
		|	ДД.РазделУчета,
		|	ДД.Партия КАК Партия,
		|	ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	ЛОЖЬ КАК ПрошлыеВыбытияТоваров,
		|	ДД.Период КАК РасчетныйПериод
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикиТоваров
		|		ПО АналитикиТоваров.Ссылка = ДД.АналитикаУчетаНоменклатуры
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО СпрНоменклатура.Ссылка = АналитикиТоваров.Номенклатура
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК СпрСклады
		|		ПО СпрСклады.Ссылка = АналитикиТоваров.МестоХранения
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТСтоимостьПартийТоваров КАК Цены
		|		ПО Цены.Организация = ДД.Организация
		|		И Цены.Период = НАЧАЛОПЕРИОДА(ДД.Период, МЕСЯЦ)
		|		И Цены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Цены.ВидЗапасов = ДД.ВидЗапасов
		|		И Цены.РазделУчета = ДД.РазделУчета
		|		И Цены.Партия = ДД.Партия
		|		И Цены.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Цены.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
		|		И Цены.ВидДеятельностиНДС = ДД.ВидДеятельностиНДС
		|ГДЕ
		|	ДД.СлужебноеВидДвиженияПриход
		|	И ТИПЗНАЧЕНИЯ(ДД.Регистратор) = ТИП(Документ.ПеремещениеТоваров)
		|	И (ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
		|		ИЛИ ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		И ЕСТЬNULL(СпрСклады.ЦеховаяКладовая, ЛОЖЬ))
		|	И (ДД.Организация,
		|		АналитикиТоваров.Номенклатура,
		|		АналитикиТоваров.МестоХранения,
		|		ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|		ДД.Регистратор) В
		|	(
		|		ВЫБРАТЬ РАЗЛИЧНЫЕ
		|			КлючиРасходов.Организация,
		|			АналитикиТоваров.Номенклатура,
		|			АналитикиТоваров.МестоХранения,
		|			(ВЫБОР
		|				КОГДА КлючиРасходов.НаправлениеДеятельности = ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
		|				 ИЛИ НЕ &УчитыватьСебестоимостьТоваровПоНазначениям
		|					ТОГДА ЕСТЬNULL(АналитикиТоваров.Назначение.НаправлениеДеятельности,
		|						ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|				ИНАЧЕ КлючиРасходов.НаправлениеДеятельности КОНЕЦ) КАК НаправлениеДеятельности,
		|			ДД.Регистратор
		|		ИЗ
		|			АналитикиРасходовВсе КАК КлючиРасходов
		|		ГДЕ 
		|			КлючиРасходов.АналитикаРасходов = АналитикиТоваров.МестоХранения
		|	)
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	СпрНоменклатура.Ссылка,
		|	АналитикиТоваров.МестоХранения,
		|	ДД.Регистратор,
		|	ДД.ВидЗапасов,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, НЕОПРЕДЕЛЕНО),
		|	ДД.ВидДеятельностиНДС,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета
		|";
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ПодставитьШаблоныВесаИОбъемаВТекстЗапроса(ТекстЗапроса);
	
КонецФункции

// ... для СформироватьДопРасходыВСебестоимостьТоваров()

Функция ТекстАналитикиПартнеров()
	Возврат
		"ВЫБРАТЬ
		|	ДД.Регистратор КАК ДокументПоступления,
		|	МИНИМУМ(ДД.АналитикаУчетаПоПартнерам) КАК АналитикаУчетаПоПартнерам
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|ГДЕ
		|	ДД.СлужебноеВидДвиженияПриход
		|	И ДД.Количество > 0
		|	И ДД.АналитикаУчетаПоПартнерам <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПоПартнерам.ПустаяСсылка)
		|	И ДД.Регистратор В (&Поступления)
		|СГРУППИРОВАТЬ ПО
		|	ДД.Регистратор
		|";
КонецФункции

// ... для СформироватьДопРасходыВДвиженияНоменклатураДоходыРасходы()

Функция ТекстРегистраторыДляНоменклатураДоходыРасходы() // вт РегистраторыДопРасходы
	Возврат
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДД.Регистратор
		|ПОМЕСТИТЬ РегистраторыДопРасходы
		|ИЗ
		|	ВТКэшРасчетныеОборотыПартииПрочихРасходов КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК Партии
		|		ПО Партии.Период = ДД.Период
		|		И Партии.Регистратор = ДД.Регистратор
		|ГДЕ
		|	НЕ ДД.СлужебноеВидДвиженияПриход
		|	И Партии.СлужебноеВидДвиженияПриход
		|ИНДЕКСИРОВАТЬ ПО
		|	ДД.Регистратор
		|";
КонецФункции

Функция ТекстОписаниеДанныхДляНоменклатураДоходыРасходы()
	Возврат
		"ВЫБРАТЬ ПЕРВЫЕ 0
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(80)) 			  						  КАК ЗапросИсточник,
		|	0 																  КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПустаяСсылка) 			  КАК ТипЗаписи,
		|	ЛОЖЬ 															  КАК РасчетЗавершен,
		|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) 									  КАК Период,
		|	НЕОПРЕДЕЛЕНО 													  КАК Регистратор,
		|
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) 		  КАК ХозяйственнаяОперация,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) 					  КАК Организация,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) 			  КАК Подразделение,
		|
		|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)		  КАК НаправлениеДеятельностиНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК АналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.Склады.ПустаяСсылка) 						  КАК Склад,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПустаяСсылка) 				  КАК ТипЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) 					  КАК ВидЗапасов,
		|
		|	НЕОПРЕДЕЛЕНО 													  КАК СтатьяДоходовРасходов,
		|	НЕОПРЕДЕЛЕНО 													  КАК АналитикаРасходов,
		|
		|	0 													  			  КАК Количество,
		|	0 													  			  КАК Стоимость,
		|	0 													  			  КАК СтоимостьБезНДС,
		|	0 													  			  КАК СтоимостьРегл,
		|	0 													  			  КАК СтоимостьУпр,
		|
		|	НЕОПРЕДЕЛЕНО 													  КАК ИсточникГФУНоменклатуры,
		|	НЕОПРЕДЕЛЕНО 													  КАК ДокументДвижения
		|//ВоВременнуюТаблицу
		|";
КонецФункции

Функция ТекстНоменклатураДоходыРасходыИзСебестоимости()
	Возврат
		"ВЫБРАТЬ
		|	""ТекстНоменклатураДоходыРасходыИзСебестоимости"" КАК ЗапросИсточник,
		|	90 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия) КАК ТипЗаписи,
		|	ИСТИНА КАК РасчетЗавершен,
		|	ДД.Период,
		|	ДД.Регистратор,
		|
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РаспределениеРасходовНаСебестоимость),
		|	ДД.Организация,
		|	ДД.Подразделение,
		|
		|	Аналитика.Назначение.НаправлениеДеятельности,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	Аналитика.МестоХранения,
		|	ЕСТЬNULL(СпрВидыЗапасов.ТипЗапасов, ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)) КАК ТипЗапасов,
		|	ДД.ВидЗапасов,
		|
		|	ДД.СтатьяРасходовСписания КАК СтатьяДоходовРасходов,
		|	ДД.АналитикаРасходов КАК АналитикаРасходов,
		|
		|	0 								 КАК Количество,
		|	СУММА(ДД.ДопРасходы) 		 	 КАК ДопРасходы,
		|	СУММА(ДД.ДопРасходыБезНДС) 		 КАК ДопРасходыБезНДС,
		|	СУММА(ДД.ДопРасходыРегл) 		 КАК ДопРасходыРегл,
		|	СУММА(ДД.ДопРасходыУпр) 		 КАК ДопРасходыУпр,
		|
		|	ВЫБОР КОГДА &ФормироватьВидыЗапасовПоГруппамФинансовогоУчета ТОГДА
		|		ДД.ВидЗапасов
		|	ИНАЧЕ
		|		ДД.АналитикаУчетаНоменклатуры.Номенклатура
		|	КОНЕЦ КАК ИсточникГФУНоменклатуры,
		|	ДД.Регистратор КАК ДокументДвижения
		|
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистраторыДопРасходы КАК Регистраторы
		|		ПО Регистраторы.Регистратор = ДД.Регистратор
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
		|		ПО Аналитика.Ссылка = ДД.АналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
		|		ПО СпрВидыЗапасов.Ссылка = ДД.ВидЗапасов
		|ГДЕ
		|	ДД.Количество = 0
		|	И (ДД.ДопРасходы <> 0 ИЛИ ДД.ДопРасходыБезНДС <> 0 ИЛИ ДД.ДопРасходыРегл <> 0 ИЛИ ДД.ДопРасходыУпр <> 0)
		|	И НЕ ДД.ХозяйственнаяОперация В
		|			(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка),
		|			 ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ДополнительныеРасходыБезПартии),
		|			 ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ДополнительныеРасходыСПартией))
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.ХозяйственнаяОперация,
		|	ДД.Организация,
		|	ДД.Подразделение,
		|	Аналитика.Назначение.НаправлениеДеятельности,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	Аналитика.МестоХранения,
		|	ЕСТЬNULL(СпрВидыЗапасов.ТипЗапасов, ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)),
		|	ДД.ВидЗапасов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.АналитикаРасходов,
		|	ВЫБОР КОГДА &ФормироватьВидыЗапасовПоГруппамФинансовогоУчета ТОГДА
		|		ДД.ВидЗапасов
		|	ИНАЧЕ
		|		ДД.АналитикаУчетаНоменклатуры.Номенклатура
		|	КОНЕЦ
		|";
КонецФункции

// Заполнение расчетной партии

Процедура ЗаполнитьРасчетнуюПартиюЗаказВПриходе(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход)
	
	ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Расход);
	РасчетнаяПартия.РасчетЗавершен = Истина;
	
	Если Приход = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	СуммовыеРесурсы = Новый Структура("Стоимость, СтоимостьБезНДС, СтоимостьРегл, НДСРегл, ПостояннаяРазница, ВременнаяРазница, НДСУпр");

	// расчетная партия заполняется на наибольшее общее вычитаемое
	КоличествоСписания = Мин(Приход.Количество, Расход.Количество);
	
	// заполняем показатели расчетной партии
	Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
		РасчетнаяПартия[ИмяРесурса.Ключ] = Окр(КоличествоСписания * Расход[ИмяРесурса.Ключ] / Расход.Количество, 2);
	КонецЦикла;
	РасчетнаяПартия.Количество = КоличествоСписания;
	
	// корректируем базу расчета в расходе
	Если Расход <> РасчетнаяПартия Тогда
		Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
			Расход[ИмяРесурса.Ключ] = Расход[ИмяРесурса.Ключ] - РасчетнаяПартия[ИмяРесурса.Ключ];
		КонецЦикла;
		Расход.Количество = Расход.Количество - КоличествоСписания;
	КонецЕсли;
	
	// корректируем базу расчета в приходе
	Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
		Приход[ИмяРесурса.Ключ] = Приход[ИмяРесурса.Ключ] - Окр(КоличествоСписания * Приход[ИмяРесурса.Ключ] / Приход.Количество, 2);
	КонецЦикла;
	Приход.Количество = Приход.Количество - КоличествоСписания;
	
	// Заполняем партионную идентификацию в расчетной партии
	РасчетнаяПартия.Заказ = Приход.Заказ;
	
КонецПроцедуры

Процедура ЗаполнитьРасчетнуюПартиюПрочихРасходов(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход)
	
	ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Расход);
	
	Если Приход = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Потребление;
	РасчетнаяПартия.ВидДвижения = ВидДвиженияНакопления.Расход;
	РасчетнаяПартия.Период = Макс(Расход.Период, Расход.РасчетныйПериод);
	
	Если Расход.Базис = 0 И Расход.БазисРегл = 0 Тогда
		Возврат;
	КонецЕсли;
	
	СуммовыеРесурсы = Новый Структура("Стоимость, СтоимостьБезНДС, НДСУпр");
	СуммовыеРесурсыРегл = Новый Структура("СтоимостьРегл, НДСРегл, ПостояннаяРазница, ВременнаяРазница");
	
	// расчетная партия заполняется на наибольшее общее вычитаемое
	БазисСписания = Мин(Приход.Значение.Базис, Расход.Базис);
	БазисСписанияРегл = Мин(Приход.Значение.БазисРегл, Расход.БазисРегл);
	
	// заполняем показатели расчетной партии
	Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
		Если Расход.Базис <> 0 Тогда
			РасчетнаяПартия[ИмяРесурса.Ключ] = Окр(БазисСписания * Расход[ИмяРесурса.Ключ] / Расход.Базис, 2);
		КонецЕсли;
	КонецЦикла;
	Для Каждого ИмяРесурса Из СуммовыеРесурсыРегл Цикл
		Если Расход.БазисРегл <> 0 Тогда
			РасчетнаяПартия[ИмяРесурса.Ключ] = Окр(БазисСписанияРегл * Расход[ИмяРесурса.Ключ] / Расход.БазисРегл, 2);
		КонецЕсли;
	КонецЦикла;
	РасчетнаяПартия.Базис = БазисСписания;
	РасчетнаяПартия.БазисРегл = БазисСписанияРегл;
	
	// корректируем базу расчета в расходе
	Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
		Расход[ИмяРесурса.Ключ] = Расход[ИмяРесурса.Ключ] - РасчетнаяПартия[ИмяРесурса.Ключ];
	КонецЦикла;
	Для Каждого ИмяРесурса Из СуммовыеРесурсыРегл Цикл
		Расход[ИмяРесурса.Ключ] = Расход[ИмяРесурса.Ключ] - РасчетнаяПартия[ИмяРесурса.Ключ];
	КонецЦикла;
	Расход.Базис = Расход.Базис - БазисСписания;
	Расход.БазисРегл = Расход.БазисРегл - БазисСписанияРегл;
	
	// корректируем базу расчета в приходе
	Приход.Значение.Базис = Приход.Значение.Базис - БазисСписания;
	Приход.Значение.БазисРегл = Приход.Значение.БазисРегл - БазисСписанияРегл;
	
	// Заполняем партионную идентификацию в расчетной партии
	Если ТипЗнч(Приход.Ключ) = Тип("ПеречислениеСсылка.ТипыНалогообложенияНДС") Тогда
		РасчетнаяПартия.НалогообложениеНДС = Приход.Ключ;
	КонецЕсли;
	Если ТипЗнч(Приход.Ключ) = Тип("ПеречислениеСсылка.ХозяйственныеОперации") Тогда
		РасчетнаяПартия.ХозяйственнаяОперация = Приход.Ключ;
	Иначе
		РасчетнаяПартия.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РаспределениеРасходовНаСебестоимость;
	КонецЕсли;
	
КонецПроцедуры

Процедура ЗаполнитьРасчетнуюПартиюПриходПартииРасходов(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход)
	
	ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Расход);
	
	Если Приход = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	// расчетная партия заполняется на наибольшее общее вычитаемое
	Если Приход.ПравилоРаспределения = Перечисления.ПравилаРаспределенияНаСебестоимостьТоваров.ПропорциональноКоличеству Тогда
		Расход.Базис = Расход.Количество;
		Расход.БазисРегл = Расход.Количество;
	ИначеЕсли Приход.ПравилоРаспределения = Перечисления.ПравилаРаспределенияНаСебестоимостьТоваров.ПропорциональноВесу Тогда
		Расход.Базис = Расход.Вес;
		Расход.БазисРегл = Расход.Вес;
	ИначеЕсли Приход.ПравилоРаспределения = Перечисления.ПравилаРаспределенияНаСебестоимостьТоваров.ПропорциональноОбъему Тогда
		Расход.Базис = Расход.Объем;
		Расход.БазисРегл = Расход.Объем;
	Иначе
		Расход.Базис = Расход.Стоимость;
		Расход.БазисРегл = Расход.СтоимостьРегл;
	КонецЕсли;
	
	Если Расход.Базис = 0 И Расход.БазисРегл = 0 Тогда
		Возврат;
	КонецЕсли;
	
	БазисСписания = Мин(Приход.Базис, Расход.Базис);
	БазисСписанияРегл = Мин(Приход.БазисРегл, Расход.БазисРегл);
	
	СуммовыеРесурсы = Новый Структура("Стоимость, СтоимостьБезНДС, НДСУпр");
	СуммовыеРесурсыРегл = Новый Структура("СтоимостьРегл, НДСРегл, ПостояннаяРазница, ВременнаяРазница");
	
	// заполняем показатели расчетной партии
	Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
		Если Приход.Базис <> 0 Тогда
			РасчетнаяПартия[ИмяРесурса.Ключ] = Окр(БазисСписания * Приход[ИмяРесурса.Ключ] / Приход.Базис, 2);
		КонецЕсли;
	КонецЦикла;
	Для Каждого ИмяРесурса Из СуммовыеРесурсыРегл Цикл
		Если Приход.БазисРегл <> 0 Тогда
			РасчетнаяПартия[ИмяРесурса.Ключ] = Окр(БазисСписанияРегл * Приход[ИмяРесурса.Ключ] / Приход.БазисРегл, 2);
		КонецЕсли;
	КонецЦикла;
	
	Если Расход.Базис <> 0 Тогда
		РасчетнаяПартия.Количество = Окр(БазисСписания * Расход.Количество / Расход.Базис, 3);
		РасчетнаяПартия.Вес 	   = Окр(БазисСписания * Расход.Вес / Расход.Базис, 8);
		РасчетнаяПартия.Объем 	   = Окр(БазисСписания * Расход.Объем / Расход.Базис, 8);
	ИначеЕсли Расход.БазисРегл <> 0 Тогда
		РасчетнаяПартия.Количество = Окр(БазисСписанияРегл * Расход.Количество / Расход.БазисРегл, 3);
		РасчетнаяПартия.Вес 	   = Окр(БазисСписанияРегл * Расход.Вес / Расход.БазисРегл, 8);
		РасчетнаяПартия.Объем 	   = Окр(БазисСписанияРегл * Расход.Объем / Расход.БазисРегл, 8);
	КонецЕсли;
	РасчетнаяПартия.Базис 	   = БазисСписания;
	РасчетнаяПартия.БазисРегл  = БазисСписанияРегл;
	
	// корректируем базу расчета в приходе
	Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
		Приход[ИмяРесурса.Ключ] = Приход[ИмяРесурса.Ключ] - РасчетнаяПартия[ИмяРесурса.Ключ];
	КонецЦикла;
	Для Каждого ИмяРесурса Из СуммовыеРесурсыРегл Цикл
		Приход[ИмяРесурса.Ключ] = Приход[ИмяРесурса.Ключ] - РасчетнаяПартия[ИмяРесурса.Ключ];
	КонецЦикла;
	
	Приход.Базис = Приход.Базис - БазисСписания;
	Приход.БазисРегл = Приход.БазисРегл - БазисСписанияРегл;
	
	// корректируем базу расчета в расходе
	Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
		Если Расход.Базис <> 0 Тогда
			Расход[ИмяРесурса.Ключ] = Расход[ИмяРесурса.Ключ] - Окр(БазисСписания * Расход[ИмяРесурса.Ключ] / Расход.Базис, 2);
		КонецЕсли;
	КонецЦикла;
	Для Каждого ИмяРесурса Из СуммовыеРесурсыРегл Цикл
		Если Расход.БазисРегл <> 0 Тогда
			Расход[ИмяРесурса.Ключ] = Расход[ИмяРесурса.Ключ] - Окр(БазисСписанияРегл * Расход[ИмяРесурса.Ключ] / Расход.БазисРегл, 2);
		КонецЕсли;
	КонецЦикла;
	
	Расход.Количество = Расход.Количество - РасчетнаяПартия.Количество;
	Расход.Вес 		  = Расход.Вес - РасчетнаяПартия.Вес;
	Расход.Объем 	  = Расход.Объем - РасчетнаяПартия.Объем;
	Расход.Базис 	  = Расход.Базис - БазисСписания;
	Расход.БазисРегл  = Расход.БазисРегл - БазисСписанияРегл;
	
	// Заполняем партионную идентификацию в расчетной партии
	ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Приход,
		"ВидДвижения, Период, Регистратор, ДокументПоступленияРасходов, СтатьяРасходов, ХозяйственнаяОперация,
		|Подразделение, ПравилоРаспределения, НаправлениеДеятельности,
		|Поставщик, СтавкаНДС, ВидЦенности");
		
	Если ЗначениеЗаполнено(Приход.АналитикаРасходов) Тогда
		РасчетнаяПартия.АналитикаРасходов = Приход.АналитикаРасходов;
	КонецЕсли;
	
	РасчетнаяПартия.ВидДеятельностиНДС = Приход.ВидДеятельностиНДС;
	РасчетнаяПартия.КорВидДеятельностиНДС = Приход.НалогообложениеНДС;
	
	РасчетнаяПартия.КорАналитикаУчетаПартий  = Приход.АналитикаУчетаПартий;
	РасчетнаяПартия.ТипЗаписи 				 = Перечисления.ТипыЗаписейПартий.Партия;
	
	РасчетнаяПартия.РасчетЗавершен = Истина;
	
КонецПроцедуры

// Вспомогательные

Функция СкопироватьКолонки(КолонкиИсточника, КолонкиПриемника)
	
	ПоляИсточника = "";
	
	Для Каждого Колонка Из КолонкиИсточника Цикл
		КолонкиПриемника.Добавить(Колонка.Имя, Колонка.ТипЗначения);
		ПоляИсточника = ПоляИсточника + ?(ЗначениеЗаполнено(ПоляИсточника), ", ", "") + Колонка.Имя;
	КонецЦикла;
	
	Возврат ПоляИсточника;
	
КонецФункции

Функция УзелИндекса(Индекс, КлючиИндекса)
	УзелИндекса = Индекс;
	Счетчик = 0;
	Пока Счетчик <= КлючиИндекса.ВГраница() И КлючиИндекса[Счетчик] <> Неопределено Цикл
		УзелИндекса = УзелИндекса[КлючиИндекса[Счетчик]];
		Если УзелИндекса = Неопределено Тогда
			Возврат Неопределено;
		КонецЕсли;
		Счетчик = Счетчик + 1;
	КонецЦикла;
	Возврат УзелИндекса;
КонецФункции

Функция ДобавитьУзелИндекса(Индекс, КлючиИндекса, Значение)
	ВГраница = КлючиИндекса.ВГраница();
	Если ВГраница < 0 Или КлючиИндекса[0] = Неопределено Тогда
		Возврат Неопределено;
	КонецЕсли;
	УзелИндекса = Индекс;
	Счетчик = 0;
	Пока Счетчик < ВГраница Цикл
		ПодузелИндекса = УзелИндекса[КлючиИндекса[Счетчик]];
		Если ПодузелИндекса = Неопределено Тогда
			ПодузелИндекса = Новый Соответствие;
			УзелИндекса.Вставить(КлючиИндекса[Счетчик], ПодузелИндекса);
		КонецЕсли;
		УзелИндекса = ПодузелИндекса;
		Счетчик = Счетчик + 1;
		Если КлючиИндекса[Счетчик] = Неопределено Тогда
			Возврат Неопределено;
		КонецЕсли;
	КонецЦикла;
	УзелИндекса.Вставить(КлючиИндекса[Счетчик], Значение);
	Возврат Значение;
КонецФункции

Функция АналитикиОбсчетаПартийПрочих(Движение, ПустыеСсылки)
	Результат = Новый Массив;
	Если НЕ Движение.ПрошлыеВыбытияТоваров Тогда
		Результат.Добавить(Движение.Номенклатура);
	КонецЕсли;
	Если НЕ Движение.ПрошлыеВыбытияТоваров И Движение.Номенклатура <> Неопределено Тогда
		Результат.Добавить(ПустаяСсылка(Движение.Номенклатура, ПустыеСсылки));
	КонецЕсли;
	Если НЕ Движение.ПрошлыеВыбытияТоваров Тогда
		Результат.Добавить(Движение.Склад);
	КонецЕсли;
	Если НЕ Движение.ПрошлыеВыбытияТоваров И Движение.Склад <> Неопределено Тогда
		Результат.Добавить(ПустаяСсылка(Движение.Склад, ПустыеСсылки));
	КонецЕсли;
	Результат.Добавить(Движение.Регистратор);
	Если Движение.Регистратор <> Движение.Заказ
	 И ЗначениеЗаполнено(Движение.Заказ) Тогда
		Результат.Добавить(Движение.Заказ);
	КонецЕсли; 
	Если Не ЗначениеЗаполнено(Движение.Регистратор) Тогда
		Результат.Добавить(Движение.Партия);
	КонецЕсли;
	Если НЕ Движение.ПрошлыеВыбытияТоваров И Движение.Регистратор <> Неопределено Тогда
		Результат.Добавить(ПустаяСсылка(Движение.Регистратор, ПустыеСсылки));
	КонецЕсли;
	// Для списания и реклассификации расходов.
	Если Движение.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеклассификацияРасходов
	 ИЛИ Движение.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.СписаниеПрочихРасходов Тогда
		Результат.Добавить(Движение.СтатьяРасходов);
		Результат.Добавить(Движение.Подразделение);
		Результат.Добавить(Движение.АналитикаРасходов);
	КонецЕсли;
	Возврат Результат;
КонецФункции

Функция ПустаяСсылка(Ссылка, КэшСсылок)
	Результат = КэшСсылок[ТипЗнч(Ссылка)];
	Если Результат = Неопределено Тогда
		МенеджерОбъекта = ОбщегоНазначения.МенеджерОбъектаПоСсылке(Ссылка);
		Если МенеджерОбъекта = Неопределено Тогда
			Возврат Неопределено;
		КонецЕсли;
		Результат = МенеджерОбъекта.ПустаяСсылка();
		КэшСсылок.Вставить(ТипЗнч(Ссылка), Результат);
	КонецЕсли;
	Возврат Результат;
КонецФункции

#КонецОбласти

#Область ПроцедурыЭтапа10_1_СписаниеРасходовНаВыбытиеТоваровПрошлыхПериодов

// Выборка данных

Процедура ПолучитьДанныеДляСписанияРасходовНаВыбытиеТоваровРегистрСебестоимость(ПараметрыРасчета)
	
	ДопПараметры = Новый Структура;
	ДопПараметры.Вставить("АналитикаНоменклатурыВВыбытии", ПланыВидовХарактеристик.СтатьиРасходов.ВыбытияТоваровВПрошлыхПериодах.ТипЗначения.СодержитТип(Тип("СправочникСсылка.Номенклатура")));
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьДанныеЭтапаРасчета(
		ПараметрыРасчета,
		ТекстЗапросаДляСписанияРасходовНаВыбытиеТоваровРегистрСебестоимость(),
		,
		ДопПараметры,
		Ложь,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Имя);
	
КонецПроцедуры

Процедура ПолучитьДанныеДляСписанияРасходовНаВыбытиеТоваровРегистрВыручка(ПараметрыРасчета)
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьДанныеЭтапаРасчета(
		ПараметрыРасчета,
		ТекстЗапросаДляСписанияРасходовНаВыбытиеТоваровРегистрВыручка(),
		,
		,
		Ложь,
		Метаданные.РегистрыНакопления.ВыручкаИСебестоимостьПродаж.Имя);
	
КонецПроцедуры

Процедура ПолучитьДанныеДляСписанияРасходовНаВыбытиеТоваровРегистрПрочиеРасходы(ПараметрыРасчета)
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьДанныеЭтапаРасчета(
		ПараметрыРасчета,
		ТекстЗапросаДляСписанияРасходовНаВыбытиеТоваровРегистрПрочиеРасходы(),
		,
		,
		Ложь,
		Метаданные.РегистрыНакопления.ПрочиеРасходы.Имя);
	
КонецПроцедуры

Процедура ПолучитьДанныеДляСписанияРасходовНаВыбытиеТоваровРегистрНоменклатураДоходыРасходы(ПараметрыРасчета)
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьДанныеЭтапаРасчета(
		ПараметрыРасчета,
		ТекстЗапросаДляСписанияРасходовНаВыбытиеТоваровРегистрНоменклатураДоходыРасходы(),
		,
		,
		Ложь,
		Метаданные.РегистрыНакопления.ДвиженияНоменклатураДоходыРасходы.Имя);
	
КонецПроцедуры

// Тексты запросов

// ... общий

Функция ТекстЗапросаДляСписанияРасходовНаВыбытиеТоваровРегистрСебестоимость(ПараметрыРасчета = Неопределено) Экспорт
	
	ТекстЗапроса = ""
		+ ТекстРаспределениеРасходовНаВыбытиеТоваровПрошлыхПериодов() // результаты распределения в ВТ РаспределениеРасходов
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()
		// выборка данных
		+ ТекстОписаниеДанныхДляСписанияРасходовНаВыбытиеТоваровРегистрСебестоимость()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстСписанияРасходовНаВыбытиеТоваровРегистрСебестоимость()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстОприходованиеРасходовНаОстаткиТоваровРегистрСебестоимость()
		+ "";
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаДляСписанияРасходовНаВыбытиеТоваровРегистрВыручка(ПараметрыРасчета = Неопределено) Экспорт
	
	ТекстЗапроса = ""
		// выборка данных
		+ ТекстОписаниеДанныхДляСписанияРасходовНаВыбытиеТоваровРегистрВыручка()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстСписанияРасходовНаВыбытиеТоваровРегистрВыручка() // результаты распределения в ВТ РаспределениеРасходов
		+ "";
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаДляСписанияРасходовНаВыбытиеТоваровРегистрПрочиеРасходы(ПараметрыРасчета = Неопределено) Экспорт
	
	ТекстЗапроса = ""
		// выборка данных
		+ ТекстОписаниеДанныхДляСписанияРасходовНаВыбытиеТоваровРегистрПрочиеРасходы()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстСписанияРасходовНаВыбытиеТоваровРегистрПрочиеРасходы() // результаты распределения в ВТ РаспределениеРасходов
		+ "";
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаДляСписанияРасходовНаВыбытиеТоваровРегистрНоменклатураДоходыРасходы(ПараметрыРасчета = Неопределено) Экспорт
	
	ТекстЗапроса = ""
		// выборка данных
		+ ТекстОписаниеДанныхДляСписанияРасходовНаВыбытиеТоваровРегистрНоменклатураДоходыРасходы()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстСписанияРасходовНаВыбытиеТоваровРегистрНоменклатураДоходыРасходы() // результаты распределения в ВТ РаспределениеРасходов
		+ "";
	
	Возврат ТекстЗапроса;
	
КонецФункции

// ... формирования временные таблиц

Функция ТекстРаспределениеРасходовНаВыбытиеТоваровПрошлыхПериодов() // ВТ РаспределениеРасходов - общая для регистров себестоимости, выручки, прочих расходов
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	ДД.Регистратор,
	|	ДД.Период,
	|	ДД.ТипЗаписи,
	|	ВЫБОР КОГДА ДД.АналитикаРасходов = НЕОПРЕДЕЛЕНО
	|		ТОГДА ДД.ДокументИсточник
	|		ИНАЧЕ ДД.АналитикаРасходов
	|	КОНЕЦ КАК ДокументДвижения,
	|
	|	ДД.АналитикаУчетаНоменклатуры,
	|	Аналитика.Номенклатура,
	|	Аналитика.Характеристика,
	|	Аналитика.Серия,
	|	Аналитика.Назначение,
	|
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС,
	|	ДД.КорАналитикаУчетаПартий,
	|
	|	МИНИМУМ(НАЧАЛОПЕРИОДА(
	|		ВЫБОР КОГДА Реестр.ДатаДокументаИБ ЕСТЬ NULL ИЛИ Реестр.ДатаДокументаИБ < &ДатаПереходаНаПартионныйУчетВерсии22
	|			ТОГДА &ДатаПереходаНаПартионныйУчетВерсии22
	|			ИНАЧЕ Реестр.ДатаДокументаИБ
	|		КОНЕЦ, МЕСЯЦ)) КАК ПериодПоступления,
	|
	|	СУММА(ДД.ДопРасходы) КАК ДопРасходы,
	|	СУММА(ДД.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
	|	СУММА(ДД.ДопРасходыРегл) КАК ДопРасходыРегл,
	|	СУММА(ДД.ДопРасходыУпр) КАК ДопРасходыУпр,
	|	СУММА(ДД.НДСРегл) КАК НДСРегл,
	|	СУММА(ДД.НДСУпр) КАК НДСУпр,
	|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
	|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница
	|
	|ПОМЕСТИТЬ РасходыДляСписанияНаВыбытиеТоваров
	|ИЗ
	|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
	|		ПО Аналитика.Ссылка = ДД.АналитикаУчетаНоменклатуры
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РеестрДокументов КАК Реестр
	|		ПО Реестр.Ссылка = ВЫБОР
	|			КОГДА ДД.АналитикаРасходов <> НЕОПРЕДЕЛЕНО ТОГДА ДД.АналитикаРасходов
	|			КОГДА ДД.ДокументИсточник <> НЕОПРЕДЕЛЕНО ТОГДА ДД.ДокументИсточник
	|			ИНАЧЕ NULL КОНЕЦ
	|		И НЕ Реестр.ДополнительнаяЗапись
	|ГДЕ
	|	&РаспределениеДопРасходовПоВыбывшимТоварам
	|	И ДД.СлужебноеВидДвиженияПриход
	|	И ДД.РазделУчета В (
	|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах),
	|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути),
	|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты))
	|	И ДД.ТипЗаписи В
	|		(ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости), 
	|		 ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам),
	|		 ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода))
	|
	|СГРУППИРОВАТЬ ПО
	|	ДД.Регистратор,
	|	ДД.Период,
	|	ДД.ТипЗаписи,
	|	ВЫБОР КОГДА ДД.АналитикаРасходов = НЕОПРЕДЕЛЕНО
	|		ТОГДА ДД.ДокументИсточник
	|		ИНАЧЕ ДД.АналитикаРасходов
	|	КОНЕЦ,
	|	ДД.АналитикаУчетаНоменклатуры,
	|	Аналитика.Номенклатура,
	|	Аналитика.Характеристика,
	|	Аналитика.Серия,
	|	Аналитика.Назначение,
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС,
	|	ДД.КорАналитикаУчетаПартий
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДД.Организация КАК Организация,
	|	ДД.Партия КАК Партия
	|ПОМЕСТИТЬ ВТОтборПартииДляСписания
	|ИЗ
	|	РасходыДляСписанияНаВыбытиеТоваров КАК ДД
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	ДД.Организация КАК Организация,
	|	ДД.Партия КАК Партия
	|ПОМЕСТИТЬ ВТОтборАналитикиВыбытия
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров.Остатки(
	|			&ГраницаКонецПредыдущегоПериода,
	|			(Организация, Партия) В
	|				(ВЫБРАТЬ
	|					Т.Организация,
	|					Т.Партия
	|				ИЗ
	|					ВТОтборПартииДляСписания КАК Т)) КАК ДД
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.Организация,
	|	ДД.Партия
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК ДД
	|ГДЕ
	|	ИСТИНА В
	|			(ВЫБРАТЬ ПЕРВЫЕ 1
	|				ИСТИНА
	|			ИЗ
	|				ВТОтборПартииДляСписания КАК Т
	|			ГДЕ
	|				ДД.Организация = Т.Организация
	|				И ДД.Партия = Т.Партия)
	|	И ДД.Период < &НачалоПериода
	|	И ДД.Организация В(&МассивОрганизаций)
	|	И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	И ДД.РазделУчета В (
	|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах),
	|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты),
	|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути))
	|	И ДД.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаВПроизводство)
	|	И НЕ ДД.Регистратор ССЫЛКА Документ.ПеремещениеТоваров
	|	И ДД.Активность
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	АналитикаУчетаНоменклатуры,
	|	Организация,
	|	Партия
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры
	|ПОМЕСТИТЬ ВТОтборАналитикиНоменклатурыВыбытия
	|ИЗ
	|	ВТОтборАналитикиВыбытия КАК ДД
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	АналитикаУчетаНоменклатуры
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ
	|	АналитикиТоваров.КлючАналитики КАК КлючАналитики,
	|	АналитикиТоваров.МестоХранения КАК МестоХранения,
	|	АналитикиТоваров.Назначение КАК Назначение,
	|	АналитикиТоваров.Номенклатура КАК Номенклатура,
	|	АналитикиТоваров.Характеристика КАК Характеристика,
	|	АналитикиТоваров.Серия КАК Серия
	|ПОМЕСТИТЬ ВТАналитикиТоваров
	|ИЗ
	|	РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикиТоваров
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтборАналитикиНоменклатурыВыбытия КАК Отбор
	|		ПО АналитикиТоваров.КлючАналитики = Отбор.АналитикаУчетаНоменклатуры
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	КлючАналитики
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ
	|	АналитикиТоваров.КлючАналитики КАК АналитикаУчетаНоменклатуры,
	|	ВЫБОР
	|		КОГДА АналитикиТоваров.МестоХранения ССЫЛКА Справочник.СтруктураПредприятия
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		КОГДА АналитикиТоваров.МестоХранения ССЫЛКА Справочник.Склады
	|			И ВЫРАЗИТЬ(АналитикиТоваров.МестоХранения КАК Справочник.Склады).ЦеховаяКладовая
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		ИНАЧЕ ДД.РазделУчета
	|	КОНЕЦ КАК РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация КАК Организация,
	|	ДД.Партия КАК Партия,
	|	ДД.АналитикаУчетаПартий,
	|
	|	МИНИМУМ(ДД.ПериодПоступления) КАК ПериодПоступления
	|
	|ПОМЕСТИТЬ АналитикиПрошлыхПоступлений
	|ИЗ
	|	РасходыДляСписанияНаВыбытиеТоваров КАК ДД
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
	|		ПО Аналитика.Ссылка = ДД.АналитикаУчетаНоменклатуры
	// При подборе аналитик номенклатуры склад не учитываем - соединяемся с аналитиками по всем складам.
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТАналитикиТоваров КАК АналитикиТоваров
	|		ПО АналитикиТоваров.Номенклатура = Аналитика.Номенклатура
	|		И АналитикиТоваров.Характеристика = Аналитика.Характеристика
	|		И (АналитикиТоваров.Серия = Аналитика.Серия
	|			ИЛИ АналитикиТоваров.Серия = ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка))
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтборАналитикиВыбытия КАК ОтборАналитикиВыбытия
	|	ПО АналитикиТоваров.КлючАналитики = ОтборАналитикиВыбытия.АналитикаУчетаНоменклатуры
	|		И ДД.Организация = ОтборАналитикиВыбытия.Организация
	|		И ДД.Партия = ОтборАналитикиВыбытия.Партия
	|	ЛЕВОЕ СОЕДИНЕНИЕ Константы КАК Константы
	|		ПО ИСТИНА
	|ГДЕ
	|	ВЫБОР
	|		КОГДА НЕ Константы.УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА АналитикиТоваров.Назначение = ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|			ИНАЧЕ ИСТИНА
	|	КОНЕЦ
	|
	|СГРУППИРОВАТЬ ПО
	|	АналитикиТоваров.КлючАналитики,
	|	ВЫБОР
	|		КОГДА АналитикиТоваров.МестоХранения ССЫЛКА Справочник.СтруктураПредприятия
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		КОГДА АналитикиТоваров.МестоХранения ССЫЛКА Справочник.Склады
	|			И ВЫРАЗИТЬ(АналитикиТоваров.МестоХранения КАК Справочник.Склады).ЦеховаяКладовая
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		ИНАЧЕ ДД.РазделУчета
	|	КОНЕЦ,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	АналитикаУчетаНоменклатуры,
	|	Организация,
	|	Партия
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.Организация КАК Организация,
	|	ДД.Партия КАК Партия,
	|	МИНИМУМ(ДД.ПериодПоступления) КАК ПериодПоступления
	|ПОМЕСТИТЬ АналитикиНоменклатурыПрошлыхПоступлений
	|ИЗ
	|	АналитикиПрошлыхПоступлений КАК ДД
	|СГРУППИРОВАТЬ ПО
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.Организация,
	|	ДД.Партия
	|ИНДЕКСИРОВАТЬ ПО
	|	АналитикаУчетаНоменклатуры,
	|	Организация,
	|	Партия,
	|	ПериодПоступления
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС,
	|	ДД.КоличествоОстаток КАК Количество
	|ПОМЕСТИТЬ ОстаткиТоваров
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров.Остатки(
	|		&ГраницаКонецПредыдущегоПериода,
	|		(АналитикаУчетаНоменклатуры, РазделУчета, ВидЗапасов, Организация, Партия, АналитикаУчетаПартий) В
	|			(ВЫБРАТЬ
	|				Т.АналитикаУчетаНоменклатуры, Т.РазделУчета, Т.ВидЗапасов, Т.Организация, Т.Партия, Т.АналитикаУчетаПартий
	|			 ИЗ
	|				АналитикиПрошлыхПоступлений КАК Т)
	|	) КАК ДД
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС,
	|	ДД.КоличествоОстаток
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров.Остатки(
	|			&ГраницаКонецПредыдущегоПериода,
	|			(АналитикаУчетаНоменклатуры, РазделУчета, ВидЗапасов, Организация, Партия, АналитикаУчетаПартий) В
	|				(ВЫБРАТЬ
	|					Т.АналитикаУчетаНоменклатуры,
	|					Т.РазделУчета,
	|					ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка),
	|					Т.Организация,
	|					Т.Партия,
	|					Т.АналитикаУчетаПартий
	|				ИЗ
	|					АналитикиПрошлыхПоступлений КАК Т
	|				ГДЕ
	|					Т.ВидЗапасов <> ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка))) КАК ДД
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	АналитикаУчетаНоменклатуры
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ
	|	ДД.Регистратор,
	|	ДД.МоментВремени,
	|	ДД.НомерСтроки,
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС,
	|	ДД.КорВидДеятельностиНДС,
	|	ДД.АналитикаУчетаПоПартнерам,
	|	ДД.ЗаказКлиента,
	|	ДД.Подразделение,
	|	ДД.КорАналитикаУчетаНоменклатуры,
	|	ДД.АналитикаРасходов,
	|	ДД.СтатьяРасходовСписания,
	|	ДД.КорНаправлениеДеятельности,
	|	ДД.ХозяйственнаяОперация,
	|	ДД.Количество
	|
	|ПОМЕСТИТЬ ПрошлыеВыбытияТоваровПредварительная
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК ДД
	|ГДЕ
	|	ИСТИНА В (
	|		ВЫБРАТЬ ПЕРВЫЕ 1
	|			ИСТИНА
	|		ИЗ
	|			АналитикиНоменклатурыПрошлыхПоступлений КАК Т
	|		ГДЕ
	|			ДД.АналитикаУчетаНоменклатуры = Т.АналитикаУчетаНоменклатуры
	|			И ДД.Организация = Т.Организация
	|			И ДД.Партия = Т.Партия
	|			И ДД.Период МЕЖДУ Т.ПериодПоступления И &КонецПредыдущегоПериода)
	|	И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	И ДД.Организация В (&МассивОрганизаций)
	|	И ДД.РазделУчета В (
	|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах),
	|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути),
	|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты))
	|	И ДД.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаВПроизводство)
	|	И НЕ ДД.Регистратор ССЫЛКА Документ.ПеремещениеТоваров
	|	И ДД.Активность
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	АналитикаУчетаНоменклатуры,
	|	Организация,
	|	Партия
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ
	|	ДД.Регистратор,
	|	ДД.МоментВремени,
	|	МАКСИМУМ(ДД.НомерСтроки) КАК НомерСтроки,
	|
	|	ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Аналитика.Номенклатура,
	|	Аналитика.Характеристика,
	|	Аналитика.Серия,
	|	Аналитика.Назначение,
	|
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС,
	|
	|	ДД.КорВидДеятельностиНДС,
	|	ДД.АналитикаУчетаПоПартнерам,
	|	ДД.ЗаказКлиента,
	|	ВЫБОР
	|		КОГДА ДД.Подразделение <> ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)
	|			ТОГДА ДД.Подразделение
	|		КОГДА ДД.КорАналитикаУчетаНоменклатуры = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)
	|		КОГДА ДД.КорАналитикаУчетаНоменклатуры.МестоХранения ССЫЛКА Справочник.СтруктураПредприятия
	|			ТОГДА ДД.КорАналитикаУчетаНоменклатуры.МестоХранения
	|		КОГДА ДД.КорАналитикаУчетаНоменклатуры.МестоХранения ССЫЛКА Справочник.Склады
	|			ТОГДА ВЫРАЗИТЬ(ДД.КорАналитикаУчетаНоменклатуры.МестоХранения КАК Справочник.Склады).Подразделение
	|		КОГДА ДД.КорАналитикаУчетаНоменклатуры.МестоХранения ССЫЛКА Справочник.Партнеры
	|			ТОГДА ВЫРАЗИТЬ(ДД.АналитикаУчетаНоменклатуры.МестоХранения КАК Справочник.Склады).Подразделение
	|		КОГДА ДД.КорАналитикаУчетаНоменклатуры.МестоХранения ССЫЛКА Справочник.ДоговорыКонтрагентов
	|			ТОГДА ВЫРАЗИТЬ(ДД.АналитикаУчетаНоменклатуры.МестоХранения КАК Справочник.ДоговорыКонтрагентов).Подразделение
	|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)
	|	КОНЕЦ КАК Подразделение,
	|	ДД.АналитикаРасходов,
	|	ДД.СтатьяРасходовСписания,
	|	ДД.КорНаправлениеДеятельности,
	|	ДД.ХозяйственнаяОперация,
	|
	|	СУММА(ДД.Количество) КАК Количество
	|
	|ПОМЕСТИТЬ ПрошлыеВыбытияТоваров
	|ИЗ
	|	ПрошлыеВыбытияТоваровПредварительная КАК ДД
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ АналитикиПрошлыхПоступлений КАК Аналитики
	|		ПО Аналитики.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
	|		И Аналитики.Организация = ДД.Организация
	|		И Аналитики.Партия = ДД.Партия
	|		И Аналитики.РазделУчета = ДД.РазделУчета
	|		И (Аналитики.ВидЗапасов = ДД.ВидЗапасов
	|			ИЛИ ДД.ВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка))
	|		И Аналитики.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
	|		ПО Аналитика.Ссылка = ДД.АналитикаУчетаНоменклатуры
	|СГРУППИРОВАТЬ ПО
	|	ДД.Регистратор,
	|	ДД.МоментВремени,
	|
	|	ДД.АналитикаУчетаНоменклатуры,
	|	Аналитика.Номенклатура,
	|	Аналитика.Характеристика,
	|	Аналитика.Серия,
	|	Аналитика.Назначение,
	|
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС,
	|
	|	ДД.КорВидДеятельностиНДС,
	|	ДД.АналитикаУчетаПоПартнерам,
	|	ДД.ЗаказКлиента,
	|	ВЫБОР
	|		КОГДА ДД.Подразделение <> ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)
	|			ТОГДА ДД.Подразделение
	|		КОГДА ДД.КорАналитикаУчетаНоменклатуры = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)
	|		КОГДА ДД.КорАналитикаУчетаНоменклатуры.МестоХранения ССЫЛКА Справочник.СтруктураПредприятия
	|			ТОГДА ДД.КорАналитикаУчетаНоменклатуры.МестоХранения
	|		КОГДА ДД.КорАналитикаУчетаНоменклатуры.МестоХранения ССЫЛКА Справочник.Склады
	|			ТОГДА ВЫРАЗИТЬ(ДД.КорАналитикаУчетаНоменклатуры.МестоХранения КАК Справочник.Склады).Подразделение
	|		КОГДА ДД.КорАналитикаУчетаНоменклатуры.МестоХранения ССЫЛКА Справочник.Партнеры
	|			ТОГДА ВЫРАЗИТЬ(ДД.АналитикаУчетаНоменклатуры.МестоХранения КАК Справочник.Склады).Подразделение
	|		КОГДА ДД.КорАналитикаУчетаНоменклатуры.МестоХранения ССЫЛКА Справочник.ДоговорыКонтрагентов
	|			ТОГДА ВЫРАЗИТЬ(ДД.АналитикаУчетаНоменклатуры.МестоХранения КАК Справочник.ДоговорыКонтрагентов).Подразделение
	|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)
	|	КОНЕЦ,
	|	ДД.АналитикаРасходов,
	|	ДД.СтатьяРасходовСписания,
	|	ДД.КорНаправлениеДеятельности,
	|	ДД.ХозяйственнаяОперация
	|
	|ИМЕЮЩИЕ
	|	СУММА(ДД.Количество) > 0
	|ИНДЕКСИРОВАТЬ ПО
	|	Регистратор,
	|	АналитикаУчетаНоменклатуры
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ
	|	Выручка.Регистратор,
	|	Выручка.МоментВремени,
	|	Выручка.НомерСтроки,
	|
	|	Выручка.АналитикаУчетаНоменклатуры,
	|	Выручка.РазделУчета,
	|	Выручка.ВидЗапасов,
	|	Выручка.Партия,
	|	Выручка.АналитикаУчетаПартий,
	|	Выручка.АналитикаУчетаПоПартнерам,
	|
	|	Выручка.Менеджер,
	|	Выручка.Склад,
	|	Выручка.Соглашение,
	|	Выручка.Договор,
	|	Выручка.ТипЗапасов,
	|	Выручка.ИсточникГФУНоменклатуры,
	|	Выручка.ИсточникГФУРасчетов,
	|
	|	Выручка.Количество
	|
	|ПОМЕСТИТЬ ДанныеПоВыручке
	|ИЗ
	|	РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Выручка
	|ГДЕ
	|	ИСТИНА В (ВЫБРАТЬ ПЕРВЫЕ 1
	|			ИСТИНА
	|		ИЗ
	|			ПрошлыеВыбытияТоваров КАК Т
	|		ГДЕ
	|			Т.Регистратор = Выручка.Регистратор
	|			И Т.АналитикаУчетаНоменклатуры = Выручка.АналитикаУчетаНоменклатуры)
	|ИНДЕКСИРОВАТЬ ПО
	|	Регистратор,
	|	АналитикаУчетаНоменклатуры
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ
	|	ЛОЖЬ КАК ЭтоОстатки,
	|	ВЫБОР КОГДА Выручка.Регистратор ЕСТЬ NULL
	|		ТОГДА ЛОЖЬ
	|		ИНАЧЕ ИСТИНА
	|	КОНЕЦ КАК ЭтоПродажа,
	|
	|	ДД.Регистратор,
	|	ЕСТЬNULL(Выручка.МоментВремени, ДД.МоментВремени) КАК МоментВремени,
	|	ЕСТЬNULL(Выручка.НомерСтроки, ДД.НомерСтроки) КАК НомерСтроки,
	|
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.Номенклатура,
	|	ДД.Характеристика,
	|	ДД.Серия,
	|	ДД.Назначение,
	|
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
	|	ДД.КорВидДеятельностиНДС КАК ВидДеятельностиНДС,
	|
	|	ДД.АналитикаУчетаПоПартнерам,
	|	ДД.ЗаказКлиента,
	|	ДД.Подразделение,
	|	ВЫБОР КОГДА Выручка.Регистратор ЕСТЬ NULL И СтатьиРасходов.Ссылка ЕСТЬ NULL
	|		ТОГДА ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ВыбытияТоваровВПрошлыхПериодах)
	|		ИНАЧЕ ДД.СтатьяРасходовСписания
	|	КОНЕЦ КАК СтатьяРасходовСписания,
	|	ВЫБОР КОГДА Выручка.Регистратор ЕСТЬ NULL И СтатьиРасходов.Ссылка ЕСТЬ NULL
	|		ТОГДА
	|			ВЫБОР КОГДА &АналитикаНоменклатурыВВыбытии
	|				ТОГДА ДД.Номенклатура
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ ДД.АналитикаРасходов
	|	КОНЕЦ КАК АналитикаРасходов,
	|	ДД.КорНаправлениеДеятельности,
	|	ДД.ХозяйственнаяОперация,
	|
	|	ЕСТЬNULL(Выручка.Менеджер, НЕОПРЕДЕЛЕНО) КАК Менеджер,
	|	ЕСТЬNULL(Выручка.Склад, НЕОПРЕДЕЛЕНО) КАК Склад,
	|	ЕСТЬNULL(Выручка.Соглашение, НЕОПРЕДЕЛЕНО) КАК Соглашение,
	|	ЕСТЬNULL(Выручка.Договор, НЕОПРЕДЕЛЕНО) КАК Договор,
	|	ЕСТЬNULL(Выручка.ТипЗапасов, НЕОПРЕДЕЛЕНО) КАК ТипЗапасов,
	|	ЕСТЬNULL(Выручка.ИсточникГФУНоменклатуры, НЕОПРЕДЕЛЕНО) КАК ИсточникГФУНоменклатуры,
	|	ЕСТЬNULL(Выручка.ИсточникГФУРасчетов, НЕОПРЕДЕЛЕНО) КАК ИсточникГФУРасчетов,
	|
	|	СУММА(ЕСТЬNULL(Выручка.Количество, ДД.Количество)) КАК Количество
	|
	|ПОМЕСТИТЬ ПрошлыеВыбытияТоваровДетальные
	|ИЗ
	|	ПрошлыеВыбытияТоваров КАК ДД
	|	ЛЕВОЕ СОЕДИНЕНИЕ ДанныеПоВыручке КАК Выручка
	|		ПО ДД.Регистратор = Выручка.Регистратор
	|		И ДД.АналитикаУчетаНоменклатуры = Выручка.АналитикаУчетаНоменклатуры
	|		И ДД.РазделУчета = Выручка.РазделУчета
	|		И ДД.ВидЗапасов = Выручка.ВидЗапасов
	|		И ДД.Партия = Выручка.Партия
	|		И ДД.АналитикаУчетаПартий = Выручка.АналитикаУчетаПартий
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТОтборАналитикаПоПартнерам КАК Отбор
	|		ПО Выручка.АналитикаУчетаПоПартнерам = Отбор.КлючАналитики
	|	ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиРасходов КАК СтатьиРасходов
	|		ПО ДД.СтатьяРасходовСписания = СтатьиРасходов.Ссылка
	|ГДЕ
	|	Выручка.Регистратор ЕСТЬ NULL
	|	ИЛИ НЕ Отбор.КлючАналитики ЕСТЬ NULL
	|
	|СГРУППИРОВАТЬ ПО
	|	ВЫБОР КОГДА Выручка.Регистратор ЕСТЬ NULL
	|		ТОГДА ЛОЖЬ
	|		ИНАЧЕ ИСТИНА
	|	КОНЕЦ,
	|	ДД.Регистратор,
	|	ЕСТЬNULL(Выручка.МоментВремени, ДД.МоментВремени),
	|	ЕСТЬNULL(Выручка.НомерСтроки, ДД.НомерСтроки),
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.Номенклатура,
	|	ДД.Характеристика,
	|	ДД.Серия,
	|	ДД.Назначение,
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.КорВидДеятельностиНДС,
	|	ДД.АналитикаУчетаПоПартнерам,
	|	ДД.ЗаказКлиента,
	|	ДД.Подразделение,
	|	ВЫБОР КОГДА Выручка.Регистратор ЕСТЬ NULL И СтатьиРасходов.Ссылка ЕСТЬ NULL
	|		ТОГДА ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ВыбытияТоваровВПрошлыхПериодах)
	|		ИНАЧЕ ДД.СтатьяРасходовСписания
	|	КОНЕЦ,
	|	ВЫБОР КОГДА Выручка.Регистратор ЕСТЬ NULL И СтатьиРасходов.Ссылка ЕСТЬ NULL
	|		ТОГДА
	|			ВЫБОР КОГДА &АналитикаНоменклатурыВВыбытии
	|				ТОГДА ДД.Номенклатура
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ ДД.АналитикаРасходов
	|	КОНЕЦ,
	|	ДД.КорНаправлениеДеятельности,
	|	ДД.ХозяйственнаяОперация,
	|	ЕСТЬNULL(Выручка.Менеджер, НЕОПРЕДЕЛЕНО),
	|	ЕСТЬNULL(Выручка.Склад, НЕОПРЕДЕЛЕНО),
	|	ЕСТЬNULL(Выручка.Соглашение, НЕОПРЕДЕЛЕНО),
	|	ЕСТЬNULL(Выручка.Договор, НЕОПРЕДЕЛЕНО),
	|	ЕСТЬNULL(Выручка.ТипЗапасов, НЕОПРЕДЕЛЕНО),
	|	ЕСТЬNULL(Выручка.ИсточникГФУНоменклатуры, НЕОПРЕДЕЛЕНО),
	|	ЕСТЬNULL(Выручка.ИсточникГФУРасчетов, НЕОПРЕДЕЛЕНО)
	|ИМЕЮЩИЕ
	|	СУММА(ЕСТЬNULL(Выручка.Количество, ДД.Количество)) > 0
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ИСТИНА КАК ЭтоОстатки,
	|	ЛОЖЬ   КАК ЭтоПродажа,
	|
	|	НЕОПРЕДЕЛЕНО КАК Регистратор,
	|	МоментыВремениОстатков.МоментВремени КАК МоментВремени,
	|	0 КАК НомерСтроки,
	|
	|	ДД.АналитикаУчетаНоменклатуры,
	|	Аналитика.Номенклатура,
	|	Аналитика.Характеристика,
	|	Аналитика.Серия,
	|	Аналитика.Назначение,
	|
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС,
	|
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПоПартнерам,
	|	НЕОПРЕДЕЛЕНО КАК ЗаказКлиента,
	|	НЕОПРЕДЕЛЕНО КАК Подразделение,
	|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовСписания,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
	|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности,
	|	НЕОПРЕДЕЛЕНО КАК ХозяйственнаяОперация,
	|
	|	НЕОПРЕДЕЛЕНО КАК Менеджер,
	|	НЕОПРЕДЕЛЕНО КАК Склад,
	|	НЕОПРЕДЕЛЕНО КАК Соглашение,
	|	НЕОПРЕДЕЛЕНО КАК Договор,
	|	НЕОПРЕДЕЛЕНО КАК ТипЗапасов,
	|	НЕОПРЕДЕЛЕНО КАК ИсточникГФУНоменклатуры,
	|	НЕОПРЕДЕЛЕНО КАК ИсточникГФУРасчетов,
	|
	|	ДД.Количество
	|
	|ИЗ
	|	ОстаткиТоваров КАК ДД
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
	|		ПО Аналитика.Ссылка = ДД.АналитикаУчетаНоменклатуры
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТДокументыРасчетаСебестоимости КАК МоментыВремениОстатков
	|		ПО ДД.Организация = МоментыВремениОстатков.Организация
	|ГДЕ
	|	ДД.Количество > 0
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ
	|	ДД.Регистратор,
	|	ДД.Период,
	|	ДД.ТипЗаписи,
	|	ДД.ДокументДвижения,
	|
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.Номенклатура,
	|	ДД.Характеристика,
	|	ДД.Серия,
	|	ДД.Назначение,
	|
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС,
	|	ДД.КорАналитикаУчетаПартий,
	|
	|	ДД.ДопРасходы,
	|	ДД.ДопРасходыБезНДС,
	|	ДД.ДопРасходыРегл,
	|	ДД.ДопРасходыУпр,
	|	ДД.НДСРегл,
	|	ДД.НДСУпр,
	|	ДД.ПостояннаяРазница,
	|	ДД.ВременнаяРазница,
	|	
	|	СУММА(ПрошлыеВыбытия.Количество) КАК Количество
	|
	|ПОМЕСТИТЬ БазаДляРаспределенияРасходов
	|ИЗ
	|	РасходыДляСписанияНаВыбытиеТоваров КАК ДД
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПрошлыеВыбытияТоваровДетальные КАК ПрошлыеВыбытия
	|		ПО ПрошлыеВыбытия.Номенклатура = ДД.Номенклатура
	|		И ПрошлыеВыбытия.Характеристика = ДД.Характеристика
	|		И (ПрошлыеВыбытия.Серия = ДД.Серия
	|			ИЛИ ПрошлыеВыбытия.Серия = ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка))
	|		И (ПрошлыеВыбытия.ВидЗапасов = ДД.ВидЗапасов
	|			ИЛИ ПрошлыеВыбытия.ВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка))
	|		И ПрошлыеВыбытия.Организация = ДД.Организация
	|		И ПрошлыеВыбытия.Партия = ДД.Партия
	|		И ПрошлыеВыбытия.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
	|		И НЕ (ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам)
	|				И ПрошлыеВыбытия.ЭтоОстатки)
	|
	|СГРУППИРОВАТЬ ПО
	|	ДД.Регистратор,
	|	ДД.Период,
	|	ДД.ТипЗаписи,
	|	ДД.ДокументДвижения,
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.Номенклатура,
	|	ДД.Характеристика,
	|	ДД.Серия,
	|	ДД.Назначение,
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС,
	|	ДД.КорАналитикаУчетаПартий,
	|	ДД.ДопРасходы,
	|	ДД.ДопРасходыБезНДС,
	|	ДД.ДопРасходыРегл,
	|	ДД.ДопРасходыУпр,
	|	ДД.НДСРегл,
	|	ДД.НДСУпр,
	|	ДД.ПостояннаяРазница,
	|	ДД.ВременнаяРазница
	|
	|ИМЕЮЩИЕ
	|	СУММА(ПрошлыеВыбытия.Количество) > 0
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ
	|	ПрошлыеВыбытия.ЭтоПродажа,
	|	ПрошлыеВыбытия.ЭтоОстатки,
	|
	|	ПрошлыеВыбытия.Количество,
	|	ПрошлыеВыбытия.МоментВремени,
	|	ПрошлыеВыбытия.НомерСтроки,
	|
	|	ДД.Регистратор,
	|	ДД.Период,
	|	ДД.ТипЗаписи,
	|	ПрошлыеВыбытия.Регистратор КАК ДокументДвижения,
	|	ДД.ДокументДвижения КАК ДокументДвиженияБазы,
	|
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС,
	|	ДД.КорАналитикаУчетаПартий,
	|
	|	ВЫБОР КОГДА ПрошлыеВыбытия.ЭтоОстатки
	|		ТОГДА ПрошлыеВыбытия.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
	|	КОНЕЦ КАК КорАналитикаУчетаНоменклатуры,
	|	ВЫБОР КОГДА ПрошлыеВыбытия.ЭтоОстатки
	|		ТОГДА ПрошлыеВыбытия.ВидЗапасов
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|	КОНЕЦ КАК КорВидЗапасов,
	|	ВЫБОР КОГДА ПрошлыеВыбытия.ЭтоОстатки
	|		ТОГДА ПрошлыеВыбытия.АналитикаФинансовогоУчета
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ КАК КорАналитикаФинансовогоУчета,
	|	ВЫБОР КОГДА ПрошлыеВыбытия.ЭтоОстатки
	|		ТОГДА ПрошлыеВыбытия.ВидДеятельностиНДС
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
	|	КОНЕЦ КАК КорВидДеятельностиНДС,
	|	ВЫБОР КОГДА ПрошлыеВыбытия.ЭтоОстатки
	|		ТОГДА ПрошлыеВыбытия.РазделУчета
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|	КОНЕЦ КАК КорРазделУчета,
	|
	|	ПрошлыеВыбытия.АналитикаУчетаПоПартнерам,
	|	ПрошлыеВыбытия.ЗаказКлиента,
	|	ПрошлыеВыбытия.Подразделение,
	|	ПрошлыеВыбытия.АналитикаРасходов,
	|	ПрошлыеВыбытия.СтатьяРасходовСписания,
	|	ПрошлыеВыбытия.КорНаправлениеДеятельности,
	|	ПрошлыеВыбытия.ХозяйственнаяОперация,
	|
	|	ПрошлыеВыбытия.Менеджер,
	|	ПрошлыеВыбытия.Склад,
	|	ПрошлыеВыбытия.Соглашение,
	|	ПрошлыеВыбытия.Договор,
	|	ПрошлыеВыбытия.ТипЗапасов,
	|	ПрошлыеВыбытия.ИсточникГФУНоменклатуры,
	|	ПрошлыеВыбытия.ИсточникГФУРасчетов,
	|
	|	ВЫРАЗИТЬ(ДД.ДопРасходы * ПрошлыеВыбытия.Количество / ДД.Количество КАК ЧИСЛО (15,2)) КАК ДопРасходы,
	|	ВЫРАЗИТЬ(ДД.ДопРасходыБезНДС * ПрошлыеВыбытия.Количество / ДД.Количество КАК ЧИСЛО (15,2)) КАК ДопРасходыБезНДС,
	|	ВЫРАЗИТЬ(ДД.ДопРасходыРегл * ПрошлыеВыбытия.Количество / ДД.Количество КАК ЧИСЛО (15,2)) КАК ДопРасходыРегл,
	|	ВЫРАЗИТЬ(ДД.ДопРасходыУпр * ПрошлыеВыбытия.Количество / ДД.Количество КАК ЧИСЛО (15,2)) КАК ДопРасходыУпр,
	|	ВЫРАЗИТЬ(ДД.НДСРегл * ПрошлыеВыбытия.Количество / ДД.Количество КАК ЧИСЛО (15,2)) КАК НДСРегл,
	|	ВЫРАЗИТЬ(ДД.НДСУпр * ПрошлыеВыбытия.Количество / ДД.Количество КАК ЧИСЛО (15,2)) КАК НДСУпр,
	|	ВЫРАЗИТЬ(ДД.ПостояннаяРазница * ПрошлыеВыбытия.Количество / ДД.Количество КАК ЧИСЛО (15,2)) КАК ПостояннаяРазница,
	|	ВЫРАЗИТЬ(ДД.ВременнаяРазница * ПрошлыеВыбытия.Количество / ДД.Количество КАК ЧИСЛО (15,2)) КАК ВременнаяРазница
	|
	|ПОМЕСТИТЬ РаспределениеРасходовСПогрешностямиОкругления
	|ИЗ
	|	БазаДляРаспределенияРасходов КАК ДД
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПрошлыеВыбытияТоваровДетальные КАК ПрошлыеВыбытия
	|		ПО ПрошлыеВыбытия.Номенклатура = ДД.Номенклатура
	|		И ПрошлыеВыбытия.Характеристика = ДД.Характеристика
	|		И (ПрошлыеВыбытия.Серия = ДД.Серия
	|			ИЛИ ПрошлыеВыбытия.Серия = ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка))
	|		И (ПрошлыеВыбытия.ВидЗапасов = ДД.ВидЗапасов
	|			ИЛИ ПрошлыеВыбытия.ВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка))
	|		И ПрошлыеВыбытия.Организация = ДД.Организация
	|		И ПрошлыеВыбытия.Партия = ДД.Партия
	|		И ПрошлыеВыбытия.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
	|		И НЕ (ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам)
	|				И ПрошлыеВыбытия.ЭтоОстатки)
	|ГДЕ
	|	(ВЫРАЗИТЬ(ДД.ДопРасходы * ПрошлыеВыбытия.Количество / ДД.Количество КАК ЧИСЛО (15,2)) <> 0
	|		ИЛИ ВЫРАЗИТЬ(ДД.ДопРасходыБезНДС * ПрошлыеВыбытия.Количество / ДД.Количество КАК ЧИСЛО (15,2)) <> 0
	|		ИЛИ ВЫРАЗИТЬ(ДД.ДопРасходыРегл * ПрошлыеВыбытия.Количество / ДД.Количество КАК ЧИСЛО (15,2)) <> 0
	|		ИЛИ ВЫРАЗИТЬ(ДД.ДопРасходыУпр * ПрошлыеВыбытия.Количество / ДД.Количество КАК ЧИСЛО (15,2)) <> 0
	|		ИЛИ ВЫРАЗИТЬ(ДД.НДСРегл * ПрошлыеВыбытия.Количество / ДД.Количество КАК ЧИСЛО (15,2)) <> 0
	|		ИЛИ ВЫРАЗИТЬ(ДД.НДСУпр * ПрошлыеВыбытия.Количество / ДД.Количество КАК ЧИСЛО (15,2)) <> 0
	|		ИЛИ ВЫРАЗИТЬ(ДД.ПостояннаяРазница * ПрошлыеВыбытия.Количество / ДД.Количество КАК ЧИСЛО (15,2)) <> 0
	|		ИЛИ ВЫРАЗИТЬ(ДД.ВременнаяРазница * ПрошлыеВыбытия.Количество / ДД.Количество КАК ЧИСЛО (15,2)) <> 0)
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ
	|	ДД.Регистратор,
	|	ДД.Период,
	|	ДД.ТипЗаписи,
	|	ДД.Количество,
	|
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС,
	|	ДД.КорАналитикаУчетаПартий,
	|	ДД.ДокументДвиженияБазы,
	|
	|	СУММА(ДД.ДопРасходы) КАК ДопРасходы,
	|	СУММА(ДД.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
	|	СУММА(ДД.ДопРасходыРегл) КАК ДопРасходыРегл,
	|	СУММА(ДД.ДопРасходыУпр) КАК ДопРасходыУпр,
	|	СУММА(ДД.НДСРегл) КАК НДСРегл,
	|	СУММА(ДД.НДСУпр) КАК НДСУпр,
	|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
	|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница
	|ПОМЕСТИТЬ ЗависшиеКопейки
	|ИЗ
	|(ВЫБРАТЬ
	|	ДД.Регистратор,
	|	ДД.Период,
	|	ДД.ТипЗаписи,
	|	МАКСИМУМ(ДД.Количество) КАК Количество,
	|
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС,
	|	ДД.КорАналитикаУчетаПартий,
	|	ДД.ДокументДвиженияБазы,
	|
	|	База.ДопРасходы - СУММА(ДД.ДопРасходы) КАК ДопРасходы,
	|	База.ДопРасходыБезНДС - СУММА(ДД.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
	|	База.ДопРасходыРегл - СУММА(ДД.ДопРасходыРегл) КАК ДопРасходыРегл,
	|	База.ДопРасходыУпр - СУММА(ДД.ДопРасходыУпр) КАК ДопРасходыУпр,
	|	База.НДСРегл - СУММА(ДД.НДСРегл) КАК НДСРегл,
	|	База.НДСУпр - СУММА(ДД.НДСУпр) КАК НДСУпр,
	|	База.ПостояннаяРазница - СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
	|	База.ВременнаяРазница - СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница
	|
	|ИЗ
	|	РаспределениеРасходовСПогрешностямиОкругления КАК ДД
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ БазаДляРаспределенияРасходов КАК База
	|	ПО ДД.Регистратор = База.Регистратор
	|		И ДД.Период = База.Период
	|		И ДД.ТипЗаписи = База.ТипЗаписи
	|		И ДД.АналитикаУчетаНоменклатуры = База.АналитикаУчетаНоменклатуры
	|		И ДД.РазделУчета = База.РазделУчета
	|		И ДД.ВидЗапасов = База.ВидЗапасов
	|		И ДД.Организация = База.Организация
	|		И ДД.Партия = База.Партия
	|		И ДД.АналитикаУчетаПартий = База.АналитикаУчетаПартий
	|		И ДД.АналитикаФинансовогоУчета = База.АналитикаФинансовогоУчета
	|		И ДД.ВидДеятельностиНДС = База.ВидДеятельностиНДС
	|		И ДД.КорАналитикаУчетаПартий = База.КорАналитикаУчетаПартий
	|		И ДД.ДокументДвиженияБазы = База.ДокументДвижения
	|
	|СГРУППИРОВАТЬ ПО
	|	ДД.Регистратор,
	|	ДД.Период,
	|	ДД.ТипЗаписи,
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС,
	|	ДД.КорАналитикаУчетаПартий,
	|	ДД.ДокументДвиженияБазы,
	|	База.ДопРасходы,
	|	База.ДопРасходыБезНДС,
	|	База.ДопРасходыРегл,
	|	База.ДопРасходыУпр,
	|	База.НДСРегл,
	|	База.НДСУпр,
	|	База.ПостояннаяРазница,
	|	База.ВременнаяРазница
	|) КАК ДД
	|
	|СГРУППИРОВАТЬ ПО
	|	ДД.Регистратор,
	|	ДД.Период,
	|	ДД.ТипЗаписи,
	|	ДД.Количество,
	|
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС,
	|	ДД.КорАналитикаУчетаПартий,
	|	ДД.ДокументДвиженияБазы
	|ИМЕЮЩИЕ
	|		СУММА(ДД.ДопРасходы) <> 0
	|	ИЛИ СУММА(ДД.ДопРасходыБезНДС) <> 0
	|	ИЛИ СУММА(ДД.ДопРасходыРегл) <> 0
	|	ИЛИ СУММА(ДД.ДопРасходыУпр) <> 0
	|	ИЛИ СУММА(ДД.НДСРегл) <> 0
	|	ИЛИ СУММА(ДД.НДСУпр) <> 0
	|	ИЛИ СУММА(ДД.ПостояннаяРазница) <> 0
	|	ИЛИ СУММА(ДД.ВременнаяРазница) <> 0
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДД.Регистратор,
	|	ДД.Период,
	|	ДД.ТипЗаписи,
	|	ДД.Количество,
	|	МИНИМУМ(НаправленияВыбытия.ДокументДвижения) КАК ДокументДвижения,
	|
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС,
	|	ДД.КорАналитикаУчетаПартий,
	|	ДД.ДокументДвиженияБазы,
	|
	|	ДД.ДопРасходы,
	|	ДД.ДопРасходыБезНДС,
	|	ДД.ДопРасходыРегл,
	|	ДД.ДопРасходыУпр,
	|	ДД.НДСРегл,
	|	ДД.НДСУпр,
	|	ДД.ПостояннаяРазница,
	|	ДД.ВременнаяРазница
	|ПОМЕСТИТЬ ДокументДвиженияДляСписанияЗависшихКопеек
	|ИЗ
	|	ЗависшиеКопейки КАК ДД
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РаспределениеРасходовСПогрешностямиОкругления КАК НаправленияВыбытия
	|		ПО НаправленияВыбытия.Регистратор = ДД.Регистратор
	|		И НаправленияВыбытия.Период = ДД.Период
	|		И НаправленияВыбытия.ТипЗаписи = ДД.ТипЗаписи
	|		И НаправленияВыбытия.Количество = ДД.Количество
	|		И НаправленияВыбытия.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
	|		И НаправленияВыбытия.РазделУчета = ДД.РазделУчета
	|		И НаправленияВыбытия.ВидЗапасов = ДД.ВидЗапасов
	|		И НаправленияВыбытия.Организация = ДД.Организация
	|		И НаправленияВыбытия.Партия = ДД.Партия
	|		И НаправленияВыбытия.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
	|		И НаправленияВыбытия.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
	|		И НаправленияВыбытия.ВидДеятельностиНДС = ДД.ВидДеятельностиНДС
	|		И НаправленияВыбытия.КорАналитикаУчетаПартий = ДД.КорАналитикаУчетаПартий
	|		И НаправленияВыбытия.ДокументДвиженияБазы = ДД.ДокументДвиженияБазы
	|СГРУППИРОВАТЬ ПО
	|	ДД.Регистратор,
	|	ДД.Период,
	|	ДД.ТипЗаписи,
	|	ДД.Количество,
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС,
	|	ДД.КорАналитикаУчетаПартий,
	|	ДД.ДокументДвиженияБазы,
	|	ДД.ДопРасходы,
	|	ДД.ДопРасходыБезНДС,
	|	ДД.ДопРасходыРегл,
	|	ДД.ДопРасходыУпр,
	|	ДД.НДСРегл,
	|	ДД.НДСУпр,
	|	ДД.ПостояннаяРазница,
	|	ДД.ВременнаяРазница
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ
	|	НаправленияВыбытия.ЭтоПродажа,
	|	НаправленияВыбытия.ЭтоОстатки,
	|
	|	ДД.Количество,
	|	НаправленияВыбытия.МоментВремени,
	|	НаправленияВыбытия.НомерСтроки,
	|
	|	ДД.Регистратор,
	|	ДД.Период,
	|	ДД.ТипЗаписи,
	|	ДД.ДокументДвижения,
	|
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС,
	|	ДД.КорАналитикаУчетаПартий,
	|	ДД.ДокументДвиженияБазы,
	|
	|	НаправленияВыбытия.КорАналитикаУчетаНоменклатуры,
	|	НаправленияВыбытия.КорВидЗапасов,
	|	НаправленияВыбытия.КорАналитикаФинансовогоУчета,
	|	НаправленияВыбытия.КорВидДеятельностиНДС,
	|	НаправленияВыбытия.КорРазделУчета,
	|
	|	НаправленияВыбытия.АналитикаУчетаПоПартнерам,
	|	НаправленияВыбытия.ЗаказКлиента,
	|	НаправленияВыбытия.Подразделение,
	|	НаправленияВыбытия.АналитикаРасходов,
	|	НаправленияВыбытия.СтатьяРасходовСписания,
	|	НаправленияВыбытия.КорНаправлениеДеятельности,
	|	НаправленияВыбытия.ХозяйственнаяОперация,
	|
	|	НаправленияВыбытия.Менеджер,
	|	НаправленияВыбытия.Склад,
	|	НаправленияВыбытия.Соглашение,
	|	НаправленияВыбытия.Договор,
	|	НаправленияВыбытия.ТипЗапасов,
	|	НаправленияВыбытия.ИсточникГФУНоменклатуры,
	|	НаправленияВыбытия.ИсточникГФУРасчетов,
	|
	|	ДД.ДопРасходы,
	|	ДД.ДопРасходыБезНДС,
	|	ДД.ДопРасходыРегл,
	|	ДД.ДопРасходыУпр,
	|	ДД.НДСРегл,
	|	ДД.НДСУпр,
	|	ДД.ПостояннаяРазница,
	|	ДД.ВременнаяРазница
	|
	|ПОМЕСТИТЬ НаправленияВыбытияДляСписанияЗависшихКопеек
	|ИЗ
	|	ДокументДвиженияДляСписанияЗависшихКопеек КАК ДД
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РаспределениеРасходовСПогрешностямиОкругления КАК НаправленияВыбытия
	|		ПО НаправленияВыбытия.Регистратор = ДД.Регистратор
	|		И НаправленияВыбытия.Период = ДД.Период
	|		И НаправленияВыбытия.ТипЗаписи = ДД.ТипЗаписи
	|		И НаправленияВыбытия.Количество = ДД.Количество
	|		И НаправленияВыбытия.ДокументДвижения = ДД.ДокументДвижения
	|		И НаправленияВыбытия.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
	|		И НаправленияВыбытия.РазделУчета = ДД.РазделУчета
	|		И НаправленияВыбытия.ВидЗапасов = ДД.ВидЗапасов
	|		И НаправленияВыбытия.Организация = ДД.Организация
	|		И НаправленияВыбытия.Партия = ДД.Партия
	|		И НаправленияВыбытия.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
	|		И НаправленияВыбытия.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
	|		И НаправленияВыбытия.ВидДеятельностиНДС = ДД.ВидДеятельностиНДС
	|		И НаправленияВыбытия.КорАналитикаУчетаПартий = ДД.КорАналитикаУчетаПартий
	|		И НаправленияВыбытия.ДокументДвиженияБазы = ДД.ДокументДвиженияБазы
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ
	|	ДД.ЭтоПродажа,
	|	ДД.ЭтоОстатки,
	|
	|	ДД.Регистратор,
	|	ДД.Период,
	|	ДД.ТипЗаписи,
	|	ДД.ДокументДвижения,
	|
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС,
	|	ДД.КорАналитикаУчетаПартий,
	|
	|	ДД.КорАналитикаУчетаНоменклатуры,
	|	ДД.КорВидЗапасов,
	|	ДД.КорАналитикаФинансовогоУчета,
	|	ДД.КорВидДеятельностиНДС,
	|	ДД.КорРазделУчета,
	|
	|	ДД.АналитикаУчетаПоПартнерам,
	|	ДД.ЗаказКлиента,
	|	ДД.Подразделение,
	|	ДД.АналитикаРасходов,
	|	ДД.СтатьяРасходовСписания,
	|	ДД.КорНаправлениеДеятельности,
	|	ДД.ХозяйственнаяОперация,
	|
	|	ДД.Менеджер,
	|	ДД.Склад,
	|	ДД.Соглашение,
	|	ДД.Договор,
	|	ДД.ТипЗапасов,
	|	ДД.ИсточникГФУНоменклатуры,
	|	ДД.ИсточникГФУРасчетов,
	|
	|	СУММА(ДД.ДопРасходы) КАК ДопРасходы,
	|	СУММА(ДД.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
	|	СУММА(ДД.ДопРасходыРегл) КАК ДопРасходыРегл,
	|	СУММА(ДД.ДопРасходыУпр) КАК ДопРасходыУпр,
	|	СУММА(ДД.НДСРегл) КАК НДСРегл,
	|	СУММА(ДД.НДСУпр) КАК НДСУпр,
	|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
	|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница
	|
	|ПОМЕСТИТЬ РаспределениеРасходов
	|ИЗ
	|	(ВЫБРАТЬ
	|		ДД.ЭтоПродажа,
	|		ДД.ЭтоОстатки,
	|
	|		ДД.Регистратор,
	|		ДД.Период,
	|		ДД.ТипЗаписи,
	|		ДД.ДокументДвижения,
	|
	|		ДД.АналитикаУчетаНоменклатуры,
	|		ДД.РазделУчета,
	|		ДД.ВидЗапасов,
	|		ДД.Организация,
	|		ДД.Партия,
	|		ДД.АналитикаУчетаПартий,
	|		ДД.АналитикаФинансовогоУчета,
	|		ДД.ВидДеятельностиНДС,
	|		ДД.КорАналитикаУчетаПартий,
	|		
	|		ДД.КорАналитикаУчетаНоменклатуры,
	|		ДД.КорВидЗапасов,
	|		ДД.КорАналитикаФинансовогоУчета,
	|		ДД.КорВидДеятельностиНДС,
	|		ДД.КорРазделУчета,
	|		
	|		ДД.АналитикаУчетаПоПартнерам,
	|		ДД.ЗаказКлиента,
	|		ДД.Подразделение,
	|		ДД.АналитикаРасходов,
	|		ДД.СтатьяРасходовСписания,
	|		ДД.КорНаправлениеДеятельности,
	|		ДД.ХозяйственнаяОперация,
	|
	|		ДД.Менеджер,
	|		ДД.Склад,
	|		ДД.Соглашение,
	|		ДД.Договор,
	|		ДД.ТипЗапасов,
	|		ДД.ИсточникГФУНоменклатуры,
	|		ДД.ИсточникГФУРасчетов,
	|
	|		ДД.ДопРасходы,
	|		ДД.ДопРасходыБезНДС,
	|		ДД.ДопРасходыРегл,
	|		ДД.ДопРасходыУпр,
	|		ДД.НДСРегл,
	|		ДД.НДСУпр,
	|		ДД.ПостояннаяРазница,
	|		ДД.ВременнаяРазница
	|	ИЗ
	|		РаспределениеРасходовСПогрешностямиОкругления КАК ДД
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ
	|		ДД.ЭтоПродажа,
	|		ДД.ЭтоОстатки,
	|
	|		ДД.Регистратор,
	|		ДД.Период,
	|		ДД.ТипЗаписи,
	|		ДД.ДокументДвижения,
	|
	|		ДД.АналитикаУчетаНоменклатуры,
	|		ДД.РазделУчета,
	|		ДД.ВидЗапасов,
	|		ДД.Организация,
	|		ДД.Партия,
	|		ДД.АналитикаУчетаПартий,
	|		ДД.АналитикаФинансовогоУчета,
	|		ДД.ВидДеятельностиНДС,
	|		ДД.КорАналитикаУчетаПартий,
	|		
	|		ДД.КорАналитикаУчетаНоменклатуры,
	|		ДД.КорВидЗапасов,
	|		ДД.КорАналитикаФинансовогоУчета,
	|		ДД.КорВидДеятельностиНДС,
	|		ДД.КорРазделУчета,
	|		
	|		ДД.АналитикаУчетаПоПартнерам,
	|		ДД.ЗаказКлиента,
	|		ДД.Подразделение,
	|		ДД.АналитикаРасходов,
	|		ДД.СтатьяРасходовСписания,
	|		ДД.КорНаправлениеДеятельности,
	|		ДД.ХозяйственнаяОперация,
	|
	|		ДД.Менеджер,
	|		ДД.Склад,
	|		ДД.Соглашение,
	|		ДД.Договор,
	|		ДД.ТипЗапасов,
	|		ДД.ИсточникГФУНоменклатуры,
	|		ДД.ИсточникГФУРасчетов,
	|
	|		ДД.ДопРасходы,
	|		ДД.ДопРасходыБезНДС,
	|		ДД.ДопРасходыРегл,
	|		ДД.ДопРасходыУпр,
	|		ДД.НДСРегл,
	|		ДД.НДСУпр,
	|		ДД.ПостояннаяРазница,
	|		ДД.ВременнаяРазница
	|
	|	ИЗ
	|		НаправленияВыбытияДляСписанияЗависшихКопеек КАК ДД
	|	) КАК ДД
	|
	|ГДЕ
	|	НЕ (ДД.ЭтоОстатки
	|		И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода)
	|		И ДД.АналитикаУчетаНоменклатуры = ДД.КорАналитикаУчетаНоменклатуры
	|		И ДД.АналитикаФинансовогоУчета = ДД.КорАналитикаФинансовогоУчета
	|		И ДД.ВидДеятельностиНДС = ДД.КорВидДеятельностиНДС
	|		И ДД.РазделУчета = ДД.КорРазделУчета)
	|
	|СГРУППИРОВАТЬ ПО
	|	ДД.ЭтоПродажа,
	|	ДД.ЭтоОстатки,
	|	ДД.Регистратор,
	|	ДД.Период,
	|	ДД.ТипЗаписи,
	|	ДД.ДокументДвижения,
	|	ДД.АналитикаУчетаНоменклатуры,
	|	ДД.РазделУчета,
	|	ДД.ВидЗапасов,
	|	ДД.Организация,
	|	ДД.Партия,
	|	ДД.АналитикаУчетаПартий,
	|	ДД.АналитикаФинансовогоУчета,
	|	ДД.ВидДеятельностиНДС,
	|	ДД.КорАналитикаУчетаПартий,
	|	ДД.КорАналитикаУчетаНоменклатуры,
	|	ДД.КорВидЗапасов,
	|	ДД.КорАналитикаФинансовогоУчета,
	|	ДД.КорВидДеятельностиНДС,
	|	ДД.КорРазделУчета,
	|	ДД.АналитикаУчетаПоПартнерам,
	|	ДД.ЗаказКлиента,
	|	ДД.Подразделение,
	|	ДД.АналитикаРасходов,
	|	ДД.СтатьяРасходовСписания,
	|	ДД.КорНаправлениеДеятельности,
	|	ДД.ХозяйственнаяОперация,
	|	ДД.Менеджер,
	|	ДД.Склад,
	|	ДД.Соглашение,
	|	ДД.Договор,
	|	ДД.ТипЗапасов,
	|	ДД.ИсточникГФУНоменклатуры,
	|	ДД.ИсточникГФУРасчетов
	|ИМЕЮЩИЕ
	|		СУММА(ДД.ДопРасходы) <> 0
	|	ИЛИ СУММА(ДД.ДопРасходыБезНДС) <> 0
	|	ИЛИ СУММА(ДД.ДопРасходыРегл) <> 0
	|	ИЛИ СУММА(ДД.ДопРасходыУпр) <> 0
	|	ИЛИ СУММА(ДД.НДСРегл) <> 0
	|	ИЛИ СУММА(ДД.НДСУпр) <> 0
	|	ИЛИ СУММА(ДД.ПостояннаяРазница) <> 0
	|	ИЛИ СУММА(ДД.ВременнаяРазница) <> 0
	|";
	
	Возврат ТекстЗапроса;
	
КонецФункции

// ... описания данных

Функция ТекстОписаниеДанныхДляСписанияРасходовНаВыбытиеТоваровРегистрСебестоимость()
	Возврат "
		|ВЫБРАТЬ ПЕРВЫЕ 0
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(80)) КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|
		|	ДД.Регистратор,
		|	ДД.Период,
		|	ДД.ТипЗаписи,
		|	ДД.ДокументДвижения,
		|
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.КорАналитикаУчетаПартий,
		|
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.ХозяйственнаяОперация,
		|
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС,
		|	ДД.КорРазделУчета,
		|	ДД.КорНаправлениеДеятельности,
		|
		|	0 КАК ДопРасходы,
		|	0 КАК ДопРасходыБезНДС,
		|	0 КАК ДопРасходыРегл,
		|	0 КАК ДопРасходыУпр,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница
		|//ВоВременнуюТаблицу
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК ДД
		|";
КонецФункции

Функция ТекстОписаниеДанныхДляСписанияРасходовНаВыбытиеТоваровРегистрВыручка()
	Возврат "
		|ВЫБРАТЬ ПЕРВЫЕ 0
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(80)) КАК ЗапросИсточник,
		|
		|	ДД.Регистратор,
		|	ДД.Период,
		|	ДД.ДокументДвижения,
		|
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.ХозяйственнаяОперация,
		|
		|	ДД.Менеджер,
		|	ДД.Склад,
		|	ДД.Соглашение,
		|	ДД.Договор,
		|	ДД.ТипЗапасов,
		|	ДД.ИсточникГФУНоменклатуры,
		|	ДД.ИсточникГФУРасчетов,
		|
		|	0 КАК ДопРасходы,
		|	0 КАК ДопРасходыБезНДС,
		|	0 КАК ДопРасходыРегл,
		|	0 КАК ДопРасходыУпр,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница
		|//ВоВременнуюТаблицу
		|ИЗ
		|	РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК ДД
		|";
КонецФункции

Функция ТекстОписаниеДанныхДляСписанияРасходовНаВыбытиеТоваровРегистрПрочиеРасходы()
	Возврат "
		|ВЫБРАТЬ ПЕРВЫЕ 0
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(80)) КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|
		|	ДД.Регистратор,
		|	ДД.Период,
		|	ДД.Регистратор КАК ДокументДвижения,
		|
		|	ДД.Организация,
		|	ДД.Подразделение,
		|	ДД.НаправлениеДеятельности,
		|	ДД.СтатьяРасходов,
		|	ДД.АналитикаРасходов,
		
		|	ДД.ХозяйственнаяОперация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|
		|	0 КАК Сумма,
		|	0 КАК СуммаБезНДС,
		|	0 КАК СуммаРегл,
		|	0 КАК СуммаУпр,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница
		|//ВоВременнуюТаблицу
		|ИЗ
		|	РегистрНакопления.ПрочиеРасходы КАК ДД
		|";
КонецФункции

Функция ТекстОписаниеДанныхДляСписанияРасходовНаВыбытиеТоваровРегистрНоменклатураДоходыРасходы()
	Возврат "
		|ВЫБРАТЬ ПЕРВЫЕ 0
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(80)) КАК ЗапросИсточник,
		|
		|	ДД.Регистратор,
		|	ДД.Период,
		|	ДД.ДокументДвижения,
		|
		|	ДД.ХозяйственнаяОперация,
		|	ДД.Организация,
		|	ДД.Подразделение,
		|	ДД.НаправлениеДеятельностиНоменклатуры,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.Склад,
		|	ДД.ТипЗапасов,
		|	ДД.ВидЗапасов,
		|	ДД.СтатьяДоходовРасходов,
		|	ДД.АналитикаРасходов,
		|	ДД.НаправлениеДеятельностиСтатьи,
		|	ДД.ИсточникГФУНоменклатуры,
		|
		|	0 КАК ДопРасходы,
		|	0 КАК ДопРасходыБезНДС,
		|	0 КАК ДопРасходыРегл,
		|	0 КАК ДопРасходыУпр,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница
		|//ВоВременнуюТаблицу
		|ИЗ
		|	РегистрНакопления.ДвиженияНоменклатураДоходыРасходы КАК ДД
		|";
КонецФункции

// ... выборки данных

Функция ТекстСписанияРасходовНаВыбытиеТоваровРегистрСебестоимость()
	Возврат "
		|ВЫБРАТЬ
		|	""ТекстСписанияРасходовНаВыбытиеТоваровРегистрСебестоимость"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|
		|	ДД.Регистратор,
		|	ДД.Период,
		|	ДД.ТипЗаписи,
		|	ДД.Регистратор КАК ДокументДвижения,
		|
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.КорАналитикаУчетаПартий,
		|
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.ХозяйственнаяОперация,
		|
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС,
		|	ДД.КорРазделУчета,
		|	ДД.КорНаправлениеДеятельности,
		|
		|	СУММА(ДД.ДопРасходы) КАК ДопРасходы,
		|	СУММА(ДД.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		|	СУММА(ДД.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	СУММА(ДД.ДопРасходыУпр) КАК ДопРасходыУпр,
		|	СУММА(ДД.НДСРегл) КАК НДСРегл,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница
		|ИЗ
		|	РаспределениеРасходов КАК ДД
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Регистратор,
		|	ДД.Период,
		|	ДД.ТипЗаписи,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.ХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.КорРазделУчета
		|";
КонецФункции

Функция ТекстОприходованиеРасходовНаОстаткиТоваровРегистрСебестоимость()
	Возврат "
		|ВЫБРАТЬ
		|	""ТекстОприходованиеРасходовНаОстаткиТоваровРегистрСебестоимость"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|
		|	ДД.Регистратор,
		|	ДД.Период,
		|	ДД.ТипЗаписи,
		|	ДД.Регистратор КАК ДокументДвижения,
		|
		|	ДД.КорАналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета КАК РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.КорАналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС КАК ВидДеятельностиНДС,
		|	ДД.КорАналитикаУчетаПартий,
		|
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.ХозяйственнаяОперация,
		|
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК КорВидЗапасов,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорВидДеятельностиНДС,
		|	НЕОПРЕДЕЛЕНО КАК КорРазделУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности,
		|
		|	СУММА(ДД.ДопРасходы) КАК ДопРасходы,
		|	СУММА(ДД.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		|	СУММА(ДД.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	СУММА(ДД.ДопРасходыУпр) КАК ДопРасходыУпр,
		|	СУММА(ДД.НДСРегл) КАК НДСРегл,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница
		|ИЗ
		|	РаспределениеРасходов КАК ДД
		|ГДЕ
		|	ДД.ЭтоОстатки
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Регистратор,
		|	ДД.Период,
		|	ДД.ТипЗаписи,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.КорРазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.ХозяйственнаяОперация,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорВидДеятельностиНДС
		|";
КонецФункции

Функция ТекстСписанияРасходовНаВыбытиеТоваровРегистрВыручка()
	Возврат "
		|ВЫБРАТЬ
		|	""ТекстСписанияРасходовНаВыбытиеТоваровРегистрВыручка"" КАК ЗапросИсточник,
		|
		|	ДД.Регистратор,
		|	ДД.Период,
		|	ДД.ДокументДвижения,
		|
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.ХозяйственнаяОперация,
		|
		|	ДД.Менеджер,
		|	ДД.Склад,
		|	ДД.Соглашение,
		|	ДД.Договор,
		|	ДД.ТипЗапасов,
		|	ДД.ИсточникГФУНоменклатуры,
		|	ДД.ИсточникГФУРасчетов,
		|
		|	СУММА(ДД.ДопРасходы) КАК ДопРасходы,
		|	СУММА(ДД.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		|	СУММА(ДД.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	СУММА(ДД.ДопРасходыУпр) КАК ДопРасходыУпр,
		|	СУММА(ДД.НДСРегл) КАК НДСРегл,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница
		|ИЗ
		|	РаспределениеРасходов КАК ДД
		|ГДЕ
		|	ДД.ЭтоПродажа
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Регистратор,
		|	ДД.Период,
		|	ДД.ДокументДвижения,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
		|	ДД.ВидДеятельностиНДС,
		|	ДД.АналитикаУчетаПоПартнерам,
		|	ДД.ЗаказКлиента,
		|	ДД.Подразделение,
		|	ДД.ХозяйственнаяОперация,
		|	ДД.Менеджер,
		|	ДД.Склад,
		|	ДД.Соглашение,
		|	ДД.Договор,
		|	ДД.ТипЗапасов,
		|	ДД.ИсточникГФУНоменклатуры,
		|	ДД.ИсточникГФУРасчетов
		|";
КонецФункции

Функция ТекстСписанияРасходовНаВыбытиеТоваровРегистрПрочиеРасходы()
	// Условия для заполнения ресурсов регистра аналогичны условиям в функции ТекстЗапросаТаблицаВтПрочиеРасходы() модуля менеджера регистра ПрочиеРасходы
	Возврат "
		|ВЫБРАТЬ
		|	""ТекстСписанияРасходовНаВыбытиеТоваровРегистрПрочиеРасходы"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|
		|	ДД.Регистратор,
		|	ДД.Период,
		|	ДД.Регистратор КАК ДокументДвижения,
		|
		|	ДД.Организация,
		|	ДД.Подразделение,
		|	ЕСТЬNULL(СпрНаправленияДеятельности.Ссылка,
		|		ЕСТЬNULL(СпрНазначения.НаправлениеДеятельности,
		|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))) КАК НаправлениеДеятельности,
		|	ДД.СтатьяРасходовСписания КАК СтатьяРасходов,
		|	ДД.АналитикаРасходов,
		|
		|	ДД.ХозяйственнаяОперация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|
		|	СУММА(ВЫБОР
		|		КОГДА СтатьиРасходов.ВариантРаспределенияРасходовУпр = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			ТОГДА 0
		|		ИНАЧЕ ДД.ДопРасходы КОНЕЦ) КАК Сумма,
		|	СУММА(ВЫБОР
		|		КОГДА СтатьиРасходов.ВариантРаспределенияРасходовУпр <> ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаПроизводственныеЗатраты)
		|			ТОГДА 0
		|		ИНАЧЕ ДД.ДопРасходыБезНДС КОНЕЦ) КАК СуммаБезНДС,
		|	СУММА(ВЫБОР 
		|		КОГДА НЕ &ИспользоватьУчетПрочихДоходовРасходовРегл ТОГДА 0
		|		КОГДА СтатьиРасходов.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			ТОГДА 0
		|		КОГДА СтатьиРасходов.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаПрочиеАктивы)
		|			ТОГДА 0
		|		КОГДА СтатьиРасходов.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
		|				И НЕ &ИспользуетсяУправлениеВНА_2_4
		|			ТОГДА 0
		|		ИНАЧЕ ДД.ДопРасходыРегл КОНЕЦ) КАК СуммаРегл,
		|	СУММА(ВЫБОР
		|		КОГДА СтатьиРасходов.ВариантРаспределенияРасходовУпр = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|		 ИЛИ НЕ &УправленческийУчетОрганизаций
		|			ТОГДА 0
		|		ИНАЧЕ ДД.ДопРасходыУпр КОНЕЦ) КАК СуммаУпр,
		|	СУММА(ВЫБОР
		|		КОГДА НЕ &ИспользоватьУчетПрочихДоходовРасходовРегл ТОГДА 0
		|		КОГДА СтатьиРасходов.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			ТОГДА 0
		|		КОГДА СтатьиРасходов.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаПрочиеАктивы)
		|			ТОГДА 0
		|		КОГДА СтатьиРасходов.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
		|				И НЕ &ИспользуетсяУправлениеВНА_2_4
		|			ТОГДА 0
		|		КОГДА НЕ СтатьиРасходов.ПринятиеКналоговомуУчету И (ДД.ДопРасходыРегл <> 0 ИЛИ ДД.ВременнаяРазница <> 0)
		|			ТОГДА ДД.ДопРасходыРегл - ДД.ВременнаяРазница
		|		ИНАЧЕ ДД.ПостояннаяРазница КОНЕЦ) КАК ПостояннаяРазница,
		|	СУММА(ВЫБОР
		|		КОГДА НЕ &ИспользоватьУчетПрочихДоходовРасходовРегл ТОГДА 0
		|		КОГДА СтатьиРасходов.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаСебестоимостьТоваров)
		|			ТОГДА 0
		|		ИНАЧЕ ДД.ВременнаяРазница КОНЕЦ) КАК ВременнаяРазница
		|ИЗ
		|	РаспределениеРасходов КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиРасходов КАК СтатьиРасходов
		|		ПО ДД.СтатьяРасходовСписания = СтатьиРасходов.Ссылка
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК СпрАналитикаНоменклатуры
		|		ПО ДД.АналитикаУчетаНоменклатуры = СпрАналитикаНоменклатуры.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Назначения КАК СпрНазначения
		|		ПО СпрАналитикаНоменклатуры.Назначение = СпрНазначения.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.НаправленияДеятельности КАК СпрНаправленияДеятельности
		|		ПО ДД.КорНаправлениеДеятельности = СпрНаправленияДеятельности.Ссылка
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Регистратор,
		|	ДД.Период,
		|	ДД.Организация,
		|	ДД.Подразделение,
		|	ЕСТЬNULL(СпрНаправленияДеятельности.Ссылка,
		|		ЕСТЬNULL(СпрНазначения.НаправлениеДеятельности,
		|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))),
		|	ДД.СтатьяРасходовСписания,
		|	ДД.АналитикаРасходов,
		|	ДД.ХозяйственнаяОперация,
		|	ДД.АналитикаУчетаНоменклатуры
		|";
КонецФункции

Функция ТекстСписанияРасходовНаВыбытиеТоваровРегистрНоменклатураДоходыРасходы()
	Возврат "
		|ВЫБРАТЬ
		|	""ТекстСписанияРасходовНаВыбытиеТоваровРегистрНоменклатураДоходыРасходы"" КАК ЗапросИсточник,
		|
		|	ДД.Регистратор,
		|	ДД.Период,
		|	ДД.Регистратор КАК ДокументДвижения,
		|
		|	ДД.ХозяйственнаяОперация,
		|	ДД.Организация,
		|	ДД.Подразделение,
		|	ЕСТЬNULL(СпрНазначения.НаправлениеДеятельности,
		|		ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельностиНоменклатуры,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	СпрАналитикаНоменклатуры.МестоХранения КАК Склад,
		|	ДД.ТипЗапасов,
		|	ДД.ВидЗапасов,
		|	ДД.СтатьяРасходовСписания КАК СтатьяДоходовРасходов,
		|	ДД.АналитикаРасходов,
		|	ДД.КорНаправлениеДеятельности КАК НаправлениеДеятельностиСтатьи,
		|	ДД.ИсточникГФУНоменклатуры,
		|
		|	СУММА(ДД.ДопРасходы) КАК ДопРасходы,
		|	СУММА(ДД.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		|	СУММА(ДД.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	СУММА(ДД.ДопРасходыУпр) КАК ДопРасходыУпр,
		|	СУММА(ДД.ПостояннаяРазница) КАК ПостояннаяРазница,
		|	СУММА(ДД.ВременнаяРазница) КАК ВременнаяРазница
		|
		|ИЗ
		|	РаспределениеРасходов КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиРасходов КАК СтатьиРасходов
		|		ПО ДД.СтатьяРасходовСписания = СтатьиРасходов.Ссылка
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК СпрАналитикаНоменклатуры
		|		ПО ДД.АналитикаУчетаНоменклатуры = СпрАналитикаНоменклатуры.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Назначения КАК СпрНазначения
		|		ПО СпрАналитикаНоменклатуры.Назначение = СпрНазначения.Ссылка
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Регистратор,
		|	ДД.Период,
		|	ДД.ХозяйственнаяОперация,
		|	ДД.Организация,
		|	ДД.Подразделение,
		|	ЕСТЬNULL(СпрНазначения.НаправлениеДеятельности,
		|		ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|	ДД.АналитикаУчетаНоменклатуры,
		|	СпрАналитикаНоменклатуры.МестоХранения,
		|	ДД.ТипЗапасов,
		|	ДД.ВидЗапасов,
		|	ДД.СтатьяРасходовСписания,
		|	ДД.АналитикаРасходов,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.ИсточникГФУНоменклатуры
		|";
КонецФункции

#КонецОбласти


#Область ПроцедурыЭтапов_Общие


#КонецОбласти

// Служебная, этап 4.5
Процедура СформироватьДвиженияРаспределениеРБП(ПараметрыРасчета, ДанныеДвижения, Суммы)
	
	ИмяРегистра = Метаданные.РегистрыНакопления.ПрочиеРасходы.Имя;
	
	КопируемыеПоля = "Период, Организация, Подразделение, СтатьяРасходов, АналитикаРасходов, НаправлениеДеятельности";

	// Добавим движение расход и заполним его основные свойства
	ЗаписьРасход = РасчетСебестоимостиКорректировкаСтоимости.ДобавитьЗаписьВТаблицуДвижений(ПараметрыРасчета, ИмяРегистра, ДанныеДвижения, КопируемыеПоля);
	
	// Заполним дополнительные свойства движения расход
	ЗаписьРасход.ВидДвижения = ВидДвиженияНакопления.Расход;
	ЗаполнитьЗначенияСвойств(ЗаписьРасход, Суммы, "Сумма, СуммаУпр, СуммаРегл, ПостояннаяРазница, ВременнаяРазница");
	ЗаписьРасход.КорПодразделение 	  = ДанныеДвижения.ПодразделениеПолучатель;
	ЗаписьРасход.КорСтатьяРасходов    = ДанныеДвижения.СтатьяРасходовПолучатель;
	ЗаписьРасход.КорАналитикаРасходов = ДанныеДвижения.АналитикаРасходовПолучатель;
	
	// Добавим движение приход и заполним его основные свойства
	ЗаписьПриход = РасчетСебестоимостиКорректировкаСтоимости.ДобавитьЗаписьВТаблицуДвижений(ПараметрыРасчета, ИмяРегистра, ДанныеДвижения, КопируемыеПоля);
	
	// Заполним дополнительные свойства движения приход
	ЗаписьПриход.ВидДвижения 	   = ВидДвиженияНакопления.Приход;
	ЗаписьПриход.Подразделение 	   = ДанныеДвижения.ПодразделениеПолучатель;
	ЗаписьПриход.СтатьяРасходов    = ДанныеДвижения.СтатьяРасходовПолучатель;
	ЗаписьПриход.АналитикаРасходов = ДанныеДвижения.АналитикаРасходовПолучатель;
	ЗаписьПриход.КорПодразделение 	  = ДанныеДвижения.Подразделение;
	ЗаписьПриход.КорСтатьяРасходов    = ДанныеДвижения.СтатьяРасходов;
	ЗаписьПриход.КорАналитикаРасходов = ДанныеДвижения.АналитикаРасходов;
	
	ЗаполнитьЗначенияСвойств(ЗаписьПриход, Суммы, "Сумма, СуммаУпр, СуммаРегл, ПостояннаяРазница, ВременнаяРазница");
	
КонецПроцедуры

#Область ПроцедурыЭтапов_Контекстные

// Используется для всех вызовов заполнения расчетной партии.
//
Процедура ЗаполнитьРасчетнуюПартию(ПараметрыРасчета, Контекст, РасчетнаяПартия, Расход, Приход, ПартияЗаполнена) Экспорт
	
	Если Контекст = "ДопРасходы_ЗаказыПоставщикам" Тогда
		// Этап 10
		ЗаполнитьРасчетнуюПартиюЗаказВПриходе(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход);
		ПартияЗаполнена = Истина;
	ИначеЕсли Контекст = "ДопРасходы_ПартииПрочихРасходов" Тогда
		// Этап 10
		ЗаполнитьРасчетнуюПартиюПрочихРасходов(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход);
		ПартияЗаполнена = Истина;
	ИначеЕсли Контекст = "ДопРасходы_ПриходПартийРасходов" Тогда
		// Этап 10
		ЗаполнитьРасчетнуюПартиюПриходПартииРасходов(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход);
		ПартияЗаполнена = Истина;
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область Тестирование

Процедура ДополнитьЭтапыСРаспределениемПартий(СписокЭтапов) Экспорт
	
	// Этап РаспределениеДопРасходовМеждуПартиямиИТоварами пока реализован на нестандартной механике.
	
КонецПроцедуры

Процедура ДополнитьЭтапыСТрансляциейПартий(СписокЭтапов) Экспорт
	
	СписокЭтапов.Добавить("СписаниеРасходовНаВыбытиеТоваровПрошлыхПериодов"); // пока возможна отладка только 1го шага из 4х
	
КонецПроцедуры

Процедура ТекстЗапросаДляРасчетаЭтапа(ИмяЭтапа, ПараметрыРасчета, ТекстЗапроса) Экспорт
	
	Если ИмяЭтапа = "СписаниеРасходовНаВыбытиеТоваровПрошлыхПериодов" Тогда
		ТекстЗапроса = ТекстЗапросаДляСписанияРасходовНаВыбытиеТоваровРегистрСебестоимость();	
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#КонецОбласти
